<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form DragMode="TRUE" DropMode="TRUE" Height="4544" Id="PS1503001C" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="건축협조사항착공전MR" Top="8" Ver="1.0" Width="776" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_list_c">
				<Contents>
					<colinfo id="MANDT" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="CFNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="CFDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="URL" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond_c">
				<Contents>
					<colinfo id="LIFNR" size="256" summ="default" type="STRING"/>
					<colinfo id="PERNO" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<record>
						<GUBUN></GUBUN>
						<LIFNR></LIFNR>
						<PERNO></PERNO>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_temp">
				<Contents>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="INT"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Static Color="user5" Font="굴림,10,Bold" Height="20" Id="Static0" Left="28" TabOrder="1" Text="search&#32;user" Top="8" VAlign="Middle" Width="176"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_send" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="2" Text="이미지수정" Top="11" Transparent="TRUE" UserData="001" Width="136"></Button>
		<Image Border="RaisedEdge" Height="429" Id="Image1" Left="8" TabOrder="2" Top="32" Width="737"></Image>
		<FileDialog Bottom="40" Filter="All(*.*)|*.*|jpg&#32;File(*.jpg)|*.jpg|jpeg&#32;File(*.jpeg)|*.jpeg|bmp&#32;File(*.bmp)|*.jpeg|gif&#32;File(*.gif)|*.gif|png&#32;File(*.png)|*.png|pdf&#32;File(*.pdf)|*.pdf|" Height="24" Id="fileDialog" Left="968" MultiSelect="TRUE" Right="992" TabOrder="32" Top="16" Width="24"></FileDialog>
		<File Bottom="72" Height="24" Id="f_tmp" Left="968" Right="992" TabOrder="33" Top="48" Width="24"></File>
		<FileDialog Bottom="40" Filter="All(*.*)|*.*|jpg&#32;File(*.jpg)|*.jpg|jpeg&#32;File(*.jpeg)|*.jpeg|bmp&#32;File(*.bmp)|*.jpeg|gif&#32;File(*.gif)|*.gif|png&#32;File(*.png)|*.png|pdf&#32;File(*.pdf)|*.pdf|" Height="24" Id="saveDialog" Left="1016" Right="1040" TabOrder="31" Top="16" Type="Save" Width="24"></FileDialog>
		<CyHttpFile Height="24" Id="httpFile" Left="1016" Top="48" Width="24"></CyHttpFile>
		<Image Border="SunkenEdge" Height="429" Id="Image2" Left="9" TabOrder="5" Top="488" Width="737"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button0" ImageID="btn_user_10" Left="610" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="4" Text="이미지수정" Top="467" Transparent="TRUE" UserData="002" Width="136"></Button>
		<Image Border="SunkenEdge" Height="429" Id="Image3" Left="9" TabOrder="7" Top="944" Width="737"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button1" ImageID="btn_user_10" Left="610" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="6" Text="이미지수정" Top="923" Transparent="TRUE" UserData="003" Width="136"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button2" ImageID="btn_user_10" Left="610" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="8" Text="이미지수정" Top="1379" Transparent="TRUE" UserData="004" Width="136"></Button>
		<Image Border="SunkenEdge" Height="429" Id="Image4" Left="9" TabOrder="9" Top="1400" Width="737"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button3" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="10" Text="이미지수정" Top="1835" Transparent="TRUE" UserData="005" Width="136"></Button>
		<Image Border="SunkenEdge" Height="429" Id="Image5" Left="8" TabOrder="11" Top="1856" Width="737"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button4" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="12" Text="이미지수정" Top="2291" Transparent="TRUE" UserData="006" Width="136"></Button>
		<Image Border="SunkenEdge" Height="429" Id="Image6" Left="8" TabOrder="13" Top="2312" Width="737"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button5" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="14" Text="이미지수정" Top="2747" Transparent="TRUE" UserData="007" Width="136"></Button>
		<Image Border="SunkenEdge" Height="429" Id="Image7" Left="8" TabOrder="15" Top="2768" Width="737"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button6" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="16" Text="이미지수정" Top="3203" Transparent="TRUE" UserData="008" Width="136"></Button>
		<Image Border="SunkenEdge" Height="429" Id="Image8" Left="8" TabOrder="17" Top="3224" Width="737"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button7" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="18" Text="이미지수정" Top="3659" Transparent="TRUE" UserData="009" Width="136"></Button>
		<Image Border="SunkenEdge" Height="429" Id="Image9" Left="8" TabOrder="19" Top="3680" Width="737"></Image>
		<Image Border="SunkenEdge" Height="429" Id="Image10" Left="8" TabOrder="21" Top="4136" Width="737"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button8" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="20" Text="이미지수정" Top="4115" Transparent="TRUE" UserData="010" Width="136"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button9" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="22" Text="이미지수정" Top="4571" Transparent="TRUE" UserData="011" Width="136"></Button>
		<Image Border="SunkenEdge" Height="429" Id="Image11" Left="8" TabOrder="23" Top="4592" Width="737"></Image>
		<Image Border="SunkenEdge" Height="429" Id="Image12" Left="8" TabOrder="25" Top="5048" Width="737"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button10" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="24" Text="이미지수정" Top="5027" Transparent="TRUE" UserData="012" Width="136"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button11" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="26" Text="이미지수정" Top="5483" Transparent="TRUE" UserData="013" Width="136"></Button>
		<Image Border="SunkenEdge" Height="429" Id="Image13" Left="8" TabOrder="27" Top="5504" Width="737"></Image>
		<Image Border="SunkenEdge" Height="429" Id="Image14" Left="8" TabOrder="29" Top="5960" Width="737"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button12" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="28" Text="이미지수정" Top="5939" Transparent="TRUE" UserData="014" Width="136"></Button>
		<Image Border="SunkenEdge" Height="429" Id="Image15" Left="8" TabOrder="31" Top="6416" Width="737"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="Button13" ImageID="btn_user_10" Left="609" OnClick="btn_load_OnClick" Style="sty_btn" TabOrder="30" Text="이미지수정" Top="6395" Transparent="TRUE" UserData="015" Width="136"></Button>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 주소록 관리 
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 

//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var _F_FILE_DIR = "";	// 로컬에서 현재 선택한 파일 디렉토리 
var _F_FILE_NAME = "";	// 로컬에서 현재 선택한 파일  명 
var _F_FILE_SIZE = 0;	// 파일 사이즈 
var _F_FILE_DELETE = false;
var F_SIZE = 1024 * 10096;	// 4096K
var _FILE_CRITERIA_NAME = "steel_construction_mr_";
var _GUBUN = "5";
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	gfn_initForm();
	ufn_selectImageUrls();	
}
/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {

}
/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return true;
}
//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 이미지 조회
********************************************************************************/
function ufn_selectImageUrls() 
{
	//trace("ufn_selectImageUrls");
	ds_cond_c.ClearData();
	ds_cond_c.AddRow();
	ds_cond_c.SetColumn(0, "GUBUN", _GUBUN);
	tit_clearActionInfo();	
	tit_addSearchActionInfo("ps15:PS1503001A_S1");
	tit_callService(
        ""
        , ""
        , "ds_cond_c=ds_cond_c"
        , "ds_list_c=ds_list_c"
        , ""
        , "ufn_showImageUrls"
        , true);
}

/********************************************************************************
* 기      능   : 이미지 출력
********************************************************************************/
function ufn_showImageUrls() 
{
	var fa_serverFileName = "";
	
	for(var i=0; i < ds_list_c.rowcount; i++)
	{
		var ii = i + 1;
		if(ds_list_c.GetColumn(i, "FNAME") != null)
		{
			fa_serverFileName = ds_list_c.GetColumn(i, "FNAME");
			
			if(IndexOf(tit_getServerDir("PS", fa_serverFileName),'localhost') > 0)
			{
				ufn_getLocalImage(eval("Image"+ii), fa_serverFileName);
			}else{
				var idx = IndexOf(tit_getServerDir("PS", fa_serverFileName),'/',10);
				ufn_getImage(eval("Image"+ii), fa_serverFileName, idx);
			}
			//trace("" + fa_serverFileName);
		}
	
	}
}

/********************************************************************************
* 기      능   : 이미지 호출
********************************************************************************/

function ufn_getLocalImage(obj, fa_serverFileName)
{
	obj.ImageID = tit_getServerDir("PS", fa_serverFileName);
}

/********************************************************************************
* 기      능   : 이미지 호출
********************************************************************************/

function ufn_getImage(obj, fileName, idx)
{
	obj.ImageID = substr(tit_getServerDir("PS", fileName),0,idx)+substr(tit_getServerDir("PS", fileName),idx);
}

/********************************************************************************
* 기      능   : 이미지 수정 버튼
********************************************************************************/
function btn_load_OnClick(obj)
{
	var fileName = _FILE_CRITERIA_NAME + obj.UserData + ".jpg";
	
	//trace("fileName = " + fileName);	
	var sRtn = fileDialog.open();
	
	if(sRtn == 0) return;
	
	if ( length(fileDialog.FilePath) == 0 
		|| length(fileDialog.FileName ) == 0 ) {
		return;
	}

	var fileSize = f_tmp.GetLength(fileDialog.FilePath + "\\" + fileDialog.FileName );
	if ( fileSize <= 0 ) {
		gfn_showAlert("CW00048");
		return;
	}

	if ( fileSize > toNumber(F_SIZE)) {
		gfn_showAlert("CW00047", "10 Mbytes" );	
		return;
	}
	
	// 파일정보
	if(length(fileDialog.FileName) > 0 )
	{
		var thumbext = fileDialog.FileName; //파일을 추가한 input 값
		thumbext = substr(thumbext, thumbext.indexOf(".") + 1); //확정자값 가져오기 
		thumbext = ToLower(thumbext); //소문자로 변경
	 
	
	    if(thumbext != "jpg")
	    { // 확장자를 확인
			global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
		    global.FRM_BOTTOM.st_msg.color = "yellow";       
			global.FRM_BOTTOM.st_msg.value = "이미지 파일(jpg)만 등록 가능합니다.";
			return false;
		}
		
		_F_FILE_DIR  = fileDialog.FilePath;
		_F_FILE_NAME = fileDialog.FileName;
		
		
		if(length(_F_FILE_NAME) != 0 && length(_F_FILE_DIR) != 0)
		{
			var arr = tit_fileWrite(httpFile
				, "PS"
				, _F_FILE_DIR
				, _F_FILE_NAME
				, fileName// 실제 서버에
				, "U"	  // time stamp를 붙이지 않을 경우 U 사용 
				, ""
			);    // ds_list_i.getColumn(i, "DEL_FNAME") );//삭제할 이전 파일명 
			
			if ( arr[0] == "S" ) {
				//trace(arr);
				ds_temp.ClearData();
				ds_temp.AddRow();
				ds_temp.setColumn(0, "FPATH", arr[1]);
				ds_temp.setColumn(0, "FNAME", arr[2]);
				ds_temp.setColumn(0, "FSIZE", ToNumber(arr[3]));
				ds_temp.SetColumn(0, "SEQNO", obj.UserData);
				ds_temp.setColumn(0, "GUBUN", _GUBUN);
								
				tit_clearActionInfo();
				tit_addMultiActionInfo("ps15:PS1503001A_I1");
				tit_callService(
							""
						   ,""
						   ,"ds_temp=ds_temp"
						   ,""
						   ,""
						   ,"fn_afterSaveImage"
						   ,"true"
						   ,"true"
						   ,"false"
						   );
				
			}
			else if ( arr[0] != "S" )
			{
				gfn_showMsg("CW00035"); 
				return;
			}
			
		}
	}
}

function fn_afterSaveImage()
{
	ufn_selectImageUrls();
}

function Image1_OnLoadError(obj,nErrorCode,strErrorMsg)
{
	//trace(obj);
}
]]></Script>
</Window>