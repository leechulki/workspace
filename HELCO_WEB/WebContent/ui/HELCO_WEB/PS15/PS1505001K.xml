<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="944" Id="PS1505001K" Left="8" OnLoadCompleted="fn_OnLoadCompleted" PidAttrib="7" Title="사진대지" Top="8" Ver="1.0" Width="488" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond1">
				<Contents>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="POSID" size="256" summ="default" type="STRING"/>
					<colinfo id="JOB_CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="LIFNR" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_file">
				<Contents>
					<colinfo id="P_CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="256" summ="default" type="STRING"/>
					<colinfo id="COMMENT" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_save_comment">
				<Contents>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="POSID" size="256" summ="default" type="STRING"/>
					<colinfo id="LIFNR" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="JOB_CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="P_CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="COMMENT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_auth">
				<Contents>
					<colinfo id="AUTH" size="256" summ="default" type="STRING"/>
					<colinfo id="AUTH_NAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_file_p">
				<Contents>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSITE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="IMG_B1" size="256" summ="default" type="STRING"/>
					<colinfo id="IMG_B2" size="256" summ="default" type="STRING"/>
					<colinfo id="IMG_B3" size="256" summ="default" type="STRING"/>
					<colinfo id="IMG_A1" size="256" summ="default" type="STRING"/>
					<colinfo id="IMG_A2" size="256" summ="default" type="STRING"/>
					<colinfo id="IMG_A3" size="256" summ="default" type="STRING"/>
					<colinfo id="CMT_B1" size="256" summ="default" type="STRING"/>
					<colinfo id="CMT_B2" size="256" summ="default" type="STRING"/>
					<colinfo id="CMT_B3" size="256" summ="default" type="STRING"/>
					<colinfo id="CMT_A1" size="256" summ="default" type="STRING"/>
					<colinfo id="CMT_A2" size="256" summ="default" type="STRING"/>
					<colinfo id="CMT_A3" size="256" summ="default" type="STRING"/>
					<record>
						<CMT_A1></CMT_A1>
						<CMT_A2></CMT_A2>
						<CMT_A3></CMT_A3>
						<CMT_B1></CMT_B1>
						<CMT_B2></CMT_B2>
						<CMT_B3></CMT_B3>
						<IMG_A1></IMG_A1>
						<IMG_A2></IMG_A2>
						<IMG_A3></IMG_A3>
						<IMG_B1></IMG_B1>
						<IMG_B2></IMG_B2>
						<IMG_B3></IMG_B3>
						<PSPID></PSPID>
						<ZSITE_NM></ZSITE_NM>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user12" Bottom="392" Height="272" Id="Shape13" Left="8" LineColor="user16" Right="243" TabOrder="5" Top="120" Type="Rectangle" Width="235"></Shape>
		<Div Height="36" Id="div_btn" TabOrder="1" TabStop="FALSE" Text="Div0" Url="WB01::CommBtnForm.xml" Width="488">
			<Contents></Contents>
		</Div>
		<Static Font="굴림,10" Height="16" Id="st_pspid" Left="8" TabOrder="2" Text="공사번호&#32;:&#32;123456" Top="48" Width="470"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" DragImageID="tab_form_05" Font="굴림,9" Height="20" Id="btn_save_b1" ImageID="btn_user_02" Left="200" OnClick="btn_save_b1_OnClick" Style="sty_btn" TabOrder="2" Text="저장" Top="368" Width="40"></Button>
		<Static Align="Center" BKColor="user24" Border="Flat" BorderColor="user0" Color="white" Font="굴림,11,Bold" Height="30" Id="Static4" Left="7" Style="sty_lb_form_basic" TabOrder="4" Text="작업&#32;전" Top="92" VAlign="Middle" Width="236"></Static>
		<Static Align="Center" BKColor="user24" Border="Flat" BorderColor="user0" Color="white" Font="굴림,11,Bold" Height="30" Id="Static5" Left="242" Style="sty_lb_form_basic" TabOrder="5" Text="작업&#32;후" Top="92" VAlign="Middle" Width="236"></Static>
		<Static Font="굴림,10" Height="16" Id="st_site_nm" Left="8" TabOrder="7" Text="현&#32;장&#32;명&#32;:&#32;영광교회&#32;신축공사" Top="68" Width="470"></Static>
		<Edit Border="Flat" Font="굴림,9" Height="20" Id="ed_cmt_b1" ImeMode="native" Left="12" LeftMargin="4" MaxLength="20" RightMargin="4" Style="sty_ipt_form" TabOrder="8" Top="368" Width="184"></Edit>
		<Shape BKColor="user12" Bottom="392" Height="272" Id="Shape0" Left="242" LineColor="user16" Right="477" TabOrder="10" Top="120" Type="Rectangle" Width="235"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" DragImageID="tab_form_05" Font="굴림,9" Height="20" Id="btn_save_a1" ImageID="btn_user_02" Left="434" OnClick="btn_save_a1_OnClick" Style="sty_btn" TabOrder="9" Text="저장" Top="368" Width="40"></Button>
		<Edit Border="Flat" Font="굴림,9" Height="20" Id="ed_cmt_a1" ImeMode="native" Left="246" LeftMargin="4" MaxLength="20" RightMargin="4" Style="sty_ipt_form" TabOrder="11" Top="368" Width="184"></Edit>
		<Shape BKColor="user12" Bottom="663" Height="272" Id="Shape1" Left="8" LineColor="user16" Right="243" TabOrder="13" Top="391" Type="Rectangle" Width="235"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" DragImageID="tab_form_05" Font="굴림,9" Height="20" Id="btn_save_b2" ImageID="btn_user_02" Left="200" OnClick="btn_save_b2_OnClick" Style="sty_btn" TabOrder="12" Text="저장" Top="639" Width="40"></Button>
		<Edit Border="Flat" Font="굴림,9" Height="20" Id="ed_cmt_b2" ImeMode="native" Left="12" LeftMargin="4" MaxLength="20" RightMargin="4" Style="sty_ipt_form" TabOrder="14" Top="639" Width="184"></Edit>
		<Shape BKColor="user12" Bottom="663" Height="272" Id="Shape2" Left="242" LineColor="user16" Right="477" TabOrder="16" Top="391" Type="Rectangle" Width="235"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" DragImageID="tab_form_05" Font="굴림,9" Height="20" Id="btn_save_a2" ImageID="btn_user_02" Left="434" OnClick="btn_save_a2_OnClick" Style="sty_btn" TabOrder="15" Text="저장" Top="639" Width="40"></Button>
		<Edit Border="Flat" Font="굴림,9" Height="20" Id="ed_cmt_a2" ImeMode="native" Left="246" LeftMargin="4" MaxLength="20" RightMargin="4" Style="sty_ipt_form" TabOrder="17" Top="639" Width="184"></Edit>
		<Shape BKColor="user12" Bottom="934" Height="272" Id="Shape3" Left="8" LineColor="user16" Right="243" TabOrder="19" Top="662" Type="Rectangle" Width="235"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" DragImageID="tab_form_05" Font="굴림,9" Height="20" Id="btn_save_b3" ImageID="btn_user_02" Left="200" OnClick="btn_save_b3_OnClick" Style="sty_btn" TabOrder="18" Text="저장" Top="910" Width="40"></Button>
		<Edit Border="Flat" Font="굴림,9" Height="20" Id="ed_cmt_b3" ImeMode="native" Left="12" LeftMargin="4" MaxLength="20" RightMargin="4" Style="sty_ipt_form" TabOrder="20" Top="910" Width="184"></Edit>
		<Shape BKColor="user12" Bottom="934" Height="272" Id="Shape4" Left="242" LineColor="user16" Right="477" TabOrder="22" Top="662" Type="Rectangle" Width="235"></Shape>
		<Button ButtonStyle="TRUE" Cursor="HAND" DragImageID="tab_form_05" Font="굴림,9" Height="20" Id="btn_save_a3" ImageID="btn_user_02" Left="434" OnClick="btn_save_a3_OnClick" Style="sty_btn" TabOrder="21" Text="저장" Top="910" Width="40"></Button>
		<Edit Border="Flat" Font="굴림,9" Height="20" Id="ed_cmt_a3" ImeMode="native" Left="246" LeftMargin="4" MaxLength="20" RightMargin="4" Style="sty_ipt_form" TabOrder="23" Top="910" Width="184"></Edit>
		<WebBrowser Border="Flat" Height="240" Id="wb_b1" Left="498" PageUrl="about:blank" Silent="True" Style="sty_ipt_form" TabOrder="24" Top="125" Width="135"></WebBrowser>
		<WebBrowser Border="Flat" Height="240" Id="wb_b2" Left="498" PageUrl="about:blank" Silent="True" Style="sty_ipt_form" TabOrder="25" Top="396" Width="135"></WebBrowser>
		<WebBrowser Border="Flat" Height="240" Id="wb_b3" Left="498" PageUrl="about:blank" Silent="True" Style="sty_ipt_form" TabOrder="26" Top="667" Width="135"></WebBrowser>
		<WebBrowser Border="Flat" Height="240" Id="wb_a3" Left="732" PageUrl="about:blank" Silent="True" Style="sty_ipt_form" TabOrder="27" Top="667" Width="135"></WebBrowser>
		<WebBrowser Border="Flat" Height="240" Id="wb_a2" Left="732" PageUrl="about:blank" Silent="True" Style="sty_ipt_form" TabOrder="28" Top="396" Width="135"></WebBrowser>
		<WebBrowser Border="Flat" Height="240" Id="wb_a1" Left="732" PageUrl="about:blank" Silent="True" Style="sty_ipt_form" TabOrder="29" Top="125" Width="135"></WebBrowser>
		<File Bottom="24" Height="24" Id="f_tmp" Left="912" Right="936" TabOrder="29" Width="24"></File>
		<Image Border="Flat" FillType="STRETCH" Height="240" Id="img_b1" Left="58" OnClick="img_b1_OnClick" Static="FALSE" TabOrder="30" Top="125" Width="135"></Image>
		<Image Border="Flat" FillType="STRETCH" Height="240" Id="img_a2" Left="292" OnClick="img_a2_OnClick" Static="FALSE" TabOrder="31" Top="396" Width="135"></Image>
		<Image Border="Flat" FillType="STRETCH" Height="240" Id="img_a1" Left="292" OnClick="img_a1_OnClick" Static="FALSE" TabOrder="32" Top="125" Width="135"></Image>
		<Image Border="Flat" FillType="STRETCH" Height="240" Id="img_b2" Left="58" OnClick="img_b2_OnClick" Static="FALSE" TabOrder="33" Top="396" Width="135"></Image>
		<Image Border="Flat" FillType="STRETCH" Height="240" Id="img_b3" Left="58" OnClick="img_b3_OnClick" Static="FALSE" TabOrder="34" Top="667" Width="135"></Image>
		<Image Border="Flat" FillType="STRETCH" Height="240" Id="img_a3" Left="292" OnClick="img_a3_OnClick" Static="FALSE" TabOrder="35" Top="667" Width="135"></Image>
		<FileDialog Bottom="24" Filter="All(*.*)|*.*|jpg&#32;File(*.jpg)|*.jpg|jpeg&#32;File(*.jpeg)|*.jpeg|bmp&#32;File(*.bmp)|*.jpeg|gif&#32;File(*.gif)|*.gif|png&#32;File(*.png)|*.png|pdf&#32;File(*.pdf)|*.pdf|" Height="24" Id="saveDialog" Left="880" Right="904" TabOrder="35" Type="Save" Width="24"></FileDialog>
		<CyHttpFile Height="24" Id="httpFile" Left="944" Width="24"></CyHttpFile>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 비용처리 팝업
 * 작  성  자   : 강민석K
 * 작성  일자   : 2019.07.25
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var userAuth = "";//사용자 권한 - 안전, 서비스 구분을 위한 변수 추가 - 2019.07.26 강민석K
var F_MAX_FILE_CNT = 3;//작업전/후 별로 저장될 수 있는 최대 파일 수
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	//Form 로드 이벤트 맨 첫줄에 기술 
	gfn_initForm();
	
	//st_pspid.Text = "공사번호 : " + ds_list.GetColumn(ds_list.row, "PSPID");
	st_pspid.Text = "공사번호 : " + ds_list.GetColumn(ds_list.row, "POSID");//프로젝트 번호 대신 호기번호로 표시 - 2019.09.19 강민석K (이현용K 요구사항)
	st_site_nm.Text = "현 장 명 : " + ds_list.GetColumn(ds_list.row, "ZSITE_NM");
	
	fn_query();
}
/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {

}
/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}
//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 조회
********************************************************************************/
function fn_query() {
	ds_cond1.DeleteAll();
	ds_cond1.AddRow();
	
	//trace("ds_list.row : " + ds_list.row);
	//trace("ds_list JOB_CODE : " + ds_list.GetColumn(ds_list.row, "JOB_CODE"));
	
	ds_cond1.SetColumn(0, "PSPID", ds_list.GetColumn(ds_list.row, "PSPID"));
	ds_cond1.SetColumn(0, "POSID", ds_list.GetColumn(ds_list.row, "POSID"));
	ds_cond1.SetColumn(0, "JOB_CODE", ds_list.GetColumn(ds_list.row, "JOB_CODE"));
	ds_cond1.SetColumn(0, "LIFNR", ds_list.GetColumn(ds_list.row, "LIFNR_OUT"));
	
	tit_clearActionInfo();
	tit_addSearchActionInfo("ps15:PS1505001P_S8");//파일목록 조회
	tit_addSearchActionInfo("ps15:PS1505001A_S6");//사용자 권한 조회
	tit_callService(
          ""
        , ""
        , "ds_cond=ds_cond1"
        , "ds_file=ds_file ds_auth=ds_auth"
        , ""
        , "fn_afterQuery"
        , true);
}
/********************************************************************************
* 기      능   : print 40
********************************************************************************/
function fn_print() {
	//출력 가능여부 체크
	if(ds_file.FindRow("COMMENT", "") != -1){
		gfn_openMsgWin("사진설명이 저장되지 않아 출력 할 수 없습니다.", "W", "", "");
		return;
	}
	
	//화면상의 설명입력란과 DB에 저장된 데이터가 다를 수 있어서 한번 더 재조회하여 화면에 표시 후 출력한다. - 2019.08.12 강민석K
	fn_query();
	
	//출력화면에서 사용할 DataSet 세팅
	//ds_file_p.SetColumn(0, "PSPID", ds_list.GetColumn(ds_list.row, "PSPID"));
	ds_file_p.SetColumn(0, "PSPID", ds_list.GetColumn(ds_list.row, "POSID"));//프로젝트 번호 대신 호기번호로 표시 - 2019.09.19 강민석K (이현용K 요구사항)
	ds_file_p.SetColumn(0, "ZSITE_NM", ds_list.GetColumn(ds_list.row, "ZSITE_NM"));
	
	//##서버 배포 전에 이미지 경로 수정 해야 함. - 2019.08.12 강민석K
	ds_file.Filter("P_CODE == '4'");//작업전 사진
	for(var i = 0; i < ds_file.rowcount; i++){
//		ds_file_p.SetColumn(0, "IMG_B" + (i + 1), "http://localhost:8088/HELCO_WEB/upload/PS/" + ds_file.GetColumn(i, "FNAME_APP"));//이미지 - local PC 테스트용
		ds_file_p.SetColumn(0, "IMG_B" + (i + 1), "http://srm.hdel.co.kr/upload/PS/" + ds_file.GetColumn(i, "FNAME_APP"));//이미지 - 서버용
		ds_file_p.SetColumn(0, "CMT_B" + (i + 1), ds_file.GetColumn(i, "COMMENT"));//설명
	}
	ds_file.UnFilter();
	
	ds_file.Filter("P_CODE == '5'");//작업후 사진
	for(var i = 0; i < ds_file.rowcount; i++){
//		ds_file_p.SetColumn(0, "IMG_A" + (i + 1), "http://localhost:8088/HELCO_WEB/upload/PS/" + ds_file.GetColumn(i, "FNAME_APP"));//이미지 - local PC 테스트용
		ds_file_p.SetColumn(0, "IMG_A" + (i + 1), "http://srm.hdel.co.kr/upload/PS/" + ds_file.GetColumn(i, "FNAME_APP"));//이미지 - 서버용
		ds_file_p.SetColumn(0, "CMT_A" + (i + 1), ds_file.GetColumn(i, "COMMENT"));//설명
	}
	ds_file.UnFilter();
	
	Dialog("PS15::PS1505001P1.xml", "");
}
/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}
//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	//컨트롤 배열 - Image
	var arrImgObj_before = [img_b1, img_b2, img_b3];
	var arrImgObj_after = [img_a1, img_a2, img_a3];
	
	//컨트롤 배열 - webBrowser
	var arrWbObj_before = [wb_b1, wb_b2, wb_b3];
	var arrWbObj_after = [wb_a1, wb_a2, wb_a3];
	
	//컨트롤 배열 - Edit
	var arrEdObj_before = [ed_cmt_b1, ed_cmt_b2, ed_cmt_b3];
	var arrEdObj_after = [ed_cmt_a1, ed_cmt_a2, ed_cmt_a3];
	
	//작업전 사진들
	ds_file.Filter("P_CODE == '4'");//작업전 사진만 필터
	for(var i = 0; i < F_MAX_FILE_CNT; i++){
		if(i <= ds_file.rowcount - 1){
			//사진 설명 표시
			arrEdObj_before[i].Text = ds_file.GetColumn(i, "COMMENT");
			arrEdObj_before[i].UserData = ds_file.GetColumn(i, "SEQ");//저장 시 사용할 각 파일별 SEQ를 컨트롤에 저장
			
			//사진 표시 - Image
			ufn_showImage(arrImgObj_before[i], ds_file.GetColumn(i, "FNAME"), ds_file.GetColumn(i, "FPATH"), ds_file.GetColumn(i, "FNAME_APP"), ds_file.GetColumn(i, "SEQ"));
			
			//사진 표시 - webBrowser
			//ufn_showWebBrowser(arrWbObj_before[i], ds_file.GetColumn(i, "FNAME"), ds_file.GetColumn(i, "FPATH"), ds_file.GetColumn(i, "FNAME_APP"), ds_file.GetColumn(i, "SEQ"));
		}else{
			//사진이 등록되지 않은 경우 이미지, 설명입력란, 저장버튼 비활성화
			eval("img_b" + (i + 1)).Enable = false;
			eval("ed_cmt_b" + (i + 1)).Enable = false;
			eval("btn_save_b" + (i + 1)).Enable = false;
		}
	}
	ds_file.UnFilter();//필터 해제
	
	//작업후 사진들
	ds_file.Filter("P_CODE == '5'");//작업후 사진만 필터
	for(var i = 0; i < F_MAX_FILE_CNT; i++){
		if(i <= ds_file.rowcount - 1){
			//사진 설명 표시
			arrEdObj_after[i].Text = ds_file.GetColumn(i, "COMMENT");
			arrEdObj_after[i].UserData = ds_file.GetColumn(i, "SEQ");//저장 시 사용할 각 파일별 SEQ를 컨트롤에 저장
			
			//사진 표시 - Image
			ufn_showImage(arrImgObj_after[i], ds_file.GetColumn(i, "FNAME"), ds_file.GetColumn(i, "FPATH"), ds_file.GetColumn(i, "FNAME_APP"), ds_file.GetColumn(i, "SEQ"));
			
			//사진 표시 - webBrowser
			//ufn_showWebBrowser(arrWbObj_after[i], ds_file.GetColumn(i, "FNAME"), ds_file.GetColumn(i, "FPATH"), ds_file.GetColumn(i, "FNAME_APP"), ds_file.GetColumn(i, "SEQ"));
		}else{
			//사진이 등록되지 않은 경우 이미지, 설명입력란, 저장버튼 비활성화
			eval("img_a" + (i + 1)).Enable = false;
			eval("ed_cmt_a" + (i + 1)).Enable = false;
			eval("btn_save_a" + (i + 1)).Enable = false;
		}
	}
	ds_file.UnFilter();//필터 해제
	
	//서비스, 안전 팀은 조회만 가능
	if(ds_auth.rowcount > 0){
		//서비스팀 권한과 안전팀 권한이 모두 있는 사용자는 없어야 한다. 이 경우 서비스팀 권한으로 처리한다.
		var nIndex = ds_auth.FindRow("AUTH", "ZPS12");//서비스팀 권한
		if(nIndex == -1){
			nIndex = ds_auth.FindRow("AUTH", "ZPS36");//안전팀 권한
		}
		
		if(nIndex != -1){
			userAuth = ds_auth.GetColumn(nIndex, "AUTH");
		}
	}
	
	if(userAuth == "ZPS12" || userAuth == "ZPS36"){
		//설명입력란
		ed_cmt_b1.Enable = false;
		ed_cmt_b2.Enable = false;
		ed_cmt_b3.Enable = false;
		ed_cmt_a1.Enable = false;
		ed_cmt_a2.Enable = false;
		ed_cmt_a3.Enable = false;
		
		//저장버튼
		btn_save_b1.Enable = false;
		btn_save_b2.Enable = false;
		btn_save_b3.Enable = false;
		btn_save_a1.Enable = false;
		btn_save_a2.Enable = false;
		btn_save_a3.Enable = false;
	}
}
/********************************************************************************
* 기      능   : 저장 Callback  
********************************************************************************/
function fn_afterSave(errCode, errMsg) {
	if(errCode != 0){
		gfn_showMsg("CE00001");
	}else{
		gfn_showMsg("CI00003");
		fn_query();
	}
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
// 사용자 정의 함수는 ufn_xxxx() 형태로 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 화면에 이미지, 설명 표시 - Image
********************************************************************************/
function ufn_showImage(imgObj, fname, fpath, fname_app, seq)
{
	imgObj.UserData = seq;//저장 시 사용할 각 파일별 SEQ를 컨트롤에 저장
	
	if(length(fname_app) > 0){
		//서버파일명이 있는 경우 서버파일 표시
		imgObj.ImageID = tit_getServerDir("PS", fname_app);
	}else{
		//서버파일명이 없는 경우 로컬파일 표시
		if(length(fname) > 0){
			//로컬파일명이 있는 경우 로컬파일 존재여부 확인
			if(f_tmp.GetLength(fpath + "\\" + fname_app) >0){
				//로컬파일이 존재하는 경우 로컬파일 표시
				imgObj.ImageID = fpath + "\\" + fname;
			}else{
				//로컬에도 파일이 없는 경우 빈화면 표시
				imgObj.ImageID = "";
				gfn_showAlert("Not found : " + fpath + "\\" + fname);
			}
		}else{
			//로컬파일명이 없는 경우 빈화면 표시
			imgObj.ImageID = "";
			gfn_showAlert("Not found : " + fpath + "\\" + fname);
		}
	}
}
/********************************************************************************
* 기      능   : 화면에 이미지, 설명 표시 - WebBrowser
********************************************************************************/
function ufn_showWebBrowser(wbObj, fname, fpath, fname_app, seq)
{
	//기존
	/*
	if(length(fname_app) > 0){
		if(length(fname) > 0){
			if(f_tmp.GetLength(fpath + "\\" + fname_app) >0){
				// 로컬에 저장된 정보 다시 표시
				trace("1)" + fpath + "\\" + fname);
				wbObj.pageUrl = fpath + "\\" + fname;
			}else{
				trace("2");
				wbObj.pageUrl = "about:blank";
				gfn_showAlert("Not found : " + fpath + "\\" + fname);
			}
		}else{
			trace("3)" + tit_getServerDir("PS", fname_app));
			wbObj.pageUrl = tit_getServerDir("PS", fname_app);
		}
	}
	*/
	
	imgObj.UserData = seq;//저장 시 사용할 각 파일별 SEQ를 컨트롤에 저장
	
	if(length(fname_app) > 0){
		//서버파일명이 있는 경우 서버파일 표시
		wbObj.pageUrl = tit_getServerDir("PS", fname_app);
	}else{
		//서버파일명이 없는 경우 로컬파일 표시
		if(length(fname) > 0){
			//로컬파일명이 있는 경우 로컬파일 존재여부 확인
			if(f_tmp.GetLength(fpath + "\\" + fname_app) >0){
				//로컬파일이 존재하는 경우 로컬파일 표시
				wbObj.pageUrl = fpath + "\\" + fname;
			}else{
				//로컬에도 파일이 없는 경우 빈화면 표시
				wbObj.pageUrl = "about:blank";
				gfn_showAlert("Not found : " + fpath + "\\" + fname);
			}
		}else{
			//로컬파일명이 없는 경우 빈화면 표시
			wbObj.pageUrl = "about:blank";
			gfn_showAlert("Not found : " + fpath + "\\" + fname);
		}
	}
	
	wbObj.run();
}
/********************************************************************************
* 기      능   : 사진설명 저장용 공통함수
* obj - 설명입력 컨트롤 ID
* order - 작업전, 후 별 순서
* pcode - 작업전/후 구분
********************************************************************************/
function ufn_save_comment(obj, order, pcode)
{
	//설명 입력여부 체크
	if(length(trim(obj.Text)) == 0){
		var msg = "";
		if(pcode == "4"){
			msg = "작업전 ";
		}else{
			msg = "작업후 ";
		}
		
		gfn_showAlert(msg + order + "번째 사진설명을 입력하세요.");
		obj.SetFocus();
		return;
	}
	
	ds_save_comment.ClearData();
	ds_save_comment.AddRow();
	
	ds_save_comment.SetColumn(0, "PSPID", ds_list.GetColumn(ds_list.row, "PSPID"));
	ds_save_comment.SetColumn(0, "POSID", ds_list.GetColumn(ds_list.row, "POSID"));
	ds_save_comment.SetColumn(0, "JOB_CODE", ds_list.GetColumn(ds_list.row, "JOB_CODE"));
	ds_save_comment.SetColumn(0, "LIFNR", ds_list.GetColumn(ds_list.row, "LIFNR_OUT"));
	ds_save_comment.SetColumn(0, "SEQ", obj.UserData);
	ds_save_comment.SetColumn(0, "P_CODE", pcode);
	ds_save_comment.SetColumn(0, "COMMENT", obj.Text);
	
	tit_clearActionInfo();
	tit_addMultiActionInfo("ps15:PS1505001P_U3");
	tit_callService(
		  ""
		, ""
		, "ds_comment=ds_save_comment"
		, ""
		, ""
		, "fn_afterSave"
		, ""
		, ""
		, true);
}
/********************************************************************************
* 기      능   : 이미지 클릭 시 큰화면으로 이미지 표시
* obj - 컨트롤 ID
********************************************************************************/
function ufn_image_click(obj)
{
	var nIndex = ds_file.FindRow("SEQ", obj.UserData);
	
	if(nIndex != -1){
		if(length(ds_file.GetColumn(nIndex, "FNAME")) > 0){
			// 첨부 파일 처리 
			fn_createWait("", this);
			
			var FilePath = "c:\\Temp";
			var FileExec = "c:\\Temp\\" + ds_file.GetColumn(nIndex, "FNAME");
			
			saveDialog.FileName = ds_file.GetColumn(nIndex, "FNAME");
			
			var rMsg = tit_fileRead(httpFile
				, "PS"										// 저장 디렉토리
				, ds_file.GetColumn(nIndex, "FNAME_APP")	// 서버에서 전송받을 이름
				, FilePath									// 로컬 경로
				, ds_file.GetColumn(nIndex, "FNAME")		// 로컬 파일명
			);
			
			fn_destroyWait();
			
			if(rMsg[0] == "E"){
				if(length(trim(rMsg[1])) > 0){
					gfn_showAlert("CW10025", rMsg[1]);
				}else{
					gfn_showAlert("CW10025", "파일 다운로드에 실패하였습니다.");
				}
			}else{
				ExecShell(FileExec);
			}
		}
	}
}
//=========================================================================================
// [ PART 6 ]
// component Event 정의 : 각 Component 별 이벤트 
//=========================================================================================
/********************************************************************************
* 기      능   : 저장 버튼 클릭 시 - 작업 전 1번 사진 설명 저장
********************************************************************************/
function btn_save_b1_OnClick(obj)
{
	ufn_save_comment(ed_cmt_b1, "1", "4");
}
/********************************************************************************
* 기      능   : 저장 버튼 클릭 시 - 작업 전 2번 사진 설명 저장
********************************************************************************/
function btn_save_b2_OnClick(obj)
{
	ufn_save_comment(ed_cmt_b2, "2", "4");
}
/********************************************************************************
* 기      능   : 저장 버튼 클릭 시 - 작업 전 3번 사진 설명 저장
********************************************************************************/
function btn_save_b3_OnClick(obj)
{
	ufn_save_comment(ed_cmt_b3, "3", "4");
}
/********************************************************************************
* 기      능   : 저장 버튼 클릭 시 - 작업 후 1번 사진 설명 저장
********************************************************************************/
function btn_save_a1_OnClick(obj)
{
	ufn_save_comment(ed_cmt_a1, "1", "5");
}
/********************************************************************************
* 기      능   : 저장 버튼 클릭 시 - 작업 후 2번 사진 설명 저장
********************************************************************************/
function btn_save_a2_OnClick(obj)
{
	ufn_save_comment(ed_cmt_a2, "2", "5");
}
/********************************************************************************
* 기      능   : 저장 버튼 클릭 시 - 작업 후 3번 사진 설명 저장
********************************************************************************/
function btn_save_a3_OnClick(obj)
{
	ufn_save_comment(ed_cmt_a3, "3", "5");
}
/********************************************************************************
* 기      능   : 이미지 클릭 시 - 큰화면으로 이미지 표시
********************************************************************************/
function img_b1_OnClick(obj,nX,nY)
{
	ufn_image_click(img_b1);
}
/********************************************************************************
* 기      능   : 이미지 클릭 시 - 큰화면으로 이미지 표시
********************************************************************************/
function img_b2_OnClick(obj,nX,nY)
{
	ufn_image_click(img_b2);
}
/********************************************************************************
* 기      능   : 이미지 클릭 시 - 큰화면으로 이미지 표시
********************************************************************************/
function img_b3_OnClick(obj,nX,nY)
{
	ufn_image_click(img_b3);
}
/********************************************************************************
* 기      능   : 이미지 클릭 시 - 큰화면으로 이미지 표시
********************************************************************************/
function img_a1_OnClick(obj,nX,nY)
{
	ufn_image_click(img_a1);
}
/********************************************************************************
* 기      능   : 이미지 클릭 시 - 큰화면으로 이미지 표시
********************************************************************************/
function img_a2_OnClick(obj,nX,nY)
{
	ufn_image_click(img_a2);
}
/********************************************************************************
* 기      능   : 이미지 클릭 시 - 큰화면으로 이미지 표시
********************************************************************************/
function img_a3_OnClick(obj,nX,nY)
{
	ufn_image_click(img_a3);
}]]></Script>
</Window>