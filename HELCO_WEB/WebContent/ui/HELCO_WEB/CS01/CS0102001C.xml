<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="632" Id="D" Left="8" OnKeyDown="gfn_EnterInForm" OnLoadCompleted="fn_OnLoadCompleted" PidAttrib="7" Title="FM청구&#32;내역&#32;조회" Top="8" Ver="1.0" Width="752" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_bwtar">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="PJT" size="255" summ="default" type="STRING"/>
					<colinfo id="CUDAT" size="255" summ="default" type="STRING"/>
					<colinfo id="REQNR" size="256" summ="default" type="STRING"/>
					<colinfo id="REQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO" size="256" summ="default" type="STRING"/>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<record>
						<CST></CST>
						<CUDAT></CUDAT>
						<DNO></DNO>
						<PJT></PJT>
						<REQNO></REQNO>
						<REQNR></REQNR>
						<UPN></UPN>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_knd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_head">
				<Contents>
					<colinfo id="CST" size="9" summ="default" type="STRING"/>
					<colinfo id="KND" size="3" summ="default" type="STRING"/>
					<colinfo id="NAM" size="150" summ="default" type="STRING"/>
					<colinfo id="SPT" size="150" summ="default" type="STRING"/>
					<colinfo id="UHJ" size="24" summ="default" type="STRING"/>
					<colinfo id="UMR" size="24" summ="default" type="STRING"/>
					<colinfo id="UPN" size="18" summ="default" type="STRING"/>
					<colinfo id="USD" size="24" summ="default" type="STRING"/>
					<colinfo id="CUDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="YEAR" size="24" summ="default" type="STRING"/>
					<colinfo id="QTNUM" size="256" summ="default" type="STRING"/>
					<colinfo id="REQNR" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="REQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="ADT" size="256" summ="default" type="STRING"/>
					<colinfo id="FMY" size="256" summ="default" type="STRING"/>
					<colinfo id="APSTAT" size="256" summ="default" type="STRING"/>
					<colinfo id="CRDPT1" size="256" summ="default" type="STRING"/>
					<colinfo id="REDPT1" size="256" summ="default" type="STRING"/>
					<colinfo id="LGORT1" size="256" summ="default" type="STRING"/>
					<colinfo id="VKGRP" size="256" summ="default" type="STRING"/>
					<colinfo id="F_CNT" size="8" summ="default" type="STRING"/>
					<colinfo id="REQKIND" size="256" summ="default" type="STRING"/>
					<colinfo id="ACPT_NUM" size="30" summ="default" type="STRING"/>
					<colinfo id="PJT" size="256" summ="default" type="STRING"/>
					<colinfo id="CNT_S" size="10" summ="default" type="DECIMAL"/>
					<colinfo id="DOCNO" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list">
				<Contents>
					<colinfo id="BWTAR" size="30" summ="default" type="STRING"/>
					<colinfo id="MAKTX" size="120" summ="default" type="STRING"/>
					<colinfo id="MATNR" size="54" summ="default" type="STRING"/>
					<colinfo id="MEINS" size="9" summ="default" type="STRING"/>
					<colinfo id="MENGE" size="15" summ="default" type="DECIMAL"/>
					<colinfo id="POSID" size="72" summ="default" type="STRING"/>
					<colinfo id="SAMT1" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="SAMT2" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="NETPR" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="SENDAT" size="24" summ="default" type="STRING"/>
					<colinfo id="YEAR" size="24" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_glist">
				<Contents>
					<colinfo id="BAM" size="11" summ="default" type="INT"/>
					<colinfo id="GYM" size="18" summ="default" type="STRING"/>
					<colinfo id="IY1" size="11" summ="default" type="INT"/>
					<colinfo id="IY2" size="11" summ="default" type="INT"/>
					<colinfo id="IY3" size="11" summ="default" type="INT"/>
					<colinfo id="IY4" size="11" summ="default" type="INT"/>
					<colinfo id="JYM" size="18" summ="default" type="STRING"/>
					<colinfo id="SUM" size="11" summ="default" type="INT"/>
					<colinfo id="YEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="GBU" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Editable="True" Id="ds_kisung">
				<Contents>
					<colinfo id="CHASU" size="24" summ="default" type="STRING"/>
					<colinfo id="DATE" size="24" summ="default" type="STRING"/>
					<colinfo id="S_SAMT2" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="S_NETPR" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="S_SUM" size="11" summ="default" type="INT"/>
					<colinfo id="PERCENT" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="S_COST" size="256" summ="default" type="STRING"/>
					<colinfo id="S_INS" size="256" summ="default" type="STRING"/>
					<colinfo id="S_GAN" size="256" summ="default" type="STRING"/>
					<colinfo id="UMS" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSPEC3" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSPEC7" size="256" summ="default" type="STRING"/>
					<colinfo id="TOT" size="256" summ="default" type="STRING"/>
					<colinfo id="K_TOT" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Editable="True" Id="ds_date">
				<Contents>
					<colinfo id="SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="A_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="B_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="C_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="D_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="E_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="A_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="B_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="C_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="D_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="E_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="CHASU" size="256" summ="default" type="STRING"/>
					<colinfo id="DATE" size="256" summ="default" type="STRING"/>
					<colinfo id="CHASU_1" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="UMS" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSPEC3" size="11" summ="default" type="INT"/>
					<colinfo id="ZSPEC7" size="256" summ="default" type="STRING"/>
					<colinfo id="KND" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Editable="True" Id="ds_list_1">
				<Contents>
					<colinfo id="SAMT2" size="22" type="DECIMAL"/>
					<colinfo id="NETPR" size="22" type="DECIMAL"/>
					<colinfo id="YEAR" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Editable="True" Id="ds_list_a">
				<Contents>
					<colinfo id="BWTAR" size="30" summ="default" type="STRING"/>
					<colinfo id="MAKTX" size="120" summ="default" type="STRING"/>
					<colinfo id="MATNR" size="54" summ="default" type="STRING"/>
					<colinfo id="MEINS" size="9" summ="default" type="STRING"/>
					<colinfo id="MENGE" size="15" summ="default" type="DECIMAL"/>
					<colinfo id="POSID" size="72" summ="default" type="STRING"/>
					<colinfo id="SAMT1" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="SAMT2" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="NETPR" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="SENDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="YEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="REQNR" size="256" summ="default" type="STRING"/>
					<colinfo id="ZCAUSETXT" size="256" summ="default" type="STRING"/>
					<colinfo id="ZCAUSETXT2" size="256" summ="default" type="STRING"/>
					<colinfo id="USERNAME" size="40" summ="default" type="STRING"/>
					<colinfo id="USERMBPN" size="36" summ="default" type="STRING"/>
					<colinfo id="REQKIND" size="3" summ="default" type="STRING"/>
					<colinfo id="TYP" size="256" summ="default" type="STRING"/>
					<colinfo id="WEBAZ" size="256" summ="default" type="STRING"/>
					<colinfo id="RDATE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Editable="True" Id="ds_list_b">
				<Contents>
					<colinfo id="BWTAR" size="30" summ="default" type="STRING"/>
					<colinfo id="MAKTX" size="120" summ="default" type="STRING"/>
					<colinfo id="MATNR" size="54" summ="default" type="STRING"/>
					<colinfo id="MEINS" size="9" summ="default" type="STRING"/>
					<colinfo id="MENGE" size="15" summ="default" type="DECIMAL"/>
					<colinfo id="POSID" size="72" summ="default" type="STRING"/>
					<colinfo id="SAMT1" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="SAMT2" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="NETPR" size="22" summ="default" type="DECIMAL"/>
					<colinfo id="SENDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="YEAR" size="256" summ="default" type="CHAR"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_glist_1">
				<Contents>
					<colinfo id="BAM" size="11" type="INT"/>
					<colinfo id="GYM" size="18" type="STRING"/>
					<colinfo id="IY1" size="11" type="INT"/>
					<colinfo id="IY2" size="11" type="INT"/>
					<colinfo id="IY3" size="11" type="INT"/>
					<colinfo id="IY4" size="11" type="INT"/>
					<colinfo id="JYM" size="18" type="STRING"/>
					<colinfo id="SUM" size="11" type="INT"/>
					<colinfo id="YEAR" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Editable="True" Id="ds_date_1">
				<Contents>
					<colinfo id="SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="A_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="B_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="C_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="D_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="E_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="A_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="B_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="C_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="D_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="E_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="CHASU" size="256" summ="default" type="STRING"/>
					<colinfo id="DATE" size="256" summ="default" type="STRING"/>
					<colinfo id="A_CHASU" size="256" summ="default" type="STRING"/>
					<colinfo id="B_CHASU" size="256" summ="default" type="STRING"/>
					<colinfo id="C_CHASU" size="256" summ="default" type="STRING"/>
					<colinfo id="D_CHASU" size="256" summ="default" type="STRING"/>
					<colinfo id="E_CHASU" size="256" summ="default" type="STRING"/>
					<colinfo id="CHASU_1" size="256" summ="default" type="STRING"/>
					<colinfo id="YEAR" size="256" summ="default" type="STRING"/>
					<colinfo id="A_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="B_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="C_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="D_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="E_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="REQNR" size="256" summ="default" type="STRING"/>
					<colinfo id="CUDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="A_UMS" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSPEC3" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSPEC7" size="256" summ="default" type="STRING"/>
					<colinfo id="B_UMS" size="256" summ="default" type="STRING"/>
					<colinfo id="C_UMS" size="256" summ="default" type="STRING"/>
					<colinfo id="D_UMS" size="256" summ="default" type="STRING"/>
					<colinfo id="E_UMS" size="256" summ="default" type="STRING"/>
					<colinfo id="TOT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_apcond">
				<Contents>
					<colinfo id="DOCKIND" size="3" summ="default" type="STRING"/>
					<colinfo id="DOCNO" size="30" summ="default" type="STRING"/>
					<record>
						<DOCKIND></DOCKIND>
						<DOCNO></DOCNO>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_aplist">
				<Contents>
					<colinfo id="DOCKIND" size="3" summ="default" type="STRING"/>
					<colinfo id="DOCNO" size="30" summ="default" type="STRING"/>
					<colinfo id="MANDT" size="9" summ="default" type="STRING"/>
					<colinfo id="R1DATE" size="24" summ="default" type="STRING"/>
					<colinfo id="R1IRUM" size="60" summ="default" type="STRING"/>
					<colinfo id="R1RNK" size="60" summ="default" type="STRING"/>
					<colinfo id="R2DATE" size="24" summ="default" type="STRING"/>
					<colinfo id="R2IRUM" size="60" summ="default" type="STRING"/>
					<colinfo id="R2RNK" size="60" summ="default" type="STRING"/>
					<colinfo id="R3DATE" size="24" summ="default" type="STRING"/>
					<colinfo id="R3IRUM" size="60" summ="default" type="STRING"/>
					<colinfo id="R3RNK" size="60" summ="default" type="STRING"/>
					<colinfo id="R4DATE" size="24" summ="default" type="STRING"/>
					<colinfo id="R4IRUM" size="60" summ="default" type="STRING"/>
					<colinfo id="R4RNK" size="60" summ="default" type="STRING"/>
					<colinfo id="R5DATE" size="24" summ="default" type="STRING"/>
					<colinfo id="R5IRUM" size="60" summ="default" type="STRING"/>
					<colinfo id="R5RNK" size="60" summ="default" type="STRING"/>
					<colinfo id="S1DATE" size="24" summ="default" type="STRING"/>
					<colinfo id="S1IRUM" size="60" summ="default" type="STRING"/>
					<colinfo id="S1RNK" size="60" summ="default" type="STRING"/>
					<colinfo id="S2DATE" size="24" summ="default" type="STRING"/>
					<colinfo id="S2IRUM" size="60" summ="default" type="STRING"/>
					<colinfo id="S2RNK" size="60" summ="default" type="STRING"/>
					<colinfo id="S3DATE" size="24" summ="default" type="STRING"/>
					<colinfo id="S3IRUM" size="60" summ="default" type="STRING"/>
					<colinfo id="S3RNK" size="60" summ="default" type="STRING"/>
					<colinfo id="S4DATE" size="24" summ="default" type="STRING"/>
					<colinfo id="S4IRUM" size="60" summ="default" type="STRING"/>
					<colinfo id="S4RNK" size="60" summ="default" type="STRING"/>
					<colinfo id="S5DATE" size="24" summ="default" type="STRING"/>
					<colinfo id="S5IRUM" size="60" summ="default" type="STRING"/>
					<colinfo id="S5RNK" size="60" summ="default" type="STRING"/>
					<colinfo id="APDESC" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_apstat">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="DTEXT1" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_decide">
				<Contents>
					<colinfo id="MANDT" size="256" summ="default" type="STRING"/>
					<colinfo id="DOCNO" size="256" summ="default" type="STRING"/>
					<colinfo id="DOCKIND" size="256" summ="default" type="STRING"/>
					<colinfo id="APPGUBN" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQSTAT" size="256" summ="default" type="STRING"/>
					<colinfo id="APDPT1" size="256" summ="default" type="STRING"/>
					<colinfo id="APDPT1_N" size="256" summ="default" type="STRING"/>
					<colinfo id="APNUM" size="256" summ="default" type="STRING"/>
					<colinfo id="APRNK" size="256" summ="default" type="STRING"/>
					<colinfo id="APDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="APTIM" size="256" summ="default" type="STRING"/>
					<colinfo id="APDESC" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_glist_2">
				<Contents>
					<colinfo id="SUM1" size="15" summ="default" type="INT"/>
					<colinfo id="SUM2" size="15" summ="default" type="INT"/>
					<colinfo id="SUM3" size="15" summ="default" type="INT"/>
					<colinfo id="SUM4" size="15" summ="default" type="INT"/>
					<colinfo id="SUM5" size="15" summ="default" type="INT"/>
					<colinfo id="TOT" size="256" summ="default" type="STRING"/>
					<record>
						<SUM1/>
						<SUM2/>
						<SUM3/>
						<SUM4/>
						<SUM5/>
						<TOT></TOT>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_chk">
				<Contents>
					<colinfo id="YEAR1" size="256" summ="default" type="STRING"/>
					<colinfo id="YEAR2" size="256" summ="default" type="STRING"/>
					<colinfo id="YEAR3" size="256" summ="default" type="STRING"/>
					<colinfo id="YEAR4" size="256" summ="default" type="STRING"/>
					<colinfo id="YEAR5" size="256" summ="default" type="STRING"/>
					<record>
						<YEAR1></YEAR1>
						<YEAR2></YEAR2>
						<YEAR3></YEAR3>
						<YEAR4></YEAR4>
						<YEAR5></YEAR5>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_chk2">
				<Contents>
					<colinfo id="CNT_L" size="4" summ="default" type="INT"/>
					<colinfo id="CNT_S" size="4" summ="default" type="INT"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Editable="True" Id="ds_date_2">
				<Contents>
					<colinfo id="SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="A_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="B_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="C_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="D_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="E_SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="A_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="B_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="C_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="D_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="E_EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="CHASU" size="256" summ="default" type="STRING"/>
					<colinfo id="DATE" size="256" summ="default" type="STRING"/>
					<colinfo id="CHASU_1" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="UMS" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_rdate">
				<Contents>
					<colinfo id="REQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="RDATE" size="256" summ="default" type="STRING"/>
					<record>
						<RDATE></RDATE>
						<REQNO></REQNO>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_head_0">
				<Contents>
					<colinfo id="MANDT" size="256" summ="default" type="STRING"/>
					<colinfo id="DOCNO" size="256" summ="default" type="STRING"/>
					<colinfo id="DOCKIND" size="256" summ="default" type="STRING"/>
					<colinfo id="APPGUBN" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQSTAT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Height="36" Id="div_btn" TabOrder="21" Text="Div0" Url="WB01::CommBtnForm.xml" Width="752">
			<Contents></Contents>
		</Div>
		<Image Height="36" Id="Image1" ImageID="form_bl_title_main" Left="8" TabOrder="1" Top="-1" Width="15"></Image>
		<Shape BKColor="user12" Bottom="72" Height="26" Id="Shape1" Left="8" LineColor="user13" Right="744" TabOrder="3" Top="46" Type="Rectangle" Width="736"></Shape>
		<Static Align="Right" Height="24" Id="Static5" Left="9" Style="sty_lb_form_basic" TabOrder="4" Text="통합프로젝트&#32;" Top="47" VAlign="Middle" Width="92"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="UPN" Height="20" Id="ed_upn" Left="103" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="6" Top="49" Width="105"></Edit>
		<Static Align="Right" Height="24" Id="Static4" Left="549" Style="sty_lb_form_basic" TabOrder="7" Text="계약&#32;시작일&#32;" Top="47" VAlign="Middle" Width="88"></Static>
		<Calendar BindDataset="ds_head" Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="USD" Dateformat="yyyy-MM-dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Enable="FALSE" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_workdt" Left="639" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="5" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="49" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="100"></Calendar>
		<Shape BKColor="user12" Bottom="97" Height="26" Id="Shape2" Left="8" LineColor="user13" Right="744" TabOrder="8" Top="71" Type="Rectangle" Width="736"></Shape>
		<Static Align="Right" Height="24" Id="Static16" Left="9" Style="sty_lb_form_basic" TabOrder="9" Text="현장명&#32;" Top="72" VAlign="Middle" Width="92"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="SPT" Height="20" Id="ed_hogi" Left="103" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="11" Top="74" Width="441"></Edit>
		<Static Align="Right" Height="24" Id="Static17" Left="549" Style="sty_lb_form_basic" TabOrder="12" Text="계약&#32;만료일&#32;" Top="72" VAlign="Middle" Width="88"></Static>
		<Calendar BindDataset="ds_head" Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="UMR" Dateformat="yyyy-MM-dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Enable="FALSE" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_zbosuin" Left="639" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="10" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="74" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="100"></Calendar>
		<Shape BKColor="user12" Bottom="122" Height="26" Id="Shape3" Left="8" LineColor="user13" Right="744" TabOrder="13" Top="96" Type="Rectangle" Width="736"></Shape>
		<Static Align="Right" Height="24" Id="Static19" Left="9" Style="sty_lb_form_basic" TabOrder="14" Text="고객명&#32;" Top="97" VAlign="Middle" Width="92"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="NAM" Height="20" Id="ed_lifnr" Left="103" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="16" Top="99" Width="441"></Edit>
		<Static Align="Right" Height="24" Id="Static20" Left="549" Style="sty_lb_form_basic" TabOrder="17" Text="계약&#32;해지일&#32;" Top="97" VAlign="Middle" Width="88"></Static>
		<Calendar BindDataset="ds_head" Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="UHJ" Dateformat="yyyy-MM-dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Enable="FALSE" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_zoipsu" Left="639" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" OnChanged="cal_zoipsu_OnChanged" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="15" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="99" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="100"></Calendar>
		<Shape BKColor="user12" Bottom="147" Height="26" Id="Shape4" Left="8" LineColor="user13" Right="744" TabOrder="18" Top="121" Type="Rectangle" Width="736"></Shape>
		<Static Align="Right" Height="24" Id="Static22" Left="9" Style="sty_lb_form_basic" TabOrder="19" Text="FM계약&#32;종류&#32;" Top="122" VAlign="Middle" Width="92"></Static>
		<Grid AreaSelect="TRUE" AutoFitEndLine="Hide" BindDataset="ds_list" BkColor2="default" BoldHead="true" Border="Flat" Bottom="431" CellMoving="TRUE" ColSelect="TRUE" ColSizing="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="179" Id="grd_list" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" OnHeadClick="grd_list_OnHeadClick" Right="744" RowHeight="20" Style="sty_grid" TabOrder="20" TabStop="true" Top="252" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="736">
			<contents>
				<format id="Default">
					<columns>
						<col width="25"/>
						<col width="73"/>
						<col width="73"/>
						<col width="148"/>
						<col width="70"/>
						<col width="70"/>
						<col width="60"/>
						<col width="35"/>
						<col width="80"/>
						<col width="80"/>
					</columns>
					<head>
						<cell align="center" col="0" display="text" font="굴림,9" text="NO"/>
						<cell align="center" col="1" display="text" font="굴림,9" text="WBS"/>
						<cell align="center" col="2" display="text" font="굴림,9" text="자재번호"/>
						<cell align="center" col="3" display="text" font="굴림,9" text="자재내역"/>
						<cell align="center" col="4" display="text" font="굴림,9" text="평가유형"/>
						<cell align="center" col="5" display="text" font="굴림,9" text="전송일"/>
						<cell align="center" col="6" display="text" font="굴림,9" text="수량"/>
						<cell align="center" col="7" display="text" font="굴림,9" text="단위"/>
						<cell align="center" col="8" display="text" font="굴림,9" text="자재원가"/>
						<cell align="center" col="9" display="text" font="굴림,9" text="판매단가"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" colid="REQKIND" combocol="CODE" combodataset="ds_reqkind_cd" combotext="CODE_NAME" display="text" expr="currow+1"/>
						<cell align="center" bkcolor2="user22" col="1" colid="POSID" display="text"/>
						<cell align="center" bkcolor2="user22" col="2" colid="MATNR" display="text"/>
						<cell bkcolor2="user22" col="3" colid="MAKTX" display="text"/>
						<cell align="center" bkcolor2="user22" col="4" colid="BWTAR" combocol="CODE" combodataset="ds_bwtar" combotext="CODE_NAME" display="combo"/>
						<cell align="center" bkcolor2="user22" col="5" colid="SENDAT" display="date"/>
						<cell align="right" bkcolor2="user22" col="6" colid="MENGE" display="text"/>
						<cell align="center" bkcolor2="user22" col="7" colid="MEINS" display="text"/>
						<cell align="right" bkcolor2="user22" col="8" colid="SAMT2" display="null" Mask="###,###"/>
						<cell align="right" bkcolor2="user22" col="9" colid="NETPR" display="number" Mask="###,###"/>
					</body>
					<summary>
						<cell bkcolor="user25" col="0" color="user26" colspan="8" display="text">
							<cell align="center" col="0" color="user26" colspan="8" display="text" text="합&#32;계"/>
						</cell>
						<cell align="right" col="8" display="number" expr='sum(&quot;SAMT2&quot;)'/>
						<cell align="right" col="9" display="number" expr='sum(&quot;NETPR&quot;)'/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Static Color="user5" Font="굴림,10,Bold" Height="20" Id="Static0" Left="28" TabOrder="2" Text="MMPR&#32;조회" Top="8" VAlign="Middle" Width="192"></Static>
		<Static Align="Right" Height="24" Id="Static6" Left="215" Style="sty_lb_form_basic" TabOrder="22" Text="거래선&#32;" Top="47" VAlign="Middle" Width="84"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="CST" Height="20" Id="ed_cst" Left="301" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="23" Top="49" Width="47"></Edit>
		<Combo BindDataset="ds_head" Border="Flat" CodeColumn="CODE" Column="KND" DataColumn="CODE_NAME" Enable="FALSE" Height="20" Id="cb_knd" InnerDataset="ds_knd" Left="102" Style="sty_ipt_form" TabOrder="24" Top="123" Width="100"></Combo>
		<Grid AreaSelect="TRUE" AutoFitEndLine="Hide" BindDataset="ds_glist" BkColor2="default" BoldHead="true" Border="Flat" Bottom="600" CellMoving="TRUE" ColSelect="TRUE" ColSizing="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="150" Id="Grid0" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" Right="744" RowHeight="20" Style="sty_grid" TabOrder="25" TabStop="true" Top="450" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="736">
			<contents>
				<format id="Default">
					<columns>
						<col width="90"/>
						<col width="90"/>
						<col width="85"/>
						<col width="81"/>
						<col width="85"/>
						<col width="85"/>
						<col width="85"/>
						<col width="110"/>
					</columns>
					<head>
						<cell align="center" col="0" display="text" font="굴림,9" text="지급예정월"/>
						<cell align="center" col="1" display="text" font="굴림,9" text="지급월"/>
						<cell align="center" col="2" display="text" font="굴림,9" text="기본기성"/>
						<cell align="center" col="3" display="text" font="굴림,9" text="인센티브1"/>
						<cell align="center" col="4" display="text" font="굴림,9" text="인센티브2"/>
						<cell align="center" col="5" display="text" font="굴림,9" text="인센티브3"/>
						<cell align="center" col="6" display="text" font="굴림,9" text="인센티브4"/>
						<cell align="center" col="7" display="text" font="굴림,9" text="합계"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" colid="JYM" display="text" Mask="####.##"/>
						<cell align="center" bkcolor2="user22" col="1" colid="GYM" display="text" Mask="####.##"/>
						<cell align="right" bkcolor2="user22" col="2" colid="BAM" display="number" Mask="###,###"/>
						<cell align="right" bkcolor2="user22" col="3" colid="IY1" display="number" Mask="###,###"/>
						<cell align="right" bkcolor2="user22" col="4" colid="IY2" combocol="CODE" combodataset="ds_bwtar" combotext="CODE_NAME" display="number" Mask="###,###"/>
						<cell align="right" bkcolor2="user22" col="5" colid="IY3" display="number" Mask="###,###"/>
						<cell align="right" bkcolor2="user22" col="6" colid="IY4" display="number" Mask="###,###"/>
						<cell align="right" bkcolor2="user22" col="7" colid="SUM" display="number" Mask="###,###"/>
					</body>
					<summary>
						<cell bkcolor="user25" col="0" color="user26" colspan="7" display="text">
							<cell align="center" col="0" color="user26" colspan="7" display="text" text="합&#32;계"/>
						</cell>
						<cell align="right" col="7" display="number" expr='sum(&quot;SUM&quot;)'/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Static Height="20" Id="st_jajae" Left="12" TabOrder="26" Text="※&#32;자재내역" Top="234" VAlign="Middle" Width="84"></Static>
		<Static Height="18" Id="st_gisung" Left="13" TabOrder="27" Text="※&#32;기성내역" Top="433" VAlign="Middle" Width="84"></Static>
		<Static Align="Right" Height="24" Id="Static1" Left="549" Style="sty_lb_form_basic" TabOrder="28" Text="계약&#32;연차&#32;&#32;&#32;&#32;" Top="121" VAlign="Middle" Width="88"></Static>
		<Edit Align="CENTER" BindDataset="ds_head" Border="Flat" Column="YEAR" Height="20" Id="Edit0" Left="638" LeftMargin="4" OnChanged="Edit0_OnChanged" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="29" Top="124" Width="103"></Edit>
		<Shape BKColor="user12" Bottom="628" Height="26" Id="sh_app" Left="9" LineColor="user13" Right="744" TabOrder="31" Top="602" Type="Rectangle" Visible="FALSE" Width="735"></Shape>
		<Static Align="Right" Height="24" Id="st_app" Left="10" Style="sty_lb_form_basic" TabOrder="32" Text="결재상태&#32;" Top="603" VAlign="Middle" Visible="FALSE" Width="70"></Static>
		<Combo BindDataset="ds_head" Border="Flat" CodeColumn="CODE" Column="APSTAT" DataColumn="DTEXT1" Enable="FALSE" Height="20" Id="cb_apstat" InnerDataset="ds_apstat" Left="80" Style="sty_ipt_search" TabOrder="32" Top="604" Visible="FALSE" Width="116"></Combo>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_rdate" ImageID="btn_sub_05" Left="368" LeftMargin="12" OnClick="fn_SaveRdate" Style="sty_btn" TabOrder="30" Text="납기일저장" Top="605" Transparent="TRUE" Visible="FALSE" Width="85"></Button>
		<Static Align="Right" Height="24" Id="Static2" Left="351" Style="sty_lb_form_basic" TabOrder="34" Text="FM&#32;대수&#32;" Top="47" VAlign="Middle" Width="84"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="F_CNT" Height="20" Id="ed_fcnt" Left="437" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="35" Top="49" Width="43"></Edit>
		<Shape BKColor="user12" Bottom="232" Height="86" Id="Shape0" Left="8" LineColor="user13" Right="744" TabOrder="36" Top="146" Type="Rectangle" Width="736"></Shape>
		<Static Align="Right" Height="85" Id="Static3" Left="9" Style="sty_lb_form_basic" TabOrder="37" Text="문제점&#32;내용" Top="147" VAlign="Middle" Width="92"></Static>
		<Static Align="Right" Height="85" Id="Static7" Left="345" Style="sty_lb_form_basic" TabOrder="38" Text="기안자&#32;의견" Top="147" VAlign="Middle" Width="92"></Static>
		<Static Align="Right" Height="24" Id="Static8" Left="215" Style="sty_lb_form_basic" TabOrder="39" Text="예상&#32;시행율" Top="121" VAlign="Middle" Width="92"></Static>
		<Edit Border="Flat" Height="20" Id="ed_per" ImeMode="none" Left="309" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="40" Top="124" Width="83"></Edit>
		<TextArea BindDataset="ds_list_a" Border="Flat" Column="ZCAUSETXT2" Height="84" Id="tx_apdesc" Left="102" MaxLength="100" Readonly="TRUE" Style="sty_ipt_form" TabOrder="41" Top="148" VScroll="TRUE" Width="241"></TextArea>
		<TextArea BindDataset="ds_aplist" Border="Flat" Column="APDESC" Height="84" Id="TextArea0" Left="438" MaxLength="100" Readonly="TRUE" Style="sty_ipt_form" TabOrder="42" Top="148" VScroll="TRUE" Width="306"></TextArea>
		<Edit Align="CENTER" Border="Flat" Height="20" Id="ed_reg" Left="520" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="43" Text="(전결규정)" Top="605" Width="121"></Edit>
		<Static Align="Center" Height="24" Id="Static13" Left="197" Style="sty_lb_form_basic" TabOrder="44" Text="납기일" Top="603" VAlign="Middle" Width="65"></Static>
		<Calendar BindDataset="ds_list_a" Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="RDATE" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Enable="FALSE" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_shdat" Left="263" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="45" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="605" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="105"></Calendar>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_app" ImageID="btn_sub_06" Left="645" LeftMargin="12" OnClick="btn_app_OnClick" Style="sty_btn" TabOrder="46" Text="결재선&#32;지정" Top="605" Transparent="TRUE" Visible="FALSE" Width="96"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_rdraft" ImageID="btn_sub_03" Left="454" LeftMargin="12" OnClick="fn_Redraft" Style="sty_btn" TabOrder="47" Text="재기안" Top="605" Transparent="TRUE" Visible="FALSE" Width="62"></Button>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : FM 청구 내역 조회
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::common_cs.js";	// 서비스 공통 스크립트
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var tot = toNumber(105900);	//검사비
var cal_ky = 0;
var year1, year2, year3, year4, year5 = 0;
var fa_apcall; // 유상기간이 만료되어 데이터 조회가 되지 않을시에 해당 변수로 팝업을 종료시키므로 변수를 추가함. 2019.06.25 Han J.H
var vDPT = "";
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	// Form 로드 이벤트 맨 첫줄에 기술 
	gfn_initForm();
	// 자재번호 설정
	ds_cond.setColumn(0, "PJT", fa_pjt);
	ds_cond.setColumn(0, "CUDAT", gfn_getCurrDate());
    ds_cond.SetColumn(0, "REQNR", fa_reqnr);
    ds_cond.SetColumn(0, "REQNO", fa_reqno);
    ds_cond.SetColumn(0, "DNO",   fa_reqno);
    ds_cond.SetColumn(0, "UPN",   substr(fa_upn,0,6));
    ds_cond.SetColumn(0, "CST",   substr(fa_upn,6));
	ds_head.SetColumn(0, "PJT", fa_pjt);
	
    // 자재평가유형코드 DataSet 가져오기
    var codeArr = ["2","CS129","WBAP_STAT"];
    var dsObjArr = [ds_bwtar,ds_knd,ds_apstat];
    var addTypeArr = [G_CODE_NONE,G_CODE_NONE,G_CODE_NONE];
    gfn_searchCommCode(codeArr, dsObjArr, addTypeArr,true);
    
    if(fa_bom == 'Y')	//BOM청구PGM에서 조회시 버튼비활성화	2015.07.07 YAR
	{
		div_btn.btn_decide.Enable 	= false;	// 결재버튼
		div_btn.btn_draft.Enable  	= false;	// 기안버튼
		div_btn.btn_sendback.Enable = false;  	// 반송버튼
		div_btn.btn_print.Enable  	= false;	// 출력버튼
		btn_app.Enable = false;
	}
    // 버튼초기화
	div_btn.btn_decide.Enable 	= false;	// 결재버튼
	div_btn.btn_draft.Enable  	= false;	// 기안버튼
	div_btn.btn_sendback.Enable = false;  	// 반송버튼

	//============== 수신부서 결재그룹 체크 ===============================	
	gfn_initDs(ds_rcond, true);
	ds_rcond.SetColumn(0, "ZPROGRAM", "WBAP_DOCKIND");
	ds_rcond.SetColumn(0, "GBN", "01");	
	vDPT = gfn_getAuthDpt(ds_rcond);
	ds_rcond.ClearData();
    //=========================================================    
    
    fn_query();
}
/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {

}
/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}
//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 1
********************************************************************************/
function fn_query() {
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs01:CS0102001C_S1", null, true);
	tit_addSearchActionInfo("cs01:CS0102001C_S11", null, true);	//EL, ES 대수 구분 
	
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond"
        , "ds_head=ds_head ds_chk2=ds_chk2"
        , ""
        , "fn_afterQuery"
        , true);
}


/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}
/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {
	//Excel Export 
	gfn_saveToExcel(grd_list, true);
}
/********************************************************************************
* 기      능   : 결재 15
********************************************************************************/
function fn_decide() {
	var decidertn;   // 결재 팝업 리턴코드
	
	gfn_clearMsgBar();
	
	if( ds_decide.rowCount() < 1 ) {
		return;
	}
	
	//if( !gfn_showConfirm("CI00014", "문서번호 : "+ quote(ds_decide.GetColumn(0,"DOCNO"))+ "결재") ) return;
	decidertn = gfn_showConfirm_decide("CI00014", "문서번호 : "+ quote(ds_decide.GetColumn(0,"DOCNO"))+ "결재") ;	
	if(decidertn == "C") return; //A : 승인, C : 취소 , W : 의견승인
	
	//----------------------------------------------------------------------
	// 의견 입력 팝업 추가 
	// f팝업 전달 변수 fa_docno : 문서번호 ,fa_dockind : 문서종류 
	// return 값 : rtn_yn (Y:의견입력됨 N:의견입력안됨)
	
	//if(gfn_showConfirm("CW10025","의견을 입력하시겠습니까?") )
	if( decidertn == "W" )    //의견입력 승인시
	{
		var arg = "";
		arg = " fa_docno=" + quote(ds_decide.GetColumn(0,"DOCNO")) +" fa_dockind=" + quote(ds_decide.GetColumn(0,"DOCKIND"));
		var rtn_yn = gfn_openPopup2("CS0401001C", true , arg);
	}
	//alert("rtn_yn:"+rtn_yn);
	// 의견입력 팝업 종료
	//----------------------------------------------------------------------
	
	tit_clearActionInfo();
	// 결재상태변경
	ds_decide.SetColumn(0, "SEQSTAT", "3");
	tit_addMultiActionInfo("cs04:CS0401002A_U2");
 	tit_addMultiActionInfo("cs04:CS0401002A_U3");
	tit_callService(
		  ""
		, ""
		, "ds_list_0=ds_decide"
		, ""
		, ""
		, "fn_afterDecide"
		, true);
}
/********************************************************************************
* 기      능   : 결재 Callback  
********************************************************************************/
function fn_afterDecide(errCode, errMsg) {
	if ( ds_error.rowcount() > 0 ) {
		gfn_showAlert("CE00001");
	} else {
		gfn_showAlert("CI00003");
		div_btn.btn_decide.Enable 	= false;	// 결재버튼
		div_btn.btn_print.Enable  	= false;	// 출력버튼
		div_btn.btn_sendback.Enable = false;  	// 반송버튼
		//parent.fn_query();
		fn_close();
	}
}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	if(ds_head.rowcount > 0)
	{	
		ds_head.SetColumn(0, "CNT_S", ds_chk2.GetColumn(0, "CNT_S"));
		tit_clearActionInfo();
		tit_addSearchActionInfo("cs01:CS0102001C_S2", null, true);
		tit_addSearchActionInfo("cs01:CS0102001C_S3", null, true);
		tit_addSearchActionInfo("cs01:CS0102001C_S13", null, true);		//수주금액조회
				
		if(ds_chk2.GetColumn(0, "CNT_L") > 0 && ds_chk2.GetColumn(0, "CNT_S") > 0)	//L,S호기 모두 있는 경우
		{	
			tit_addSearchActionInfo("cs01:CS0102001C_S12", null, true);
		}
		else 
		{
			tit_addSearchActionInfo("cs01:CS0102001C_S4", null, true);
		}
	    tit_addSearchActionInfo("cs01:CS0102001C_S6", null, true);
	    // 결재자조회
	    ds_cond.SetColumn( 0, "DNO", ds_head.GetColumn(0, "REQNO") );
		tit_addSearchActionInfo("cs11:CS1101001B_S9");
		
		tit_callService(
			""
			, ""
			, "ds_head=ds_head ds_cond=ds_cond ds_date=ds_date ds_head=ds_head"
			, "ds_list=ds_list ds_glist=ds_glist ds_date_2=ds_date_2 ds_date=ds_date ds_list_a=ds_list_a ds_decide=ds_decide"
			, ""
			, "fn_afterQuery2"
			, true);

	}
	else
	{
		gfn_showAlert("CW00010");
		if (fa_apcall == null && fa_apcall != "Y")
		{
			close();
		} else {
			btn_app.Visible = true;
		}
	}
} 
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery2(errCode, errMsg) {

	var tmp_webaz = 0;
	var max_webaz = 0;
	var cal_date_fr, cal_date_to;
	
	//결재 -> 기안미진행인 경우에만 납기일 체크하여 재조정 가능토록 추가  2016.03.10 YAR
	//APSTAT = '0' 기안미진행 / '1' 기안진행중 
	if(ds_head.GetColumn(0, "APSTAT") == '0')
	{	
		if(!check_Rdate())	return false;
	}
    //계약 년차 표기 
    // var s_date = ds_date.GetColumn(0, "SDATE");
    // var e_date = gfn_getCurrDate();
    // var month_day = gfn_getMonthCnt(s_date, e_date);
    // var month_cal = Round(((parseInt(month_day) / 12) + 0.499999));
    // var year_cal = month_cal + "년차";계

    sh_app.Visible 		= true;
	cb_apstat.Visible 	= true;
	st_app.Visible 		= true;
    
	
	for (var i = 0; i < ds_date.RowCount(); i++)
	{
		if (ds_date.GetColumn(i, "GNO") = ds_head.GetColumn(0, "GNO"))
		{
			ds_head.SetColumn(0, "YEAR", ds_date.GetColumn(i, "CHASU"));
		}
	}	
    ds_date_1.AddRow();
  //  ds_date_2.AddRow();
    ds_date_1.SetColumn(0, "CUDAT", ds_head.GetColumn(0, "CUDAT"));
    ds_date_1.SetColumn(0, "SDATE", ds_date.GetColumn(0, "SDATE"));
    ds_date_1.SetColumn(0, "EDATE", ds_date.GetColumn(0, "EDATE"));                
    ds_date_1.SetColumn(0, "UPN", ds_date.GetColumn(0, "UPN"));                
    ds_date_1.SetColumn(0, "CST", ds_date.GetColumn(0, "CST"));                        
    
    //1년차 기간
    ds_glist_1.Filter("YEAR == " + quote(ds_date_1.GetColumn(0, "A_CHASU")));
    ds_date_1.SetColumn(0, "A_SDATE", ds_date.GetColumn(0, "SDATE"));
    ds_date_1.SetColumn(0, "A_EDATE", ds_date.GetColumn(0, "EDATE"));
    ds_date_1.SetColumn(0, "A_CHASU", ds_date.GetColumn(0, "CHASU_1"));
    //ds_date_1.SetColumn(0, "A_AMT", ds_date.GetColumn(0, "AMT"));
    ds_date_1.SetColumn(0, "A_AMT", ds_date_2.GetColumn(0, "AMT"));
    if (length(ds_date.GetColumn(0, "EDATE")) > 0 )
    {
       ds_date_1.SetColumn(0, "EDATE", ds_date.GetColumn(0, "EDATE"));                    
    }
    ds_date_1.SetColumn(0, "A_UMS", ds_date.GetColumn(0, "UMS"));
	ds_date_1.SetColumn(0, "A_ZSPEC3", ds_date.GetColumn(0, "ZSPEC3"));
    
    //2년차 기간
    ds_date_1.SetColumn(0, "B_SDATE", ds_date.GetColumn(1, "SDATE"));
    ds_date_1.SetColumn(0, "B_EDATE", ds_date.GetColumn(1, "EDATE"));
    ds_date_1.SetColumn(0, "B_CHASU", ds_date.GetColumn(1, "CHASU_1"));
    // ds_date_1.SetColumn(0, "B_AMT", ds_date.GetColumn(1, "AMT"));
    ds_date_1.SetColumn(0, "B_AMT", ds_date_2.GetColumn(1, "AMT"));
    if (length(ds_date.GetColumn(1, "EDATE")) > 0 )
    {
       ds_date_1.SetColumn(0, "EDATE", ds_date.GetColumn(1, "EDATE"));                    
    }
    ds_date_1.SetColumn(0, "B_UMS", ds_date.GetColumn(1, "UMS"));
	ds_date_1.SetColumn(0, "ZSPEC3", ds_date.GetColumn(1, "ZSPEC3"));
	        
    //3년차
    ds_date_1.SetColumn(0, "C_SDATE", ds_date.GetColumn(2, "SDATE"));
    ds_date_1.SetColumn(0, "C_EDATE", ds_date.GetColumn(2, "EDATE"));
    ds_date_1.SetColumn(0, "C_CHASU", ds_date.GetColumn(2, "CHASU_1"));
    //ds_date_1.SetColumn(0, "C_AMT", ds_date.GetColumn(2, "AMT"));
    ds_date_1.SetColumn(0, "C_AMT", ds_date_2.GetColumn(2, "AMT"));
    if (length(ds_date.GetColumn(2, "EDATE")) > 0 )
    {
       ds_date_1.SetColumn(0, "EDATE", ds_date.GetColumn(2, "EDATE"));                    
    }
    ds_date_1.SetColumn(0, "C_UMS", ds_date.GetColumn(2, "UMS"));
	ds_date_1.SetColumn(0, "ZSPEC3", ds_date.GetColumn(2, "ZSPEC3"));
	    
    //4년차
    ds_date_1.SetColumn(0, "D_SDATE", ds_date.GetColumn(3, "SDATE"));
    ds_date_1.SetColumn(0, "D_EDATE", ds_date.GetColumn(3, "EDATE"));
    ds_date_1.SetColumn(0, "D_CHASU", ds_date.GetColumn(3, "CHASU_1"));
    //ds_date_1.SetColumn(0, "D_AMT", ds_date.GetColumn(3, "AMT"));
    ds_date_1.SetColumn(0, "D_AMT", ds_date_2.GetColumn(3, "AMT"));
    if (length(ds_date.GetColumn(3, "EDATE")) > 0 )
    {
       ds_date_1.SetColumn(0, "EDATE", ds_date.GetColumn(3, "EDATE"));                    
    }
    ds_date_1.SetColumn(0, "D_UMS", ds_date.GetColumn(3, "UMS"));
	ds_date_1.SetColumn(0, "ZSPEC3", ds_date.GetColumn(3, "ZSPEC3"));
	     
    //5년차
    ds_date_1.SetColumn(0, "E_SDATE", ds_date.GetColumn(4, "SDATE"));
    ds_date_1.SetColumn(0, "E_EDATE", ds_date.GetColumn(4, "EDATE"));     
    ds_date_1.SetColumn(0, "E_CHASU", ds_date.GetColumn(4, "CHASU_1"));
    //ds_date_1.SetColumn(0, "E_AMT", ds_date.GetColumn(4, "AMT"));
    ds_date_1.SetColumn(0, "E_AMT", ds_date_2.GetColumn(4, "AMT"));
    if (length(ds_date.GetColumn(4, "EDATE")) > 0 )
    {
       ds_date_1.SetColumn(0, "EDATE", ds_date.GetColumn(4, "EDATE"));                    
    }     
    // ds_date_1.SetColumn(0, "E_SDATE", gfn_getafterDate(ds_date.GetColumn(0, "SDATE"), 1461));
    // ds_date_1.SetColumn(0, "E_EDATE", gfn_getafterDate(ds_date.GetColumn(0, "E_SDATE"), 364));    
    ds_date_1.SetColumn(0, "E_UMS", ds_date.GetColumn(4, "UMS"));
	ds_date_1.SetColumn(0, "ZSPEC3", ds_date.GetColumn(4, "ZSPEC3"));

	//예상시행율 출력 위한 로직추가 2015.04.09 YAR
	if(ds_head.rowcount > 0)
	{		
		tit_clearActionInfo();
	    tit_addSearchActionInfo("cs01:CS0102001C_S5", null, true); //자재원가	    
	    if(ds_glist.GetColumn(0, "GBU") <> '3') //직영현장의 경우 기성비 집계 2015.04.14 YAR
	    {
			tit_addSearchActionInfo("cs01:CS0102001C_S9", null, true); 
		}
		else{
			tit_addSearchActionInfo("cs01:CS0102001C_S7", null, true); //기성비
		}
		tit_callService(
			""
			, ""
			, "ds_date_1=ds_date_1 ds_head=ds_head"
			, "ds_list_b=ds_list_b ds_glist_1=ds_glist_1"
			, ""
			, "fn_afterQuery3"
			, true);
	}
    
    // 결재선 등록
    var user_grp = gfn_getUserGroup();
	if(user_grp > "10" || length(G_DPT1) > 0) // 내부직원 작성가능
	{
		sh_app.Visible = true;
		cb_apstat.Visible = true;
		st_app.Visible = true;

		// 변경 전
		//기안자 접수자는 화면에서 결재선 지정
		// if (parseInt(ds_head.GetColumn(0,"APSTAT")) < 1 || (ds_head.GetColumn(0,"APSTAT") == "3" && ds_head.GetColumn(0,"REDPT1") == G_DPT1)
		    // || (ds_head.GetColumn(0, "APSTAT") == "5" || ds_head.GetColumn(0, "APSTAT") == "2"))
		// {
		    // if(ds_list_a.GetColumn(0, "REQKIND") == "9" || ds_list_a.GetColumn(0, "REQKIND") == "H"){
					// btn_rdraft.Visible = true;
			// }
			// btn_app.Visible = true;
		// } else {
			// btn_app.Visible = false;
		// }

		// 기안자 접수자는 화면에서 결재선 지정
		//if (parseInt(ds_head.GetColumn(0,"APSTAT")) < 1 || (ds_head.GetColumn(0,"APSTAT") == "3" && ds_head.GetColumn(0,"REDPT1") == G_DPT1)
		//   || (ds_head.GetColumn(0, "APSTAT") == "5" || ds_head.GetColumn(0, "APSTAT") == "2"))
		if (parseInt(ds_head.GetColumn(0,"APSTAT")) < 1 || (ds_head.GetColumn(0,"APSTAT") == "3" && ds_head.GetColumn(0,"REDPT1") == vDPT)
		    || (ds_head.GetColumn(0, "APSTAT") == "5" || ds_head.GetColumn(0, "APSTAT") == "2"))
		{
		    /*if((ds_head.GetColumn(0, "DOCNO") > 0) && (ds_head.GetColumn(0, "APSTAT") == "5" || ds_head.GetColumn(0, "APSTAT") == "2")){
					btn_rdraft.Visible = true;
			}
			btn_app.Visible = true;*/
			
			if((ds_head.GetColumn(0, "DOCNO") > 0) && (ds_head.GetColumn(0, "APSTAT") == "5" || ds_head.GetColumn(0, "APSTAT") == "2")){
					btn_rdraft.Visible = true;
			} else {
				// 2020.09.24 기안반송 및 수신반송의 경우 결재선 지정이 무조건 보이게 되어 있어, 재기안 버튼 눌르고 결재선 지정 버튼 보이도록 수정.
				btn_app.Visible = true;
			}
			
		} else {
			btn_rdraft.Visible = false;
			btn_app.Visible = false;
		}	
		
		// 결재
		// if (parseInt(ds_head.GetColumn(0,"APSTAT")) < 1 || (ds_head.GetColumn(0,"APSTAT") == "3" && ds_head.GetColumn(0,"REDPT1") == G_DPT1)
			// || (ds_head.GetColumn(0, "APSTAT") == "5" || ds_head.GetColumn(0, "APSTAT") == "2"))
		// 임시 주석처리
		/*if (parseInt(ds_head.GetColumn(0,"APSTAT")) < 1 || (ds_head.GetColumn(0,"APSTAT") == "3" && ds_head.GetColumn(0,"REDPT1") == vDPT)
			|| (ds_head.GetColumn(0, "APSTAT") == "5" || ds_head.GetColumn(0, "APSTAT") == "2"))
		{ 
			 if((ds_head.GetColumn(0, "DOCNO") > 0) && (ds_head.GetColumn(0, "APSTAT") == "5" || ds_head.GetColumn(0, "APSTAT") == "2")){
					btn_rdraft.Visible = true;
			}
		    btn_app.Visible = true;
		    
		} else {
			btn_rdraft.Visible = false;
			btn_app.Visible = false;
		}*/

		if(G_USER_ID == "3011038" || G_USER_ID == "2020882" || G_USER_ID == "2025418" || G_USER_ID == "2018209") { // 윤경환KJ, 이동진SW , 이세호sw 결재선 지정 활성화(내부조직변경)
		    btn_app.Visible = true;
		}

		// 기안진행(1), 수신진행(4) 일때 결재자일때 결재버튼 활성화.
		// alert( 'G_USER_ID:' + G_USER_ID );
		// alert( 'APNUM:' + substr(ds_decide.GetColumn(0, "APNUM"),1) );
		// alert( 'APSTAT:' + ds_head.GetColumn(0, "APSTAT") );
		if( (ds_head.GetColumn(0,"APSTAT") > '0' && ds_head.GetColumn(0,"APSTAT") != '3' && ds_head.GetColumn(0,"APSTAT") < '6') && G_USER_ID == substr(ds_decide.GetColumn(0, "APNUM"),1) ) {
			div_btn.btn_decide.Enable   = true;		// 결재버튼
			div_btn.btn_sendback.Enable = true;		// 반송버튼
		} else {
			div_btn.btn_decide.Enable = false;		// 결재버튼
			div_btn.btn_sendback.Enable = false;	// 반송버튼
		}
		ufn_getApprovalData();
	} else 
	{
		btn_app.Visible = false;
		//보수협력사로 로그인 했을 경우 기안 접수가 가능해야한다.
		if( user_grp == "10" && ds_head.GetColumn(0,"APSTAT") == '0' ) {
			btn_app.Visible 	= true;
			ufn_getApprovalData();
		}
	}
}
function fn_sum(errCode, errMsg) {
	//경비,검사비,기성비 계산 	2015.04.30 YAR
	var a_ums = parseInt(ds_date_1.GetColumn(0, "A_UMS"));
	var b_ums = parseInt(ds_date_1.GetColumn(0, "B_UMS"));
	var c_ums = parseInt(ds_date_1.GetColumn(0, "C_UMS"));
	var d_ums = parseInt(ds_date_1.GetColumn(0, "D_UMS"));
	var e_ums = parseInt(ds_date_1.GetColumn(0, "E_UMS"));
	var zspec3 = toNumber(ds_date.GetColumn(0, "ZSPEC3"));
	var fa_amt = parseInt(fa_amt);

    //직영현장 기성비 계산 (zcsr152r 인건비 + (지사별노무비 * 계약개월수 * 속도 * 1.086))
	if(ds_glist.GetColumn(0, "GBU") <> '3') {
		ds_glist_2.SetColumn(0, "SUM1", round((fa_amt*a_ums*zspec3*1.086),3));
		ds_glist_2.SetColumn(0, "SUM2", round((fa_amt*b_ums*zspec3*1.086),3));
		ds_glist_2.SetColumn(0, "SUM3", round((fa_amt*c_ums*zspec3*1.086),3));
		ds_glist_2.SetColumn(0, "SUM4", round((fa_amt*d_ums*zspec3*1.086),3));
		ds_glist_2.SetColumn(0, "SUM5", round((fa_amt*e_ums*zspec3*1.086),3));
	}
	//경비계산 (협력사: 기성비 * 19.2% + 한달치보수료(인센티브) / 직영: 기성비 * 21.8% )
	if(ds_glist.GetColumn(0, "GBU") <> '3'){
		cal_ky = toNumber(0.218);
	}
	else{	
		cal_ky = toNumber(0.192);
	}
	//해당 연차 값 있는지 check
	if(a_ums == 0) {ds_chk.SetColumn(0, "YEAR1", 0);} else{ds_chk.SetColumn(0, "YEAR1", 1);}
	if(b_ums == 0) {ds_chk.SetColumn(0, "YEAR2", 0);} else{ds_chk.SetColumn(0, "YEAR2", 1);}
	if(c_ums == 0) {ds_chk.SetColumn(0, "YEAR3", 0);} else{ds_chk.SetColumn(0, "YEAR3", 1);}
	if(d_ums == 0) {ds_chk.SetColumn(0, "YEAR4", 0);} else{ds_chk.SetColumn(0, "YEAR4", 1);}
	if(e_ums == 0) {ds_chk.SetColumn(0, "YEAR5", 0);} else{ds_chk.SetColumn(0, "YEAR5", 1);}
	year1 = toNumber(ds_chk.GetColumn(0, "YEAR1"));
	year2 = toNumber(ds_chk.GetColumn(0, "YEAR2"));
	year3 = toNumber(ds_chk.GetColumn(0, "YEAR3"));
	year4 = toNumber(ds_chk.GetColumn(0, "YEAR4"));
	year5 = toNumber(ds_chk.GetColumn(0, "YEAR5"));

	var flr = 0;	//S호기 FLOOR 변수
	//에스컬레이터 검사비는 층수 상관없이 대당 94,000원
	if(ds_chk2.GetColumn(0, "CNT_L") > 0 && ds_chk2.GetColumn(0, "CNT_S") > 0) {	//L/S호기 모두 있는 현장
		flr = ds_chk2.GetColumn(0, "CNT_S") * 94000;
	}
	if(ds_chk2.GetColumn(0, "CNT_S") > 0 && ds_chk2.GetColumn(0, "CNT_L") =0 ) {	//S호기만 있는 현장
		flr = ds_chk2.GetColumn(0, "CNT_S") * 94000;
		ds_glist_2.SetColumn(0, "TOT", flr);
		return;
	}	
	var cnt = ds_chk2.GetColumn(0, "CNT_L");
	//검사비계산 (대수 당 계산. 기본 6층까지 105,900원, 7층부터 층당 2,860원 증가) 
	for(var i = 7; i<= ds_date.GetColumn(0, "ZSPEC7"); i++)
	{
		tot += toNumber(2860);
		if(i == ds_date.GetColumn(0, "ZSPEC7"))
		{	
			ds_glist_2.SetColumn(0, "TOT", toNumber(tot*cnt)+flr);	
			return;
		}
	}
	ds_glist_2.SetColumn(0, "TOT", toNumber(tot*cnt)+flr);
}

function fn_afterQuery3(){	
	fn_sum();
	var cnt = ds_chk2.GetColumn(0, "CNT_L");
    ds_list_b.Filter("YEAR == " + quote(ds_date_1.GetColumn(0, "A_CHASU")));
	ds_glist_1.Filter("YEAR == " + quote(ds_date_1.GetColumn(0, "A_CHASU")));
	ds_kisung.AddRow();
	ds_kisung.SetColumn(0, "DATE", ds_date_1.GetColumn(0, "A_SDATE")+" ~   "+ds_date_1.GetColumn(0, "A_EDATE"));
	ds_kisung.SetColumn(0, "S_SAMT2", ds_list_b.Sum("SAMT2"));
	ds_kisung.SetColumn(0, "S_NETPR", ds_list_b.Sum("NETPR"));	
	ds_kisung.SetColumn(0, "S_SUM", (ds_glist_2.GetColumn(0,"SUM1")*cnt)+ds_glist_1.Sum("SUM"));	//임금인상반영 직영계산 + zcsr152r인건비
	ds_kisung.SetColumn(0, "CHASU", ds_date_1.GetColumn(0, "A_CHASU"));
	ds_kisung.SetColumn(0, "AMT", ds_date_1.GetColumn(0, "A_AMT"));
	ds_kisung.SetColumn(0, "PSPID", ds_date_1.GetColumn(0, "UPN"));
	ds_kisung.SetColumn(0, "UMS", ds_date.GetColumn(0, "UMS"));
	ds_kisung.SetColumn(0, "ZSPEC3", ds_date.GetColumn(0, "ZSPEC3"));
	ds_kisung.SetColumn(0, "TOT", parseInt(ds_glist_2.GetColumn(0, "TOT"))*year1);	//검사비
	ds_kisung.SetColumn(0, "K_TOT", ((ds_glist_2.GetColumn(0,"SUM1")*cnt)+ds_glist_1.Sum("SUM"))*cal_ky);
	ds_list_b.UnFilter();	
	ds_glist_1.UnFilter();
    
	ds_list_b.Filter("YEAR == " + quote(ds_date_1.GetColumn(0, "B_CHASU")));
	ds_glist_1.Filter("YEAR == " + quote(ds_date_1.GetColumn(0, "B_CHASU")));
	ds_kisung.AddRow();
	ds_kisung.SetColumn(1, "DATE", ds_date_1.GetColumn(0, "B_SDATE")+" ~   "+ds_date_1.GetColumn(0, "B_EDATE"));	
	ds_kisung.SetColumn(1, "S_SAMT2", ds_list_b.Sum("SAMT2"));
	ds_kisung.SetColumn(1, "S_NETPR", ds_list_b.Sum("NETPR"));
	ds_kisung.SetColumn(1, "S_SUM",  (ds_glist_2.GetColumn(0,"SUM2")*cnt)+ds_glist_1.Sum("SUM"));
	ds_kisung.SetColumn(1, "CHASU", ds_date_1.GetColumn(0, "B_CHASU"));
	ds_kisung.SetColumn(1, "AMT", ds_date_1.GetColumn(0, "B_AMT"));
	ds_kisung.SetColumn(1, "PSPID", ds_date_1.GetColumn(0, "UPN"));
	ds_kisung.SetColumn(1, "UMS", ds_date.GetColumn(1, "UMS"));
	ds_kisung.SetColumn(1, "ZSPEC3", ds_date.GetColumn(1, "ZSPEC3"));
	ds_kisung.SetColumn(1, "TOT", parseInt(ds_glist_2.GetColumn(0, "TOT"))*year2);
	ds_kisung.SetColumn(1, "K_TOT", ((ds_glist_2.GetColumn(0,"SUM2")*cnt)+ds_glist_1.Sum("SUM"))*cal_ky);
	ds_list_b.UnFilter();	
	ds_glist_1.UnFilter();

	ds_list_b.Filter("YEAR == " + quote(ds_date_1.GetColumn(0, "C_CHASU")));
	ds_glist_1.Filter("YEAR == " + quote(ds_date_1.GetColumn(0, "C_CHASU")));
	ds_kisung.AddRow();
	ds_kisung.SetColumn(2, "DATE", ds_date_1.GetColumn(0, "C_SDATE")+" ~   "+ds_date_1.GetColumn(0, "C_EDATE"));	
	ds_kisung.SetColumn(2, "S_SAMT2", ds_list_b.Sum("SAMT2"));
	ds_kisung.SetColumn(2, "S_NETPR", ds_list_b.Sum("NETPR"));
	ds_kisung.SetColumn(2, "S_SUM",  (ds_glist_2.GetColumn(0,"SUM3")*cnt)+ds_glist_1.Sum("SUM"));
	ds_kisung.SetColumn(2, "CHASU", ds_date_1.GetColumn(0, "C_CHASU"));
	ds_kisung.SetColumn(2, "AMT", ds_date_1.GetColumn(0, "C_AMT"));
	ds_kisung.SetColumn(2, "PSPID", ds_date_1.GetColumn(0, "UPN"));
	ds_kisung.SetColumn(2, "UMS", ds_date.GetColumn(2, "UMS"));
	ds_kisung.SetColumn(2, "ZSPEC3", ds_date.GetColumn(2, "ZSPEC3"));
	ds_kisung.SetColumn(2, "TOT", parseInt(ds_glist_2.GetColumn(0, "TOT"))*year3);
	ds_kisung.SetColumn(2, "K_TOT", ((ds_glist_2.GetColumn(0,"SUM3")*cnt)+ds_glist_1.Sum("SUM"))*cal_ky);
	ds_list_b.UnFilter();	
	ds_glist_1.UnFilter();

	ds_list_b.Filter("YEAR == " + quote(ds_date_1.GetColumn(0, "D_CHASU")));
	ds_glist_1.Filter("YEAR == " + quote(ds_date_1.GetColumn(0, "D_CHASU")));
	ds_kisung.AddRow();
	ds_kisung.SetColumn(3, "DATE", ds_date_1.GetColumn(0, "D_SDATE")+" ~   "+ds_date_1.GetColumn(0, "D_EDATE"));	
	ds_kisung.SetColumn(3, "S_SAMT2", ds_list_b.Sum("SAMT2"));
	ds_kisung.SetColumn(3, "S_NETPR", ds_list_b.Sum("NETPR"));
	ds_kisung.SetColumn(3, "S_SUM", (ds_glist_2.GetColumn(0,"SUM4")*cnt)+ds_glist_1.Sum("SUM"));
	ds_kisung.SetColumn(3, "CHASU", ds_date_1.GetColumn(0, "D_CHASU"));
	ds_kisung.SetColumn(3, "AMT", ds_date_1.GetColumn(0, "D_AMT"));
	ds_kisung.SetColumn(3, "PSPID", ds_date_1.GetColumn(0, "UPN"));
	ds_kisung.SetColumn(3, "UMS", ds_date.GetColumn(3, "UMS"));
	ds_kisung.SetColumn(3, "ZSPEC3", ds_date.GetColumn(3, "ZSPEC3"));
	ds_kisung.SetColumn(3, "TOT", parseInt(ds_glist_2.GetColumn(0, "TOT"))*year4);
	ds_kisung.SetColumn(3, "K_TOT", ((ds_glist_2.GetColumn(0,"SUM4")*cnt)+ds_glist_1.Sum("SUM"))*cal_ky);
	ds_list_b.UnFilter();	
	ds_glist_1.UnFilter();				

	ds_list_b.Filter("YEAR == " + quote(ds_date_1.GetColumn(0, "E_CHASU")));
	ds_glist_1.Filter("YEAR == " + quote(ds_date_1.GetColumn(0, "E_CHASU")));
	ds_kisung.AddRow();
	ds_kisung.SetColumn(4, "DATE", ds_date_1.GetColumn(0, "E_SDATE")+" ~   "+ds_date_1.GetColumn(0, "E_EDATE"));	
	ds_kisung.SetColumn(4, "S_SAMT2", ds_list_b.Sum("SAMT2"));
	ds_kisung.SetColumn(4, "S_NETPR", ds_list_b.Sum("NETPR"));
	ds_kisung.SetColumn(4, "S_SUM",  (ds_glist_2.GetColumn(0,"SUM5")*cnt)+ds_glist_1.Sum("SUM"));
	ds_kisung.SetColumn(4, "CHASU", ds_date_1.GetColumn(0, "E_CHASU"));
	ds_kisung.SetColumn(4, "AMT", ds_date_1.GetColumn(0, "E_AMT"));
	ds_kisung.SetColumn(4, "PSPID", ds_date_1.GetColumn(0, "UPN"));
	ds_kisung.SetColumn(4, "UMS", ds_date.GetColumn(4, "UMS"));
	ds_kisung.SetColumn(4, "ZSPEC3", ds_date.GetColumn(4, "ZSPEC3"));
	ds_kisung.SetColumn(4, "TOT", parseInt(ds_glist_2.GetColumn(0, "TOT"))*year5);
	ds_kisung.SetColumn(4, "K_TOT", ((ds_glist_2.GetColumn(0,"SUM5")*cnt)+ds_glist_1.Sum("SUM"))*cal_ky);
	ds_list_b.UnFilter();	
	ds_glist_1.UnFilter();
	
	var sum_percent = '';
	sum_percent = parseInt(ds_date_1.GetColumn(0, "A_AMT")) + parseInt(ds_date_1.GetColumn(0, "B_AMT")) + parseInt(ds_date_1.GetColumn(0, "C_AMT")) + parseInt(ds_date_1.GetColumn(0, "D_AMT")) + parseInt(ds_date_1.GetColumn(0, "E_AMT"));

    //ZMMT001에 데이터가 없더라도(미승인상태) FM출력시 해당 자재원가 표기 해야되므로 따로 계산 
	if (length(ds_list_a.GetColumn( 0, "REQNR")) < 1 )
	{
		if (ds_date_1.GetColumn(0, "A_SDATE") <= ds_list_a.GetColumn(0, "SENDAT") && ds_date_1.GetColumn(0, "A_EDATE") >= ds_list_a.GetColumn( 0, "SENDAT"))
		{
			ds_kisung.SetColumn(0, "S_SAMT2", parseInt(ds_kisung.GetColumn(0, "S_SAMT2")) + parseInt(ds_list_a.Sum("SAMT2")));
		}
		
		if (ds_date_1.GetColumn(0, "B_SDATE") <= ds_list_a.GetColumn( 0, "SENDAT") && ds_date_1.GetColumn(0, "B_EDATE") >= ds_list_a.GetColumn( 0, "SENDAT"))
		{
			ds_kisung.SetColumn(1, "S_SAMT2", parseInt(ds_kisung.GetColumn(1, "S_SAMT2")) + parseInt(ds_list_a.Sum("SAMT2")));
		}
		
		if (ds_date_1.GetColumn(0, "C_SDATE") <= ds_list_a.GetColumn( 0, "SENDAT") && ds_date_1.GetColumn(0, "C_EDATE") >= ds_list_a.GetColumn( 0, "SENDAT"))
		{
			ds_kisung.SetColumn(2, "S_SAMT2", parseInt(ds_kisung.GetColumn(2, "S_SAMT2")) + parseInt(ds_list_a.Sum("SAMT2")));
		}
		
		if (ds_date_1.GetColumn(0, "D_SDATE") <= ds_list_a.GetColumn( 0, "SENDAT") && ds_date_1.GetColumn(0, "D_EDATE") >= ds_list_a.GetColumn( 0, "SENDAT"))
		{
			ds_kisung.SetColumn(3, "S_SAMT2", parseInt(ds_kisung.GetColumn(3, "S_SAMT2")) + parseInt(ds_list_a.Sum("SAMT2")));
		}
	
		if (ds_date_1.GetColumn(0, "E_SDATE") <= ds_list_a.GetColumn( 0, "SENDAT") && ds_date_1.GetColumn(0, "E_EDATE") >= ds_list_a.GetColumn( 0, "SENDAT"))
		{
			ds_kisung.SetColumn(4, "S_SAMT2", parseInt(ds_kisung.GetColumn(4, "S_SAMT2")) + parseInt(ds_list_a.Sum("SAMT2")));
		}
	}
	
    var samt2 = 0;
    if(length(fa_reqnr) < 1){	//청구번호 없는경우, 자재내역에 표기된 자재원가 합산
		samt2 = toNumber(ds_list_a.Sum("SAMT2")) + toNumber(ds_list_b.Sum("SAMT2")); //자재원가합계
	}
	else {
		samt2 = toNumber(ds_list_b.Sum("SAMT2"));
	}
	//예상시행율 계산 2015.04.09 YAR     
	var sum = toNumber(ds_kisung.Sum("S_SUM"));                //기성비 
	//var amt = toNumber(ds_date.Sum("AMT"));	                   //수주금액
	var amt2 = toNumber(ds_kisung.Sum("AMT"));			       //수주금액(5년차까지)
	var tot = toNumber(ds_kisung.Sum("TOT"));   	           //검사비
	var k_tot = toNumber(ds_kisung.Sum("K_TOT"));	           //경비
	var gan = (samt2 + sum + tot + k_tot) * 0.093;             //간접비
	
	trace("수주금액-자재원가-기성비-경비-검사비-간접비-시행율");
	trace(amt2);
	trace(samt2);
	trace(sum);
	trace(k_tot);
	trace(tot);
	trace(gan);
	
	var per_si = round(((samt2 + sum + tot + k_tot + ((samt2 + sum + tot + k_tot) * 0.093)) / amt2) * 100 , 1); 
	ed_per.Text = per_si;
	ufn_setRegulation(ds_list.Sum("SAMT2"));	
}

/********************************************************************************
* 기      능   : 결재 데이터 조회
********************************************************************************/
function ufn_getApprovalData() {
	
    ds_apcond.SetColumn(0,"DOCNO", ds_head.GetColumn(0,"REQNO"));
    ds_apcond.SetColumn(0,"DOCKIND", "2");

   	tit_clearActionInfo();
	tit_addSearchActionInfo("cs04:CS0401000A_S1");

	tit_callService(
		 ""
		, ""
		, "ds_apcond=ds_apcond"
		, "ds_aplist=ds_aplist"
		, ""
		, ""
        , "");	
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 : 각 Component 별 이벤트 
//=========================================================================================
/********************************************************************************
* 기      능   : 그리드 헤더 클릭시 정렬 처리 
********************************************************************************/
function grd_list_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	if ( nCell == 0 ) {
		// 그리드 표시할 컬럼 선택 
		gfn_selectGridCol(obj);
	} else {
		// 그리드 정렬 처리 
		gfn_sortGrid(obj,nCell);
	}
}

// function btn_upn_OnClick(obj)
// {
	// var upn= null;
	// upn = gfn_openPopup("CS9601001A", true);

    // if (posid !=null ) {
		// ed_upn.value = upn[0];
		// ed_upn.value = upn[1];
		// fn_query();
    // }
// }

/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {
	// Excel Export 
	//gfn_saveToExcel(grd_list, true );
	gfn_saveToExcel(grd_sum, true );
}

/********************************************************************************
* 기      능   : 출력 1
********************************************************************************/
function fn_print() {
	
	var knd_txt = '';
	
	if (ds_head.GetColumn(0, "KND") == 'A') {
		knd_txt = '레귤러';
	}
	else if (ds_head.GetColumn(0, "KND") == 'B') {
		knd_txt = '프리미엄';		
	}
	else if (ds_head.GetColumn(0, "KND") == 'C') {
		knd_txt = '다이너스티';		
	}
	
	var	arg = " fa_knd=" + quote(knd_txt);
	arg += " fa_upn=" + quote(ed_upn.value);
	arg += " fa_cst=" + quote(ed_cst.value);
	arg += " fa_spt=" + quote(ed_hogi.value);
	arg += " fa_nam=" + quote(ed_lifnr.value);
	if( length(fa_qtnum) > 0 && fa_qtnum != null)
	{
		arg += " fa_qtnum=" + quote(fa_qtnum);
		arg += " fa_lgort1=" + quote(fa_lgort1);
		arg += " fa_vkgrp=" + quote(fa_vkgrp);
	} else
	{
		arg += " fa_qtnum=" + quote(ds_head.GetColumn(0, "QTNUM"));
		arg += " fa_lgort1=" + quote(ds_head.GetColumn(0, "LGORT1"));
		arg += " fa_vkgrp=" + quote(ds_head.GetColumn(0, "VKGRP"));
	}
	
	arg += " fa_usd=" + quote(ds_head.GetColumn(0, "USD"));
	arg += " fa_umr=" + quote(ds_head.GetColumn(0, "UMR"));
	arg += " fa_uhj=" + quote(ds_head.GetColumn(0, "UHJ"));
	arg += " fa_bosu=" + quote(ds_head.GetColumn(0, "ZBOSUIN"));	
	arg += " fa_year=" + quote(ds_head.GetColumn(0, "YEAR"));
	arg += " fa_acpt_num=" + quote(ds_head.GetColumn(0, "ACPT_NUM"));
	arg += " fa_txt=" + quote(ds_list_a.GetColumn(0, "ZCAUSETXT"));
	arg += " fa_txt2=" + quote(ds_list_a.GetColumn(0, "ZCAUSETXT2"));
	arg += " fa_reqkind=" + quote(ds_list_a.GetColumn(0, "REQKIND"));
	arg += " fa_f_cnt=" + quote(ed_fcnt.value);

	////UbiReport Call
	Dialog("CS01::CS0102001E.xml", arg);	
}

/********************************************************************************
* 기      능   : 그리드 헤더 클릭시 정렬 처리 
********************************************************************************/
function grd_list_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	if ( nCell == 0 ) {
		// 그리드 표시할 컬럼 선택 
		gfn_selectGridCol(obj);
	} else {
		// 그리드 정렬 처리 
		gfn_sortGrid(obj,nCell);
	}
}

// 결재선 지정 POPUP
function btn_app_OnClick(obj)
{
	// 보수협력사일 경우 기안접수테이블에 insert 한다.
	var user_grp = gfn_getUserGroup();
	if( user_grp == '10' ) {
		alert( '보수협력사일 경우 기안접수테이블에 insert 한다!' );
		return;
	}
    var appgubn = "S";
    	
	if(ds_head.GetColumn(0,"APSTAT") == "3") appgubn = "R";
	    
    var arg = "fa_docno=" + quote(ds_head.GetColumn(0,"REQNO")) + " fa_dockind =" + quote("2") + " fa_appgubn=" + quote(appgubn);
    
    if (length(fa_docno) > 0 && fa_apcall == "Y")
    {
		arg = "fa_docno=" + quote(fa_docno) + " fa_dockind =2" + " fa_appgubn=R";
    }

	var returnArgs = gfn_openPopup2("CS0401001A", true, arg);
	if( returnArgs[0] == 'S' ) {
		btn_app.Enable = false;
	}
}

/********************************************************************************
* 기      능   : 납기일저장 처리			2016.03.11 YAR 
********************************************************************************/
function fn_SaveRdate(obj)
{
	if(!check_Rdate())	return false;
	
	tit_clearActionInfo();
 	// 납기일 변경 처리 (ZMMT031)
 	tit_addMultiActionInfo("cs01:CS0102001C_U1");
	tit_callService(
		  ""
		, ""
		, "ds_rdate=ds_rdate" 
		, ""
		, ""
		, "fn_afterQuery"
		, true);
}

/********************************************************************************
* 기      능   : 반송 65
********************************************************************************/
function fn_sendback() {
	var decidertn;   // 결재 팝업 리턴코드
	
	gfn_clearMsgBar();
	
	if( ds_decide.rowCount() < 1 ) {
		// 승인할 정보 없음. 
		return;
	}
	
	//if( !gfn_showConfirm("CI00014", "문서번호 : "+ quote(ds_decide.GetColumn(0,"DOCNO"))+ "반송") ) return;
	decidertn = gfn_showConfirm_decide("CI00014", "문서번호 : "+ quote(ds_decide.GetColumn(0,"DOCNO"))+ "반송") ;	
	if(decidertn == "C") return; //A : 승인, C : 취소 , W : 의견승인
	
	//----------------------------------------------------------------------
	// 의견 입력 팝업 추가 
	// f팝업 전달 변수 fa_docno : 문서번호 ,fa_dockind : 문서종류 
	// return 값 : rtn_yn (Y:의견입력됨 N:의견입력안됨)
	
	//if(gfn_showConfirm("CW10025","의견을 입력하시겠습니까?") )
	if( decidertn == "W" )    //의견입력 승인시
	{
		var arg = "";
		arg = " fa_docno=" + quote(ds_decide.GetColumn(0,"DOCNO")) +" fa_dockind=" + quote(ds_decide.GetColumn(0,"DOCKIND"));
		var rtn_yn = gfn_openPopup2("CS0401001C", true , arg);
	}
	//alert("rtn_yn:"+rtn_yn);
	// 의견입력 팝업 종료
	//----------------------------------------------------------------------
	
	tit_clearActionInfo();
	
	// 결재상태변경
	ds_decide.SetColumn(0, "SEQSTAT", "2");
	// 결재정보 관리 - 차순별 결재정보  update(zwbap02)
 	tit_addMultiActionInfo("cs04:CS0401002A_U2");
 	// 현장지원 결재 정보 관리 update(zwbap01)
 	tit_addMultiActionInfo("cs04:CS0401002A_U3");

	tit_callService(
		  ""
		, ""
		, "ds_list_0=ds_decide" 
		, ""
		, ""
		, "fn_afterSendback"
		, true);
}

/********************************************************************************
* 기      능   : 반송 Callback  
********************************************************************************/
function fn_afterSendback(errCode, errMsg) {
	if ( ds_error.rowcount() > 0 ) {
		gfn_showAlert("CE00001");
	} else {
		gfn_showAlert("CI00003");
		div_btn.btn_decide.Enable 	= false;	// 결재버튼
		div_btn.btn_draft.Enable  	= false;	// 기안버튼
		div_btn.btn_print.Enable  	= false;	// 출력버튼
		div_btn.btn_save.Enable   	= false;	// 저장버튼
		div_btn.btn_sendback.Enable = false;  	// 반송버튼
		fn_query();
		//fn_close();
	}
}
/********************************************************************************
* 기      능   : 납기일 체크로직
********************************************************************************/
function check_Rdate(obj)
{
	var tmp_webaz = 0;
	var max_webaz = 0;
	var cal_date_fr, cal_date_to;
		
	ds_rdate.SetColumn(0, "REQNO", ds_head.GetColumn(0,"REQNO"));
	ds_rdate.SetColumn(0, "RDATE", cal_shdat.Value);
		
	for(var iCnt=0;iCnt<ds_list.rowcount;iCnt++)
	{
		tmp_webaz = ds_list.GetColumn(iCnt, "WEBAZ");
	
		if(parseInt(tmp_webaz) > parseInt(max_webaz)) {
			max_webaz = tmp_webaz;
		}
		if(tmp_webaz == "") tmp_webaz = 0;	
	}
	max_webaz = parseInt(max_webaz) + 1;
	//cal_date_to = gfn_getWorkingDate(max_webaz, '2000', gfn_getCurrDate());
	cal_date_to = gfn_getAfterDate(gfn_getCurrDate(), parseInt(max_webaz));
	if(cal_shdat.Value < cal_date_to) {
		
		cal_shdat.Enable = true;
		btn_rdate.Visible = true;
		gfn_showAlert("CW10025", "납기일은 자재의 LEADTIME을 계산하여 입력하시기 바랍니다. (" 
								+ cal_date_to + "이후)");
		return false;
	}
	return true;
}
/********************************************************************************
* 기      능   : 전결규정 설정	2015.04.20 YAR
********************************************************************************/
function ufn_setRegulation(samt2){
	//해당청구 건 자재원가합계 기준 
	//=====================================2019.03.05 전결규정 변경으로 인한 주석처리=============================================================
	/*if(toNumber(samt2) < 5000000)										//500만 미만
	{
		ed_reg.Text = "부서장 전결";
	}
	else if(toNumber(samt2) >= 5000000 && toNumber(samt2) < 10000000)	//500만 이상 1000만 미만
	{
		ed_reg.Text = "담당 전결";
	}
	else																//1000만 이상
	{
		ed_reg.Text = "본부장 전결";
	}*/
	//===========================================================================================================================================
	
	//====================================2019.03.05 전결규정 변경. 이동진 DL 요청===============================================================
	if(toNumber(samt2) < 3000000)										//300만 미만
	{
		ed_reg.Text = "팀장 전결";
	}
	else if(toNumber(samt2) >= 3000000 && toNumber(samt2) < 5000000)	//300만 이상 500만 미만
	{
		ed_reg.Text = "담당 전결";
	}
	else																//500만 이상
	{
		ed_reg.Text = "본부장 전결";
	}
	//===========================================================================================================================================
	
	//전결규정
	ed_reg.enable = true;
	ed_reg.color = "gray";
	ed_reg.bkColor = "#E9E9E9";
	ed_reg.readOnly = true;
	ed_reg.ToolTipText = "원가기준 전결규정";
}

function fn_Redraft(obj)	//반송 건 결재문서삭제
{
	if(length(ds_head.GetColumn(0, "DOCNO")) <> 0){	
		if(!gfn_showConfirm("CW10025","재기안하시겠습니까? (재기안시 기존 결재내역은 삭제되어 복구가 불가합니다.)") ) return;
	}
	tit_clearActionInfo();
	//결재 반송 데이터 삭제
 	tit_addMultiActionInfo("cs04:CS0401002A_D1");
 	tit_addMultiActionInfo("cs04:CS0401002A_D2");

	tit_callService(
		  ""
		, ""
		, "ds_head_0=ds_aplist" 
		, ""
		, ""
		, "fn_afterRedraft"
		, true);
}
}

function fn_afterRedraft(obj)	//반송 건 결재문서삭제
{
	fn_query();
}

]]></Script>
</Window>