<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="562" Id="Sbi0094" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="사양별&#32;특성값&#32;지정" Top="8" Ver="1.0" Width="980" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_error">
				<Contents>
					<colinfo id="IDX" size="256" type="STRING"/>
					<colinfo id="ERRMSG" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="BRNDCD" size="256" summ="default" type="STRING"/>
					<colinfo id="BRNDSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="PRH" size="256" summ="default" type="STRING"/>
					<colinfo id="ZPRDGBN" size="256" summ="default" type="STRING"/>
					<record>
						<BRNDCD></BRNDCD>
						<BRNDSEQ></BRNDSEQ>
						<PRH></PRH>
						<ZPRDGBN></ZPRDGBN>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_batch_sanyangPrd" OnColumnChanged="ds_batch_sanyangPrd_OnColumnChanged">
				<Contents>
					<colinfo id="MANDT" size="256" summ="default" type="STRING"/>
					<colinfo id="BRNDSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="ZPRDGBN" size="256" summ="default" type="STRING"/>
					<colinfo id="BRNDCD" size="256" summ="default" type="STRING"/>
					<colinfo id="PRH" size="256" summ="default" type="STRING"/>
					<colinfo id="MFLAG" size="256" summ="default" type="STRING"/>
					<colinfo id="MSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="MDATATYPE" size="256" summ="default" type="STRING"/>
					<colinfo id="MDISPTP" size="256" summ="default" type="STRING"/>
					<colinfo id="MMODITP" size="256" summ="default" type="STRING"/>
					<colinfo id="MEGISSND" size="256" summ="default" type="STRING"/>
					<colinfo id="MDIPSDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="PRD" size="256" summ="default" type="STRING"/>
					<colinfo id="DFLAG" size="256" summ="default" type="STRING"/>
					<colinfo id="DDATATYPE" size="256" summ="default" type="STRING"/>
					<colinfo id="DDISPTP" size="256" summ="default" type="STRING"/>
					<colinfo id="DDIPSDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="DSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="DCNT" size="256" summ="default" type="STRING"/>
					<colinfo id="ERRMSG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_excel"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zsdt1141">
				<Contents>
					<colinfo id="MANDT" size="256" summ="default" type="STRING"/>
					<colinfo id="BRNDSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="ZPRDGBN" size="256" summ="default" type="STRING"/>
					<colinfo id="BRNDCD" size="256" summ="default" type="STRING"/>
					<colinfo id="PRH" size="256" summ="default" type="STRING"/>
					<colinfo id="DISPTP" size="256" summ="default" type="STRING"/>
					<colinfo id="MODITP" size="256" summ="default" type="STRING"/>
					<colinfo id="EGISSND" size="256" summ="default" type="STRING"/>
					<colinfo id="DIPSDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="AENAM" size="256" summ="default" type="STRING"/>
					<colinfo id="AEDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="FLAG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zsdt1142">
				<Contents>
					<colinfo id="MANDT" size="256" summ="default" type="STRING"/>
					<colinfo id="BRNDSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="ZPRDGBN" size="256" summ="default" type="STRING"/>
					<colinfo id="BRNDCD" size="256" summ="default" type="STRING"/>
					<colinfo id="BRNDCDNM" size="256" summ="default" type="STRING"/>
					<colinfo id="PRH" size="256" summ="default" type="STRING"/>
					<colinfo id="PRD" size="256" summ="default" type="STRING"/>
					<colinfo id="DISPTP" size="256" summ="default" type="STRING"/>
					<colinfo id="DIPSDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="AEDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="AENAM" size="256" summ="default" type="STRING"/>
					<colinfo id="FLAG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_abrand">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="CHECK" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user0" Bottom="69" Height="26" Id="Shape1" Left="8" LineColor="user1" Right="976" TabOrder="1" Top="43" Type="Rectangle" Width="968"></Shape>
		<Static Align="Right" Height="24" Id="Static1" Left="8" Style="sty_lb_search" TabOrder="2" Text="브랜드차수&#32;" Top="43" VAlign="Middle" Width="65"></Static>
		<Grid AreaSelect="true" AutoEnter="TRUE" AutoFitEndLine="Hide" BkColor2="default" BoldHead="true" Border="Flat" Bottom="544" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="25" Height="464" Id="grd_batch_sanyangPrd" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" OnMouseOver="grd_batch_sanyangPrd_OnMouseOver" Right="973" RowHeight="20" Style="sty_grid" TabOrder="3" TabStop="true" Top="80" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="965">
			<contents>
				<format id="Default">
					<columns>
						<col width="38"/>
						<col width="80"/>
						<col width="32"/>
						<col width="42"/>
						<col width="99"/>
						<col width="59"/>
						<col width="67"/>
						<col width="77"/>
						<col width="79"/>
						<col width="40"/>
						<col width="51"/>
						<col width="126"/>
						<col width="65"/>
						<col width="90"/>
					</columns>
					<head>
						<cell align="center" col="0" display="text" rowspan="2" Valign="Center">
							<cell col="0" color="user21" display="text" font="굴림,9" text="브랜드" wordwrap="word"/>
							<cell col="0" color="user21" display="text" font="굴림,9" row="1" text="차수" wordwrap="word"/>
						</cell>
						<cell align="center" col="1" display="text" rowspan="2" Valign="Center">
							<cell col="0" color="user21" display="text" font="굴림,9" text="브랜드" wordwrap="word"/>
							<cell col="0" display="text" row="1"/>
						</cell>
						<cell col="2" colspan="7" display="text">
							<cell col="0" display="text"/>
							<cell align="center" col="7" color="user21" display="text" font="굴림,9" wordwrap="word"/>
							<cell align="center" col="6" color="user21" display="text" font="굴림,9" wordwrap="word"/>
							<cell align="center" col="5" color="user21" display="text" font="굴림,9" wordwrap="word"/>
							<cell align="center" col="4" color="user21" display="text" font="굴림,9" text="특성" wordwrap="word"/>
							<cell align="center" col="3" color="user21" display="text" font="굴림,9" wordwrap="word"/>
							<cell align="center" col="2" color="user21" display="text" font="굴림,9" wordwrap="word"/>
							<cell align="center" col="1" color="user21" display="text" font="굴림,9" wordwrap="word"/>
						</cell>
						<cell col="9" colspan="5" display="text">
							<cell col="0" display="text"/>
							<cell col="1" display="text"/>
							<cell col="2" display="text"/>
							<cell align="center" col="3" color="user21" display="text" font="굴림,9" text="특성값" wordwrap="word"/>
							<cell col="4" display="text"/>
						</cell>
						<cell col="2" color="user21" display="text" font="굴림,9" row="1" text="No"/>
						<cell col="3" color="user21" display="text" font="굴림,9" row="1" text="변경"/>
						<cell col="4" color="user21" display="text" font="굴림,9" row="1" text="특성"/>
						<cell col="5" color="user21" display="text" font="굴림,9" row="1" text="출력여부"/>
						<cell col="6" color="user21" display="text" font="굴림,9" row="1" text="수정여부"/>
						<cell col="7" color="user21" display="text" font="굴림,9" row="1" text="EGIS전송"/>
						<cell col="8" color="user21" display="text" font="굴림,9" row="1" text="폐기일"/>
						<cell col="9" color="user21" display="text" font="굴림,9" row="1" text="No"/>
						<cell col="10" color="user21" display="text" font="굴림,9" row="1" text="변경"/>
						<cell col="11" color="user21" display="text" font="굴림,9" row="1" text="특성값"/>
						<cell col="12" color="user21" display="text" font="굴림,9" row="1" text="출력여부"/>
						<cell col="13" color="user21" display="text" font="굴림,9" row="1" text="폐기일"/>
					</head>
					<body>
						<cell align="center" col="0" colid="BRNDSEQ" display="text" suppress="1"/>
						<cell align="center" col="1" colid="BRNDCD" display="text" suppress="1"/>
						<cell align="center" col="2" colid="MSEQ" display="text" suppress="1"/>
						<cell align="center" bkimageid='expr:gfn_getFlagBkImageID(getColumn(currow,&#32;&quot;MFLAG&quot;))' col="3" display="text" suppress="1"/>
						<cell align="left" col="4" colid="PRH" display="text" suppress="1"/>
						<cell align="center" col="5" colid="MDISPTP" display="checkbox" edit="checkbox"/>
						<cell align="center" col="6" colid="MMODITP" display="checkbox" edit="checkbox"/>
						<cell align="center" col="7" colid="MEGISSND" display="checkbox" edit="checkbox"/>
						<cell align="center" col="8" colid="MDIPSDAT" display="text" edit="normal" Mask="@@@@-@@-@@"/>
						<cell align="center" col="9" colid="DSEQ" display="text"/>
						<cell align="center" bkimageid='expr:gfn_getFlagBkImageID(getColumn(currow,&#32;&quot;DFLAG&quot;))' col="10" display="text"/>
						<cell align="left" col="11" colid="PRD" display="text"/>
						<cell align="center" col="12" colid="DDISPTP" display="checkbox" edit="checkbox"/>
						<cell align="center" col="13" colid="DDIPSDAT" display="text" edit="normal" Mask="@@@@-@@-@@"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Div Height="43" Id="div_btn" Left="3" TabOrder="4" Text="Div0" Url="WB01::CommBtnForm.xml" Width="973">
			<Contents></Contents>
		</Div>
		<Shape BKColor="user12" Bottom="69" Height="26" Id="Shape0" Left="290" LineColor="user13" Right="874" TabOrder="5" Top="43" Type="Rectangle" Width="584"></Shape>
		<Static Align="Right" Height="24" Id="Static4" Left="291" Style="sty_lb_form_basic" TabOrder="6" Text="File&#32;" Top="44" VAlign="Middle" Width="60"></Static>
		<Edit Border="Flat" Height="20" Id="ed_fileName" Left="353" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="7" Top="46" Width="500"></Edit>
		<Button Cursor="HAND" Height="18" Id="btn_openFile" ImageID="btn_icon_polder" Left="854" OnClick="fn_excel_open" TabOrder="8" Text="Button0" Top="47" Width="18"></Button>
		<FileDialog Bottom="24" FilePath="c:\" Filter="Excel&#32;통합문서&#32;(*.xlsx)|*.xlsx|Excel&#32;97-2003&#32;통합문서&#32;(*.xls)|*.xls|" Height="24" Id="fileDialog" Left="992" Right="1016" TabOrder="10" Width="24"></FileDialog>
		<Edit Align="CENTER" Enable="FALSE" Height="23" Id="ed_brndseq" Left="78" MaxLength="10" Number="TRUE" Style="sty_btn" TabOrder="9" Top="44" UpperOnly="TRUE" Width="42"></Edit>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_excel_upload" ImageID="btn_sub_06" Left="877" LeftMargin="12" OnClick="fn_excel_sayangUpload" Style="sty_btn" TabOrder="10" Text="엑셀업로드" Top="46" Transparent="TRUE" Width="72"></Button>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 브랜드사양 일괄 등록
 * 작  성  자   : 박수근
 * 작성  일자   : 2020-09-07
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */   
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::nsfRequest.js";	// 공통 스크립트 
#include "LIB::common_hdel.js";	// 공통 스크립트  /* GNY 추가 */
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var F_TITLE = "브랜드 사양 일괄 등록";
var pGubun;
var F_BRNDSEQ = "000";
var F_ZPRDGBN;

/**
*	화면 로드 
**/
var _F_FILE_DIR = "";	// 로컬에서 현재 선택한 파일 디렉토리 
var _F_FILE_NAME = "";	// 로컬에서 현재 선택한 파일  명 

//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
    // 팝업 버튼 적용
	div_btn.fn_loadUseBtn("30,900", F_TITLE, "", "");
	gfn_initForm();
	fn_init_form() ;
}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

/********************************************************************************
* 기      능   : 폼 초기화
********************************************************************************/
function fn_init_form() {
    ed_brndseq.Text = F_BRNDSEQ;
    
    ds_abrand.ClearData();
    ds_abrand.Copy(parent.ds_abrand);

	// 그리드 속성
	grd_batch_sanyangPrd.SetCellProp("body", 5, "edit", "expr:iif(Length(MDISPTP)>0, 'checkbox', 'none')");
	grd_batch_sanyangPrd.SetCellProp("body", 6, "edit", "expr:iif(Length(MMODITP)>0, 'checkbox', 'none')");
	grd_batch_sanyangPrd.SetCellProp("body", 7, "edit", "expr:iif(Length(MEGISSND)>0, 'checkbox', 'none')");
	grd_batch_sanyangPrd.SetCellProp("body", 8, "edit", "expr:iif(Length(MEGISSND)>0, 'normal', 'none')");
	grd_batch_sanyangPrd.SetCellProp("body", 12, "edit", "expr:iif(Length(DDISPTP)>0, 'checkbox', 'none')");
	grd_batch_sanyangPrd.SetCellProp("body", 13, "edit", "expr:iif(Length(PRD)>0, 'normal', 'none')");

	grd_batch_sanyangPrd.SetCellProp("body", 5, "display", "expr:iif(Length(MDISPTP)>0, 'checkbox', 'none')");
	grd_batch_sanyangPrd.SetCellProp("body", 6, "display", "expr:iif(Length(MMODITP)>0, 'checkbox', 'none')");
	grd_batch_sanyangPrd.SetCellProp("body", 7, "display", "expr:iif(Length(MEGISSND)>0, 'checkbox', 'none')");
	grd_batch_sanyangPrd.SetCellProp("body", 8, "display", "expr:iif(Length(MEGISSND)>0, 'normal', 'none')");
	grd_batch_sanyangPrd.SetCellProp("body", 12, "display", "expr:iif(Length(DDISPTP)>0, 'checkbox', 'none')");
	grd_batch_sanyangPrd.SetCellProp("body", 13, "display", "expr:iif(Length(PRD)>0, 'normal', 'none')");
	
    // 색깔지정
    for(var i=0; i <= 13; i++) {
        grd_batch_sanyangPrd.SetCellProp("body", i, "bkColor", "expr:iif(Length(ERRMSG) > 0, 'yellow', 'default')");
        grd_batch_sanyangPrd.SetCellProp("body", i, "bkColor2", "expr:iif(Length(ERRMSG) > 0, 'yellow', 'default')");
    }
} 

//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
function fn_OnClick_btn(obj)
{
	var fncName = "fn_" + substr(obj.id, 4); 
	eval( fncName + "()");
}

/********************************************************************************
* 기      능   : 조회
********************************************************************************/
function fn_query() {
}

/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {
    fn_createWait("",this);
}

/********************************************************************************
* 기      능   : 확인  
********************************************************************************/
function fn_confirm() {
    fn_createWait("",this);
}

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	this.close();
}

/********************************************************************************
* 기      능   : 저장
********************************************************************************/
function fn_save() {
	if (gfn_showConfirm("브랜드 특성/특성값을 일괄 저장하시겠습니까?") == false) {
	    return;
    }

    // 저장할 데이터를 생성한다.
	var mandt;
	var brndseq;
	var zprdgbn;
	var brndcd;
	var prh;
	var mflag;
	var mdisptp;
	var mmoditp;
	var megissnd;
	var mdipsdat;
	var prd;
	var dflag;
	var ddisptp;
	var ddipsdat;
	var errMsg;
	var mRow = -1;
	var dRow = -1;
	ds_zsdt1141.ClearData();
	ds_zsdt1142.ClearData();
    for(var i=0; i < ds_batch_sanyangPrd.GetRowCount(); i++) {
		mandt    = ds_batch_sanyangPrd.GetColumn(i, "MANDT");
		brndseq  = ds_batch_sanyangPrd.GetColumn(i, "BRNDSEQ");
		zprdgbn  = ds_batch_sanyangPrd.GetColumn(i, "ZPRDGBN");
		brndcd   = ds_batch_sanyangPrd.GetColumn(i, "BRNDCD");
		prh      = ds_batch_sanyangPrd.GetColumn(i, "PRH");
		mflag    = ds_batch_sanyangPrd.GetColumn(i, "MFLAG");
		mdisptp  = ds_batch_sanyangPrd.GetColumn(i, "MDISPTP");
		mmoditp  = ds_batch_sanyangPrd.GetColumn(i, "MMODITP");
		megissnd = ds_batch_sanyangPrd.GetColumn(i, "MEGISSND");
		mdipsdat = ds_batch_sanyangPrd.GetColumn(i, "MDIPSDAT");
		prd      = ds_batch_sanyangPrd.GetColumn(i, "PRD");
		dflag    = ds_batch_sanyangPrd.GetColumn(i, "DFLAG");
		ddisptp  = ds_batch_sanyangPrd.GetColumn(i, "DDISPTP");
		ddipsdat = ds_batch_sanyangPrd.GetColumn(i, "DDIPSDAT");
		errMsg   = ds_batch_sanyangPrd.GetColumn(i, "ERRMSG");
		if(Length(prh) > 0 && (mflag == "I" || mflag == "U" || mflag == "D") && Length(errMsg) == 0) {
		    mRow  = ds_zsdt1141.AppendRow();
		    ds_zsdt1141.SetColumn(mRow, "FLAG", mflag);
			ds_zsdt1141.SetColumn(mRow, "MANDT"   , mandt);
			ds_zsdt1141.SetColumn(mRow, "BRNDSEQ" , brndseq);
			ds_zsdt1141.SetColumn(mRow, "ZPRDGBN" , zprdgbn);
			ds_zsdt1141.SetColumn(mRow, "BRNDCD"  , brndcd);
			ds_zsdt1141.SetColumn(mRow, "PRH"     , prh);
			if(mdisptp == '1') {
			    mdisptp = 'X';
			} else {
			    mdisptp = '';
			}
			ds_zsdt1141.SetColumn(mRow, "DISPTP"  , mdisptp);
			if(mmoditp == '1') {
			    mmoditp = 'X';
			} else {
			    mmoditp = '';
			}
			ds_zsdt1141.SetColumn(mRow, "MODITP"  , mmoditp);
			if(megissnd == '1') {
			    megissnd = 'X';
			} else {
			    megissnd = '';
			}
			ds_zsdt1141.SetColumn(mRow, "EGISSND" , megissnd);
			ds_zsdt1141.SetColumn(mRow, "DIPSDAT" , mdipsdat);
		}
		
		if(Length(prd) > 0 && (dflag == "I" || dflag == "U" || dflag == "D")) {
		    dRow = ds_zsdt1142.AppendRow();
		    ds_zsdt1142.SetColumn(dRow, "FLAG", dflag);
			ds_zsdt1142.SetColumn(dRow, "MANDT"   , mandt);
			ds_zsdt1142.SetColumn(dRow, "BRNDSEQ" , brndseq);
			ds_zsdt1142.SetColumn(dRow, "ZPRDGBN" , zprdgbn);
			ds_zsdt1142.SetColumn(dRow, "BRNDCD"  , brndcd);
			ds_zsdt1142.SetColumn(dRow, "PRH"     , prh);
			ds_zsdt1142.SetColumn(dRow, "PRD"     , prd);
			if(ddisptp == '1') {
			    ddisptp = 'X';
			} else {
			    ddisptp = '';
			}
			ds_zsdt1142.SetColumn(dRow, "DISPTP"  , ddisptp);
			ds_zsdt1142.SetColumn(dRow, "DIPSDAT" , ddipsdat);
		}
    }

    if(fn_save_validate()) {
		var svcId = "saveSayang";
		var svcUrl = "sbi0094c/saveBatchSayang";
		var inDsList = "ds_zsdt1141=ds_zsdt1141 ds_zsdt1142=ds_zsdt1142";
		var outDsList = "ds_error=ds_error";
		var inParam  = "";
		var callBackFunc = "fn_afterSave";
		fn_createWait("",this);
		nsfRequest(svcId, svcUrl, inDsList, outDsList, inParam, callBackFunc);
    }
} 

/********************************************************************************
* 기      능   : 저장 입력값 체크
********************************************************************************/
function fn_save_validate() {
    var isValidate = true;
    if (!ds_zsdt1141.GetUpdate() && !ds_zsdt1142.GetUpdate()) {
        gfn_openMsgWin("저장할 내역이 없습니다", "", "A", "저장");
		return false;
	}
    
    return isValidate;
}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : fn_init_form Callback  
********************************************************************************/
function fn_afterInitForm(svcId, errCode, errMsg) {
    fn_destroyWait();
	if(ds_error.rowcount > 0)	{
		gfn_showAlert(ds_error.GetColumn(0,"ERRMSG"));
		return;
	}
}

/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(svcId, errCode, errMsg) {
    fn_destroyWait();
	if(ds_error.rowcount > 0)	{
		gfn_showAlert(ds_error.GetColumn(0,"ERRMSG"));
		return;
	}
}

/********************************************************************************
* 기      능   : 저장 Callback  
********************************************************************************/
function fn_afterSave(svcId, errCode, errMsg) {
    fn_destroyWait();
	if(ds_error.rowcount > 0)	{
		gfn_showAlert(ds_error.GetColumn(0,"ERRMSG"));
		return;
	} else {
        gfn_openMsgWin("브랜드 특성/특성값 일괄 저장이 완료 되었습니다.", "", "A", "저장");
        fn_close();
        parent.fn_query();
	}
}

//=========================================================================================
// [ PART 5]
// 화면 UI 함수
//=========================================================================================
/********************************************************************************
* 기      능   : 브랜드차수 그리드 삭제
********************************************************************************/
function fn_excel_open(obj)
{
    ds_excel.ClearData();
	fileDialog.open();
	
	if ( length(fileDialog.FilePath) == 0
		|| length( fileDialog.FileName ) == 0 ) {
		return;
	}

	_F_FILE_DIR =  fileDialog.FilePath;
	_F_FILE_NAME = fileDialog.FileName;
	ed_fileName.value = _F_FILE_DIR + "\\" + _F_FILE_NAME;
}

/********************************************************************************
* 기      능   : 엑셀사양 등록
********************************************************************************/
function fn_excel_sayangUpload(obj)
{
    fn_createWait("",this);
    
	var newRow = -1;
	var brndseq;
	var brndcd;
	var mseq;
	var mflag;
	var dflag;
    var value;
    var prh;
    var mdisptp;
    var mmoditp;
    var megissnd;
    var mdipsdat;
    var dseq;
    var prd;
    var ddisptp;
    var ddipsdat;

    if(ed_fileName.value == '') {
        fn_destroyWait();
        gfn_openMsgWin("브랜드 일괄등록 엑셀 파일을 입력하세요", "", "A", "엑셀업로드");
        return;
    }

	ext_ExcelImportByIndex(ed_fileName.value, null, "ds_excel",0,3,0,3);
    grd_batch_sanyangPrd.BindDataset = "";
	ds_batch_sanyangPrd.ClearData();
	ds_batch_sanyangPrd.OnColumnChanged = "";
	for(var i=0; i < ds_excel.rowcount ; i++) {
		newRow = ds_batch_sanyangPrd.AddRow();
		ds_batch_sanyangPrd.SetColumn(newRow, "MANDT", G_MANDT);
		ds_batch_sanyangPrd.SetColumn(newRow, "ZPRDGBN", F_ZPRDGBN);
		
		if(Length(ds_excel.GetColumn(i,0)) > 0) {
		    brndseq = ds_excel.GetColumn(i,0);
		}    
		ds_batch_sanyangPrd.SetColumn(newRow, "BRNDSEQ", brndseq);

		if(Length(ds_excel.GetColumn(i,1)) > 0) {
		    brndcd = ds_excel.GetColumn(i,1);
		}    
		ds_batch_sanyangPrd.SetColumn(newRow, "BRNDCD", brndcd);

		if(Length(ds_excel.GetColumn(i,2)) > 0) {
			mseq = ds_excel.GetColumn(i,2);
		}
		ds_batch_sanyangPrd.SetColumn(newRow, "MSEQ", mseq);

        mdisptp   = ds_excel.GetColumn(i,5);
        mmoditp   = ds_excel.GetColumn(i,6);
        megissnd  = ds_excel.GetColumn(i,7);
        mdipsdat  = ds_excel.GetColumn(i,8);
		if(Length(ds_excel.GetColumn(i,3)) > 0) {
			mflag = ds_excel.GetColumn(i,3);
		} else {
			mflag = "";
		}
		if(mflag == 'ADD') {
			mflag = 'A';
		}
		
        if(mflag == 'A' && (mdisptp == 'X' || mmoditp == 'X' || megissnd == 'X' || Length(mdipsdat) >0)) {
			mflag = 'I';
		} else if(mflag != 'A' && (mdisptp == 'X' || mmoditp == 'X' || megissnd == 'X' || Length(mdipsdat) >0)) {
			mflag = 'U';
		} else if(Length(mflag) == 0 && Length(mdisptp) == 0 && Length(mmoditp) == 0 && Length(megissnd) == 0 && Length(mdipsdat) == 0) {
			mflag = 'D';
		}
		if(Length(ds_excel.GetColumn(i,2)) > 0) {
		    ds_batch_sanyangPrd.SetColumn(newRow, "MFLAG", mflag);
		}    

        // 영업특성
		ds_batch_sanyangPrd.SetColumn(newRow, "MDATATYPE", "");

		if(Length(ds_excel.GetColumn(i,4)) > 0)
			prh = ds_excel.GetColumn(i,4);
		ds_batch_sanyangPrd.SetColumn(newRow, "PRH", prh);

		if(Length(ds_excel.GetColumn(i,2)) > 0) {
			if(mdisptp == 'X') {
				mdisptp = '1';
			} else {
				mdisptp = '0';
			}
			ds_batch_sanyangPrd.SetColumn(newRow, "MDISPTP", mdisptp);

			if(mmoditp == 'X') {
				mmoditp = '1';
			} else {
				mmoditp = '0';
			}
			ds_batch_sanyangPrd.SetColumn(newRow, "MMODITP", mmoditp);

			if(megissnd == 'X') {
				megissnd = '1';
			} else {
				megissnd = '0';
			}
			ds_batch_sanyangPrd.SetColumn(newRow, "MEGISSND", megissnd);

			mdipsdat = Replace(mdipsdat, "-", "");
			ds_batch_sanyangPrd.SetColumn(newRow, "MDIPSDAT", mdipsdat);  // - 제거
		} else {
			ds_batch_sanyangPrd.SetColumn(newRow, "MDISPTP", "");
			ds_batch_sanyangPrd.SetColumn(newRow, "MMODITP", "");
			ds_batch_sanyangPrd.SetColumn(newRow, "MEGISSND", "");
			ds_batch_sanyangPrd.SetColumn(newRow, "MDIPSDAT", "");
		}

        // 영업특성 값
		ds_batch_sanyangPrd.SetColumn(newRow, "DDATATYPE", "");
		dseq = ds_excel.GetColumn(i,9);
		ds_batch_sanyangPrd.SetColumn(newRow, "DSEQ", dseq);

        ddisptp  = ds_excel.GetColumn(i,12);
        ddipsdat  = ds_excel.GetColumn(i,13);
        
		dflag = ds_excel.GetColumn(i,10);
		if(dflag == 'ADD') {
		    dflag = 'A';
		}
		
		if(dflag == 'A' && (ddisptp == 'X' || Length(ddipsdat) > 0)) {
			dflag = 'I';
		} else if(Length(dflag) == 0 && (ddisptp == 'X' || Length(ddipsdat) > 0)) {
			dflag = 'U';
		} else if(Length(dflag) == 0 && Length(ddisptp) == 0 && Length(ddipsdat) == 0) {
			dflag = 'D';
		}
		ds_batch_sanyangPrd.SetColumn(newRow, "DFLAG", dflag);
		
		prd = ds_excel.GetColumn(i,11);
		ds_batch_sanyangPrd.SetColumn(newRow, "PRD", prd);

		if(ddisptp == 'X') {
		    ddisptp = '1';
		} else {
		    ddisptp = '0';
		}
		ds_batch_sanyangPrd.SetColumn(newRow, "DDISPTP", ddisptp);

		ddipsdat = Replace(ddipsdat, "-", "");
		ds_batch_sanyangPrd.SetColumn(newRow, "DDIPSDAT", ddipsdat);  // - 제거

		//trace("prh:"+prh+", prd:"+prd+", dflag:"+dflag+", ddisptp="+ddisptp+", ddipsdat:"+ddipsdat);
		// 데이터 처리 완료 후 입력값 체크 수행
	}


    // 입력값 체크 로직 수행
    var errMsg;
    var findRow = -1;
    for(var i=0; i < ds_batch_sanyangPrd.GetRowCount(); i++) {
        errMsg = "";
        brndseq = ds_batch_sanyangPrd.GetColumn(i, "BRNDSEQ");
        if(Length(brndseq) == 1) {
            if(IsDigit(brndseq)) {
                ds_batch_sanyangPrd.SetColumn(i, "BRNDSEQ", "00"+brndseq);
            } else {
				errMsg = errMsg + "\n브랜드 차수 입력값을 확인하세요";
            }
        } else if(Length(brndseq) == 2) {
            if(IsDigit(brndseq)) {
                ds_batch_sanyangPrd.SetColumn(i, "BRNDSEQ", "0"+brndseq);
            } else {
				errMsg = errMsg + "\n브랜드 차수 입력값을 확인하세요";
            }
        } else if(Length(brndseq) > 3) {
            errMsg = errMsg + "\n브랜드 차수 입력값을 확인하세요";
        }
        
        // 등록된 브랜드 코드값 체크
        brndcd = ds_batch_sanyangPrd.GetColumn(i, "BRNDCD");
        findRow = ds_abrand.FindRow("CODE", brndcd);
        if(findRow < 0) {
            errMsg = errMsg + "\n등록되지 않은 브랜드 입력값 입니다.";
        }
        
        prh = ds_batch_sanyangPrd.GetColumn(i, "PRH");
        if(Length(prh) == 0) {
            errMsg = errMsg + "\n특성이 입력되지 않았습니다.";
        }
        
        // 특성 폐기일 체크
        mdipsdat = ds_batch_sanyangPrd.GetColumn(i, "MDIPSDAT");
        if(Length(mdipsdat) > 0) {
            if(GetDay(mdipsdat) < 0) {
                errMsg = errMsg + "\n입력한 특성 폐기일을 확인하십시요";
            }            
        }

        prd = ds_batch_sanyangPrd.GetColumn(i, "PRD");
        if(Length(prh) == 0) {
            errMsg = errMsg + "\n특성값이 입력되지 않았습니다.";
        }

        // 특성r값 폐기일 체크
        ddipsdat = ds_batch_sanyangPrd.GetColumn(i, "DDIPSDAT");
        if(Length(ddipsdat) > 0) {
            if(GetDay(ddipsdat) < 0) {
                errMsg = errMsg + "\n입력한 특성값 폐기일을 확인하십시요";
            }            
        }
        
        if(Length(errMsg) > 0) {
		    ds_batch_sanyangPrd.SetColumn(i, "ERRMSG", Substr(errMsg, 1));
        } else {
		    ds_batch_sanyangPrd.SetColumn(i, "ERRMSG", "");
        }
    }

    ds_batch_sanyangPrd.ApplyChange();
	//trace("ds_batch_sanyangPrd:"+ds_batch_sanyangPrd.SaveXML());
	ds_batch_sanyangPrd.OnColumnChanged = "ds_batch_sanyangPrd_OnColumnChanged";
    grd_batch_sanyangPrd.BindDataset = "ds_batch_sanyangPrd";

    fn_destroyWait();
}

/*===============================================================
= 기능 : 엑셀 입력 사양특성 데이터 변경 시 처리
===============================================================*/
function ds_batch_sanyangPrd_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	var mflag = ds_batch_sanyangPrd.GetColumn(nRow, "MFLAG");
	var dflag = ds_batch_sanyangPrd.GetColumn(nRow, "DFLAG");
    var mdisptp;
    var mmoditp;
    var megissnd;
    var mdipsdat;
    var ddisptp;
    var ddipsdat;
    switch(strColumnID) {
	    case "MDISPTP":
	    case "MMODITP":
	    case "MEGISSND":
	    case "MDIPSDAT":
	        mdisptp = ds_batch_sanyangPrd.GetColumn(nRow, "MDISPTP");
	        mmoditp = ds_batch_sanyangPrd.GetColumn(nRow, "MMODITP");
	        megissnd= ds_batch_sanyangPrd.GetColumn(nRow, "MEGISSND");
	        mdipsdat= ds_batch_sanyangPrd.GetColumn(nRow, "MDIPSDAT");
			ds_batch_sanyangPrd.OnColumnChanged = "";
			if(mflag == "A" || Length(mflag) == 0) {
				if(mflag == "A" && (mdisptp == '1' || mmoditp == '1' || megissnd == '1' || Length(mdipsdat) > 0)) {
					ds_batch_sanyangPrd.SetColumn(nRow, "MFLAG", "I");
				} else if(Length(mflag) == 0 && (mdisptp == '1' || mmoditp == '1' || megissnd == '1' || Length(mdipsdat) > 0)) {
					ds_batch_sanyangPrd.SetColumn(nRow, "MFLAG", "U");
				} else if(Length(mflag) == 0 && ( mdisptp == '0' && mmoditp == '0' && megissnd == '0' && Length(mdipsdat) == 0)) {
					ds_batch_sanyangPrd.SetColumn(nRow, "MFLAG", "D");
					var prh = ds_batch_sanyangPrd.GetColumn(nRow, "PRH");
				    for(var i=nRow; i < ds_batch_sanyangPrd.GetRowCount(); i++) {
				        if(prh != ds_batch_sanyangPrd.GetColumn(i, "PRH")) {
				            break;
				        }
				        dflag = ds_batch_sanyangPrd.GetColumn(i, "DFLAG");
				        if(dflag == "A" || dflag == "I") {
				            ds_batch_sanyangPrd.SetColumn(i, "DDISPTP", "0");
				            ds_batch_sanyangPrd.SetColumn(i, "DDIPSDAT", "");
				            ds_batch_sanyangPrd.SetColumn(i, "DFLAG", "A");
				        } else {
				            ds_batch_sanyangPrd.SetColumn(i, "DDISPTP", "0");
				            ds_batch_sanyangPrd.SetColumn(i, "DDIPSDAT", "");
				            ds_batch_sanyangPrd.SetColumn(i, "DFLAG", "D");
				        }
				    }
				}
			} else {
				if(mflag == "I") {
					if(mdisptp == '0' && mmoditp == '0' && megissnd == '0' && Length(mdipsdat) == 0) {
						ds_batch_sanyangPrd.SetColumn(nRow, "MFLAG", "A");
						var prh = ds_batch_sanyangPrd.GetColumn(nRow, "PRH");
						for(var i=nRow; i < ds_batch_sanyangPrd.GetRowCount(); i++) {
							if(prh != ds_batch_sanyangPrd.GetColumn(i, "PRH")) {
								break;
							}
							ds_batch_sanyangPrd.SetColumn(i, "DDISPTP", "0");
							ds_batch_sanyangPrd.SetColumn(i, "DDIPSDAT", "");
							ds_batch_sanyangPrd.SetColumn(i, "DFLAG", "A");
						}
					}
				} else if(mflag == "D") {
					if(mdisptp == '1' || mmoditp == '1' || megissnd == '1' || Length(mdipsdat) > 0) {
						ds_batch_sanyangPrd.SetColumn(nRow, "MFLAG", "U");
						var prh = ds_batch_sanyangPrd.GetColumn(nRow, "PRH");
						for(var i=nRow; i < ds_batch_sanyangPrd.GetRowCount(); i++) {
							if(prh != ds_batch_sanyangPrd.GetColumn(i, "PRH")) {
								break;
							}
							dflag = ds_batch_sanyangPrd.GetColumn(i, "DFLAG");
							if(dflag == "D") {
								ds_batch_sanyangPrd.SetColumn(i, "DDISPTP", ds_batch_sanyangPrd.GetOrgBuffColumn(i, "DDISPTP"));
								ds_batch_sanyangPrd.SetColumn(i, "DDIPSDAT", ds_batch_sanyangPrd.GetOrgBuffColumn(i, "DDIPSDAT"));
								ds_batch_sanyangPrd.SetColumn(i, "DFLAG", "U");
							} else {
								ds_batch_sanyangPrd.SetColumn(i, "DDISPTP", "0");
								ds_batch_sanyangPrd.SetColumn(i, "DDIPSDAT", "");
								ds_batch_sanyangPrd.SetColumn(i, "DFLAG", "A");
							}
						}
					}
				} else if(mflag == "U") {
					if(mdisptp == '0' && mmoditp == '0' && megissnd == '0' && Length(mdipsdat) == 0) {
						ds_batch_sanyangPrd.SetColumn(nRow, "MFLAG", "D");
						var prh = ds_batch_sanyangPrd.GetColumn(nRow, "PRH");
						for(var i=nRow; i < ds_batch_sanyangPrd.GetRowCount(); i++) {
							if(prh != ds_batch_sanyangPrd.GetColumn(i, "PRH")) {
								break;
							}
							dflag = ds_batch_sanyangPrd.GetColumn(i, "DFLAG");
							if(dflag == "I" || dflag == "A") {
								ds_batch_sanyangPrd.SetColumn(i, "DDISPTP", "0");
								ds_batch_sanyangPrd.SetColumn(i, "DDIPSDAT", "");
								ds_batch_sanyangPrd.SetColumn(i, "DFLAG", "A");
							} else {
								ds_batch_sanyangPrd.SetColumn(i, "DDISPTP", "0");
								ds_batch_sanyangPrd.SetColumn(i, "DDIPSDAT", "");
								ds_batch_sanyangPrd.SetColumn(i, "DFLAG", "D");
							}
						}
					}
				}
			}
			ds_batch_sanyangPrd.OnColumnChanged = "ds_batch_sanyangPrd_OnColumnChanged";
	        break;
	    case "DDISPTP":
	    case "DDIPSDAT":
	        ddisptp= ds_batch_sanyangPrd.GetColumn(nRow, "DDISPTP");
	        ddipsdat= ds_batch_sanyangPrd.GetColumn(nRow, "DDIPSDAT");
			ds_batch_sanyangPrd.OnColumnChanged = "";
			if(dflag == "A" || Length(dflag) == 0) {
				if(dflag == "A" && (ddisptp == '1' || Length(ddipsdat) > 0)) {
					ds_batch_sanyangPrd.SetColumn(nRow, "DFLAG", "I");
				} else if(Length(dflag) == 0 && (ddisptp == '1' || Length(ddipsdat) > 0)) {
					ds_batch_sanyangPrd.SetColumn(nRow, "DFLAG", "U");
				} else if(Length(dflag) == 0 && (ddisptp == '0' && Length(ddipsdat) == 0)) {
					ds_batch_sanyangPrd.SetColumn(nRow, "DFLAG", "D");
				}
			} else {
				if(dflag == "I") {
					if(ddisptp == '0' && Length(ddipsdat) == 0) {
						ds_batch_sanyangPrd.SetColumn(nRow, "DFLAG", "A");
					}
				} else if(dflag == "D") {
					if(ddisptp == '1' || Length(ddipsdat) > 0 ) {
						ds_batch_sanyangPrd.SetColumn(nRow, "DFLAG", "U");
					}
				} else if(dflag == "U") {
					if(ddisptp == '0' && Length(ddipsdat) == 0) {
						ds_batch_sanyangPrd.SetColumn(nRow, "DFLAG", "D");
					}
				}
			}
			ds_batch_sanyangPrd.OnColumnChanged = "ds_batch_sanyangPrd_OnColumnChanged";
	        break;
	    default  :
	        break;
	}
}

/*===============================================================
= 기능 : 에러 데이터 처리
===============================================================*/
function grd_batch_sanyangPrd_OnMouseOver(obj,nPosX,nPosY,nRow,nCell,nPivotIndex)
{
  	var errMsg = ds_batch_sanyangPrd.GetColumn(nRow, "ERRMSG");
  	if(nCell == 4 || nCell == 11) {
		if(Length(errMsg) > 0) {
			grd_batch_sanyangPrd.ToolTipText = errMsg;
		} else {
			grd_batch_sanyangPrd.ToolTipText = "";
		}
  	}
}
]]></Script>
</Window>