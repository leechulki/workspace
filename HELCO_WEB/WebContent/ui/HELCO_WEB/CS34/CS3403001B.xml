<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="272" Id="CS3403001B" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="공문출력&#32;입력내용(사용안함)" Top="8" Ver="1.0" Width="768" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond2">
				<Contents>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="VKGRP" size="256" summ="default" type="STRING"/>
					<colinfo id="KUNNR" size="256" summ="default" type="STRING"/>
					<colinfo id="PS_PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="STR" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO" size="256" summ="default" type="STRING"/>
					<colinfo id="PNO" size="256" summ="default" type="STRING"/>
					<record>
						<DNO></DNO>
						<KUNNR></KUNNR>
						<PNO></PNO>
						<PS_PSPID></PS_PSPID>
						<SEQ></SEQ>
						<STR></STR>
						<UPN></UPN>
						<VKGRP></VKGRP>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list2">
				<Contents>
					<colinfo id="KUNNR_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="TITLE" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="MI_SU_F" size="256" summ="default" type="STRING"/>
					<colinfo id="BANKVN" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR2" size="256" summ="default" type="STRING"/>
					<colinfo id="TEL" size="256" summ="default" type="STRING"/>
					<colinfo id="FAX" size="256" summ="default" type="STRING"/>
					<colinfo id="SGUSR" size="256" summ="default" type="STRING"/>
					<colinfo id="TITLE2" size="256" summ="default" type="STRING"/>
					<colinfo id="ARA_TEXT" size="256" summ="default" type="STRING"/>
					<colinfo id="EPNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="DUEDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="KUNNR" size="256" summ="default" type="STRING"/>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<record>
						<ADDR></ADDR>
						<ADDR2></ADDR2>
						<ARA_TEXT></ARA_TEXT>
						<BANKVN></BANKVN>
						<DUEDATE></DUEDATE>
						<EPNAME></EPNAME>
						<FAX></FAX>
						<KUNNR></KUNNR>
						<KUNNR_NM></KUNNR_NM>
						<MI_SU_F></MI_SU_F>
						<SGUSR></SGUSR>
						<TEL></TEL>
						<TITLE></TITLE>
						<TITLE2></TITLE2>
						<UPN></UPN>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list3">
				<Contents>
					<colinfo id="KUNNR" size="256" summ="default" type="STRING"/>
					<colinfo id="TITLE" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="DUEDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="MI_SU_F" size="256" summ="default" type="STRING"/>
					<colinfo id="BANKVN" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR2" size="256" summ="default" type="STRING"/>
					<colinfo id="TEL" size="256" summ="default" type="STRING"/>
					<colinfo id="FAX" size="256" summ="default" type="STRING"/>
					<colinfo id="SGUSR" size="256" summ="default" type="STRING"/>
					<colinfo id="TITLE2" size="256" summ="default" type="STRING"/>
					<colinfo id="ARA_TEXT" size="256" summ="default" type="STRING"/>
					<colinfo id="EPNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO_01" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO_02" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO_03" size="256" summ="default" type="STRING"/>
					<colinfo id="DUEDATE_01" size="256" summ="default" type="STRING"/>
					<colinfo id="DUEDATE_02" size="256" summ="default" type="STRING"/>
					<colinfo id="DUEDATE_03" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="DISCONTINUE" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ1" size="256" summ="default" type="STRING"/>
					<colinfo id="FLAG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_save">
				<Contents>
					<colinfo id="KUNNR" size="256" summ="default" type="STRING"/>
					<colinfo id="KUNNR_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="TITLE" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="MI_SU_F" size="256" summ="default" type="STRING"/>
					<colinfo id="BANKVN" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR2" size="256" summ="default" type="STRING"/>
					<colinfo id="TEL" size="256" summ="default" type="STRING"/>
					<colinfo id="FAX" size="256" summ="default" type="STRING"/>
					<colinfo id="SGUSR" size="256" summ="default" type="STRING"/>
					<colinfo id="TITLE2" size="256" summ="default" type="STRING"/>
					<colinfo id="ARA_TEXT" size="256" summ="default" type="STRING"/>
					<colinfo id="EPNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="DUEDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="FLAG" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="VKGRP" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO" size="256" summ="default" type="STRING"/>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="AUART" size="256" summ="default" type="STRING"/>
					<colinfo id="LGORT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_save2">
				<Contents>
					<colinfo id="FLAG" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO_A" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO" size="256" summ="default" type="STRING"/>
					<colinfo id="PNO" size="256" summ="default" type="STRING"/>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="KUNNR" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_dno">
				<Contents>
					<colinfo id="DNO" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_bank">
				<Contents>
					<colinfo id="KUNNR" size="256" summ="default" type="STRING"/>
					<colinfo id="TITLE" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="DUEDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="MI_SU_F" size="256" summ="default" type="STRING"/>
					<colinfo id="BANKVN" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR2" size="256" summ="default" type="STRING"/>
					<colinfo id="TEL" size="256" summ="default" type="STRING"/>
					<colinfo id="FAX" size="256" summ="default" type="STRING"/>
					<colinfo id="SGUSR" size="256" summ="default" type="STRING"/>
					<colinfo id="TITLE2" size="256" summ="default" type="STRING"/>
					<colinfo id="ARA_TEXT" size="256" summ="default" type="STRING"/>
					<colinfo id="EPNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO_01" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO_02" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO_03" size="256" summ="default" type="STRING"/>
					<colinfo id="DUEDATE_01" size="256" summ="default" type="STRING"/>
					<colinfo id="DUEDATE_02" size="256" summ="default" type="STRING"/>
					<colinfo id="DUEDATE_03" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="DISCONTINUE" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="AUART" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_dnoChk">
				<Contents>
					<colinfo id="DNO_01" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO_02" size="256" summ="default" type="STRING"/>
					<colinfo id="DNO_03" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user12" Bottom="114" Height="26" Id="Shape1" Left="7" LineColor="user13" Right="509" TabOrder="2" Top="88" Type="Rectangle" Width="502"></Shape>
		<Shape BKColor="user12" Bottom="211" Height="26" Id="Shape2" Left="7" LineColor="user13" Right="509" TabOrder="3" Top="185" Type="Rectangle" Width="502"></Shape>
		<Shape BKColor="user12" Bottom="236" Height="26" Id="Shape0" Left="7" LineColor="user13" Right="509" TabOrder="7" Top="210" Type="Rectangle" Width="502"></Shape>
		<Div Height="36" Id="div_btn" TabOrder="1" Text="Div0" ToolTipFont="Default,0" Url="WB01::CommBtnForm.xml" Width="792">
			<Contents></Contents>
		</Div>
		<Static Align="Right" Height="24" Id="st_kunner_nm" Left="8" Style="sty_lb_form_basic" TabOrder="4" Text="고객명&#32;" Top="89" VAlign="Middle" Width="95"></Static>
		<Static Align="Right" Height="24" Id="st_gbn" Left="8" Style="sty_lb_form_basic" TabOrder="5" Text="미납내역&#32;" Top="186" VAlign="Middle" Width="95"></Static>
		<Static Align="Right" Height="24" Id="st_misu_f" Left="8" Style="sty_lb_form_basic" TabOrder="6" Text="총미납금액&#32;" Top="211" VAlign="Middle" Width="95"></Static>
		<Shape BKColor="user12" Bottom="162" Height="26" Id="Shape6" Left="7" LineColor="user13" Right="509" TabOrder="8" Top="136" Type="Rectangle" Width="502"></Shape>
		<Shape BKColor="user12" Bottom="187" Height="26" Id="Shape7" Left="7" LineColor="user13" Right="509" TabOrder="9" Top="161" Type="Rectangle" Width="502"></Shape>
		<Static Align="Right" Height="24" Id="st_addr" Left="8" Style="sty_lb_form_basic" TabOrder="10" Text="주&#32;&#32;소&#32;" Top="162" VAlign="Middle" Width="95"></Static>
		<Static Align="Right" Height="24" Id="st_title" Left="8" Style="sty_lb_form_basic" TabOrder="11" Text="제&#32;&#32;목&#32;" Top="137" VAlign="Middle" Width="95"></Static>
		<Edit BindDataset="ds_list2" Border="Flat" Column="TITLE" Height="20" Id="ed_title" Left="105" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="12" Top="139" Width="400"></Edit>
		<Edit BindDataset="ds_list2" Border="Flat" Column="ADDR" Height="20" Id="ed_addr" Left="105" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="13" Top="164" Width="400"></Edit>
		<Edit BindDataset="ds_list2" Border="Flat" Column="TITLE2" Height="20" Id="ed_gbn" Left="105" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="14" Top="189" Width="400"></Edit>
		<Edit BindDataset="ds_list2" Border="Flat" BorderColor="user13" Column="KUNNR_NM" DisableBKColor="user0" Height="20" Id="ed_kunnr_nm" Left="105" Style="sty_ipt_form" TabOrder="15" Top="91" Width="400"></Edit>
		<MaskEdit Align="Right" BindDataset="ds_list2" Border="Flat" Column="MI_SU_F" Height="20" Id="med_misu_f" Left="105" Style="sty_ipt_form" TabOrder="16" Top="213" Width="120"></MaskEdit>
		<Static Height="16" Id="Static15" Left="228" TabOrder="17" Text="원" Top="217" Width="30"></Static>
		<Shape BKColor="user12" Bottom="138" Height="26" Id="Shape3" Left="7" LineColor="user13" Right="509" TabOrder="18" Top="112" Type="Rectangle" Width="502"></Shape>
		<Static Align="Right" Height="24" Id="st_epname" Left="8" Style="sty_lb_form_basic" TabOrder="19" Text="대표자명&#32;" Top="113" VAlign="Middle" Width="95"></Static>
		<Edit BindDataset="ds_list2" Border="Flat" BorderColor="user13" Column="EPNAME" DisableBKColor="user0" Height="20" Id="ed_epname" Left="105" Style="sty_ipt_form" TabOrder="20" Top="115" Width="400"></Edit>
		<Shape BKColor="user12" Bottom="260" Height="26" Id="Shape4" Left="7" LineColor="user13" Right="509" TabOrder="22" Top="234" Type="Rectangle" Width="502"></Shape>
		<Static Align="Right" Height="24" Id="st_duedate" Left="8" Style="sty_lb_form_basic" TabOrder="21" Text="납부기한&#32;" Top="235" VAlign="Middle" Width="95"></Static>
		<Calendar BindDataset="ds_list2" Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="DUEDATE" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DisableBKColor="user5" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_duedate" Left="105" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="23" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="237" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="100"></Calendar>
		<Shape BKColor="user12" Bottom="74" Height="26" Id="Shape5" Left="7" LineColor="user13" Right="509" TabOrder="24" Top="48" Type="Rectangle" Width="502"></Shape>
		<Static Align="Right" Height="24" Id="st_etn" Left="8" Style="sty_lb_form_basic" TabOrder="25" Text="공문번호&#32;" Top="49" VAlign="Middle" Width="95"></Static>
		<Edit Border="Flat" Column="DNO" Enable="FALSE" Height="20" Id="ed_dno" Left="105" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="26" Top="51" Width="150"></Edit>
		<Static Align="Right" Height="24" Id="st_sir" Left="259" Style="sty_lb_form_basic" TabOrder="27" Text="공문차수&#32;" Top="49" VAlign="Middle" Width="95"></Static>
		<Edit Border="Flat" Enable="FALSE" Height="20" Id="ed_seq" ImeMode="none" Left="356" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="28" Top="51" Width="150"></Edit>
	</Form>
	<Script><![CDATA[﻿﻿﻿﻿﻿﻿﻿﻿/*
 ******************************************************************************************
 * 기      능   : 미수채권 공문 작성 
 * 작  성  자   : 이하림
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::utility.js";	// 다중 선택 
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var upn = ""; 	//통합프로젝트
var ps_pspid = "";  //wbs
var vkgrp = ""; 	//팀코드
var lgort = ""; 	//업체코드
var kunnr = ""; 	//고객번호
var kunnr_nm = "";  //고객명
var amount = 0; 	//미수금액
var seq = ""; 		//공문 순번
var sgusr = "";
var auart = ""; 	//제품구분
var gno = ""; 		// 403에 저장되는 대표 프로젝트
var dno = ""; 		// 미수공문 발송현황 구분값 ( CS3406001A ) 
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {

	gfn_initForm();	
	fn_setCond2(); // ds_cond2 세팅
}

/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {

}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : ds_cond2 세팅
********************************************************************************/
function fn_setCond2() {

	ds_cond2.SetColumn(0, "UPN",      upn);
	ds_cond2.SetColumn(0, "VKGRP",    vkgrp);
	ds_cond2.SetColumn(0, "KUNNR",    kunnr);
	ds_cond2.SetColumn(0, "PS_PSPID", ps_pspid);
	ds_cond2.SetColumn(0, "SEQ",      seq);
	ds_cond2.SetColumn(0, "DNO",      dno);
	TRACE(DS_COND2.SaveXML());
	if(dno > "") { 
		fn_query3();// 미수공문 발송현황 ( CS3406001A ) 에서 조회시
	
	} else {
		fn_query();
	}	
}
//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 
********************************************************************************/
function fn_query() {
	// 공문을 작성할 청구번호들의 공문 작성 이력 조회
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs34:CS3403001B_S2"); // 청구번호 비교
	tit_callService(
		""
		, ""
		, "ds_cond=ds_cond2"
		, "ds_dnoChk=ds_dnoChk"
		, ""
		, "fn_query2"
		, true
		, true);

}
		
function fn_query2() {

	tit_clearActionInfo();
	
	if( seq == "01" ) {
	
		if(length(ds_dnoChk.GetColumn(0, "DNO_01")) == 0 
		  && length(ds_dnoChk.GetColumn(0, "DNO_02")) == 0 
		  && length(ds_dnoChk.GetColumn(0, "DNO_03")) == 0 ) { 
		} else {
			alert(seq + "차 공문을 작성할 수 없습니다.");
			close();
		}
	}
	if( seq == "02" ) {
	
		if(length(ds_dnoChk.GetColumn(0, "DNO_01")) != 0 
		  && length(ds_dnoChk.GetColumn(0, "DNO_02")) == 0 
		  && length(ds_dnoChk.GetColumn(0, "DNO_03")) == 0 ) { 
		} else {
			alert(seq + "차 공문을 작성할 수 없습니다.");
			close();
		}
	}
	if( seq == "03" ) {
	
		if(length(ds_dnoChk.GetColumn(0, "DNO_01")) != 0 
		  && length(ds_dnoChk.GetColumn(0, "DNO_02")) != 0 
		  && length(ds_dnoChk.GetColumn(0, "DNO_03")) == 0 ) { 
		} else {
			alert(seq + "차 공문을 작성할 수 없습니다.");
			close();
		}
	}
	// 공문 작성에 필요한 계좌 정보 및 고객정보 조회
	tit_addSearchActionInfo("cs34:CS3403001B_S1"); // 계좌정보 조회

	tit_callService(
		""
		, ""
		, "ds_cond=ds_cond2"
		, "ds_list2=ds_list2 ds_bank=ds_bank"
		, ""
		, "fn_afterQuery"
		, true
		, true);	

}
	
function fn_query3() {
	// 미수공문 발송현황에서 조회 
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs34:CS3403001B_S6");  // 공문내용 조회 
	tit_addSearchActionInfo("cs34:CS3403001B_S4"); // 계좌정보 조회

	tit_callService(
		""
		, ""
		, "ds_cond=ds_cond2"
		, "ds_list2=ds_list2 ds_bank=ds_bank"
		, ""
		, "fn_afterQuery"
		, true
		, true);	

}
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {

	// 사용자 변경 시 원사용자의 이름을 공문에 출력한다.
	var arr = split(G_ORG_USER_INFO, "^", true);
	if (arr[1] == null) {
		sgusr = G_USER_NAME;
	} else {
		sgusr = arr[1];
	}

	ed_seq.Text = seq; 
	ed_dno.Text = ds_list2.GetColumn(0, "DNO");  //  공문번호

	auart = ds_bank.GetColumn(0, "AUART");
	gno = ds_bank.GetColumn(0, "GNO");

	div_btn.btn_print.Enable = true;
	div_btn.btn_save.Enable = false;	

	// 공문 초기 작성 시 parent 정보 받아오기
	if( length(ed_dno.Text) == 0 ) { // 신규 작성
	
		ed_kunnr_nm.Text = ds_bank.GetColumn(0, "KUNNR_NM") ;
		med_misu_f.Text  = amount ;
		ed_title.Text    = "승강기 " + ds_bank.GetColumn(0, "TITLE2") + " 납부 독촉의 건" ;
		ed_addr.Text     = ds_bank.GetColumn(0, "ADDR") ;
		ed_gbn.Text      = ds_bank.GetColumn(0, "TITLE2") ;
		cal_duedate.Text = ds_bank.GetColumn(0, "DUEDATE") ;
		ed_epname.Text   = ds_bank.GetColumn(0, "EPNAME") ;
			
		div_btn.btn_print.Enable = false; // 출력 버튼	
		div_btn.btn_save.Enable = true;	  // 저장 버튼	
				
	} else { 
		// 높은 차수 생성 시 전 차수 수정 불가
		if(seq == "01" && ( length(ds_list2.GetColumn(0,"DNO_02")) <> 0
					   || length(ds_list2.GetColumn(0,"DNO_03")) <> 0 ) ) {
			div_btn.btn_save.Enable = false;	
		} else if(seq == "02" && length(ds_list2.GetColumn(0,"DNO_03")) <> 0 ) {
			div_btn.btn_save.Enable = false;		
		} else {
			div_btn.btn_save.Enable = true;	
		} 
	}
}

/********************************************************************************
* 기      능   : 저장
********************************************************************************/
function fn_save() {
	
	ds_save.ClearData();
	ds_save.AddRow();
	ds_save.SetColumn(0, "FLAG", "U");
	ds_save.SetColumn(0, "UPN",      upn);
	ds_save.SetColumn(0, "KUNNR",    kunnr); 
	ds_save.SetColumn(0, "KUNNR_NM", ed_kunnr_nm.Text); 
	ds_save.SetColumn(0, "TITLE",    ed_title.Text);
	ds_save.SetColumn(0, "ADDR",     ed_addr.Text);
	ds_save.SetColumn(0, "MI_SU_F",  Replace(med_misu_f.Text, ",", ""));
	ds_save.SetColumn(0, "TITLE2",   ed_gbn.Text);
	ds_save.SetColumn(0, "DUEDATE",  cal_duedate.Text);
	ds_save.SetColumn(0, "EPNAME",   ed_epname.Text);
	ds_save.SetColumn(0, "GNO",      gno);
	ds_save.SetColumn(0, "VKGRP",    vkgrp);
	ds_save.SetColumn(0, "SEQ",      seq);
	ds_save.SetColumn(0, "DNO",      ed_dno.Text);
	ds_save.SetColumn(0, "AUART",    auart);
	ds_save.SetColumn(0, "LGORT",    lgort);

	if(ds_save.rowCount() < 1) {
		// 저장할 정보 없음.
		gfn_showMsg("CW00010");
		return;
	}
	
	// 공문 초기 작성 여부에 따른 분기
	if( length(ed_dno.Text) == 0 ) {
	
		fn_saveInsert1(); // 공문 신규 생성
	
	} else {
	
		fn_saveUpdate(); // 기작성 공문 내용 수정
	
	}	

}
/********************************************************************************
* 기      능   : 공문 저장 ZCST403 
********************************************************************************/
function fn_saveInsert1() {

	tit_clearActionInfo();

	tit_addSaveActionInfo(
		""
		, "cs34:CS3403001B_I1"
		, ""
		, "FLAG");

	tit_callService(
        ""
        , ""
        , "ds_save=ds_save"
        , ""
        , ""
        , "fn_saveInsert2");
        
}
/********************************************************************************
* 기      능   : 청구번호 저장 ZCST405
********************************************************************************/
function fn_saveInsert2() {

	gfn_clearMsgBar();
	
	ds_save2.ClearData();

	for(var i=0; i<parent.ds_list_cp.RowCount(); i++) {

		var rows = ds_save2.AddRow();
		
		ds_save2.SetColumn(rows, "FLAG", "U");
		ds_save2.SetColumn(rows, "GNO_A",    gno); //대표 WBS
		ds_save2.SetColumn(rows, "GNO", 	 parent.ds_list_cp.GetColumn(i, "PSPID"));
		ds_save2.SetColumn(rows, "SEQ", 	 seq);
		ds_save2.SetColumn(rows, "PNO", 	 parent.ds_list_cp.GetColumn(i, "BELNR"));
		ds_save2.SetColumn(rows, "UPN",      upn);
		ds_save2.SetColumn(rows, "KUNNR",    kunnr); 
	}

	tit_clearActionInfo();

	tit_addSaveActionInfo(
        ""
        , "cs34:CS3403001B_I2"
        , ""
        , "FLAG");
	
	tit_addSearchActionInfo("cs34:CS3403001B_S3"); // 생성된 공문번호 조회
	
	tit_callService(
        ""
        , ""
        , "ds_save2=ds_save2"
        , "ds_dno=ds_dno"
        , ""
        , "fn_afterSave");
        
}
/********************************************************************************
* 기      능   : Update (수정)
********************************************************************************/
function fn_saveUpdate() {

	tit_clearActionInfo();

	tit_addSaveActionInfo(
		""
		, "cs34:CS3403001B_U1"
		, ""
		, "FLAG");

	tit_callService(
        ""
        , ""
        , "ds_save=ds_save"
        , ""
        , ""
        , "fn_afterSaveUpdate");
        
}
/********************************************************************************
* 기      능   : 저장 Callback  
********************************************************************************/
function fn_afterSave(errCode, errMsg) {
	
	if(errCode != 0) {
		gfn_showMsg("CE00001");
	} else {
		gfn_showMsg("CI00003");
		gfn_showAlert("CI00003"); // 저장을 완료했습니다.
		ed_dno.Text = ds_dno.GetColumn(0, "DNO");  // 생성된 공문번호
		div_btn.btn_save.Enable = false;	
	}
	
}
/********************************************************************************
* 기      능   : 저장 Callback  
********************************************************************************/
function fn_afterSaveUpdate(errCode, errMsg) {
	
	if(errCode != 0) {
		gfn_showMsg("CE00001");
	} else {
		gfn_showMsg("CI00003");
	}
	
}

/********************************************************************************
* 기      능   : 삭제
********************************************************************************/
function fn_delete() {	

}

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {

	close();
	
}

/********************************************************************************
* 기      능   : 출력
********************************************************************************/
function fn_print() {

	if(length(trim(ed_kunnr_nm.Text)) == 0){	
		gfn_showAlert(st_kunner_nm.Text + " 항목의 값이 누락되었습니다.");
		return false;
	}
	if(length(trim(ed_title.Text)) == 0){	
		gfn_showAlert(st_title.Text + " 항목의 값이 누락되었습니다.");
		return false;
	}
	if(length(trim(ed_addr.Text)) == 0){	
		gfn_showAlert(st_addr.Text + " 항목의 값이 누락되었습니다.");
		return false;
	}
	if(length(trim(ed_gbn.Text)) == 0){	
		gfn_showAlert(st_gbn.Text + " 항목의 값이 누락되었습니다.");
		return false;
	}
	if(length(trim(med_misu_f.Text)) == 0){	
		gfn_showAlert(st_misu_f.Text + " 항목의 값이 누락되었습니다.");
		return false;
	}
	if(length(trim(ed_epname.Text)) == 0){	
		gfn_showAlert(st_epname.Text + " 항목의 값이 누락되었습니다.");
		return false;
	}
	if(length(trim(cal_duedate.Text)) == 0){	
		gfn_showAlert(st_duedate.Text + " 항목의 값이 누락되었습니다.");
		return false;
	}
	
	ds_list3.ClearData();
	ds_list3.Reset();
	
	ds_list3.AddRow();
	ds_list3.SetColumn(0, "KUNNR",    ed_kunnr_nm.Text); 
	ds_list3.SetColumn(0, "TITLE",    ed_title.Text);
	ds_list3.SetColumn(0, "ADDR",     ed_addr.Text);
	ds_list3.SetColumn(0, "MI_SU_F",  med_misu_f.Text);
	
	ds_list3.SetColumn(0, "BANKVN",   ds_bank.GetColumn(0, "BANKVN"));
	ds_list3.SetColumn(0, "ADDR2",    ds_bank.GetColumn(0, "ADDR2"));
	ds_list3.SetColumn(0, "TEL",      G_USERTELE );
	ds_list3.SetColumn(0, "FAX",      ds_bank.GetColumn(0, "FAX"));
	ds_list3.SetColumn(0, "SGUSR",    sgusr );
	ds_list3.SetColumn(0, "TITLE2",   ds_list2.GetColumn(0, "TITLE2"));
	ds_list3.SetColumn(0, "ARA_TEXT", ds_bank.GetColumn(0, "ARA_TEXT"));
	
	ds_list3.SetColumn(0, "DUEDATE",  Replace(cal_duedate.Text, ".", ""));
	ds_list3.SetColumn(0, "DUEDATE_01",  ds_list2.GetColumn(0, "DUEDATE_01"));
	ds_list3.SetColumn(0, "DUEDATE_02",  ds_list2.GetColumn(0, "DUEDATE_02"));
	
	
	ds_list3.SetColumn(0, "EPNAME",   ed_epname.Text);
	
	ds_list3.SetColumn(0, "DNO",      ed_dno.Text);
	ds_list3.SetColumn(0, "DNO_01",   ds_list2.GetColumn(0, "DNO_01"));
	ds_list3.SetColumn(0, "DNO_02",   ds_list2.GetColumn(0, "DNO_02"));
	ds_list3.SetColumn(0, "DNO_03",   ds_list2.GetColumn(0, "DNO_03"));
	
	ds_list3.SetColumn(0, "SEQ",      Replace(ed_seq.Text, "0", ""));
	
	ds_list3.SetColumn(0, "DISCONTINUE",    ds_list2.GetColumn(0, "DISCONTINUE")); // 3차 보수중지일

	ds_list3.SetColumn(0, "FLAG", "U"); 
	ds_list3.SetColumn(0, "SEQ1",     ed_seq.Text);	

	// 출력여부 업데이트	
	tit_clearActionInfo();
	tit_addSaveActionInfo(
		""
		, "cs34:CS3403001B_U2"
		, ""
		, "FLAG");
	tit_callService(
		""
		, ""
		, "ds_list3=ds_list3"
		, ""
		, ""
		, "fn_printPopup"
		, true);
	
}
/********************************************************************************
* 기      능   : 출력 팝업
********************************************************************************/
function fn_printPopup() {
	//UbiReport Call 
	
	if(ds_list3.GetColumn(0, "SEQ") == "1") {
		Dialog("CS34::CS3403001C.xml", "");
	
	} else if(ds_list3.GetColumn(0, "SEQ") == "2"){
		Dialog("CS34::CS3403002C.xml", "");
		
	} else if(ds_list3.GetColumn(0, "SEQ") == "3"){
		Dialog("CS34::CS3403003C.xml", "");
	}
}
]]></Script>
</Window>