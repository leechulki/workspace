<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="576" Id="st_fdt" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="대금청구계획변경승인" Top="8" Ver="1.0" Width="776" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_head">
				<Contents>
					<colinfo id="VBELN" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="STATUS" size="256" summ="default" type="STRING"/>
					<colinfo id="KUNNR_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="BSTKD" size="256" summ="default" type="STRING"/>
					<colinfo id="BSU_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="BSTDK" size="256" summ="default" type="STRING"/>
					<colinfo id="NETWR" size="256" summ="default" type="STRING"/>
					<colinfo id="PM_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="MDT" size="256" summ="default" type="STRING"/>
					<colinfo id="USER" size="256" summ="default" type="STRING"/>
					<colinfo id="USER_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="PARVW_PY" size="256" summ="default" type="STRING"/>
					<colinfo id="WAERS" size="256" summ="default" type="STRING"/>
					<colinfo id="CHD" size="256" summ="default" type="STRING"/>
					<record>
						<BSTDK></BSTDK>
						<BSTKD></BSTKD>
						<BSU_NM></BSU_NM>
						<CHD></CHD>
						<KUNNR_NM></KUNNR_NM>
						<MDT></MDT>
						<NETWR></NETWR>
						<PARVW_PY></PARVW_PY>
						<PM_NAME></PM_NAME>
						<PSPID></PSPID>
						<SEQ></SEQ>
						<STATUS></STATUS>
						<USER></USER>
						<USER_NM></USER_NM>
						<VBELN></VBELN>
						<WAERS></WAERS>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list2">
				<Contents>
					<colinfo id="SO_NO" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="FKNO" size="256" summ="default" type="STRING"/>
					<colinfo id="FPLTR" size="256" summ="default" type="STRING"/>
					<colinfo id="FKDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="FAKWR" size="256" summ="default" type="STRING"/>
					<colinfo id="FKSAF" size="256" summ="default" type="STRING"/>
					<colinfo id="CHD" size="256" summ="default" type="STRING"/>
					<colinfo id="MDT" size="256" summ="default" type="STRING"/>
					<colinfo id="USER" size="256" summ="default" type="STRING"/>
					<colinfo id="USER_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="WAERK" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_chd">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<record>
						<CODE>01</CODE>
						<CODE_NAME>공사(작업)&#32;지연</CODE_NAME>
					</record>
					<record>
						<CODE>02</CODE>
						<CODE_NAME>자재공급지연</CODE_NAME>
					</record>
					<record>
						<CODE>03</CODE>
						<CODE_NAME>현장요청</CODE_NAME>
					</record>
					<record>
						<CODE>04</CODE>
						<CODE_NAME>분할발행</CODE_NAME>
					</record>
					<record>
						<CODE>05</CODE>
						<CODE_NAME>수주취소예정</CODE_NAME>
					</record>
					<record>
						<CODE>99</CODE>
						<CODE_NAME>기타</CODE_NAME>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list3">
				<Contents>
					<colinfo id="SO_NO" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="FKNO" size="256" summ="default" type="STRING"/>
					<colinfo id="FKDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="FAKWR" size="256" summ="default" type="STRING"/>
					<colinfo id="FKSAF" size="256" summ="default" type="STRING"/>
					<colinfo id="WAERK" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_error">
				<Contents>
					<colinfo id="IDX" size="256" type="STRING"/>
					<colinfo id="ERRMSG" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_error2">
				<Contents>
					<colinfo id="IDX" size="256" type="STRING"/>
					<colinfo id="ERRMSG" size="256" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user12" Bottom="66" Height="26" Id="Shape1" Left="7" LineColor="user13" Right="769" TabOrder="4" Top="40" Type="Rectangle" Width="762"></Shape>
		<Shape BKColor="user12" Bottom="91" Height="26" Id="Shape2" Left="7" LineColor="user13" Right="769" TabOrder="5" Top="65" Type="Rectangle" Width="762"></Shape>
		<Shape BKColor="user12" Bottom="166" Height="26" Id="Shape4" Left="7" LineColor="user13" Right="769" TabOrder="15" Top="140" Type="Rectangle" Width="762"></Shape>
		<Shape BKColor="user12" Bottom="116" Height="26" Id="Shape0" Left="7" LineColor="user13" Right="769" TabOrder="12" Top="90" Type="Rectangle" Width="762"></Shape>
		<Shape BKColor="user12" Bottom="141" Height="26" Id="Shape3" Left="7" LineColor="user13" Right="769" TabOrder="14" Top="115" Type="Rectangle" Width="762"></Shape>
		<Grid AutoEnter="TRUE" AutoFitEndLine="Hide" BindDataset="ds_list2" BkColor2="default" BoldHead="true" Border="Flat" Bottom="560" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="344" Id="grd_list2" InputPanel="FALSE" Left="43" LineColor="user20" LineType="ExHORZ" Right="356" RowHeight="20" Style="sty_grid" TabOrder="1" TabStop="true" Top="216" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="313">
			<contents>
				<format id="Default">
					<columns>
						<col width="44"/>
						<col width="103"/>
						<col width="99"/>
						<col width="65"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user21" display="text" font="굴림,9" text="No"/>
						<cell align="center" col="1" color="user21" display="text" font="굴림,9" text="대금청구일"/>
						<cell align="center" col="2" color="user21" display="text" font="굴림,9" text="대금청구&#32;값"/>
						<cell align="center" col="3" color="user21" display="text" font="굴림,9" text="빌링상태"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" display="text" expr="currow+1"/>
						<cell align="center" bkcolor2="user22" col="1" colid="FKDAT" combodisplayrowcnt="6" display="text" Mask="####.##.##"/>
						<cell align="right" bkcolor2="user22" col="2" colid="FAKWR" display="number"/>
						<cell align="center" bkcolor2="user22" col="3" colid="FKSAF" display="text"/>
					</body>
					<summary>
						<cell align="center" bkcolor="user25" col="0" color="user26" colspan="2" display="text" font="굴림,9" text="합&#32;계"/>
						<cell align="right" bkcolor="user25" col="2" color="user26" display="number" expr='sum(&quot;FAKWR&quot;)'/>
						<cell align="right" bkcolor="user25" col="3" color="user26" display="text"/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Div Height="36" Id="div_btn" TabOrder="2" Text="Div0" ToolTipFont="Default,0" Url="WB01::CommBtnForm.xml" Width="778">
			<Contents></Contents>
		</Div>
		<Calendar Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="146" Id="cal_temp" Left="784" MonthOnly="TRUE" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" OnChanged="cal_temp_OnChanged" OnDayClick="cal_temp_OnDayClick" OnKillFocus="cal_temp_OnKillFocus" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="3" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="172" Value="20130101" Visible="FALSE" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="152"></Calendar>
		<Static Align="Right" Height="24" Id="st_vbeln" Left="8" Style="sty_lb_form_basic" TabOrder="6" Text="S/O번호&#32;" Top="41" VAlign="Middle" Width="95"></Static>
		<Static Align="Right" Height="24" Id="st_mdt" Left="8" Style="sty_lb_form_basic" TabOrder="8" Text="변경요청일&#32;" Top="116" VAlign="Middle" Width="95"></Static>
		<Static Align="Right" Height="24" Id="st_user_nm" Left="261" Style="sty_lb_form_basic" TabOrder="9" Text="변경요청자&#32;" Top="116" VAlign="Middle" Width="95"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="VBELN" Enable="FALSE" Height="20" Id="ed_vbeln" Left="105" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="7" Top="43" Width="71"></Edit>
		<Static Align="Right" Height="24" Id="st_bstkd" Left="261" Style="sty_lb_form_basic" TabOrder="11" Text="현장명&#32;" Top="66" VAlign="Middle" Width="95"></Static>
		<Static Align="Right" Height="24" Id="st_kunnr_nm" Left="8" Style="sty_lb_form_basic" TabOrder="10" Text="고객명&#32;" Top="66" VAlign="Middle" Width="95"></Static>
		<Static Align="Right" Height="24" Id="st_bstdk" Left="8" Style="sty_lb_form_basic" TabOrder="13" Text="수주일&#32;" Top="91" VAlign="Middle" Width="95"></Static>
		<Static Align="Right" Height="24" Id="st_status" Left="515" Style="sty_lb_form_basic" TabOrder="16" Text="진행상태&#32;" Top="41" VAlign="Middle" Width="95"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="STATUS" Enable="FALSE" Height="20" Id="ed_status" Left="612" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="17" Top="43" Width="74"></Edit>
		<Edit BindDataset="ds_head" Border="Flat" Column="USER_NM" Enable="FALSE" Height="20" Id="ed_user_nm" Left="358" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="18" Top="118" Width="150"></Edit>
		<Static Align="Right" Height="24" Id="st_pspid" Left="261" Style="sty_lb_form_basic" TabOrder="19" Text="프로젝트&#32;" Top="41" VAlign="Middle" Width="95"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="PSPID" Enable="FALSE" Height="20" Id="ed_posid" ImeMode="none" Left="358" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="20" Top="43" Width="90"></Edit>
		<Static Align="Right" Height="24" Id="st_parvw_py" Left="8" Style="sty_lb_form_basic" TabOrder="21" Text="지급인&#32;" Top="141" VAlign="Middle" Width="95"></Static>
		<Static Align="Right" Height="24" Id="st_bsu_nm" Left="515" Style="sty_lb_form_basic" TabOrder="22" Text="업체명&#32;" Top="66" VAlign="Middle" Width="95"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="BSU_NM" Enable="FALSE" Height="20" Id="ed_bsu_nm" Left="612" LeftMargin="4" MaxLength="6" RightMargin="4" Style="sty_ipt_form" TabOrder="23" Top="68" Width="150"></Edit>
		<Static Align="Right" Height="24" Id="st_pm_name" Left="515" Style="sty_lb_form_basic" TabOrder="24" Text="보수PM&#32;" Top="91" VAlign="Middle" Width="95"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="PM_NAME" Enable="FALSE" Height="20" Id="ed_pm_name" Left="612" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="25" Top="93" Width="150"></Edit>
		<Edit BindDataset="ds_head" Border="Flat" Column="KUNNR_NM" Enable="FALSE" Height="20" Id="ed_kunnr_nm" Left="105" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="26" Top="68" Width="150"></Edit>
		<Edit BindDataset="ds_head" Border="Flat" Column="BSTKD" Enable="FALSE" Height="20" Id="ed_bstkd" Left="358" LeftMargin="4" MaxLength="6" RightMargin="4" Style="sty_ipt_form" TabOrder="27" Top="68" Width="150"></Edit>
		<MaskEdit BindDataset="ds_head" Border="Flat" BorderColor="silver" Column="BSTDK" DecimalLen="0" DigitLen="0" DisableBKColor="user5" DisableColor="BACKGROUND" Enable="FALSE" Height="20" Id="ed_bstdk" Left="105" Mask="####.##.##" Style="sty_ipt_search" TabOrder="28" Top="93" Type="STRING" Value="0" Width="71"></MaskEdit>
		<MaskEdit BindDataset="ds_head" Border="Flat" BorderColor="silver" Column="MDT" DecimalLen="0" DigitLen="0" DisableBKColor="user5" DisableColor="BACKGROUND" Enable="FALSE" Height="20" Id="ed_mdt" Left="105" Mask="####.##.##" Style="sty_ipt_search" TabOrder="29" Top="118" Type="STRING" Value="0" Width="71"></MaskEdit>
		<Static Align="Right" Height="24" Id="st_netwr" Left="261" Style="sty_lb_form_basic" TabOrder="30" Text="수주금액&#32;" Top="91" VAlign="Middle" Width="95"></Static>
		<MaskEdit BindDataset="ds_head" Border="Flat" Column="NETWR" DecimalLen="0" DisableBKColor="user5" DisableColor="BACKGROUND" Enable="FALSE" Height="20" Id="ed_netwr" Left="358" Mask="###,###" Style="sty_ipt_form" TabOrder="31" Top="93" Value="0" Width="81"></MaskEdit>
		<Edit BindDataset="ds_head" Border="Flat" Column="PARVW_PY" Enable="FALSE" Height="20" Id="ed_parvw_py" Left="105" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="32" Top="143" Width="150"></Edit>
		<Grid AutoEnter="TRUE" AutoFitEndLine="Hide" BindDataset="ds_list3" BkColor2="default" BoldHead="true" Border="Flat" Bottom="560" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="344" Id="grd_list3" InputPanel="FALSE" Left="416" LineColor="user20" LineType="ExHORZ" Right="729" RowHeight="20" Style="sty_grid" TabOrder="33" TabStop="true" Top="216" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="313">
			<contents>
				<format id="Default">
					<columns>
						<col width="44"/>
						<col width="103"/>
						<col width="99"/>
						<col width="65"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user21" display="text" font="굴림,9" text="No"/>
						<cell align="center" col="1" color="user21" display="text" font="굴림,9" text="대금청구일"/>
						<cell align="center" col="2" color="user21" display="text" font="굴림,9" text="대금청구&#32;값"/>
						<cell align="center" col="3" color="user21" display="text" font="굴림,9" text="빌링상태"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" display="text" expr="currow+1"/>
						<cell align="center" bkcolor2="user22" col="1" colid="FKDAT" combodisplayrowcnt="6" display="text" edit='expr:iif(FKSAF&#32;==&#32;&quot;C&quot;,&quot;none&quot;,&quot;mask&quot;)' Mask="####.##.##"/>
						<cell align="right" bkcolor2="user22" col="2" colid="FAKWR" display="number" edit='expr:iif(FKSAF&#32;==&#32;&quot;C&quot;,&quot;none&quot;,&quot;number&quot;)'/>
						<cell align="center" bkcolor2="user22" col="3" colid="FKSAF" display="text"/>
					</body>
					<summary>
						<cell align="center" bkcolor="user25" col="0" color="user26" colspan="2" display="text" font="굴림,9" text="합&#32;계"/>
						<cell align="right" bkcolor="user25" col="2" color="user26" display="number" expr='sum(&quot;FAKWR&quot;)'/>
						<cell align="right" bkcolor="user25" col="3" color="user26" display="text"/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Button Height="24" Id="Button0" Left="161" TabOrder="34" Text="변경전" Top="181" Width="74"></Button>
		<Button Height="24" Id="Button1" Left="533" TabOrder="35" Text="변경후" Top="181" Width="74"></Button>
		<Button Column="COPY" Height="34" Id="bt_copy" Left="370" OnClick="btn_copy_OnClick" TabOrder="36" Text="▶" Top="365" Width="30"></Button>
		<Static Align="Right" Height="24" Id="st_chd" Left="515" Style="sty_lb_form_basic" TabOrder="37" Text="변경사유&#32;" Top="116" VAlign="Middle" Width="95"></Static>
		<Combo BindDataset="ds_head" Border="Flat" CodeColumn="CODE" Column="CHD" DataColumn="CODE_NAME" Height="20" Id="cb_chd" InnerDataset="ds_chd" Left="611" Style="sty_ipt_form" TabOrder="38" Top="117" Width="153"></Combo>
		<Static Align="Right" Height="24" Id="Static0" Left="261" Style="sty_lb_form_basic" TabOrder="39" Text="통화&#32;" Top="141" VAlign="Middle" Width="95"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="WAERS" Enable="FALSE" Height="20" Id="ed_waers" Left="358" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="40" Top="143" Width="50"></Edit>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_plus" ImageID="btn_icon_plus" Left="682" LeftMargin="12" OnClick="btn_plus_OnClick" Style="sty_btn" TabOrder="41" Top="193" Transparent="TRUE" Width="22"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_minus" ImageID="btn_icon_minus" Left="706" LeftMargin="12" OnClick="btn_minus_OnClick" Style="sty_btn" TabOrder="42" Top="193" Transparent="TRUE" Width="22"></Button>
	</Form>
	<Script><![CDATA[﻿﻿﻿﻿﻿﻿﻿﻿/*
 ******************************************************************************************
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::utility.js";	// 다중 선택 
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var userGroup;
var gRow = null;
var executeChk = false; // 2020.11.30 저장 중복 체크
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	gfn_initForm();

	var user_grp = gfn_getUserGroup();
	
	if(user_grp == "10") { // 보수협력사일 경우
		div_btn.btn_approval.enable = false;
	} else if(user_grp == "20") { // 보수PM일 경우
//		div_btn.btn_approval.enable = false;
	} else if(user_grp == "30") { // 지방사무소일 경우
	} else if(user_grp == "40") { // 고객지원부일 경우
		div_btn.btn_delete.enable = false;
	}

	if(fplt == "CHANGE") {
		fn_setHead();
		
	}

}
/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {

}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 (ds_list2-변경전 data)
********************************************************************************/
function fn_query() {
	gfn_clearGridSortMark(grd_list2);
	tit_clearActionInfo();

	tit_addSearchActionInfo("cs34:CS3404001B_S2"); 		
	
	tit_callService(
        ""
        , ""
        , "ds_head=ds_head"
        , "ds_list2=ds_list2"
        , ""
        , "fn_query2"
        , true);
}
/********************************************************************************
* 기      능   : 조회 (ds_list3-변경후 data)
********************************************************************************/
function fn_query2() {
	gfn_clearGridSortMark(grd_list3);
	tit_clearActionInfo();

//리스트 재조회 않을 경우 헤더정보 GET
	ds_head.SetColumn(0, "SEQ", ds_list2.GetColumn(0, "SEQ"));
	ds_head.SetColumn(0,"CHD",ds_list2.GetColumn(0,"CHD"));
	ds_head.SetColumn(0,"MDT",ds_list2.GetColumn(0,"MDT"));
	ds_head.SetColumn(0,"USER",ds_list2.GetColumn(0,"USER"));
	ds_head.SetColumn(0,"USER_NM",ds_list2.GetColumn(0,"USER_NM"));

	tit_addSearchActionInfo("cs34:CS3404001B_S3"); 		
	
	tit_callService(
        ""
        , ""
        , "ds_head=ds_head"
        , "ds_list3=ds_list3"
        , ""
        , "fn_afterQuery"
        , true);
}
/********************************************************************************
* 기      능   : 조회 (ds_list2-청구계획 data)
********************************************************************************/
function fn_query3() {
	gfn_clearGridSortMark(grd_list2);
	tit_clearActionInfo();
	
	tit_addSearchActionInfo("cs34:CS3404001B_S1"); 		
	
	tit_callService(
        ""
        , ""
        , "ds_head=ds_head"
        , "ds_list2=ds_list2"
        , ""
        , "fn_afterQuery2"
        , true);
}
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	if(ds_list2.RowCount() == 0) {
		fn_query3();//변경요청 건이 없으면 청구계획 read
	} else {
		gfn_showMsg("CI00002",ds_list3.RowCount()+"");
		ds_head.SetColumn(0,"STATUS","A");
	}
}
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery2(errCode, errMsg) {
	ds_head.SetColumn(0, "SEQ", ds_list2.GetColumn(0, "SEQ"));
	ds_head.SetColumn(0, "MDT", gfn_getCurrDate());
	ds_head.SetColumn(0, "USER", G_USER_ID);
	ds_head.SetColumn(0, "USER_NM", G_USER_NAME);
	
	gfn_showMsg("CI00002",ds_list2.RowCount()+"");
}
/********************************************************************************
* 기      능   : 저장
********************************************************************************/
function fn_save() {

	// 중복실행 방지 2020.11.30. Han J.H
	if(executeChk == true) {
		gfn_showAlert("프로그램이 지금 실행중입니다. 강제종료 후 재 실행 시 오류가 발생할 가능성이 있습니다.");
		return;
	}
	
	if(length(trim(ds_head.GetColumn(0, "CHD"))) == 0) {
		gfn_showAlert("변경사유를 입력하세요.");
		return;
	}
	
	// 2020.10.05 저장 상태가 아닐 경우에는 변경전 데이터셋 체크 Han J.H
	if(ds_head.GetColumn(0, "STATUS") != "A") {
		if(ds_list2.rowCount() < 1) {
			gfn_showAlert("변경전 대금청구계획이 존재하지 않습니다.");
			return;
		}	
	}
	// 2020.10.05 fn_save3에서 변경 후 데이터셋 활용하므로 체크 Han J.H
	if(ds_list3.rowCount() < 1) {
		gfn_showAlert("변경후 대금청구계획이 존재하지 않습니다.");
		return;
	}

	for(var i=0; i<ds_list3.rowcount; i++) {
	    if(length(trim(ds_list3.GetColumn(i, "FKDAT"))) < 8 || ds_list3.GetColumn(i, "FKDAT") == "00000000") {
			var arr = [parseInt(i) + 1, "청구계획일"];
			gfn_showAlert("CW00055", arr);
			return;
		}
		if(length(trim(ds_list3.GetColumn(i, "FAKWR"))) == 0 || ds_list3.GetColumn(i, "FAKWR") == 0) {
			var arr = [parseInt(i) + 1, "청구계획금"];
			gfn_showAlert("CW00055", arr);
			return;
		}
		
		var suju = replace(ed_bstdk.Value,"-",""); // 수주일
		var gijun = ds_list3.GetColumn(i,"FKDAT"); // 대금청구 예정일
		var caldt = gfn_getBeforeMonth(suju,2);    // 수주일 -2 개월
		// 수주월 -2개월 이전으로 입력하는 경우 저장처리 불가 20150707(전현정 요청)
		if(ds_list3.GetColumn(i,"FKSAF") == "A" ){
			if (caldt >= substr(gijun,0,6)) {
				gfn_showAlert(ds_list3.GetColumn(i,"FKDAT")+ " 로 입력할 수 없습니다.");
				return;
			}
		}	
	}

    if(ds_list3.Sum("FAKWR",0,ds_list3.RowCount())  <> ds_head.GetColumn(0,"NETWR")) {
//			alert(parseInt((ds_list3.Sum("FAKWR",0,ds_list3.RowCount()))) - parseInt(ds_head.GetColumn(0,"NETWR")));
		if(parseInt((ds_list3.Sum("FAKWR",0,ds_list3.RowCount())) - parseInt(ds_head.GetColumn(0,"NETWR")) > 100) &
		    parseInt((ds_list3.Sum("FAKWR",0,ds_list3.RowCount())) - parseInt(ds_head.GetColumn(0,"NETWR")) < -100)) {
			gfn_showAlert("청구금액합이 수주금액과 다릅니다.");
			return;
		}
	}

    //변경전 정보 저장
	tit_clearActionInfo();
	
	executeChk = true;

	if(ds_head.GetColumn(0, "STATUS") == "A") {
		tit_addSingleActionInfo("cs34:CS3404001B_U1");
		
		tit_callService(
			""
			, ""
			, "ds_head=ds_head"
			, ""
			, ""
			, "fn_save2"
			, true);
	} else {
		for(var i=0; i<ds_list2.rowcount; i++) {
			ds_list2.SetColumn(i, "FKNO", i+1);
		}

	    tit_addSingleActionInfo("cs34:CS3404001B_I1");
		tit_addMultiActionInfo("cs34:CS3404001B_I2");
		
		tit_callService(
			""
			, ""
			, "ds_head=ds_head ds_list2=ds_list2"
			, ""
			, ""
			, "fn_save2"
			, true);
	}
}

/********************************************************************************
* 기      능   : 삭제
********************************************************************************/
function fn_delete() {	
	if(!gfn_showConfirm("CW10207","변경요청을 취소")) {
		return;
	}
	
	if(ds_head.GetColumn(0, "STATUS") != "A") {
		gfn_showAlert("변경요청건이 없습니다.");
		return false;
	}

	tit_clearActionInfo();
	tit_addSingleActionInfo("cs34:CS3404001B_D2");
	tit_addSingleActionInfo("cs34:CS3404001B_D3");
	tit_addSingleActionInfo("cs34:CS3404001B_U5");
	tit_callService(
		""
		, ""
		, "ds_head=ds_head ds_head=ds_head ds_head=ds_head"
		, ""
		, ""
		, "fn_afterDelete"
		, true);
}
/********************************************************************************
* 기      능   : 승인
********************************************************************************/
function fn_approval() {
	if(ds_head.GetColumn(0, "STATUS") != "A") {
		gfn_showAlert("변경요청 상태에서만 승인이 가능합니다.");
		return false;
	}

    var j = 0;
    
	for(var i=0; i<ds_list3.rowcount; i++) {
	    if(length(trim(ds_list3.GetColumn(i, "FKDAT"))) < 8 || ds_list3.GetColumn(i, "FKDAT") == "00000000") {
					var arr = [parseInt(i) + 1, "청구계획일"];
					gfn_showMsg("CW00055", arr);
					return;
				}
		if(length(trim(ds_list3.GetColumn(i, "FAKWR"))) == 0 || ds_list3.GetColumn(i, "FAKWR") == 0) {
					var arr = [parseInt(i) + 1, "청구계획금"];
					gfn_showMsg("CW00055", arr);
					return;
				}
		
//		ds_list4.AddRow();
//		ds_list4.SetColumn(j, "SO_NO", ds_list3.GetColumn(i, "SO_NO"));
//		ds_list4.SetColumn(j, "FKDAT", ds_list3.GetColumn(i, "FKDAT"));
//		ds_list4.SetColumn(j, "FAKWR", ds_list3.GetColumn(i, "FAKWR"));
//		ds_list4.SetColumn(j, "FKSAF", ds_list3.GetColumn(i, "FKSAF"));
//		ds_list4.SetColumn(j, "WAERK", ds_list3.GetColumn(i, "WAERK"));
//		j++;		
	}

//    if(ds_list3.Sum("FAKWR",0,ds_list3.RowCount()) <> ds_head.GetColumn(0,"NETWR")) {
//		gfn_showAlert("청구금액합이 수주금액과 다릅니다.");
//		return;
//	}
	
    if(ds_list3.Sum("FAKWR",0,ds_list3.RowCount())  <> ds_head.GetColumn(0,"NETWR")) {
//			alert(parseInt((ds_list3.Sum("FAKWR",0,ds_list3.RowCount()))) - parseInt(ds_head.GetColumn(0,"NETWR")));
		if(parseInt((ds_list3.Sum("FAKWR",0,ds_list3.RowCount())) - parseInt(ds_head.GetColumn(0,"NETWR")) > 100) &
		    parseInt((ds_list3.Sum("FAKWR",0,ds_list3.RowCount())) - parseInt(ds_head.GetColumn(0,"NETWR")) < -100)) {
			gfn_showAlert("청구금액합이 수주금액과 다릅니다.");
			return;
		}
	}
	
	if(!gfn_showConfirm("CW10207","승인")) {
		return;
	}
//trace(ds_list3.SaveXML());
	tit_callService(
		"CS3404001B_ACT"
		, "save"
		, "ds_list3=ds_list3"
		, "ds_error2=ds_error"
		, ""
		, "fn_afterApproval");
}
/********************************************************************************
* 기      능   : 저장시 이전 정보삭제 (update)
********************************************************************************/
function fn_save2() {
//trace(ds_list3.SaveXML());
    //저장시 이전 정보삭제
 	tit_clearActionInfo();

	tit_addSingleActionInfo("cs34:CS3404001B_U3");
	tit_addSingleActionInfo("cs34:CS3404001B_U4");

	tit_callService(
		""
		, ""
		, "ds_head=ds_head ds_head=ds_head"
		, ""
		, ""
		, "fn_save3"
		, true);
}		
/********************************************************************************
* 기      능   : 저장 변경후 data(update, insert)
********************************************************************************/
function fn_save3() {
//trace(ds_list3.SaveXML());
    //변경후 정보 저장
    for(var i=0; i<ds_list3.rowcount; i++) {
		ds_list3.SetColumn(i, "FKNO", i+1);
	}
	
 	tit_clearActionInfo();

	tit_addMultiActionInfo("cs34:CS3404001B_U2");

	tit_callService(
		""
		, ""
		, "ds_list3=ds_list3"
		, ""
		, ""
		, "fn_del"
		, true);
}		
/********************************************************************************
* 기      능   : 빈data 삭제
********************************************************************************/
function fn_del() {
 	tit_clearActionInfo();

	tit_addSingleActionInfo("cs34:CS3404001B_D1");

	tit_callService(
		""
		, ""
		, "ds_head=ds_head"
		, ""
		, ""
		, "fn_afterSave"
		, true);
}		
/********************************************************************************
* 기      능   : 저장 Callback  
********************************************************************************/
function fn_afterSave(errCode, errMsg) {
	if(errCode != 0) {
		gfn_showMsg("CE00001");
	} else {
		gfn_showMsg("CI00005");
		ds_head.SetColumn(0,"STATUS","A");    //UPDATE 성공시 HEADER상태 "A"로 변경
	}
	
	executeChk = false;
}

/********************************************************************************
* 기      능   : 삭제 Callback  
********************************************************************************/
function fn_afterDelete(errCode, errMsg) {
	if(errCode != 0) {
		gfn_showMsg("CE00001");
	} else {
		gfn_showMsg("CI00005");
		ds_head.SetColumn(0,"STATUS","");    //DELETE 성공시 HEADER상태 BLANK로 변경
		fn_query();  // 재조회
//		close();
	}
}

/********************************************************************************
* 기      능   : 승인 Callback
********************************************************************************/
function fn_afterApproval(errCode, errMsg) {
	if(ds_error2.rowcount() > 0) {
		gfn_showMsg("CE00001");
		// error 정보 표시 
//		gfn_openWSErrorWin(grd_list, ds_list1, ds_error2, "FLAG");
//        alert(errMsg);
		gfn_showalert(ds_error2.GetColumn(0, "ERRMSG"));
//		trace(ds_error2.SaveXML());
			ds_head.SetColumn(0,"STATUS","");
			fn_query();
	} else {
		if(errCode != 0) {
			gfn_showMsg("CE00001");
		} else {
			gfn_showMsg("CI00005");
		}
	}
}

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================

/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {
	gfn_saveToExcel(grd_list2, true);
}

function fn_setHead() {
	ds_list2.ClearData();

	for(var i=0; i<ds_list.RowCount(); i++) {
		if(ds_list.GetColumn(i, "CHK") == true) { //체크박스가 true 일 경우
//			if(k == 0) {
				ds_head.SetColumn(0, "PSPID", ds_list.GetColumn(i, "POSID"));
//				ds_head.SetColumn(0, "SEQ", ds_list.GetColumn(i, "SEQ"));				
				ds_head.SetColumn(0, "VBELN", ds_list.GetColumn(i, "VBELN"));				
//				ds_head.SetColumn(0, "STATUS", ds_list.GetColumn(i, "STATUS"));
				ds_head.SetColumn(0, "KUNNR_NM", ds_list.GetColumn(i, "KUNNR_NM"));
				ds_head.SetColumn(0, "BSTKD", ds_list.GetColumn(i, "BSTKD"));
				ds_head.SetColumn(0, "BSU_NM", ds_list.GetColumn(i, "BSU_NM"));
				ds_head.SetColumn(0, "BSTDK", ds_list.GetColumn(i, "BSTDK"));
				ds_head.SetColumn(0, "NETWR", ds_list.GetColumn(i, "NETWR"));
				ds_head.SetColumn(0, "PM_NAME", ds_list.GetColumn(i, "PM_NAME"));
				ds_head.SetColumn(0, "PARVW_PY", ds_list.GetColumn(i, "PARVW_PY"));				
				ds_head.SetColumn(0, "BSTDK", ds_list.GetColumn(i, "BSTDK"));
				ds_head.SetColumn(0, "WAERS", ds_list.GetColumn(i, "WAERS"));
//				if(ds_head.GetColumn(0, "STATUS") == "") {
//					ds_head.SetColumn(0, "MDT", gfn_getCurrDate());
//					ds_head.SetColumn(0, "USER", G_USER_ID);
//					ds_head.SetColumn(0, "USER_NM", G_USER_NAME);
//				} else {
//					ds_head.SetColumn(0, "MDT", ds_list.GetColumn(i, "MDT"));
//					ds_head.SetColumn(0, "USER", ds_list.GetColumn(i, "USER"));
//					ds_head.SetColumn(0, "USER_NM", ds_list.GetColumn(i, "USER_NM"));
//				}
			}
//		}
	}
	
	if(ds_head.GetColumn(0,"VBELN")!=""){
		fn_query();
	}
}

// 달력 처리 부분 
/********************************************************************************
* 기      능   : 달력에서 일자 선택했을 경우 
********************************************************************************/
function cal_temp_OnDayClick(obj,strText) {
	obj.Visible = false;
}

/********************************************************************************
* 기      능   : 달력에서 포커스 잃었을 경우 
********************************************************************************/
function cal_temp_OnKillFocus(obj) {
	obj.Visible = false;
}

function btn_copy_OnClick(obj)
{
	ds_list3.ClearData();

	for(var i=0; i<ds_list2.RowCount(); i++) {
		ds_list3.AddRow();	
		
		ds_list3.SetColumn(i, "SO_NO", ds_list2.GetColumn(i, "SO_NO"));
		ds_list3.SetColumn(i, "PSPID", ds_list2.GetColumn(i, "PSPID"));
		ds_list3.SetColumn(i, "SEQ", ds_list2.GetColumn(i, "SEQ"));
		ds_list3.SetColumn(i, "FKNO", 0);
		ds_list3.SetColumn(i, "FKDAT", ds_list2.GetColumn(i, "FKDAT"));
		ds_list3.SetColumn(i, "FAKWR", ds_list2.GetColumn(i, "FAKWR"));
		ds_list3.SetColumn(i, "FKSAF", ds_list2.GetColumn(i, "FKSAF"));
	
		}
	}
	
}
/********************************************************************************
* 기      능   : 그리드에 row추가
********************************************************************************/
function btn_plus_OnClick(obj)
{
    ds_list3.AddRow();
    ds_list3.SetColumn(ds_list3.currow,"SO_NO",ds_head.GetColumn(0,"VBELN"));
    ds_list3.SetColumn(ds_list3.currow,"PSPID",ds_head.GetColumn(0,"PSPID"));
    ds_list3.SetColumn(ds_list3.currow,"SEQ",ds_list2.GetColumn(0,"SEQ"));
    ds_list3.SetColumn(ds_list3.currow,"FKNO",0);
    ds_list3.SetColumn(ds_list3.currow,"FKDAT","");
    ds_list3.SetColumn(ds_list3.currow,"FAKWR",0);
    ds_list3.SetColumn(ds_list3.currow,"FKSAF","A");
}
/********************************************************************************
* 기      능   : 그리드에 row삭제
********************************************************************************/
function btn_minus_OnClick(obj) {
	if(ds_list3.GetColumn(ds_list3.currow,"FKSAF") == "C") {
		gfn_showAlert("빌링된 건은 삭제 할수 없습니다.");
		return;
	} else {
		ds_list3.DeleteRow(ds_list3.row);
	}
}
]]></Script>
</Window>