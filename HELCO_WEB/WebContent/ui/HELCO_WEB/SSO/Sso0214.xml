<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="562" Id="form" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="Sso0214" Top="8" Ver="1.0" Width="968" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="ZZPJT_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="FR_CHAKD" size="256" summ="default" type="STRING"/>
					<colinfo id="TO_CHAKD" size="256" summ="default" type="STRING"/>
					<colinfo id="VKBUR_F" size="256" summ="default" type="STRING"/>
					<colinfo id="VKBUR_T" size="256" summ="default" type="STRING"/>
					<colinfo id="VKGRP_F" size="256" summ="default" type="STRING"/>
					<colinfo id="VKGRP_T" size="256" summ="default" type="STRING"/>
					<colinfo id="CHKCOL" size="256" summ="default" type="STRING"/>
					<colinfo id="CHKTPDATE2" size="256" summ="default" type="STRING"/>
					<colinfo id="CHKTPDATE3" size="256" summ="default" type="STRING"/>
					<colinfo id="DEALER" size="256" summ="default" type="STRING"/>
					<colinfo id="MANAGER" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list" OnColumnChanged="ds_list_OnColumnChanged">
				<Contents>
					<colinfo id="ZZPJT_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="HOGI" size="256" summ="default" type="STRING"/>
					<colinfo id="BSTNK" size="256" summ="default" type="STRING"/>
					<colinfo id="NAME1" size="256" summ="default" type="STRING"/>
					<colinfo id="CHAKD" size="256" summ="default" type="STRING"/>
					<colinfo id="DPCPD" size="256" summ="default" type="STRING"/>
					<colinfo id="CHKCOL" size="256" summ="default" type="STRING"/>
					<colinfo id="CHKTPDATE2" size="256" summ="default" type="STRING"/>
					<colinfo id="CHKTPDATE3" size="256" summ="default" type="STRING"/>
					<colinfo id="POCDT" size="256" summ="default" type="STRING"/>
					<colinfo id="PTPDT" size="256" summ="default" type="STRING"/>
					<colinfo id="TPDATE2" size="256" summ="default" type="STRING"/>
					<colinfo id="TPDATE3" size="256" summ="default" type="STRING"/>
					<colinfo id="DEALER" size="256" summ="default" type="STRING"/>
					<colinfo id="MANAGER" size="256" summ="default" type="STRING"/>
					<colinfo id="SDFIELD" size="256" summ="default" type="STRING"/>
					<colinfo id="CHANGED" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_error">
				<Contents>
					<colinfo id="IDX" size="256" summ="default" type="STRING"/>
					<colinfo id="ERRMSG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_print_list">
				<Contents>
					<colinfo id="ZZPJT_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="HOGI" size="256" summ="default" type="STRING"/>
					<colinfo id="BSTNK" size="256" summ="default" type="STRING"/>
					<colinfo id="NAME1" size="256" summ="default" type="STRING"/>
					<colinfo id="CHAKD" size="256" summ="default" type="STRING"/>
					<colinfo id="DPCPD" size="256" summ="default" type="STRING"/>
					<colinfo id="CHKCOL" size="256" summ="default" type="STRING"/>
					<colinfo id="CHKTPDATE2" size="256" summ="default" type="STRING"/>
					<colinfo id="CHKTPDATE3" size="256" summ="default" type="STRING"/>
					<colinfo id="POCDT" size="256" summ="default" type="STRING"/>
					<colinfo id="PTPDT" size="256" summ="default" type="STRING"/>
					<colinfo id="TPDATE2" size="256" summ="default" type="STRING"/>
					<colinfo id="TPDATE3" size="256" summ="default" type="STRING"/>
					<colinfo id="DEALER" size="256" summ="default" type="STRING"/>
					<colinfo id="MANAGER" size="256" summ="default" type="STRING"/>
					<colinfo id="SDFIELD" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_save_list">
				<Contents>
					<colinfo id="ZZPJT_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="POCDT" size="256" summ="default" type="STRING"/>
					<colinfo id="POPDT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list_sman">
				<Contents>
					<colinfo id="SMAN_CD" size="256" type="STRING"/>
					<colinfo id="SMAN_NM" size="256" type="STRING"/>
					<colinfo id="SMAN_INFO" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_error_sman">
				<Contents>
					<colinfo id="IDX" size="256" type="STRING"/>
					<colinfo id="ERRMSG" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond_sman">
				<Contents>
					<colinfo id="SMAN_CD" size="10" type="STRING"/>
					<colinfo id="SMAN_NM" size="105" type="STRING"/>
					<colinfo id="SMAN_FILTER" size="256" type="STRING"/>
					<record>
						<SMAN_CD></SMAN_CD>
						<SMAN_FILTER></SMAN_FILTER>
						<SMAN_NM></SMAN_NM>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Height="96" Id="Div1" Left="4" TabOrder="10" Text="Div0" Top="4" Width="953">
			<Contents>
				<Shape BKColor="user0" Bottom="44" Height="26" Id="Shape2" Left="4" LineColor="user1" Right="953" TabOrder="1" Top="18" Type="Rectangle" Width="949"></Shape>
				<Static Align="Right" Height="24" Id="st_zzpjtid" Left="5" Style="sty_lb_search" TabOrder="4" Text="프로젝트&#32;" Top="19" VAlign="Middle" Width="72"></Static>
				<Shape BKColor="user0" Bottom="68" Height="26" Id="Shape0" Left="4" LineColor="user1" Right="953" TabOrder="2" Top="42" Type="Rectangle" Width="949"></Shape>
				<Static Align="Right" BKColor="user12" Height="20" Id="Static5" Left="858" Style="sty_lb_form_basic" TabOrder="3" Text="~" Top="192" VAlign="Middle" Width="12"></Static>
				<Static Align="Right" BKColor="user0" Height="20" Id="Static7" Left="170" Style="sty_lb_form_basic" TabOrder="3" Text="~" Top="45" VAlign="Middle" Width="12"></Static>
				<Shape BKColor="user0" Bottom="93" Height="26" Id="Shape1" Left="4" LineColor="user1" Right="953" TabOrder="4" Top="67" Type="Rectangle" Width="949"></Shape>
				<Static Align="Right" Height="24" Id="st_dealer" Left="653" Style="sty_lb_search" TabOrder="7" Text="영업담당자&#32;" Top="43" VAlign="Middle" Width="72"></Static>
				<Static Align="Right" Height="24" Id="st_chk" Left="5" Style="sty_lb_search" TabOrder="8" Text="세부조건&#32;" Top="68" VAlign="Middle" Width="72"></Static>
				<Static Align="Right" Height="24" Id="st_chakd" Left="5" Style="sty_lb_search" TabOrder="9" Text="착공예정일&#32;" Top="43" VAlign="Middle" Width="72"></Static>
				<Static Align="Right" Height="24" Id="st_manager" Left="653" Style="sty_lb_search" TabOrder="10" Text="관리담당자&#32;" Top="18" VAlign="Middle" Width="72"></Static>
				<Static Align="Right" Height="24" Id="st_vkbur" Left="290" Style="sty_lb_search" TabOrder="11" Text="부서&#32;" Top="18" VAlign="Middle" Width="72"></Static>
				<Static Align="Right" Height="24" Id="st_vkgrp" Left="290" Style="sty_lb_search" TabOrder="12" Text="팀&#32;" Top="43" VAlign="Middle" Width="72"></Static>
				<Div BKColor="user5" Height="22" Id="div_dealer" Left="729" OnLoadCompleted="fn_OnLoadCompleted" TabOrder="6" Text="Div0" Top="45" Url="COM::Coms031.xml" Width="209">
					<Contents></Contents>
				</Div>
			</Contents>
		</Div>
		<Grid AutoFitEndLine="Hide" BindDataset="ds_list" BkColor2="default" BoldHead="true" Border="Flat" Bottom="508" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="400" Id="grd_file" InputPanel="true" Left="9" LineColor="user20" LineType="ExHORZ" OnCellDBLClick="grd_common_OnKeyDown" OnExpandEdit="grd_list_OnExpandEdit" OnHeadClick="grd_header_OnHeadClick" OnKeyDown="grd_detail_OnKeyDown" Right="957" RowHeight="20" Style="sty_grid" TabOrder="10" TabStop="true" Top="108" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="948">
			<contents>
				<format id="Default">
					<columns>
						<col width="30"/>
						<col width="25"/>
						<col width="83"/>
						<col width="99"/>
						<col width="157"/>
						<col width="147"/>
						<col width="99"/>
						<col width="121"/>
						<col width="99"/>
						<col width="106"/>
						<col width="108"/>
						<col width="99"/>
						<col width="95"/>
						<col width="99"/>
						<col width="110"/>
						<col width="76"/>
						<col width="77"/>
						<col width="106"/>
					</columns>
					<head>
						<cell col="0" color="user21" display="text" font="굴림,9" text="변경"/>
						<cell col="1" color="user21" display="text" font="굴림,9" text="No"/>
						<cell col="2" color="user21" display="text" font="굴림,9" text="프로젝트번호"/>
						<cell col="3" color="user21" display="text" font="굴림,9" text="호기번호"/>
						<cell col="4" color="user21" display="text" font="굴림,9" text="프로젝트명"/>
						<cell col="5" color="user21" display="text" font="굴림,9" text="지급처"/>
						<cell col="6" color="user21" display="text" font="굴림,9" text="착공예정일"/>
						<cell col="7" color="user21" display="text" font="굴림,9" text="수금예정일&#32;(계약시)"/>
						<cell col="8" color="user21" display="text" font="굴림,9" text="계약금&#32;수금여부"/>
						<cell col="9" color="user21" display="text" font="굴림,9" text="영업사양전송&#32;여부"/>
						<cell col="10" color="user21" display="text" font="굴림,9" text="기술사양전송&#32;여부"/>
						<cell col="11" color="user21" display="text" edit="normal" font="굴림,9" text="수금예정일"/>
						<cell col="12" color="user21" display="text" edit="normal" font="굴림,9" text="영업사양예정일"/>
						<cell col="13" color="user21" display="text" font="굴림,9" text="수금완료일"/>
						<cell col="14" color="user21" display="text" font="굴림,9" text="기술사양&#32;전송날짜"/>
						<cell col="15" color="user21" display="text" font="굴림,9" text="영업담당"/>
						<cell col="16" color="user21" display="text" font="굴림,9" text="관리담당"/>
						<cell col="17" color="user21" display="text" font="굴림,9" text="영업지사"/>
					</head>
					<body>
						<cell bkcolor2="user22" bkimageid='expr:gfn_getFlagBkImageID(getColumn(currow,&#32;&quot;changed&quot;))' col="0" colid="changed" display="image"/>
						<cell align="center" col="1" display="text" expr="currow+1"/>
						<cell col="2" colid="ZZPJT_ID" display="text"/>
						<cell col="3" colid="HOGI" display="text"/>
						<cell col="4" colid="BSTNK" display="text"/>
						<cell col="5" colid="NAME1" display="text"/>
						<cell col="6" colid="CHAKD" display="text"/>
						<cell col="7" colid="DPCPD" display="text"/>
						<cell col="8" colid="CHKCOL" display="text"/>
						<cell col="9" colid="CHKTPDATE2" display="text"/>
						<cell col="10" colid="CHKTPDATE3" display="text"/>
						<cell col="11" colid="POCDT" display="text" edit="normal"/>
						<cell col="12" colid="PTPDT" display="text" edit="normal"/>
						<cell col="13" colid="TPDATE2" display="text"/>
						<cell col="14" colid="TPDATE3" display="text"/>
						<cell col="15" colid="DEALER" display="text"/>
						<cell col="16" colid="MANAGER" display="text"/>
						<cell col="17" colid="SDFIELD" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Calendar Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_frChakd" Left="85" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" OnKeyDown="ed_cdnm_OnKeyDown" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="2" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="48" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="87"></Calendar>
		<Calendar Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_toChakd" Left="190" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" OnKeyDown="ed_cdnm_OnKeyDown" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="3" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="48" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="87"></Calendar>
		<Checkbox BKColor="user0" Height="14" Id="chk_col" Left="85" TabOrder="7" Text="계약금&#32;미수금" Top="78" Value="FALSE" Width="100"></Checkbox>
		<Checkbox BKColor="user0" Height="14" Id="chk_tpdate2" Left="237" TabOrder="8" Text="영업사양&#32;미전송" Top="78" Value="FALSE" Width="120"></Checkbox>
		<Checkbox BKColor="user0" Height="14" Id="chk_tpdate3" Left="389" TabOrder="9" Text="기술사양&#32;미전송" Top="78" Value="FALSE" Width="120"></Checkbox>
		<Div BKColor="user5" Height="44" Id="div_vbvg" Left="370" OnLoadCompleted="fn_OnLoadCompleted" OnTimer="WB0199010A_OnTimer" TabOrder="4" Text="Div0" Top="24" Url="COM::Coms001.xml" Width="280">
			<Contents></Contents>
		</Div>
		<Edit Border="Flat" Height="20" Id="ed_zzpjtid" Left="84" LeftMargin="4" MaxLength="6" RightMargin="4" Style="sty_ipt_search_ind" TabOrder="1" Top="25" UpperOnly="TRUE" Width="64"></Edit>
		<Button Cursor="HAND" Height="18" Id="btn_pjt" ImageID="btn_icon_search" Left="149" OnClick="ufn_openPjt" TabOrder="12" Top="25" Transparent="TRUE" Width="18"></Button>
		<Edit Border="Flat" Height="20" Id="ed_sman_cd" Left="733" LeftMargin="4" OnChanged="ed_sman_cd_OnChanged" OnCharChanged="ed_sman_cd_OnCharChanged" OnFocus="fn_OnFocus" OnKillFocus="fn_OnKillFocus" RightMargin="4" Style="sty_ipt_form" TabOrder="5" Top="24" UpperOnly="TRUE" Width="80"></Edit>
		<Button Height="18" Id="btn_popSman" ImageID="btn_icon_search" Left="814" OnClick="fn_OnClick_popup" TabOrder="12" Text="Button0" Top="25" Transparent="TRUE" Width="18"></Button>
		<Edit Border="Flat" CheckLength="Byte" Enable="FALSE" Height="20" Id="ed_sman_nm" ImeMode="none" Left="833" LeftMargin="4" MaxLength="105" RightMargin="4" Style="sty_ipt_search" TabOrder="13" Top="24" Width="83"></Edit>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 영업미결(계약금 미수금, 사양미결) 현장관리
 * 작  성  자   : 김은하
 * 작성  일자   : 2020.08
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 * COMMENT
   1. WFC URL 				: 
   2. WFC OPERATION NAME 	: 
   3. WFC OBJ NAME 			: 
   4. 개발자료 :  
 ******************************************************************************************
*/

#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::nsfRequest.js";	// 공통 스크립트 
#include "LIB::common_hdel.js";	// 공통 스크립트  /* GNY 추가 */
#include "LIB::common_sd.js";

//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================

var F_FRM_ID;
var F_GRID_SELECT = "N";
var f_user_auth = "";  			// 사용자권한 (G_USER_GROUP_B)
var f_user_id = "";  
var f_user_name = "";
==========================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	// Form 로드 이벤트 맨 첫줄에 기술 
	gfn_initForm(true);
	fn_init_form(); 	// 폼 초기화
	
	// 영업담당자 정보 불러옴
	switch (G_VEND_WGBN) {
		case "E" : 
			f_user_id   = G_SAP_USER_PM_B;
			f_user_name = G_SAP_USER_PMNM_B;
			break;
		default  : 
			f_user_id   = G_SAP_USER_ID;
			f_user_name = G_SAP_USER_NAME;
			break;
	}
	
	f_user_auth = G_USER_GROUP_B;
	fn_setting_user_auth(f_user_auth);
}

// 사용자 권한별 설정
function fn_setting_user_auth(userAuth)
{  
	switch (userAuth)  
	{
		// 영업담당자인 경우 부서, 팀을 리턴된 담당자코드로 SET
		case "B30" : fn_init_sman(); break;
		case "B40" : fn_init_sman(); break;
		case "B50" : fn_init_sman(); break;
		default:
			break;
	} 
}

function fn_init_sman()
{	 
	ed_sman_cd.text = f_user_id;	// 리턴된 담당자코드로 검색조건 SET
	ed_sman_nm.text = f_user_name; 
}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

/********************************************************************************
* 기      능   : 폼 초기화
********************************************************************************/
function fn_init_form() {

}

/********************************************************************************
* 팝업 버튼 분배
********************************************************************************/
function fn_OnClick_btn(obj) {
	var fncName = "fn_" + substr(obj.id, 4); 
	eval( fncName + "()");
}

function ufn_openPjt(obj)
{
	var arg = "fa_zzpjt_cd   = "+quote(ed_vbeln_qry.Text);		//프로젝트번호
//프로젝트명			+ " fa_zzpjt_nm  = "+quote(ed_qtso_nm.Text); 	
	var arr = gfn_openPopUpUrlHdel("Com::Com0180.xml", true, arg);			
	if (arr != null && arr != 0) {
		ed_vbeln_qry.Text = arr[0];
	}				
}

function fn_OnClick_popup(obj)
{
	var arg = "fa_sman_cd= " 	+ quote(ed_sman_cd.text) // 담당자코드
			 + " fa_sman_nm = " + quote(ed_sman_nm.text); // 담당자명 
			 	
	var arr = gfn_openPopUpUrlHdel("Com::Com0030.xml", true, arg);	
	
	//trace("arr : " + arr);
	
	if (arr != null && arr != 0) {
		ed_sman_cd.text = arr[0];	// 리턴된 담당자코드로 검색조건 SET
		ed_sman_nm.text = arr[1];	// 리턴된 담당자명으로 검색조건 SET
		ed_sman_nm.SetFocus();
	} 
}

/********************************************************************************
* 기      능   : 조회
********************************************************************************/
var fn_query_chk = false;
function fn_query(obj) {
	if(!fn_query_chk) {
		fn_query_chk = true;
	} else {
		return;
	}
	
	gfn_clearMsgBar();
	gfn_clearGridSortMark(grd_file);
	
	ds_cond.DeleteAll();
	ds_cond.AddRow();
	ds_cond.SetColumn(0, "ZZPJT_ID", ed_zzpjtid.value);	// 프로젝트
	ds_cond.SetColumn(0, "FR_CHAKD", cal_frChakd.value);	// 착공예정일_시작
	ds_cond.SetColumn(0, "TO_CHAKD", cal_toChakd.value);	// 착공예정일_끝
	ds_cond.SetColumn(0, "VKBUR_F", div_vbvg.cb_frvb.value);	// 부서_시작
	ds_cond.SetColumn(0, "VKBUR_T", div_vbvg.cb_tovb.value);	// 부서_끝
	ds_cond.SetColumn(0, "VKGRP_F", div_vbvg.cb_frvg.value); 	// 영업그룹_시작
	ds_cond.SetColumn(0, "VKGRP_T", div_vbvg.cb_tovg.value); 	// 영업그룹_끝
	ds_cond.SetColumn(0, "DEALER", div1.div_dealer.ed_dealer_cd.Text);	// 영업담당자
	ds_cond.SetColumn(0, "MANAGER", ed_sman_cd.Text);	// 관리담당자
	ds_cond.SetColumn(0, "CHKCOL", chk_col.value);	// 계약금 미수금
	ds_cond.SetColumn(0, "CHKTPDATE2", chk_tpdate2.value);	// 영업사양 미전송
	ds_cond.SetColumn(0, "CHKTPDATE3", chk_tpdate3.value);	// 기술사양 미전송
	
	ds_list.DeleteAll();
	ds_error.ClearData();
	
	//조회조건 제한
	var dayGap = DateTime(ds_cond.GetColumn(0, "TO_CHAKD")) - DateTime(ds_cond.GetColumn(0, "FR_CHAKD"));
	if(ds_cond.GetColumn(0, "FR_CHAKD") == '' || ds_cond.GetColumn(0, "TO_CHAKD") == '' || dayGap > 365){
		gfn_showAlert("CW10025", "의뢰기간은 1년 이하로 설정하시기 바랍니다.");
		fn_query_chk = false;
		return;
	}
	
	fn_createWait("",this);     // 처리중입니다. 메시지 처리
	nsfRequest('query'
				, 'sso0214/find'
				, 'ds_cond=ds_cond ds_list=ds_list'
				, 'ds_list=ds_list ds_error=ds_error'
				, ''
				, 'fn_afterQuery'
				);
}

function ed_sman_cd_OnChanged(obj,strText)
{
	// 입력된 조건이 없으면
	if (length(trim(ed_sman_cd.text)) == 0 && length(trim(ed_sman_nm.text)) == 0) {
		//fn_OnClick_popup(btn_popSman);  // 팝업화면 호출
	} else {
		fn_query_sman();  				// 담당자조회 서비스 호출
	}	
}

function ed_sman_cd_OnCharChanged(obj,strPreText,strPostText)
{
	if (strPreText != strPostText)
		ed_sman_nm.Text = "";	
}

function fn_query_sman() { 

	gfn_clearMsgBar();   
	
//	trace(ds_cond_sman.SaveXML()); 	
	
	// 출력데이타셋 초기화
	ds_list_sman.ClearData();
	ds_cond_sman.ClearData();
	ds_cond_sman.AddRow();
	ds_cond_sman.SetColumn(ds_cond_sman.row, "SMAN_CD", trim(ed_sman_cd.text));
	ds_cond_sman.SetColumn(ds_cond_sman.row, "SMAN_NM", trim(ed_sman_nm.text));

	// 서비스호출
	nsfRequest("query"									// srvId
				, "com0030/find"						// url
				, "ds_cond_sman=ds_cond_sman ds_list_sman=ds_list_sman"		// inDsList
				, "ds_list_sman=ds_list_sman ds_error_sman=ds_error_sman"	// outDsList
				, ""									// strParam
				, "fn_afterQuery_sman");				// CallBackFunc
}

/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(svcId, errCode, errMsg) {
	fn_query_chk = false; //중복조회 방지용 flag
	fn_destroyWait();

	if(ds_error.rowcount() > 0) 	{
		gfn_showMsg("CE00001");
	} else {
		if (ds_list.RowCount() > 0) {
			grd_file.SetFocus();
		}
	}
}


/********************************************************************************
* 기      능   :  담당자 조회 Callback  
********************************************************************************/ 
function fn_afterQuery_sman(errCode, errMsg) {
		//alert(" .... first search : "+ds_list_sman.SaveXML());
	if(ds_error_sman.rowcount() > 0) { 	// 호출결과처리
		//trace("fn_Query FAILED!!! "
		//       + "[idx : " 			+ ds_error.GetColumn(0,"IDX") + "] "
		//       + "[error message : "+ ds_error.GetColumn(0,"ERRMSG") + "]"
		//       );		       
	} else {
		//alert(" .... first search : "+ds_list_sman.SaveXML());
		if (ds_list_sman.RowCount() = 1) { // 한 건 조회된 경우
			// 조회해 온 값으로 담당자 검색정보 SET
			ed_sman_cd.Text = ds_list_sman.GetColumn(ds_list_sman.row, "SMAN_CD");
			ed_sman_nm.Text = ds_list_sman.GetColumn(ds_list_sman.row, "SMAN_NM");
		} 
		else if (ds_list_sman.RowCount() > 1) { // 다 건 조회된 경우	
			fn_OnClick_popup(btn_popSman); // 담당자조회 팝업화면  호출
		}
	}
}

/********************************************************************************
* 기      능   : 그리드 셀 더블클릭 시
********************************************************************************/
function grd_common_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam)
{
	//fn_OnClick_btn(btn_confirm);  // 확인버튼 클릭 호출
}

/********************************************************************************
* 기      능   : 그리드 헤더 클릭시 정렬 처리 
********************************************************************************/
function grd_header_OnHeadClick(obj,nCell,nX,nY,nPivotIndex) {

	var content = grd_header.Contents;

	if( nCell == 0 ) gfn_selectAllGrid(obj,nCell,nCell,true);
	else {
		gfn_sortGrid(obj, nCell);
		grd_header.Contents = content;
	}
}

/********************************************************************************
* 기      능   : 그리드 키 입력시
********************************************************************************/

function grd_detail_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam) {
	var ds = object(obj.BindDataset);
	if (nChar==13) { 	// 엔터키이면 다음 행으로 이동
		ds.row = ds.row + 1;
	} else if (nChar==27)	{ 	// Esc 키이면 변경전 자료로 되돌린다.
		var nCol = obj.GetCellPos();
		gfn_SetOrgColumn(obj, ds.row, nCol);
	} else {
		gfn_GrdCellCopyPasteReset(obj, ds, bCtrl, nChar);
	}
}

/********************************************************************************
* 기      능   : data column 변경시
********************************************************************************/

function ds_list_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex) {
    if (varNewValue != varOldValue) {
    
		F_GRID_SELECT = "Y";	// 데이터 입력 여부
    
		var obj_chn = obj.GetColumn(nRow, "CHANGED");
		var obj_pocdt = obj.GetColumn(nRow, "POCDT");
		var obj_ptpdt = obj.GetColumn(nRow, "PTPDT");
		
		ds_list.SetColumn(nRow, "POCDT" , obj_pocdt);
		ds_list.SetColumn(nRow, "PTPDT" , obj_ptpdt);
		ds_list.SetColumn(nRow, "CHANGED" , "U");
		
	}
}

/********************************************************************************
* 기      능   : 저장
********************************************************************************/
function fn_save(obj)
{	
	if (F_GRID_SELECT == "Y") {
		if (gfn_showConfirm("CI10003") == true) { // CI10003 저장하시겠습니까?
			fn_createWait("",this);     // 처리중입니다. 메시지 처리
			
			ds_list.Filter('changed=='+quote('U'));
			destroy("ds_save_list");
			create("dataset","ds_save_list");
			object("ds_save_list").copyF(ds_list);
			ds_list.UnFilter();
			
			for(var i=0; i<lds_list.GetRowCount(); i++) {
				ds_save_list.DeleteAll();
				ds_save_list.AddRow();
				ds_save_list.SetColumn(0, "ZZPJT_ID", ds_list.GetColumn(ds_list.row, "ZZPJT_ID"));	// 프로젝트
				ds_save_list.SetColumn(0, "POCDT", ds_list.GetColumn(ds_list.row, "POCDT"));	// 수금예정일
				ds_save_list.SetColumn(0, "PTPDT", ds_list.GetColumn(ds_list.row, "PTPDT"));	// 영업사양예정일
			}
			
			nsfRequest("updateZsdt0218",
						"sso0214/merge",
						"ds_save_list=ds_save_list",
						"ds_error=ds_error",
						"",
						"fn_afterSave");
		}
	}
	else {
		Alert("변경된 정보가 없습니다.");
	}
}

/********************************************************************************
* 기      능   : 저장 Callback
********************************************************************************/
function fn_afterSave(svcId, errCode, errMsg) {
	F_GRID_SELECT = "N";	// 데이터 입력 여부
	fn_destroyWait();
	
	if(ds_error.rowcount() > 0) 	{
		gfn_showMsg("CE00001");
	} else {
		if (ds_list.RowCount() > 0) {
			grd_file.SetFocus();
		}
	}
	
	fn_query();
	
}
/********************************************************************************
* 기      능   : 엑셀  
********************************************************************************/
function fn_excel()
{
	gfn_exportExcel(grd_file,G_USER_ID);
}

function cb_vkbur_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex) {
	ds_vkgrp.UnFilter();
	ds_vkgrp.Filter("DTEXT1 == '" + strCode + "'");
	tab.main.div_header.cb_vkgrp.SetFocus();
	tab.main.div_header.cb_vkgrp.index = 0;	
}

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}

/********************************************************************************
* 기      능   :  엔터 시
********************************************************************************/
function ed_cdnm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam) {
	if ( nChar == 13 ) // enter key
	{
		fn_query();// 조회
	}
}
]]></Script>
</Window>