<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="560" Id="Ses0410" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="&#32;시방서&#32;검토&#32;요청&#32;등록" Top="8" Ver="1.0" Width="978" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="mandt" size="256" summ="default" type="STRING"/>
					<colinfo id="zrqno" size="256" summ="default" type="STRING"/>
					<colinfo id="zseq" size="256" summ="default" type="STRING"/>
					<colinfo id="kunnr" size="256" summ="default" type="STRING"/>
					<colinfo id="kunnr_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="kunz2" size="256" summ="default" type="STRING"/>
					<colinfo id="kunz2_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="zrqvym" size="256" summ="default" type="STRING"/>
					<colinfo id="zrqdat" size="256" summ="default" type="STRING"/>
					<colinfo id="part_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="detail_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="check_id" size="256" summ="default" type="STRING"/>
					<colinfo id="item_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="searchkey" size="256" summ="default" type="STRING"/>
					<colinfo id="spec_text" size="256" summ="default" type="STRING"/>
					<colinfo id="sman" size="256" summ="default" type="STRING"/>
					<record>
						<check_id></check_id>
						<detail_cd></detail_cd>
						<item_cd></item_cd>
						<kunnr></kunnr>
						<kunnr_nm></kunnr_nm>
						<kunz2></kunz2>
						<kunz2_nm></kunz2_nm>
						<mandt></mandt>
						<part_cd></part_cd>
						<searchkey></searchkey>
						<sman></sman>
						<spec_text></spec_text>
						<zrqdat></zrqdat>
						<zrqno></zrqno>
						<zrqvym></zrqvym>
						<zseq></zseq>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_error">
				<Contents>
					<colinfo id="IDX" size="256" type="STRING"/>
					<colinfo id="ERRMSG" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list">
				<Contents>
					<colinfo id="mandt" size="256" summ="default" type="STRING"/>
					<colinfo id="flag" size="256" summ="default" type="STRING"/>
					<colinfo id="zrqno" size="256" summ="default" type="STRING"/>
					<colinfo id="zseq" size="256" summ="default" type="STRING"/>
					<colinfo id="destat" size="256" summ="default" type="STRING"/>
					<colinfo id="kunnr" size="256" summ="default" type="STRING"/>
					<colinfo id="kunnr_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="name1" size="256" summ="default" type="STRING"/>
					<colinfo id="zrevym" size="256" summ="default" type="STRING"/>
					<colinfo id="kunz2" size="256" summ="default" type="STRING"/>
					<colinfo id="kunz2_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="zrqdat" size="256" summ="default" type="STRING"/>
					<colinfo id="kunz3" size="256" summ="default" type="STRING"/>
					<colinfo id="kunz3_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="zrecdt" size="256" summ="default" type="STRING"/>
					<colinfo id="zrefdt" size="256" summ="default" type="STRING"/>
					<colinfo id="vkbur" size="256" summ="default" type="STRING"/>
					<colinfo id="vkgrp" size="256" summ="default" type="STRING"/>
					<colinfo id="part_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="part_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="detail_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="detail_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="check_id" size="256" summ="default" type="STRING"/>
					<colinfo id="check_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="item_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="searchkey" size="256" summ="default" type="STRING"/>
					<colinfo id="spec_text" size="256" summ="default" type="STRING"/>
					<colinfo id="hdel_text" size="256" summ="default" type="STRING"/>
					<colinfo id="append_text" size="256" summ="default" type="STRING"/>
					<colinfo id="sman" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_destat_cd">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_part_cd">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_detail_cd">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_check_id">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_header">
				<Contents>
					<colinfo id="mandt" size="256" summ="default" type="STRING"/>
					<colinfo id="zrqno" size="256" summ="default" type="STRING"/>
					<colinfo id="zrqdat" size="256" summ="default" type="STRING"/>
					<colinfo id="zrevym" size="256" summ="default" type="STRING"/>
					<colinfo id="kunnr" size="256" summ="default" type="STRING"/>
					<colinfo id="name1" size="256" summ="default" type="STRING"/>
					<colinfo id="sman" size="256" summ="default" type="STRING"/>
					<colinfo id="kunz2_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user0" Bottom="66" Height="26" Id="Shape1" Left="8" LineColor="user1" Right="970" TabOrder="1" Top="40" Type="Rectangle" Width="962"></Shape>
		<Shape BKColor="user0" Bottom="91" Height="26" Id="Shape2" Left="8" LineColor="user1" Right="970" TabOrder="2" Top="65" Type="Rectangle" Width="962"></Shape>
		<Static Align="Right" Height="24" Id="st_qtdat_fm" Left="9" Style="sty_lb_search" TabOrder="3" Text="요청번호&#32;" Top="41" VAlign="Middle" Width="119"></Static>
		<Grid AutoEnter="TRUE" AutoFitEndLine="Hide" BindDataset="ds_list" BkColor2="default" BoldHead="true" Border="Flat" Bottom="552" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="25" Height="336" HScrollCell="TRUE" Id="grd_list" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" OnCellClick="grd_list_OnCellClick" Right="973" RowHeight="50" ScrollCell="true" Style="sty_grid" TabOrder="4" TabStop="true" Top="216" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="965">
			<contents>
				<format id="Default">
					<columns>
						<col width="31"/>
						<col width="34"/>
						<col width="55"/>
						<col width="88"/>
						<col width="160"/>
						<col width="197"/>
						<col width="80"/>
						<col width="181"/>
						<col width="400"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user21" display="text" font="굴림,9" text="No"/>
						<cell col="1" display="text" font="새굴림,9" text="구분"/>
						<cell align="center" col="2" color="user21" display="text" font="굴림,9" text="항목품번"/>
						<cell align="center" col="3" color="user21" display="text" font="굴림,9" text="파트"/>
						<cell align="center" col="4" color="user21" display="text" font="굴림,9" text="세부파트"/>
						<cell align="center" col="5" color="user21" display="text" font="굴림,9" text="검토항목"/>
						<cell align="center" col="6" color="user21" display="text" font="굴림,9" text="항목번호"/>
						<cell align="center" col="7" color="user21" display="text" font="굴림,9" text="검색어"/>
						<cell align="center" col="8" color="user21" display="text" font="굴림,9" text="시방서내용"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" display="text" expr="currow+1"/>
						<cell bkimageid='expr:gfn_getFlagBkImageID(getColumn(currow,&#32;&quot;FLAG&quot;))' col="1" display="text"/>
						<cell align="center" bkcolor2="user22" col="2" colid="ZSEQ" display="combo"/>
						<cell align="left" bkcolor2="user22" col="3" colid="part_nm" display="normal"/>
						<cell align="left" bkcolor2="user22" col="4" colid="detail_nm" display="normal"/>
						<cell align="left" bkcolor2="user22" col="5" colid="check_nm" display="normal"/>
						<cell align="center" bkcolor2="user22" col="6" colid="item_cd" display="text"/>
						<cell align="center" bkcolor2="user22" col="7" colid="SEARCHKEY" display="text"/>
						<cell align="left" bkcolor2="user22" col="8" colid="SPEC_TEXT" display="text" multiline="true" wordwrap="word"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Align="Right" Height="24" Id="Static3" Left="624" Style="sty_lb_search" TabOrder="5" Text="영업담당자&#32;" Top="67" VAlign="Middle" Width="112"></Static>
		<Shape BKColor="user0" Bottom="116" Height="26" Id="Shape0" Left="8" LineColor="user1" Right="970" TabOrder="6" Top="90" Type="Rectangle" Width="962"></Shape>
		<Static Align="Right" Height="24" Id="Static0" Left="9" Style="sty_lb_search" TabOrder="7" Text="시방서개정년월&#32;" Top="66" VAlign="Middle" Width="119"></Static>
		<Edit BindDataset="ds_header" Border="Flat" Column="sman" Enable="FALSE" Height="20" Id="ed_sman_cd" Left="739" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="8" Top="69" UpperOnly="TRUE" Width="80"></Edit>
		<Button Height="18" Id="btn_popSman" ImageID="btn_icon_search" Left="820" OnClick="fn_OnClick_popup" TabOrder="9" Text="Button0" Top="70" Transparent="TRUE" Width="18"></Button>
		<Edit BindDataset="ds_header" Border="Flat" CheckLength="Byte" Column="kunz2_nm" Enable="FALSE" Height="20" Id="ed_sman_nm" ImeMode="none" Left="839" LeftMargin="4" MaxLength="105" RightMargin="4" Style="sty_ipt_search" TabOrder="10" Top="69" Width="83"></Edit>
		<Static Align="Right" Height="24" Id="Static7" Left="336" Style="sty_lb_search" TabOrder="11" Text="영업요청일자&#32;" Top="65" VAlign="Middle" Width="88"></Static>
		<Div Height="35" Id="div_btn" TabOrder="12" Text="Div0" Url="WB01::CommBtnForm.xml" Width="976">
			<Contents></Contents>
		</Div>
		<Static Align="Right" Height="24" Id="Static1" Left="624" Style="sty_lb_search" TabOrder="13" Text="건설사&#32;" Top="41" VAlign="Middle" Width="112"></Static>
		<Edit BindDataset="ds_header" Border="Flat" Column="ZRQNO" Enable="FALSE" Height="19" Id="ed_zrqno" ImeMode="english" Left="131" LeftMargin="4" MaxLength="10" RightMargin="4" Style="sty_ipt_form" TabOrder="14" Top="44" UpperOnly="TRUE" Width="100"></Edit>
		<Calendar BindDataset="ds_header" Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="zrqdat" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_zrqdat" Left="427" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="15" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="68" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="88"></Calendar>
		<Shape BKColor="user0" Bottom="141" Height="26" Id="Shape3" Left="8" LineColor="user1" Right="970" TabOrder="16" Top="115" Type="Rectangle" Width="962"></Shape>
		<Shape BKColor="user0" Bottom="208" Height="68" Id="Shape4" Left="8" LineColor="user1" Right="970" TabOrder="17" Top="140" Type="Rectangle" Width="962"></Shape>
		<Static Align="Right" Height="24" Id="Static5" Left="9" Style="sty_lb_search" TabOrder="18" Text="파&#32;트&#32;" Top="91" VAlign="Middle" Width="79"></Static>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="part_cd" DataColumn="CODE_NAME" Height="20" Id="cb_part" InnerDataset="ds_part_cd" Left="90" OnChanged="cb_part_OnChanged" Style="sty_ipt_form" TabOrder="21" Top="92" Width="120"></Combo>
		<Static Align="Right" Height="24" Id="Static2" Left="336" Style="sty_lb_search" TabOrder="19" Text="세부파트&#32;" Top="91" VAlign="Middle" Width="88"></Static>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="detail_cd" DataColumn="CODE_NAME" Height="20" Id="cb_detail" InnerDataset="ds_detail_cd" Left="426" OnChanged="cb_detail_OnChanged" Style="sty_ipt_form" TabOrder="22" Top="92" Width="184"></Combo>
		<Static Align="Right" Height="24" Id="Static4" Left="624" Style="sty_lb_search" TabOrder="20" Text="검토항목&#32;" Top="91" VAlign="Middle" Width="112"></Static>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="check_id" DataColumn="CODE_NAME" Height="20" Id="cb_check" InnerDataset="ds_check_id" Left="738" OnChanged="cb_check_OnChanged" Style="sty_ipt_form" TabOrder="23" Top="92" Width="184"></Combo>
		<Static Align="Right" Height="24" Id="Static6" Left="9" Style="sty_lb_search" TabOrder="24" Text="항목번호&#32;" Top="116" VAlign="Middle" Width="79"></Static>
		<Edit BindDataset="ds_list" Border="Flat" Column="item_cd" Height="19" Id="ed_item_no" ImeMode="english" Left="91" LeftMargin="4" MaxLength="10" OnChanged="ed_item_no_OnChanged" RightMargin="4" Style="sty_ipt_form" TabOrder="25" Top="119" UpperOnly="TRUE" Width="152"></Edit>
		<Static Align="Right" Height="24" Id="Static8" Left="336" Style="sty_lb_search" TabOrder="26" Text="검색어&#32;" Top="116" VAlign="Middle" Width="88"></Static>
		<Edit BindDataset="ds_list" Border="Flat" Column="searchkey" Height="19" Id="ed_searchkey" ImeMode="english" Left="427" LeftMargin="4" MaxLength="10" OnChanged="ed_searchkey_OnChanged" RightMargin="4" Style="sty_ipt_form" TabOrder="27" Top="119" UpperOnly="TRUE" Width="256"></Edit>
		<Static Align="Right" Height="67" Id="Static9" Left="9" Style="sty_lb_search" TabOrder="28" Text="시방서&#32;내용&#32;" Top="141" VAlign="Middle" Width="79"></Static>
		<TextArea BindDataset="ds_list" Border="Flat" Column="spec_text" Height="64" Id="txt_spec_text" Left="91" OnChanged="txt_spec_text_OnChanged" Style="sty_ipt_form" TabOrder="29" Top="142" VScroll="TRUE" Width="864"></TextArea>
		<Div BKColor="user0" Height="22" Id="div_kunnr" Left="738" OnLoadCompleted="fn_OnLoadCompleted" TabOrder="30" Text="Div0" Top="43" Url="COM::Coms003.xml" Width="227">
			<Contents></Contents>
		</Div>
		<Div BKColor="user0" Height="22" Id="div_zrevym" Left="132" OnLoadCompleted="fn_OnLoadCompleted" TabOrder="31" Text="Div0" Top="67" Url="COM::Coms012.xml" Width="181">
			<Contents></Contents>
		</Div>
		<Static Align="Right" Height="24" Id="Static10" Left="336" Style="sty_lb_search" TabOrder="32" Text="항목품번&#32;" Top="40" VAlign="Middle" Width="88"></Static>
		<Edit BindDataset="ds_list" Border="Flat" Column="zseq" Enable="FALSE" Height="20" Id="Edit0" Left="427" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="33" Top="43" UpperOnly="TRUE" Width="93"></Edit>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::nsfRequest.js";	// 공통 스크립트 
#include "LIB::common_hdel.js";	// 공통 스크립트  /* GNY 추가 */
#include "LIB::common_sd.js";
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var F_FRM_TITLE;// = "견적상세(국내본팀)";	// 공통코드 화면명
var NEW_REG_ZRQNO = "N";	//
var NOW_ZRQNO = "";	// 현재 창의 요청일련번호
var LIST_NOW_ROW;	// 자식창에서 그리드 선택 값
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	// Form 로드 이벤트 맨 첫줄에 기술 
	gfn_initForm(true);	

	//팝업창 상단 타이블 및 버튼
	F_FRM_TITLE = "시방서 검토 요청 등록 ";
	div_btn.fn_loadUseBtn("20,30", F_FRM_TITLE, "", ""); 
	
	//부모창에서 선택값
	if(parent.F_NOW_LISTROW == -1){
		NEW_REG_ZRQNO = "Y";	
	}
	
	//'시방서 검토 요청' 버튼을 클릭하였는지 그리드를 더블 클릭하였는지 구분
	if(NEW_REG_ZRQNO == "N") {
		//부모창에서 더블클릭하여 넘어온 경우
		trace("//부모창에서 더블클릭하여 넘어온 경우");
		NOW_ZRQNO = parent.ds_list.GetColumn(parent.F_NOW_LISTROW,"zrqno");
		fn_query();		//요청 일련 번호에 맞는 데이터를 읽어 와야 한다.
	} else {
		//부모창에서 '시방서 검토 요청' 버튼을 클릭하여 넘어온 경우
		trace("부모창에서 '시방서 검토 요청' 버튼을 클릭하여 넘어온 경우");
	}
	
	fn_init_form(); 	// 폼 초기화
}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

/********************************************************************************
* 기      능   : 폼 초기화
********************************************************************************/
function fn_init_form() {
	if(NEW_REG_ZRQNO == "N") {
		btn_popSman.Enable = false;
		div_zrevym.Enable = false;
		div_kunnr.btn_popBuyr.Enable = false;
		cal_zrqdat.Enable = false;
	} else {
		ds_header.AddRow(); 
		cal_zrqdat.text = gfn_getCurrDate();
	}
	
	//시방서 개정일자 콤보 만들기
	var curYear = substr(gfn_getCurrDate(),0,4);		//현재 년도를 구한다.
	var curMonth = substr(gfn_getCurrDate(),4,2);		//현재 월을 구한다.
	div_zrevym.fn_makeYear(curYear,-7,0,0);				//시작년, 마지막년, 선택년 - 현재 년을 기준으로 한다.
	div_zrevym.cb_monthf.index = parseInt(curMonth)-1;
	
	ed_sman_cd = "H"+G_USER_ID;
	ed_sman_nm = G_USER_NAME;
}


/********************************************************************************
* 기      능   : 조회 
********************************************************************************/
function fn_query() {
	ds_header.DeleteAll();	// 데이터셋 초기화
	ds_list.DeleteAll();	// 데이터셋 초기화
	
	var param = "zrqno="+NOW_ZRQNO;	
	
	nsfRequest("fn_queryHeader", 
				"ses0520/selectDeviationListHeader", 
				"ds_header=ds_header", 
				"ds_header=ds_header ds_error=ds_error", 
				param, 
				"fn_afterQuery");

}


/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	parent.fn_query();
	close();
}

function fn_partCodeLoad(){
	ds_part_cd.ClearData();
	ds_detail_cd.ClearData();
	ds_check_id.ClearData();
	
	nsfRequest(  ""
			   , "ses0520/queryPartCd"
			   , "ds_part_cd=ds_part_cd"
			   , "ds_part_cd=ds_part_cd ds_error=ds_error"
			   , ""
			   , "fn_partCodeLoadafter");
}

function fn_partCodeLoadafter(){
	gfn_InsertRowCombo(ds_part_cd, 0, "Y", "Y"); // 선택 행 추가
	cb_part.index = 0;
}

function fn_afterQuery(svcId, errCode, errMsg){
	if(svcId == "fn_queryHeader"){
	
		// 상단 건설사, 시방서개정년월, 영업담당자 셋팅하기
		div_zrevym.cb_yearf.Value =  substr(ds_header.GetColumn(0,"zrevym"),0,4);
		div_zrevym.cb_monthf.Value = substr(ds_header.GetColumn(0,"zrevym"),4,2);
		
		div_kunnr.ed_buyr_cd.Value = substr(ds_header.GetColumn(0,"kunnr"), 4, 10);
		div_kunnr.ed_buyr_nm.Value = ds_header.GetColumn(0,"name1");
		
		ed_sman_cd.Text = ds_header.GetColumn(0,"sman");
		ed_sman_nm.Text = ds_header.GetColumn(0,"kunz2_nm");
				
		//요청 header callback 후 바로 Detail 읽어 오기		
		var param = "zrqno="+ds_header.GetColumn(0,"zrqno");
		nsfRequest("fn_queryDetail", 
					"ses0520/selectDeviationListDetail", 
					"ds_list=ds_list", 
					"ds_list=ds_list ds_error=ds_error", 
					param, 
					"fn_afterQuery");
		
		grd_list_OnCellClick("grd_list",1,0);
					
	} else if (svcID == "fn_queryDetail"){
		
	}
	if (svcId == "fn_query") {
		trace("부모 창에서 그리드를 더블 클릭 했을 경우 리스트 조회 끝");
		//읽어 오면 그리드 첫번째 행을 가르키며, onCellClick 를 실행 - 코드 값 셋팅을 위해
		
		//시방서 날짜를 셋팅해 준다.
		div_zrevym.cb_yearf.value = substr(ds_list.GetColumn(0, "zrevym"),0,4);
		div_zrevym.cb_monthf.value = substr(ds_list.GetColumn(0, "zrevym"),4,2);
		
	}
	
}

// 그리드 클릭 시 실행
function grd_list_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	ds_part_cd.ClearData();
	ds_detail_cd.ClearData();
	ds_check_id.ClearData();
	
	LIST_NOW_ROW = nRow;	//선택 된 리스트의 값을 저장
	
	nsfRequest(  ""
			   , "ses0520/queryPartCd"
			   , "ds_part_cd=ds_part_cd"
			   , "ds_part_cd=ds_part_cd ds_error=ds_error"
			   , ""
			   , "fn_partCode");
}

//리스트 클릭 시 상단 파트 콤보박스 셋팅 콜백
function fn_partCode(){
	var ListPartCode = ds_list.GetColumn(LIST_NOW_ROW,"part_cd");

	cb_part.Value = ListPartCode;

	//세부코드 호출 및 셋팅 하는 함수 호출
	fn_listDetailCodeCall();
}


//리스트 클릭 시 파트 코드 호출 후 세부코드 호출 및 셋팅하기
function fn_listDetailCodeCall(){
	var param = "part_cd="+cb_part.Value;
	
	nsfRequest(  ""
			   , "ses0520/queryDetailCd"
			   , "ds_detail_cd=ds_detail_cd"
			   , "ds_detail_cd=ds_detail_cd ds_error=ds_error"
			   , param
			   , "fn_detailCode");
}

function fn_detailCode(){
	var ListDetailCode = ds_list.GetColumn(LIST_NOW_ROW,"detail_cd");
			   
	cb_detail.Value = ListDetailCode; 
	
	fn_listCheckCode();
}

function fn_listCheckCode(){
	var param = "detail_cd="+cb_detail.Value;
	
	nsfRequest(  ""
			   , "ses0520/queryCheckCd"
			   , "ds_check_id=ds_check_id"
			   , "ds_check_id=ds_check_id ds_error=ds_error"
			   , param
			   , "fn_listCheckCodeCall");
}

function fn_listCheckCodeCall(){
	var ListCheckCode = ds_list.GetColumn(LIST_NOW_ROW,"check_id");
			   
	cb_check.Value = ListCheckCode; 
}

//영업 담당자 조회
function fn_OnClick_popup(obj)
{
	var arg = "fa_sman_cd= " 	+ quote(ed_sman_cd.text) // 담당자코드
			 + " fa_sman_nm = " + quote(ed_sman_nm.text); // 담당자명 
			 	
	var arr = gfn_openPopUpUrlHdel("Com::Com0030.xml", true, arg);	
	
	
	if (arr != null && arr != 0) {
		ed_sman_cd.text = arr[0];	// 리턴된 담당자코드로 검색조건 SET
		ed_sman_nm.text = arr[1];	// 리턴된 담당자명으로 검색조건 SET
		ed_sman_nm.SetFocus();
	} 
}


//시방서 검토 요청 저장
function fn_save(){
	if(NEW_REG_ZRQNO == "Y"){
		// 신규 데이터 입력일 경우
		// 시방서 개정 년월 합치기
		var zrevym = div_zrevym.cb_yearf.value +""+div_zrevym.cb_monthf.value;
		trace("zrevym : " + zrevym);
		
		if(div_kunnr.ed_buyr_cd.value == "" || div_kunnr.ed_buyr_cd.value == null){
			alert("[건설사]는 필수 선택 옵션입니다.'");
			break;
		}
		
		//헤더 데이터 만들기
		ds_header.SetColumn(0, "zrqdat", cal_zrqdat.Value);
		ds_header.SetColumn(0, "zrevym", zrevym);
		ds_header.SetColumn(0, "kunnr", div_kunnr.ed_buyr_cd.Value);
		ds_header.SetColumn(0, "kunz2", ed_sman_cd.Value);
		
		ds_list.SetColumn(LIST_NOW_ROW, "zrevym", zrevym);
		ds_list.SetColumn(LIST_NOW_ROW, "kunnr" , div_kunnr.ed_buyr_cd.value);
		ds_list.SetColumn(LIST_NOW_ROW, "kunz2" , ed_sman_cd.value);
		
		// 헤더만 먼저 저장한다.
		nsfRequest("", "ses0520/insertDeviationHeader", "ds_header=ds_header", "ds_header=ds_header ds_error=ds_error", "", "fn_insertDeviationHeaderAfter");		
	}else{
		//변경된 추가된 데이터나 변경된 데이터가 있는지 확인한다.
		var totalRowCount = 0;
		var editRowCount = 0;
		totalRowCount = ds_list.GetRowCount();		//전체 리스트 갯수 저장
		trace("리스트 갯수 : " + totalRowCount);
		for(var i = 0 ; i < totalRowCount ; i++){
			if(ds_list.GetColumn(i, "flag") != null){	//수정된 데이터가 있는지 확인
				trace(i+"번째 데이터는 " + ds_list.GetColumn(i, "flag"));
				editRowCount++;
			}
		}
			
		if(editRowCount <= 0){
			alert("수정되거나 추가된 데이터가 없습니다.\n확인 바랍니다.");
			return;
		}
	
		if ( !gfn_showConfirm("CI00024", "[저장]") ) { // [저장]을 하시겠습니까?
			return;
		}
	
		fn_createWait("",this);     // 처리중입니다. 메시지 처리
		
		for(var i = 0 ; i <= ds_list.GetColCount() ; i++){
			ds_list.SetColumn(i, "zrqno", NOW_ZRQNO);
		}
		
		var inDs =  "ds_list=ds_list";
	
		var outDs = "ds_list=ds_list ds_error=ds_error";
	
		nsfRequest("", "ses0520/saveDeviationDetail", inDs, outDs, "", "fn_afterSave");		
		
	}
}

//헤더 저장 콜백
function fn_insertDeviationHeaderAfter(svcId, errCode, errMsg){
	//신규 저장된 요청일련번호 확인
	NOW_ZRQNO = ds_header.getColumn(0, "zrqno");
	trace("신규 요청일련번호 : " + NOW_ZRQNO);
	
	for(var i = 0 ; i <= ds_list.GetColCount() ; i++){
		ds_list.SetColumn(i, "zrqno", NOW_ZRQNO);
	}
	
	nsfRequest("", "ses0520/saveDeviationDetail", "ds_list=ds_list", "ds_list=ds_list ds_error=ds_error", "", "");
		
	NEW_REG_ZRQNO = "N";
	
	fn_query();
}

//저장 콜백
function fn_afterSave(svcId, errCode, errMsg)
{
	if ( ds_error.GetRowCount() > 0 ) {
		fn_destroyWait();
		gfn_showAlert("CE00001");
		return;
	} 
	fn_destroyWait();
	fn_query();
}

//입력 버튼 클릭
function fn_input(){
	if(NEW_REG_ZRQNO == "Y") {
		//부모창에서 '시방서 검토 요청' 버튼을 클릭한 경우
		
		//영업요청일자, 영업 담당자, 건설사 입력 활성화
		cal_zrqdat.Enable = true;	//영업요청일자 버튼 활성화

		//영업요청일자는 기본적으로 현재 날짜 선택
		cal_zrqdat.Text = gfn_getCurrDate();		
	}
	
	// 파트 코드 불러오기
	fn_partCodeLoad();
	
	//한 줄 추가
	ds_list.AddRow();
	LIST_NOW_ROW = ds_list.rowpos;
	ds_list.SetColumn(LIST_NOW_ROW,"flag","I");	//추가한 로우에 flag에 Insert 구분 삽입
	
	gfn_InsertRowCombo(ds_part_cd, 0, "Y", "Y"); // 선택 행 추가
	cb_part.index = 0;
	
	//신규 항목품번 추가 이므로 세부파트, 검토항목 초기화
	ds_detail_cd.DeleteAll();
	ds_check_id.DeleteAll();
	
	
	//부모창에서 연경우 기존 데이터 셋팅
	//요청 일련 번호, 항목품번 체번 및 셋팅

	var newZseq = ds_list.GetColumn(LIST_NOW_ROW-1, "zseq");
	ds_list.SetColumn(LIST_NOW_ROW, "zseq",ToInteger(newZseq)+1);
	
}


//세부파트 변경시 - 검토항목 코드 다시 불러오기 및 리스트에 변경 내용 반영하기
function cb_detail_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex){
	if(ds_list.GetColumn(LIST_NOW_ROW, "flag") != "I"){
		// 현재 로우의 상태가 Insert 가 아니라면 Update 상태로 만든다.
		ds_list.SetColumn(LIST_NOW_ROW,"flag","U");
	}
	
	ds_list.setColumn(LIST_NOW_ROW, "detail_cd",cb_detail.Value);
	ds_list.setColumn(LIST_NOW_ROW, "detail_nm",cb_detail.Text);
	
	ds_check_id.DeleteAll();
	
	var param = "detail_cd="+cb_detail.Value;
	
	nsfRequest(  ""
			   , "ses0520/queryCheckCd"
			   , "ds_check_id=ds_check_id"
			   , "ds_check_id=ds_check_id ds_error=ds_error"
			   , param
			   , "fn_changeCheckid");
}

function fn_changeCheckid(){
	gfn_InsertRowCombo(ds_check_id, 0, "Y", "Y"); // 선택 행 추가
	cb_check.index = 0;
}


//검토항목 코드가 변경 되었을 경우 리스트에 내용 반영하기
function cb_check_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex){
	if(ds_list.GetColumn(LIST_NOW_ROW, "flag") != "I"){
		// 현재 로우의 상태가 Insert 가 아니라면 Update 상태로 만든다.
		ds_list.SetColumn(LIST_NOW_ROW,"flag","U");
	}
	
	ds_list.setColumn(LIST_NOW_ROW, "check_id",cb_check.Value);
	ds_list.setColumn(LIST_NOW_ROW, "check_nm",cb_check.Text);

}



function cb_part_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex){
	if(ds_list.GetColumn(LIST_NOW_ROW, "flag") != "I"){
		// 현재 로우의 상태가 Insert 가 아니라면 Update 상태로 만든다.
		ds_list.SetColumn(LIST_NOW_ROW,"flag","U");
	}
	
	ds_list.setColumn(LIST_NOW_ROW, "part_cd",cb_part.Value);
	ds_list.setColumn(LIST_NOW_ROW, "part_nm",cb_part.Text);
	
	ds_detail_cd.DeleteAll();
	ds_check_id.DeleteAll();

	var param = "part_cd="+cb_part.Value;
	
	nsfRequest(  ""
			   , "ses0520/queryDetailCd"
			   , "ds_detail_cd=ds_detail_cd"
			   , "ds_detail_cd=ds_detail_cd ds_error=ds_error"
			   , param
			   , "fn_changeDetailCd");
}

function fn_changeDetailCd(){
	gfn_InsertRowCombo(ds_detail_cd, 0, "Y", "Y"); // 선택 행 추가
	cb_detail.index = 0;

}

function ed_item_no_OnChanged(obj,strText)
{
	if(ds_list.GetColumn(LIST_NOW_ROW, "flag") != "I"){
		ds_list.SetColumn(LIST_NOW_ROW,"flag","U");
	}	
}

function ed_searchkey_OnChanged(obj,strText)
{
	if(ds_list.GetColumn(LIST_NOW_ROW, "flag") != "I"){
		ds_list.SetColumn(LIST_NOW_ROW,"flag","U");
	}	
}

function txt_spec_text_OnChanged(obj,strText)
{
	if(ds_list.GetColumn(LIST_NOW_ROW, "flag") != "I"){
		ds_list.SetColumn(LIST_NOW_ROW,"flag","U");
	}	
}
]]></Script>
</Window>