<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="392" Id="Ses0248" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="의뢰" Top="8" Ver="1.0" Width="456" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<colinfo id="ZRMK" size="256" type="STRING"/>
					<colinfo id="ZPRDGBN" size="256" type="STRING"/>
					<colinfo id="ZWGBN" size="256" type="STRING"/>
					<record>
						<DOCREQNO></DOCREQNO>
						<MANDT></MANDT>
						<ZPRDGBN></ZPRDGBN>
						<ZRMK></ZRMK>
						<ZSEQ></ZSEQ>
						<ZWGBN/>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_error">
				<Contents>
					<colinfo id="IDX" size="256" type="STRING"/>
					<colinfo id="ERRMSG" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list" OnColumnChanged="ds_header_OnColumnChanged">
				<Contents>
					<colinfo id="CHECK" size="256" type="STRING"/>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZRQFLG" size="256" type="STRING"/>
					<colinfo id="ZRQDAT" size="256" type="STRING"/>
					<colinfo id="ZRQCN" size="256" type="STRING"/>
					<colinfo id="ZWRITER" size="256" type="STRING"/>
					<colinfo id="ZRMK" size="256" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="CDATE" size="256" type="STRING"/>
					<colinfo id="CTIME" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UDATE" size="256" type="STRING"/>
					<colinfo id="UTIME" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_docmn">
				<Contents>
					<colinfo id="CODE" size="2" type="STRING"/>
					<colinfo id="CODE_NAME" size="2" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zrqflg">
				<Contents>
					<colinfo id="CODE" size="2" type="STRING"/>
					<colinfo id="CODE_NAME" size="2" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_header" OnColumnChanged="ds_header_OnColumnChanged">
				<Contents>
					<colinfo id="CHECK" size="256" type="STRING"/>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZRQFLG" size="256" type="STRING"/>
					<colinfo id="ZRQDAT" size="256" type="STRING"/>
					<colinfo id="ZRQCN" size="256" type="STRING"/>
					<colinfo id="ZWRITER" size="256" type="STRING"/>
					<colinfo id="ZRMK" size="256" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="CDATE" size="256" type="STRING"/>
					<colinfo id="CTIME" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UDATE" size="256" type="STRING"/>
					<colinfo id="UTIME" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<record>
						<CDATE></CDATE>
						<CHECK></CHECK>
						<CTIME></CTIME>
						<CUSER></CUSER>
						<DOCREQNO></DOCREQNO>
						<MANDT></MANDT>
						<QTNUM></QTNUM>
						<QTSER></QTSER>
						<UDATE></UDATE>
						<UTIME></UTIME>
						<UUSER></UUSER>
						<ZRMK></ZRMK>
						<ZRQCN></ZRQCN>
						<ZRQDAT></ZRQDAT>
						<ZRQFLG></ZRQFLG>
						<ZSEQ></ZSEQ>
						<ZWRITER></ZWRITER>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_save" OnColumnChanged="ds_header_OnColumnChanged">
				<Contents>
					<colinfo id="CHECK" size="256" type="STRING"/>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZRQFLG" size="256" type="STRING"/>
					<colinfo id="ZRQDAT" size="256" type="STRING"/>
					<colinfo id="ZRQCN" size="256" type="STRING"/>
					<colinfo id="ZWRITER" size="256" type="STRING"/>
					<colinfo id="ZRMK" size="256" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="CDATE" size="256" type="STRING"/>
					<colinfo id="CTIME" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UDATE" size="256" type="STRING"/>
					<colinfo id="UTIME" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<record>
						<CDATE></CDATE>
						<CHECK></CHECK>
						<CTIME></CTIME>
						<CUSER></CUSER>
						<DOCREQNO></DOCREQNO>
						<MANDT></MANDT>
						<QTNUM></QTNUM>
						<QTSER></QTSER>
						<UDATE></UDATE>
						<UTIME></UTIME>
						<UUSER></UUSER>
						<ZRMK></ZRMK>
						<ZRQCN></ZRQCN>
						<ZRQDAT></ZRQDAT>
						<ZRQFLG></ZRQFLG>
						<ZSEQ></ZSEQ>
						<ZWRITER></ZWRITER>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsContReqAppend">
				<Contents>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<colinfo id="ZATTSEQ" size="256" type="STRING"/>
					<colinfo id="ZATTPATH" size="256" type="STRING"/>
					<colinfo id="ZATTFN" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
					<colinfo id="FILE_SIZE" size="10" type="INT"/>
					<colinfo encrypt="base64" id="CONTENT" size="255" type="BLOB"/>
					<colinfo id="FLAG" size="256" type="STRING"/>
					<colinfo id="TEMP" size="256" type="STRING"/>
					<colinfo id="ZATTFN_OR" size="256" type="STRING"/>
					<colinfo id="ZWGBN" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsContReqAppend_0" UseClientLayout="1">
				<Contents>
					<colinfo id="reportNo" size="256" type="STRING"/>
					<colinfo id="reqNo" size="256" type="STRING"/>
					<colinfo id="sno" size="256" type="STRING"/>
					<colinfo id="appendCd" size="256" type="STRING"/>
					<colinfo id="appendLocFileNm" size="256" type="STRING"/>
					<colinfo id="appendFileNm" size="256" type="STRING"/>
					<colinfo id="appendDispNm" size="256" type="STRING"/>
					<colinfo id="appendFileSz" size="256" type="STRING"/>
					<colinfo id="details" size="256" type="STRING"/>
					<colinfo id="regDate" size="256" type="STRING"/>
					<colinfo id="consCd" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_detail">
				<Contents>
					<colinfo id="CHECK" size="256" type="STRING"/>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZRQFLG" size="256" type="STRING"/>
					<colinfo id="ZRQDAT" size="256" type="STRING"/>
					<colinfo id="ZRQCN" size="256" type="STRING"/>
					<colinfo id="ZWRITER" size="256" type="STRING"/>
					<colinfo id="ZRMK" size="256" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="CDATE" size="256" type="STRING"/>
					<colinfo id="CTIME" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UDATE" size="256" type="STRING"/>
					<colinfo id="UTIME" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<record>
						<CDATE></CDATE>
						<CHECK></CHECK>
						<CTIME></CTIME>
						<CUSER></CUSER>
						<DOCREQNO></DOCREQNO>
						<MANDT></MANDT>
						<QTNUM></QTNUM>
						<QTSER></QTSER>
						<UDATE></UDATE>
						<UTIME></UTIME>
						<UUSER></UUSER>
						<ZRMK></ZRMK>
						<ZRQCN></ZRQCN>
						<ZRQDAT></ZRQDAT>
						<ZRQFLG></ZRQFLG>
						<ZSEQ></ZSEQ>
						<ZWRITER></ZWRITER>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_filedown" UseClientLayout="1">
				<Contents>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<colinfo id="ZATTSEQ" size="256" type="STRING"/>
					<colinfo id="ZATTPATH" size="256" type="STRING"/>
					<colinfo id="ZATTFN" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
					<colinfo id="FILE_SIZE" size="10" type="INT"/>
					<colinfo encrypt="base64" id="CONTENT" size="255" type="BLOB"/>
					<colinfo id="ZATTFN_OR" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_delFile">
				<Contents>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<colinfo id="ZATTSEQ" size="256" type="STRING"/>
					<colinfo id="ZATTPATH" size="256" type="STRING"/>
					<colinfo id="ZATTFN" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
					<colinfo id="FILE_SIZE" size="10" type="INT"/>
					<colinfo encrypt="base64" id="CONTENT" size="255" type="BLOB"/>
					<colinfo id="FLAG" size="256" type="STRING"/>
					<colinfo id="TEMP" size="256" type="STRING"/>
					<colinfo id="ZATTFN_OR" size="256" type="STRING"/>
					<colinfo id="ZWGBN" size="256" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Height="36" Id="div_btn" TabOrder="10" Text="Div0" Url="WB01::CommBtnForm.xml" Width="456">
			<Contents></Contents>
		</Div>
		<Shape BKColor="user0" Bottom="180" Height="140" Id="Shape1" Left="0" LineColor="user1" Right="456" TabOrder="9" Top="40" Type="Rectangle" Width="456"></Shape>
		<Static Align="Right" Height="20" Id="Static0" Left="5" Style="sty_lb_search" TabOrder="8" Text="Dwg&#32;Reqst&#32;#&#32;" Top="45" VAlign="Middle" Width="107"></Static>
		<Button Appearance="FLAT" ButtonStyle="TRUE" Color="user5" Cursor="HAND" DomainID="btn.save" Height="22" Id="btn_save" ImageID="btn_comm_save_k" Left="336" LeftMargin="20" OnClick="fn_OnClick_btn" TabOrder="7" Text="저장" Top="6" Width="52"></Button>
		<Static Align="Right" Height="20" Id="st_TempName" Left="5" Style="sty_lb_search" TabOrder="11" Text="Reqst&#32;Type&#32;" Top="67" VAlign="Middle" Width="107"></Static>
		<Edit BindDataset="ds_detail" Border="Flat" Column="ZRQCN" Height="20" Id="ed_Zrqcn" ImeMode="keep,native" Left="119" LeftMargin="4" MaxLength="100" RightMargin="4" Style="sty_ipt_form" TabOrder="5" Top="133" Width="329"></Edit>
		<Static Align="Right" Height="20" Id="Static2" Left="5" Style="sty_lb_search" TabOrder="13" Text="Contents&#32;" Top="133" VAlign="Middle" Width="107"></Static>
		<Static Align="Right" Height="20" Id="Static1" Left="5" Style="sty_lb_search" TabOrder="12" Text="Reqst&#32;Date&#32;" Top="89" VAlign="Middle" Width="107"></Static>
		<Edit BindDataset="ds_detail" Border="Flat" Column="ZRMK" Height="20" Id="ed_zrmk" ImeMode="keep,native" Left="119" LeftMargin="4" MaxLength="100" RightMargin="4" Style="sty_ipt_form" TabOrder="6" Top="155" Width="329"></Edit>
		<Static Align="Right" Height="20" Id="Static3" Left="5" Style="sty_lb_search" TabOrder="13" Text="Remarks&#32;" Top="155" VAlign="Middle" Width="107"></Static>
		<Static Align="Right" Height="20" Id="Static4" Left="5" Style="sty_lb_search" TabOrder="13" Text="Manager&#32;" Top="111" VAlign="Middle" Width="107"></Static>
		<Edit BindDataset="ds_detail" Border="Flat" Column="ZWRITER" Enable="FALSE" Height="20" Id="ed_zwriter" ImeMode="keep,native" Left="119" LeftMargin="4" MaxLength="10" RightMargin="4" Style="sty_ipt_form" TabOrder="4" Top="111" Width="136"></Edit>
		<Edit BindDataset="ds_detail" Border="Flat" Column="DOCREQNO" Enable="FALSE" Height="20" Id="ed_docreqno" ImeMode="english" Left="120" LeftMargin="4" MaxLength="10" RightMargin="4" Style="sty_ipt_form" TabOrder="1" Top="46" Width="136"></Edit>
		<Combo BindDataset="ds_detail" Border="Flat" CodeColumn="CODE" Column="ZRQFLG" DataColumn="CODE_NAME" Enable="FALSE" Height="20" Id="cb_zrqflg" InnerDataset="ds_zrqflg" Left="120" Style="sty_ipt_form" TabOrder="2" Top="67" Width="136"></Combo>
		<Calendar BindDataset="ds_detail" Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="ZRQDAT" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Enable="FALSE" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_zrqdat" Left="120" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="3" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="89" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="136"></Calendar>
		<FileDialog AppendExtDefault="TRUE" Bottom="206" Filter="Acrobet&#32;Reader(*.pdf)|*.pdf|CAD&#32;Files(*.dwg)|*.dwg|" Height="24" Id="fdAttachedFile" Left="32" MultiSelect="TRUE" Right="56" TabOrder="26" Top="182" Width="24"></FileDialog>
		<FileDialog Bottom="206" Filter="Acrobet&#32;Reader(*.pdf)|*.pdf|CAD&#32;Files(*.dwg)|*.dwg|" Height="24" Id="fdFileDownload" Left="8" Right="32" TabOrder="26" Top="182" Type="Save" Width="24"></FileDialog>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoFitEndLine="Hide" BindDataset="dsContReqAppend" BkColor2="default" BoldHead="true" Border="Flat" Bottom="384" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="35" Height="168" Id="grd_detail" InputPanel="FALSE" LineColor="user20" LineType="ExHORZ" MinWidth="100" OnCellDBLClick="grd_detail_OnCellDblClick" OnExpandUp="grd_detail_OnExpandUp" OnHeadClick="grd_list_OnHeadClick" Right="456" RowHeight="20" Style="sty_grid" TabOrder="13" TabStop="true" Top="216" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="456">
			<contents>
				<format id="Default">
					<columns>
						<col width="26"/>
						<col width="225"/>
						<col width="199"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user21" display="text" font="굴림,9" text="No"/>
						<cell align="center" col="1" color="user21" display="text" font="굴림,9" text="File&#32;Path"/>
						<cell col="2" color="user21" font="굴림,9" text="File&#32;Name"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" display="text" expr="currow+1"/>
						<cell align="left" bkcolor2="user22" col="1" colid="ZATTPATH" display="text"/>
						<cell align="left" col="2" colid="ZATTFN_OR" expandimage="btn_icon_next_01" expandshow="expr:iif(pGubun==&apos;240&apos;&#32;&amp;&amp;&#32;gZrqflg&#32;==&apos;10&apos;,&#32;true,&#32;iif(pGubun==&apos;241&apos;&#32;&amp;&amp;&#32;gZrqflg==&apos;52&apos;&#32;,&#32;true,&#32;false))"/>
					</body>
				</format>
			</contents>
		</Grid>
		<File Bottom="206" Height="24" Id="fdFile" Left="56" Right="80" TabOrder="20" Top="182" Width="24"></File>
		<CyHttpFile Height="24" Id="httpFile" Left="79" Top="182" Width="24"></CyHttpFile>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_add" ImageID="btn_sub_04" Left="210" LeftMargin="12" OnClick="btnAttachFile_OnClick" Style="sty_btn" TabOrder="17" Text="Add&#32;File" Top="192" Transparent="TRUE" Width="75"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_download" ImageID="btn_sub_05" Left="368" LeftMargin="12" OnClick="btn_download_OnClick" Style="sty_btn" TabOrder="18" Text="Download" Top="192" Transparent="TRUE" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_delete" ImageID="btn_sub_05" Left="283" LeftMargin="12" OnClick="btn_del_list_detail_OnClick" Style="sty_btn" TabOrder="19" Text="Delete&#32;Files" Top="192" Transparent="TRUE" Width="85"></Button>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */   
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::nsfRequest.js";	// 공통 스크립트 
#include "LIB::common_hdel.js";	// 공통 스크립트  /* GNY 추가 */

//#include "LIB::common_coms.js";	// 파일업/다운로드 */
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var F_FORM_ID 	 = "Ses0248";
var F_FRM_TITLE = "Dwg Request";

var pGubun;
var gZrqflg;
var gbDocreqno;
var gbZseq;
var gFID;

var _F_FILE_DIR = "";	// 로컬에서 현재 선택한 파일 디렉토리 
var _F_FILE_NAME = "";	// 로컬에서 현재 선택한 파일  명 
var _F_FILE_SIZE = 0;	// 파일 사이즈 
var _F_FILE_DELETE = false;

var imgUploadFlg = "";
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	gfn_initForm(false); 	// Form 로드 이벤트 맨 첫줄에 기술 
	
	gfn_translation(obj, G_LANG);	//언어
	
	fn_init_form(); 	// 폼 초기화
	div_btn.fn_loadUseBtn("7", "의뢰", "8", "");   	// 화면제목 설정 및 버튼 활성화
}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================

/********************************************************************************
* 기      능   : 폼 초기화
********************************************************************************/
function fn_init_form() {
	var hStatus = parent.ds_header.getcolumn(parent.ds_header.rowpos, "ZRQFLG");
	
	pGubun = pGubun;
	gFID = pFID;
	gbDocreqno = pDocreqNo;
	gbZseq = pZseq;
	gZrqflg = pZrqflg;
	
	// 최종 변경된 셀정보 초기화
	F_CHG_COLNUM = "";	             // 변경된 컬럼번호
	F_CHG_ROWNUM = "";	             // 변경된 행번호
	F_MAX_SERNO  = 0;	             // 최종순번

	ds_zrqflg.ClearData();
	ds_zrqflg.Copy(parent.ds_zrqflg);	
	
	if(pZwriter != G_USER_ID)
	{				
		ed_docreqno.Enable = false;
		cb_zrqflg.Enable = false;		
		cal_zrqdat.Enable = false;
		ed_Zrqcn.Enable = false;
		ed_zwriter.Enable = false;
		ed_Zrmk.Enable = false;			
		btn_save.Enable = false;
		btn_add.Visible = false;
		btn_delete.Visible = false;
	} else {
		var hzrqflg = decode(gFID, "240", "10", "242", "52");
		//trace("hzrqflg > " + hzrqflg +  " , hStatus > " + hStatus + " , gZrqflg > " + gZrqflg);
		ed_Zrqcn.Enable = iif(hStatus==hzrqflg && hStatus== gZrqflg, true, false);		
		ed_Zrmk.Enable =  iif(hStatus==hzrqflg && hStatus== gZrqflg, true, false);
		btn_add.Visible =  iif(hStatus==hzrqflg && hStatus== gZrqflg, true, false);
		btn_delete.Visible =  iif(hStatus==hzrqflg && hStatus== gZrqflg, true, false);
		btn_save.Visible =  iif(hStatus==hzrqflg && hStatus== gZrqflg, true, false);
	}
	
	

	fn_query();
	
} 

/********************************************************************************
* 기      능   : 조회 1
********************************************************************************/
function fn_query() {

	dsContReqAppend.ClearData();	
    
	fn_createWait("",this);     // 처리중입니다. 메시지 처리
	ds_cond.setColumn(0, "MANDT"  , G_MANDT         );   
	ds_cond.setColumn(0, "ZWGBN"   , "M");
	ds_cond.setColumn(0, "DOCREQNO", pDocreqno);
	ds_cond.setColumn(0, "ZSEQ", pZseq);
	
	nsfRequest("query", "ses0240/fileview", "ds_cond=ds_cond ds_detail=ds_detail dsContReqAppend=dsContReqAppend", "ds_Detail=ds_Detail dsContReqAppend=dsContReqAppend ds_error=ds_error", "", "fn_afterQuery");
}

/********************************************************************************
* 기      능   : 저장
********************************************************************************/
function fn_save() {
	//변경여부 확인
	if(ds_detail.GetUpdate() == false && dsContReqAppend.GetUpdate() == false) 
	{ 
		gfn_showAlert("CW00006", F_FRM_TITLE);
		return false; 
	} 

	//첨부 변경 없으면 상세만 저장
	if (ds_detail.GetUpdate() == true && dsContReqAppend.GetUpdate() == false) {
		fn_detailSave();
	} 
	// 첨부 변경된 경우 파입업로드 완료후 DB 파일정보 저장
	else if (dsContReqAppend.GetUpdate() == true) {		
		fn_fileUpload();
	}
}

/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {
}

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	fn_destroyWait();
} 

/********************************************************************************
* 기      능   : 저장 Callback
********************************************************************************/
function fn_afterSave(svcId, errCode, errMsg) {
	fn_destroyWait();

	if (ds_error.rowcount > 0) gfn_showAlert(ds_error.GetColumn(0,"ERRMSG"));
	
	if (svcId = "fileSave") {
		fn_query();
	}
}
/********************************************************************************
* 기      능   : 상세저장 Callback
********************************************************************************/
function fn_afterDetailSave(svcId, errCode, errMsg) {
	fn_destroyWait();

	if (ds_error.rowcount > 0) gfn_showAlert(ds_error.GetColumn(0,"ERRMSG"));
	
	parent.fn_detail();
}
//=========================================================================================
// [ PART 5 ]
// User Function 정의 : 사용자정의 함수
//=========================================================================================

/********************************************************************************
* 기      능   :  첨부파일 업로드
********************************************************************************/
function fn_fileUpload()
{
	ds_detail.setColumn(0, "MANDT"		, G_MANDT);    	
	ds_detail.setColumn(0, "CUSER"		, G_USER_ID);
	ds_detail.setColumn(0, "UUSER"		, G_USER_ID);
	
	var consCd = dsContReqAppend.GetColumn(0, "G_MANDT");
	var fileName = "";	
	
	//file서버에 이미지 저장
	for(var i = 0; i < dsContReqAppend.rowcount; i++)
	{
		if(dsContReqAppend.GetRowType(i) == "insert" || dsContReqAppend.GetRowType(i) == "update") {
		
			if(length(dsContReqAppend.getColumn(i, "ZATTFN")) != 0 && length(dsContReqAppend.getColumn(i, "ZATTPATH")) != 0)
			{			
				dsContReqAppend.setColumn(i, "MANDT"  	, G_MANDT         );    
				dsContReqAppend.setColumn(i, "DOCREQNO"	, pDocreqno);
				dsContReqAppend.setColumn(i, "ZSEQ"		, pZseq);		
				dsContReqAppend.setColumn(i, "CUSER"	, G_USER_ID);
				dsContReqAppend.setColumn(i, "UUSER"	, G_USER_ID);
				dsContReqAppend.setColumn(i, "TEMP"		, dsContReqAppend.getColumn(i, "ZATTFN"));
				
				//파일명 만들기			
				fileName = "MN_" + pDocreqno + "_"+ pZseq + "_" + substr(GetDate(),8,13)+"."+gfn_getFileExt(dsContReqAppend.getColumn(i, "ZATTFN"));
	
				//파일업로드 서비스 호출
				var arr = tit_fileWrite(httpFile					//http객체
					, "SD"											//저장디렉토리
					, dsContReqAppend.getColumn(i, "ZATTPATH")		//로컬경로
					, dsContReqAppend.getColumn(i, "TEMP")			//로컬파일명
					, fileName										// 실제 db에 저장될 파일 이름
					, "U"											// time stamp를 붙이지 않을 경우 U 사용 
					, "");											//삭제할 이전 파일명 
				
				//------------------ log
				//trace("file path       > " +dsContReqAppend.getColumn(i, "ZATTPATH"));
				//trace("local file name > " +dsContReqAppend.getColumn(i, "TEMP")); 
				//trace("file name       > " +fileName); 
				//trace("arr             > " +arr);
				//------------------ log
				
				//업로드 성공인 경우
				if ( arr[0] == "S" ) {
					dsContReqAppend.setColumn(i, "ZATTFN", arr[2]);		
					dsContReqAppend.setColumn(i, "ZATTFN_OR", dsContReqAppend.getColumn(i, "TEMP"));	
				}
				//업로드 실패인 경우
				else if ( arr[0] != "S" )
				{
					gfn_showMsg("CW00035"); 
					return false;
				}
				
			} else {
				gfn_showAlert("CW10215");	//CW10215=첨부파일을 입력하십시오.
				return false;
			}//end if
		} //end if		

	} //end for
	
	for (var j=0; j<ds_delFile.rowcount; j++) {
		tit_fileDelete("SD", ds_delFile.getColumn(j, "ZATTFN"), "");
	}
	
	
	fn_fileSave();		//업로드 완료 후 파일정보 DB저장
	fn_detailSave();	//Detail 저장
}
/********************************************************************************
* 기      능   :  파일 체크
********************************************************************************/
function fn_filecheck() {
	if(dsContReqAppend.rowcount == 0) {
		gfn_showAlert("CW10219"); 	//조회된 파일이 없습니다.
		return false;
	}	
	if(dsContReqAppend.GetRowType(dsContReqAppend.rowpos) == "insert") {
		return false;
	}
	return true;
}
/********************************************************************************
* 기      능   :  첨부파일 다운로드
********************************************************************************/
function fn_filedownload(obj,nRow,nCell,nX,nY,nPivotIndex)
{					
	if(!fn_filecheck()) return;
	
	var svrFileName = dsContReqAppend.GetColumn(nRow, "ZATTFN");
	var orgFileName = dsContReqAppend.GetColumn(nRow, "ZATTFN_OR");
	var ext =     gfn_getFileExt(dsContReqAppend.getColumn(nRow, "ZATTFN"));
	
	fdFileDownload.FileName =orgFileName;
	fdFileDownload.Filter = "Acrobet Reader(*.pdf)|*.pdf|CAD Files(*.dwg)|*.dwg|";
	fdFileDownload.FilterIndex = decode(ext, "pdf","0", "1");
    fdFileDownload.open();
    

	var idx = indexOf(fdFileDownload.FileName, ".");
	var fdFileName = fdFileDownload.FileName;   
    var fileName =  decode(idx, -1, fdFileName, substr(fdFileName, 0, indexOf(fdFileName, ".")));
    var localFileName = fileName + "." + ext;

	tit_fileRead(httpFile
		, "SD"						//저장 디렉토리
		, svrFileName				//서버에서 전송받을 이름	
        , fdFileDownload.FilePath	//로컬 경로
        , localFileName);			//로컬 파일명		
}

/********************************************************************************
* 기      능   :  상세정보  저장
********************************************************************************/
function fn_detailSave() {
	nsfRequest("updateDetail"
					, "ses0240/updateDetail"
					, "ds_cond=ds_cond ds_list=ds_detail:U"
					, "ds_error=ds_error"
					, ""
					, "fn_afterDetailSave");
	fn_createWait("",this);     // 처리중입니다. 메시지 처리	
}

/********************************************************************************
* 기      능   :   파일정보 저장
********************************************************************************/
function fn_fileSave() {
	nsfRequest("fileSave"														// srvId
	, "ses0240/fileSave"														// url
	, "ds_file=dsContReqAppend:U ds_delFile=ds_delFile:A"		// inDsList
	, "dsContReqAppend=ds_file ds_error=ds_error"												    	// outDsList
	, ""																		// strParam
	, "fn_afterSave"															// CallBackFunc
	);
	fn_createWait("",this);     // 처리중입니다. 메시지 처리	
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 : 각 Component 별 이벤트 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회
********************************************************************************/
function fn_OnClick_btn(obj) {
	var fncName = "fn_" + substr(obj.id, 4); 
	eval( fncName + "()");
}

/********************************************************************************
* 기      능   : 정렬 처리 
********************************************************************************/
function grd_list_OnHeadClick(obj,nCell,nX,nY,nPivotIndex) {

	if( nCell == 0 ) gfn_selectAllGrid(obj,nCell,nCell,true);
	else             gfn_sortGrid(obj, nCell);
}

/********************************************************************************
* 기      능   :  행 추가
********************************************************************************/
function btnAttachFile_OnClick(obj)
{	
	var nRow = gfn_addGridRow(grd_detail, -1, "FLAG");	
	dsContReqAppend.setColumn(nRow, "MANDT"  , G_MANDT         );   
	dsContReqAppend.setColumn(nRow, "ZWGBN"  	, "M"   );   
	dsContReqAppend.setColumn(nRow, "DOCREQNO", pDocreqno);
	dsContReqAppend.setColumn(nRow, "ZSEQ", pZseq);		
	dsContReqAppend.setColumn(nRow, "CUSER", G_USER_ID);
	dsContReqAppend.setColumn(nRow, "UUSER", G_USER_ID);
	
}

/********************************************************************************
* 기      능   :  첨부파일 추가
********************************************************************************/
function grd_detail_OnExpandUp(obj,nRow,nCell,strVal,nPivotIndex)
{
	if ( nCell == 2 ) {
		var arr = gfn_openFileMgr(
		    "SD"
			, dsContReqAppend.getColumn(nRow, "ZATTFN")//FileDialog.FileName
			, dsContReqAppend.getColumn(nRow, "ZATTPATH")//FileDialog.FilePath
			, imgUploadFlg
		);

		if ( arr != null ) {
			var ext = gfn_getFileExt(arr[1]);
			if (ext != toLower("pdf") && ext != toLower("dwg")) {
				gfn_showAlert("CW10218", "PDF or DWG"); 	//PDF 또는 DWG파일만 가능합니다.
				return false;
			} else {
			   dsContReqAppend.setColumn(nRow, "ZATTPATH",arr[0]) ; // 디렉토리 정보 
			   dsContReqAppend.setColumn(nRow, "ZATTFN",arr[1]); // 파일명 
			   dsContReqAppend.setColumn(nRow, "ZATTFN_OR",arr[1]); 
		   }
		}
	} 
}

/********************************************************************************
* 기      능   :  그리드 더블클릭시 
********************************************************************************/
function grd_detail_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{	
	fn_filedownload(nRow);	
}
/********************************************************************************
* 기      능   :  다운로드 버튼 클릭시
********************************************************************************/
function btn_download_OnClick(obj)
{
	fn_filedownload(dsContReqAppend.rowpos);
}

//--------------------------------------------------------------------------------------
//  아래부터는 기존 소스..
//--------------------------------------------------------------------------------------
function fn_AppendDataBound(dsAppend)
{        
	for(var i = 0; i < dsAppend.rowcount; i++) {
		
		dsAppend.setColumn(i, "MANDT"  , G_MANDT         );    
		dsAppend.setColumn(i, "DOCREQNO", pDocreqno);
		dsAppend.setColumn(i, "ZSEQ", pZseq);		
		dsAppend.setColumn(i, "CUSER", G_USER_ID);
		dsAppend.setColumn(i, "UUSER", G_USER_ID);
	}
}


function fn_afterFile()
{
	fn_destroyWait();
	fn_query();
}

function btn_query_OnClick(obj)
{
	fn_query();
}

/********************************************************************************
* 기      능   : 첨부파일 삭제
********************************************************************************/
function btn_del_list_detail_OnClick(obj)
{
	if(dsContReqAppend.rowcount == 0) {
		gfn_showAlert("CW10219"); 	//조회된 파일이 없습니다.
		return false;
	}
	
	if (dsContReqAppend.GetRowType(dsContReqAppend.rowpos) == "normal") {
		ds_delFile.InsertRow(0);
		ds_delFile.CopyRow(0,"dsContReqAppend", dsContReqAppend.row);
		dsContReqAppend.DeleteRow(dsContReqAppend.rowpos);
	} else {
		gfn_deleteGridRow( grd_detail, dsContReqAppend.row, "FLAG" );
	}
}

]]></Script>
</Window>