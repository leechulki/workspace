<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="512" Id="BS0102007B" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="견적승인판정&#32;기준" Top="8" Ver="1.0" Width="1336" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond2">
				<Contents>
					<colinfo id="ZDEV" size="256" type="STRING"/>
					<colinfo id="ZGNM" size="256" type="STRING"/>
					<colinfo id="GSNAM" size="256" type="STRING"/>
					<colinfo id="ZTEL" size="256" type="STRING"/>
					<colinfo id="ZADDR_ADR1" size="256" type="STRING"/>
					<record>
						<GSNAM></GSNAM>
						<ZADDR_ADR1></ZADDR_ADR1>
						<ZDEV></ZDEV>
						<ZGNM></ZGNM>
						<ZTEL></ZTEL>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list2">
				<Contents>
					<colinfo id="QTGBN" size="256" summ="default" type="STRING"/>
					<colinfo id="SPART" size="256" summ="default" type="STRING"/>
					<colinfo id="ZDEV" size="256" summ="default" type="STRING"/>
					<colinfo id="ZGNM" size="256" summ="default" type="STRING"/>
					<colinfo id="GSNAM" size="256" summ="default" type="STRING"/>
					<colinfo id="ZCID" size="256" summ="default" type="STRING"/>
					<colinfo id="ZPID" size="300" summ="default" type="STRING"/>
					<colinfo id="ZTEL" size="300" summ="default" type="STRING"/>
					<colinfo id="ZADDR_ADR1" size="300" summ="default" type="STRING"/>
					<colinfo id="ZADDR_ADR2" size="256" summ="default" type="STRING"/>
					<colinfo id="ZAPFLG" size="300" summ="default" type="STRING"/>
					<colinfo id="ZPRGFLG" size="300" summ="default" type="STRING"/>
					<colinfo id="ZRTRSN" size="300" summ="default" type="STRING"/>
					<colinfo id="UDATE" size="90" summ="default" type="STRING"/>
					<colinfo id="MANDT" size="256" summ="default" type="STRING"/>
					<colinfo id="QTNUM" size="256" summ="default" type="STRING"/>
					<colinfo id="QTSER" size="256" summ="default" type="STRING"/>
					<colinfo id="ZRQSEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="CHK" size="1" summ="default" type="STRING"/>
					<colinfo id="ZKUNNR_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="ZRQCN" size="256" summ="default" type="STRING"/>
					<colinfo id="ZAPDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="UUSER" size="256" summ="default" type="STRING"/>
					<colinfo id="JGBN" size="256" summ="default" type="STRING"/>
					<colinfo id="MAXQTSER_ZPRGFLG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ncd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_jrt">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_error">
				<Contents>
					<colinfo id="IDX" size="256" type="STRING"/>
					<colinfo id="ERRMSG" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list3">
				<Contents>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="INT"/>
					<colinfo id="ZRQSEQ" size="256" type="STRING"/>
					<colinfo id="ZAPFLG" size="256" type="STRING"/>
					<colinfo id="ZRTRSN" size="300" type="STRING"/>
					<colinfo id="USERGBN" size="2" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_gbn">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_pst">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list4">
				<Contents>
					<colinfo id="QTGBN" size="256" type="STRING"/>
					<colinfo id="SPART" size="256" type="STRING"/>
					<colinfo id="ZDEV" size="256" type="STRING"/>
					<colinfo id="ZGNM" size="256" type="STRING"/>
					<colinfo id="GSNAM" size="256" type="STRING"/>
					<colinfo id="ZCID" size="256" type="STRING"/>
					<colinfo id="ZPID" size="300" type="STRING"/>
					<colinfo id="ZTEL" size="300" type="STRING"/>
					<colinfo id="ZADDR_ADR1" size="300" type="STRING"/>
					<colinfo id="ZADDR_ADR2" size="256" type="STRING"/>
					<colinfo id="ZAPFLG" size="300" type="STRING"/>
					<colinfo id="ZPRGFLG" size="300" type="STRING"/>
					<colinfo id="ZRTRSN" size="300" type="STRING"/>
					<colinfo id="UDATE" size="90" type="STRING"/>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="ZRQSEQ" size="256" type="STRING"/>
					<colinfo id="CHK" size="1" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user12" Bottom="69" Height="26" Id="Shape7" Left="7" LineColor="user13" Right="863" TabOrder="3" Top="43" Type="Rectangle" Width="856"></Shape>
		<Grid AutoFitEndLine="Hide" BindDataset="ds_list2" BkColor2="default" BoldHead="true" Border="Flat" Bottom="504" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="424" Id="grd_list2" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" OnCellClick="grd_list2_OnCellClick" OnHeadClick="grd_list2_OnHeadClick" OnMouseOver="grd_list2_OnMouseOver" Right="1328" RowHeight="20" Style="sty_grid" TabOrder="1" TabStop="true" Top="80" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1320">
			<contents>
				<format id="Default">
					<columns>
						<col fix="left" width="30"/>
						<col fix="left" width="20"/>
						<col fix="left" width="82"/>
						<col fix="left" width="57"/>
						<col width="243"/>
						<col width="64"/>
						<col width="64"/>
						<col width="100"/>
						<col width="100"/>
						<col width="110"/>
						<col width="80"/>
						<col width="90"/>
						<col width="220"/>
						<col width="100"/>
						<col width="81"/>
						<col width="96"/>
						<col width="96"/>
						<col width="96"/>
						<col width="130"/>
						<col width="130"/>
						<col width="0"/>
						<col width="80"/>
						<col width="64"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user21" display="text" font="굴림,9" text="NO"/>
						<cell align="center" col="1" color="user21" display="text" font="굴림,9"/>
						<cell col="2" color="user21" display="text" font="굴림,9" text="견적번호"/>
						<cell col="3" color="user21" display="text" font="굴림,9" text="견적차수"/>
						<cell align="center" col="4" color="user21" display="text" font="굴림,9" text="요청내용"/>
						<cell align="center" col="5" color="user21" display="text" font="굴림,9" text="제품구분"/>
						<cell align="center" col="6" color="user21" display="text" font="굴림,9" text="견적구분"/>
						<cell align="center" col="7" color="user21" display="text" font="굴림,9" text="담당자"/>
						<cell align="center" col="8" color="user21" display="text" font="굴림,9" text="시행사"/>
						<cell align="center" col="9" color="user21" display="text" font="굴림,9" text="발주처"/>
						<cell align="center" col="10" color="user21" display="text" font="굴림,9" text="공사명"/>
						<cell align="center" col="11" color="user21" display="text" font="굴림,9" text="면담자"/>
						<cell align="center" col="12" color="user21" display="text" font="굴림,9" text="현장연락처"/>
						<cell align="center" col="13" color="user24" display="text" font="굴림,9" text="주소"/>
						<cell align="center" col="14" color="user24" display="text" font="굴림,9" text="상세주소"/>
						<cell align="center" col="15" color="user21" display="text" font="굴림,9" text="판정결과"/>
						<cell col="16" color="user21" display="text" font="굴림,9" text="판정일자"/>
						<cell col="17" color="user21" display="text" font="굴림,9" text="판정자"/>
						<cell align="center" col="18" color="user21" display="text" font="굴림,9" text="해당차수&#32;진행상태"/>
						<cell align="center" col="19" color="user21" display="text" font="굴림,9" text="최종차수&#32;진행상태"/>
						<cell align="center" col="20" color="user21" display="text" font="굴림,9" text="불가사유"/>
						<cell align="center" col="21" color="user21" display="text" font="굴림,9" text="주차설비유무"/>
						<cell col="22" display="text"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" colid="BS201_GNM" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text" expr="CURROW+1"/>
						<cell align="center" col="1" colid="CHK" display="checkbox" edit="checkbox"/>
						<cell align="center" col="2" colid="QTNUM" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell col="3" colid="QTSER" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell col="4" colid="ZRQCN" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell align="center" bkcolor2="user22" col="5" colid="SPART" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" combocol="CODE" combodataset="ds_gbn" combotext="CODE_NAME" display="combo"/>
						<cell align="center" bkcolor2="user22" col="6" colid="QTGBN" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell bkcolor2="user22" col="7" colid="ZKUNNR_NM" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell bkcolor2="user22" col="8" colid="ZDEV" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell bkcolor2="user22" col="9" colid="ZGNM" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell bkcolor2="user22" col="10" colid="GSNAM" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell bkcolor2="user22" col="11" colid="ZPID" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell bkcolor2="user22" col="12" colid="ZTEL" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell bkcolor2="user22" col="13" colid="ZADDR_ADR1" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell bkcolor2="user22" col="14" colid="ZADDR_ADR2" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell align="center" bkcolor2="user22" col="15" colid="ZAPFLG" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" combocol="CODE" combodataset="ds_jrt" combotext="CODE_NAME" display="combo"/>
						<cell align="center" col="16" colid="ZAPDAT" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text" Mask="####.##.##"/>
						<cell align="center" col="17" colid="UUSER" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" display="text"/>
						<cell align="center" bkcolor2="user22" col="18" colid="ZPRGFLG" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" combocol="CODE" combodataset="ds_pst" combotext="CODE_NAME" display="combo"/>
						<cell align="center" bkcolor2="user22" col="19" colid="MAXQTSER_ZPRGFLG" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" combocol="CODE" combodataset="ds_pst" combotext="CODE_NAME" display="combo"/>
						<cell align="left" bkcolor2="user22" col="20" colid="ZRTRSN" color="expr:decode(CHK,true,&apos;red&apos;,&apos;default&apos;)" combocol="CODE" combodataset="ds_ncd" combotext="CODE_NAME" display="combo"/>
						<cell align="center" col="21" colid="JGBN" display="text"/>
						<cell col="22" colid="QTCHK" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Div Height="36" Id="div_btn" TabOrder="2" Text="Div0" Url="WB01::CommBtnForm.xml" Width="1328">
			<Contents></Contents>
		</Div>
		<Static Align="Right" Height="24" Id="st_jrt" Left="8" Style="sty_lb_form_basic" TabOrder="4" Text="판정결과&#32;" Top="44" VAlign="Middle" Width="100"></Static>
		<Combo Border="Flat" CodeColumn="CODE" DataColumn="CODE_NAME" Height="20" Id="cb_jrt" InnerDataset="ds_jrt" Left="110" OnChanged="cb_jrt_OnChanged" Style="sty_ipt_form" TabOrder="5" Top="45" Width="107"></Combo>
		<Static Align="Right" Height="24" Id="st_ncd" Left="219" Style="sty_lb_form_basic" TabOrder="6" Text="불가사유&#32;" Top="44" VAlign="Middle" Width="69"></Static>
		<Combo Border="Flat" CodeColumn="CODE" DataColumn="CODE_NAME" Height="20" Id="cb_ncd" InnerDataset="ds_ncd" Left="290" OnChanged="cb_ncd_OnChanged" Style="sty_ipt_form" TabOrder="7" Top="45" Width="107"></Combo>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_sub_save" ImageID="btn_sub_02" Left="812" LeftMargin="12" OnClick="btn_sub_save_OnClick" Style="sty_btn" TabOrder="8" Text="저장" Top="46" Transparent="TRUE" Width="50"></Button>
		<Static Height="18" Id="st_cond" Left="128" TabOrder="9" Text="조회조건을&#32;하나이상" Top="520" Visible="FALSE" Width="81"></Static>
		<Static Height="16" Id="st_panguyl" Left="216" TabOrder="10" Text="판정결과" Top="520" Visible="FALSE" Width="56"></Static>
		<Static Height="13" Id="st_bulga" Left="272" TabOrder="11" Text="불가" Top="520" Visible="FALSE" Width="40"></Static>
		<Static Height="16" Id="Static0" Left="304" TabOrder="12" Text="불가사유" Top="520" Visible="FALSE" Width="80"></Static>
		<Static Height="13" Id="st_param" Left="360" TabOrder="13" Text="저장할" Top="520" Visible="FALSE" Width="40"></Static>
		<Static Height="13" Id="st_pst" Left="408" TabOrder="14" Text="진행상태" Top="520" Visible="FALSE" Width="50"></Static>
		<Static Align="Right" Height="24" Id="Static1" Left="399" Style="sty_lb_form_basic" TabOrder="15" Text="기타사유&#32;" Top="44" VAlign="Middle" Width="74"></Static>
		<Edit Enable="FALSE" Height="23" Id="ed_sau" Left="476" TabOrder="16" Top="45" Width="319"></Edit>
	</Form>
	<Script><![CDATA[﻿﻿﻿﻿﻿﻿﻿﻿/*
 ******************************************************************************************
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::utility.js";	// 다중 선택 
#include "LIB::nsfRequest.js";	// 공통 스크립트 
#include "LIB::common_hdel.js";	// 공통 스크립트  /* GNY 추가 */
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================

var F_FRM_TITLE = "견적승인판정검증";	// 공통코드 화면명
var F_ZADDR_ADR1 = "";
var F_ZDEV = "";
var F_ZGNM = "";
var F_GSNAM = "";
var F_ZTEL = "";
var F_USER_GBN = "";		// 사용자 직책확인
var F_QTNUM = "";		// 견적번호
var F_QTSER = "";		// 견적차수

//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {  

	gfn_initForm(false);

	F_USER_GBN = right(G_USER_GROUP_B, 2 );

	F_QTNUM = qtnum;
	F_QTSER = qtser;
	F_ZADDR_ADR1 = zaddr_adr1;
	F_ZDEV = zdev;
	F_ZGNM = zgnm;
	F_GSNAM = gsnam;
	F_ZTEL = ztel;
	
	div_btn.fn_loadUseBtn("", F_FRM_TITLE, "", "");

	var codeArr  = ["BS112", "SD102", "SPART", "SD107"];
	var dsObjArr = [ds_ncd,  ds_jrt,  ds_gbn,  ds_pst];
	var addTypeArr = [G_CODE_SELECT,G_CODE_SELECT,G_CODE_ALL,G_CODE_ALL];
	gfn_searchCommCode(codeArr, dsObjArr, addTypeArr);

}
/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {

	cb_jrt.Index = 0;
/*
	if (F_USER_GBN == "30")		{ // 견적요청 접수 처리만 가능  30: 담당
		ds_jrt.Filter("CODE =="+quote("")+" || CODE =="+quote("20") + " || CODE == "+quote("40"));
	}else if(F_USER_GBN == "40")	{	// 승인 또는 불가만 가능 40 : 팀장
		ds_jrt.Filter("CODE =="+quote("")+" || CODE == "+quote("30") + " || CODE == "+quote("40"));
	}else if(F_USER_GBN == "50")	{	// 전체처리 가능
		ds_jrt.Filter("CODE !="+quote("10"));
	}else	{
		ds_jrt.Enable = false;
		btn_sub_save.Visible = false;
	}  */
//  영업3부 전체처리 가능하도록 수정 BY 김선호 2013-02-18 윤승희 DL 요청  
	if(F_USER_GBN == "30" || F_USER_GBN == "40" || F_USER_GBN == "50" )	{
		if(substr(F_QTNUM,0,1) == "J") {
		    //주차의 경우 승인(30) 처리만 
			ds_jrt.Filter("CODE !="+quote("10") + " && CODE !="+quote("20") );
		} else {
			ds_jrt.Filter("CODE !="+quote("10"));			
		}
	}else	{
		ds_jrt.Enable = false;
		btn_sub_save.Visible = false;
	}  
	cb_ncd.Index = 0;
	cb_ncd.Enable = false;

	// 코드 조회 후 조회 요청
	fn_query();
}

//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 
********************************************************************************/
function fn_query() {
	fn_createWait("",this);     // 처리중입니다. 메시지 처리

	ds_error.ClearData();

	ds_cond2.SetColumn(0,"ZDEV",F_ZDEV);
	ds_cond2.SetColumn(0,"ZGNM",F_ZGNM);
	ds_cond2.SetColumn(0,"GSNAM",F_GSNAM);
	ds_cond2.SetColumn(0,"ZTEL",F_ZTEL);
	ds_cond2.SetColumn(0,"ZADDR_ADR1",F_ZADDR_ADR1);

	nsfRequest("query"
		     , "ses0082/find"
		     , "ds_cond2=ds_cond2 ds_list2=ds_list2"
		     , "ds_list2=ds_list2 ds_error=ds_error"
		     , ""
		     , "fn_afterQuery");
		     
}

/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {

	fn_destroyWait();
    
	if (ds_error.rowcount() > 0) {
		gfn_showMsg("CE00001");
		//gfn_openWSErrorWin(grd_list, ds_list, ds_error, "FLAG");	// error 정보 표시 
	}else	{
		gfn_showMsg("CI00002", ds_list2.RowCount() + "");

		// 해당 견적번호만 추출
		// 조회 후 승인판정 요청 견적번호 체크
		// 판정결과(ZAPFLG)가 요청 또는 접수의 경우만 체크 (담당별 처리)
		ds_list2.Filter("QTNUM == " + quote(F_QTNUM) + " && QTSER == " + quote(F_QTSER) );
		for (var i = 0; i < ds_list2.GetRowCount() ; i++)
		{ /*
			if (F_USER_GBN == "30")		{		// 영업담당자 : 요청건만 체크
				if (ds_list2.GetColumn(i, "ZAPFLG") == "10")	{
					ds_list2.SetColumn(i, "CHK", "1");
				}
			}
			else if (F_USER_GBN == "40")		{		// 팀장 : 접수건만 체크
				if (ds_list2.GetColumn(i, "ZAPFLG") == "20")	{
					ds_list2.SetColumn(i, "CHK", "1");
				}
			}else if (F_USER_GBN == "50")		{		//  관리자
				if (ds_list2.GetColumn(i, "ZAPFLG") == "10" || ds_list2.GetColumn(i, "ZAPFLG") == "20")	{
					ds_list2.SetColumn(i, "CHK", "1");
				}
			}    */
			
         //  영업3부 전체처리 가능하도록 수정 BY 김선호 2013-02-	18 윤승희 DL 요청  
			if (F_USER_GBN == "30" || F_USER_GBN == "40" || F_USER_GBN == "50")		{		//  관리자
				/*if (ds_list2.GetColumn(i, "ZAPFLG") == "10" || ds_list2.GetColumn(i, "ZAPFLG") == "20"
				    || ds_list2.GetColumn(i, "ZAPFLG") == "30" || ds_list2.GetColumn(i, "ZAPFLG") == "40" ){
					ds_list2.SetColumn(i, "CHK", "1");
				}
				*/
				ds_list2.SetColumn(i, "CHK", "1");
			}    			
		}
		
		ds_list2.UnFilter();
	}
}
/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================

/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {
	if(ds_list.RowCount() == 0)		{
		gfn_showAlert("CW00010");
		return false;
	}else	{
		gfn_exportExcel(grd_list2, "견적승인판정 기준");
	}
	//gfn_saveToExcel(grd_list2, true);
}

/********************************************************************************
* 기      능   : 판정기준 선택
********************************************************************************/
function cb_jrt_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex) {
	if(cb_jrt.Value == "40") { //불가
		cb_ncd.Enable = true;
	} else {
		cb_ncd.Index = 0;
		cb_ncd.Enable = false;
	}
}

/********************************************************************************
* 기      능   : 저장
********************************************************************************/
function btn_sub_save_OnClick(obj) {

	// 권한이 존재하지 않는 사용자의 경우 처리불가
	if (F_USER_GBN != "30" && F_USER_GBN != "40" && F_USER_GBN != "50")		{
		gfn_showAlert("CW10025","견적승인 판정에 대한 권한이 없습니다.");
		return false;
	}

	if (cb_jrt.Value == "" || cb_jrt.Value == null)	{
		gfn_showAlert("CW00116","판정결과");
		return false;
	}
	
	// 담당자도 모두처리 가능하도록 수정 20130220  윤승희 DL 요청 	
	// 담당별 판정결과 선택 기준 처리
	/*if (F_USER_GBN == "30")		{		// 영업담당자 : 접수 및 반려 처리 가능
		if (cb_jrt.Value != "20" and cb_jrt.Value != "40")	{
			gfn_showAlert("CW10025","담당자는 접수 및 반려 처리만 가능합니다.");
			return false;
		}
	}
	else if (F_USER_GBN == "40")		{		// 팀장 : 승인 반려 처리 가능
		if (cb_jrt.Value != "30" and cb_jrt.Value != "40")	{
			gfn_showAlert("CW10025","접수 처리는 담당자만 가능합니다.");
			return false;
		}
	} */


	
	if (cb_jrt.Value == "40")	{		// 반려 선택 시
		if(cb_ncd.Value == null || cb_ncd.Value == ""){
			gfn_showAlert("CW10025","불가사유를 선택해 주십시요.");
			return false;
		}
	}


	ds_list4.ClearData();
	ds_list4.Copy(ds_list2);
	
	ds_list4.Filter("CHK==1");

	if(ds_list4.rowcount() == 0){
		gfn_showAlert("CW00013");
		return;
	}

	ds_list3.ClearData();

	for(var i = 0; i < ds_list4.rowcount(); i++)	{
		ds_list3.AddRow();

		ds_list3.SetColumn(i, "QTNUM",  ds_list4.GetColumn(i,  "QTNUM"));
		ds_list3.SetColumn(i, "QTSER",  ds_list4.GetColumn(i,  "QTSER"));
		ds_list3.SetColumn(i, "ZRQSEQ", ds_list4.GetColumn(i, "ZRQSEQ"));
		ds_list3.SetColumn(i, "ZAPFLG", cb_jrt.Value);
		if (cb_ncd.Value ==  "90") { // 반려 사유 기타(90) 경우 - 텍스트 입력사항 저장 
		  ds_list3.SetColumn(i, "ZRTRSN", ed_sau.Value);
		} else {
		  ds_list3.SetColumn(i, "ZRTRSN", cb_ncd.Value);
		}
		ds_list3.SetColumn(i, "USERGBN", F_USER_GBN);	// 담당구분값

		if (cb_jrt.Value == "20")	{	// 접수
			// 요청 내역건만 접수가 가능함
			if (ds_list4.GetColumn(, "ZAPFLG") != "10")	{
				gfn_showAlert("CW10025", "판정결과가 요청건만 선택 가능합니다.");
				return false;
			}
		}else if (cb_jrt.Value == "30")	{	// 승인
			// 접수 내역건만 접수가 가능함
			if (substr(F_QTNUM,0,1) == "J") {
				// 요청 내역건만 접수가 가능함// 주차는 승인(30) 처리만 
				if (ds_list4.GetColumn(, "ZAPFLG") != "10")	{
					gfn_showAlert("CW10025", "판정결과가 요청건만 선택 가능합니다.");
					return false;
				}
			} else {
				if (ds_list4.GetColumn(i, "ZAPFLG") != "20")	{
					gfn_showAlert("CW10025", "판정결과가 접수건만 선택 가능합니다.");
					return false;
				}
			}
		}else if (cb_jrt.Value == "40")		{	// 반려
			if (F_USER_GBN == "30" || (substr(F_QTNUM,0,1) == "J" && F_USER_GBN == "40")){	// 담당자의 경우
				if (ds_list4.GetColumn(, "ZAPFLG") != "10")	{
					gfn_showAlert("CW10025", "담당자는 판정결과가 요청건만 반려가 가능합니다.");
					return false;
				}
			}else if (F_USER_GBN == "40")		{	// 팀장 경우
				if (ds_list4.GetColumn(, "ZAPFLG") != "20")	{
					gfn_showAlert("CW10025", "팀장은 판정결과가 접수건만 반려가 가능합니다.");
					return false;
				}
			}

		}
	}

	ds_list4.unFilter();

	if ( !gfn_showConfirm("CW10025", "견적승인에 대한 판정결과를 처리 하시겠습니까?") )	return false;

	ds_error.ClearData();

	fn_createWait("",this);     // 처리중입니다. 메시지 처리

	nsfRequest("update"
		     , "ses0082/save"
		     , "ds_list3=ds_list3"
		     , "ds_list3=ds_list3 ds_error=ds_error"
		     , ""
		     , "fn_afterSave");
}

/********************************************************************************
* 기      능   : 저장 Callback
********************************************************************************/
function fn_afterSave(svcId, errCode, errMsg) {
	fn_destroyWait();

	if(ds_error.RowCount() > 0) {
		gfn_showMsg("CE00001");
	} else {
		gfn_showAlert("CI00003");
		Parent.fn_query();
		close();
	}
}

/********************************************************************************
* 기      능   : 그리드 헤더 선택 시 소트
********************************************************************************/
function grd_list2_OnHeadClick(obj,nCell,nX,nY,nPivotIndex) {
	if ( nCell == 0 || nCell == 1 ) {
		return;
	}
	gfn_sortGrid(obj,nCell);
}

/********************************************************************************
* 기      능   :  Check box선택 시
********************************************************************************/
function grd_list2_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	if (nCell == 1)		{
		if (grd_list2.GetCellValue(nRow, 13) == "30")	{
			grd_list2.SetCellProp("body", 1, "edit", "none");
			gfn_showAlert("CW00114", "판정결과가 승인건은 선택이");
			return false;
		}else	{
			grd_list2.SetCellProp("body", 1, "edit", "checkbox");
		}
	}
}

function grd_list2_OnMouseOver(obj,nPosX,nPosY,nRow,nCell,nPivotIndex)
{
	if (nCell == 4) // 요청사유 ToolTip 
	{
		grd_list2.ToolTipText = grd_list2.GetCellText("body", nRow, nCell);
	}
	else
	{
		grd_list2.ToolTipText  = "";
	}	
}

function cb_ncd_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	trace(cb_ncd.Value);	
    if (cb_ncd.Value == "90") { // 사유코드 기타(90) 일떄 
		ed_sau.Enable = true;
    }
}
]]></Script>
</Window>