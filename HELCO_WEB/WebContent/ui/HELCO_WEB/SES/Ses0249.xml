<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="440" Id="Ses0249" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="도면제안" Top="8" Ver="1.0" Width="456" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="ZTPLGBN" size="256" type="STRING"/>
					<colinfo id="ZTPLNO" size="256" type="STRING"/>
					<colinfo id="ZRMK" size="256" type="STRING"/>
					<colinfo id="ZPRDGBN" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<colinfo id="ZWGBN" size="256" type="STRING"/>
					<record>
						<DOCREQNO></DOCREQNO>
						<MANDT></MANDT>
						<ZPRDGBN></ZPRDGBN>
						<ZRMK></ZRMK>
						<ZSEQ></ZSEQ>
						<ZTPLGBN></ZTPLGBN>
						<ZTPLNO></ZTPLNO>
						<ZWGBN/>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_error">
				<Contents>
					<colinfo id="IDX" size="256" type="STRING"/>
					<colinfo id="ERRMSG" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ztplgbn">
				<Contents>
					<colinfo id="CODE" size="1" type="STRING"/>
					<colinfo id="CODE_NAME" size="1" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prhcd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_temp" OnColumnChanged="ds_temp_OnColumnChanged">
				<Contents>
					<colinfo id="MCLASS" size="256" type="STRING"/>
					<colinfo id="ATKLA" size="256" type="STRING"/>
					<colinfo id="PRH" size="256" type="STRING"/>
					<colinfo id="PRHNAME" size="256" type="STRING"/>
					<colinfo id="PRD" size="256" type="STRING"/>
					<colinfo id="FLAG" size="256" type="STRING"/>
					<colinfo id="ZTPLGBN" size="256" type="STRING"/>
					<colinfo id="ZTPLNM" size="256" type="STRING"/>
					<colinfo id="ZPRDGBN" size="256" type="STRING"/>
					<colinfo id="ZTPLSEQ" size="256" type="STRING"/>
					<colinfo id="ZTPLNO" size="256" type="STRING"/>
					<colinfo id="PRH0" size="256" type="STRING"/>
					<colinfo id="CNT" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list" OnColumnChanged="ds_header_OnColumnChanged">
				<Contents>
					<colinfo id="CHECK" size="256" type="STRING"/>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZRQFLG" size="256" type="STRING"/>
					<colinfo id="ZRQDAT" size="256" type="STRING"/>
					<colinfo id="ZRQCN" size="256" type="STRING"/>
					<colinfo id="ZWRITER" size="256" type="STRING"/>
					<colinfo id="ZRMK" size="256" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="CDATE" size="256" type="STRING"/>
					<colinfo id="CTIME" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UDATE" size="256" type="STRING"/>
					<colinfo id="UTIME" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_docmn">
				<Contents>
					<colinfo id="CODE" size="2" type="STRING"/>
					<colinfo id="CODE_NAME" size="2" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zrqflg">
				<Contents>
					<colinfo id="CODE" size="2" type="STRING"/>
					<colinfo id="CODE_NAME" size="2" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_header">
				<Contents>
					<colinfo id="CHECK" size="256" type="STRING"/>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZRQFLG" size="256" type="STRING"/>
					<colinfo id="ZRQDAT" size="256" type="STRING"/>
					<colinfo id="ZRQCN" size="256" type="STRING"/>
					<colinfo id="ZWRITER" size="256" type="STRING"/>
					<colinfo id="ZRMK" size="256" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="CDATE" size="256" type="STRING"/>
					<colinfo id="CTIME" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UDATE" size="256" type="STRING"/>
					<colinfo id="UTIME" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<colinfo id="GSNAM" size="256" type="STRING"/>
					<record>
						<CDATE></CDATE>
						<CHECK></CHECK>
						<CTIME></CTIME>
						<CUSER></CUSER>
						<DOCREQNO></DOCREQNO>
						<GSNAM></GSNAM>
						<MANDT></MANDT>
						<QTNUM></QTNUM>
						<QTSER></QTSER>
						<UDATE></UDATE>
						<UTIME></UTIME>
						<UUSER></UUSER>
						<ZRMK></ZRMK>
						<ZRQCN></ZRQCN>
						<ZRQDAT></ZRQDAT>
						<ZRQFLG></ZRQFLG>
						<ZSEQ></ZSEQ>
						<ZWRITER></ZWRITER>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_save" OnColumnChanged="ds_header_OnColumnChanged">
				<Contents>
					<colinfo id="CHECK" size="256" type="STRING"/>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZRQFLG" size="256" type="STRING"/>
					<colinfo id="ZRQDAT" size="256" type="STRING"/>
					<colinfo id="ZRQCN" size="256" type="STRING"/>
					<colinfo id="ZWRITER" size="256" type="STRING"/>
					<colinfo id="ZRMK" size="256" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="CDATE" size="256" type="STRING"/>
					<colinfo id="CTIME" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UDATE" size="256" type="STRING"/>
					<colinfo id="UTIME" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<record>
						<CDATE></CDATE>
						<CHECK></CHECK>
						<CTIME></CTIME>
						<CUSER></CUSER>
						<DOCREQNO></DOCREQNO>
						<MANDT></MANDT>
						<QTNUM></QTNUM>
						<QTSER></QTSER>
						<UDATE></UDATE>
						<UTIME></UTIME>
						<UUSER></UUSER>
						<ZRMK></ZRMK>
						<ZRQCN></ZRQCN>
						<ZRQDAT></ZRQDAT>
						<ZRQFLG></ZRQFLG>
						<ZSEQ></ZSEQ>
						<ZWRITER></ZWRITER>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsContDocAppend" UseClientLayout="1">
				<Contents>
					<colinfo id="reportNo" size="256" type="STRING"/>
					<colinfo id="ConsCd" size="256" type="STRING"/>
					<colinfo id="seqNo" size="256" type="STRING"/>
					<colinfo id="sno" size="256" type="STRING"/>
					<colinfo id="appendCd" size="256" type="STRING"/>
					<colinfo id="appendLocFileNm" size="256" type="STRING"/>
					<colinfo id="appendFileNm" size="256" type="STRING"/>
					<colinfo id="appendDispNm" size="256" type="STRING"/>
					<colinfo id="appendFileSz" size="256" type="STRING"/>
					<colinfo id="details" size="256" type="STRING"/>
					<colinfo id="regDate" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="dsContReqAppend">
				<Contents>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<colinfo id="ZATTSEQ" size="256" type="STRING"/>
					<colinfo id="ZATTPATH" size="256" type="STRING"/>
					<colinfo id="ZATTFN" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
					<colinfo id="FILE_SIZE" size="10" type="INT"/>
					<colinfo encrypt="base64" id="CONTENT" size="255" type="BLOB"/>
					<colinfo id="FLAG" size="256" type="STRING"/>
					<colinfo id="TEMP" size="256" type="STRING"/>
					<colinfo id="ZATTFN_OR" size="256" type="STRING"/>
					<colinfo id="ZWGBN" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_delFile">
				<Contents>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="DOCREQNO" size="256" type="STRING"/>
					<colinfo id="ZSEQ" size="256" type="STRING"/>
					<colinfo id="ZATTSEQ" size="256" type="STRING"/>
					<colinfo id="ZATTPATH" size="256" type="STRING"/>
					<colinfo id="ZATTFN" size="256" type="STRING"/>
					<colinfo id="CUSER" size="256" type="STRING"/>
					<colinfo id="UUSER" size="256" type="STRING"/>
					<colinfo id="FILE_SIZE" size="10" type="INT"/>
					<colinfo encrypt="base64" id="CONTENT" size="255" type="BLOB"/>
					<colinfo id="FLAG" size="256" type="STRING"/>
					<colinfo id="TEMP" size="256" type="STRING"/>
					<colinfo id="ZATTFN_OR" size="256" type="STRING"/>
					<colinfo id="ZWGBN" size="256" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Height="40" Id="div_btn" TabOrder="12" Text="Div0" Url="WB01::CommBtnForm.xml" Width="456">
			<Contents></Contents>
		</Div>
		<Shape BKColor="user0" Bottom="224" Height="184" Id="Shape1" Left="0" LineColor="user1" Right="456" TabOrder="11" Top="40" Type="Rectangle" Width="456"></Shape>
		<Static Align="Right" Height="20" Id="Static0" Left="5" Style="sty_lb_search" TabOrder="10" Text="Dwg&#32;Reqst&#32;#&#32;" Top="45" VAlign="Middle" Width="107"></Static>
		<Button Appearance="FLAT" ButtonStyle="TRUE" Color="user5" Cursor="HAND" DomainID="btn.save" Height="22" Id="btn_save" ImageID="btn_comm_save_k" Left="339" LeftMargin="20" OnClick="fn_OnClick_btn" TabOrder="9" Text="저장" Top="6" Width="52"></Button>
		<Static Align="Right" Height="20" Id="st_TempName" Left="5" Style="sty_lb_search" TabOrder="13" Text="Reqst&#32;Type&#32;" Top="67" VAlign="Middle" Width="107"></Static>
		<Edit BindDataset="ds_header" Border="Flat" Column="ZRQCN" Height="20" Id="ed_Zrqcn" ImeMode="keep,native" Left="115" LeftMargin="4" MaxLength="100" RightMargin="4" Style="sty_ipt_form" TabOrder="7" Top="177" Width="329"></Edit>
		<Static Align="Right" Height="20" Id="Static2" Left="5" Style="sty_lb_search" TabOrder="15" Text="Contents&#32;" Top="177" VAlign="Middle" Width="107"></Static>
		<Static Align="Right" Height="20" Id="Static1" Left="5" Style="sty_lb_search" TabOrder="14" Text="Reqst&#32;Date&#32;" Top="89" VAlign="Middle" Width="107"></Static>
		<Edit BindDataset="ds_header" Border="Flat" Column="ZRMK" Height="20" Id="ed_zrmk" ImeMode="keep,native" Left="115" LeftMargin="4" MaxLength="100" RightMargin="4" Style="sty_ipt_form" TabOrder="8" Top="199" Width="329"></Edit>
		<Static Align="Right" Height="20" Id="Static3" Left="5" Style="sty_lb_search" TabOrder="17" Text="Remarks&#32;" Top="199" VAlign="Middle" Width="107"></Static>
		<Static Align="Right" Height="20" Id="Static4" Left="5" Style="sty_lb_search" TabOrder="16" Text="Manager&#32;" Top="111" VAlign="Middle" Width="107"></Static>
		<Edit BindDataset="ds_header" Border="Flat" Column="ZWRITER" Enable="FALSE" Height="20" Id="ed_zwriter" ImeMode="keep,native" Left="115" LeftMargin="4" MaxLength="10" RightMargin="4" Style="sty_ipt_form" TabOrder="4" Top="111" Width="136"></Edit>
		<Static Align="Right" Height="20" Id="Static5" Left="5" Style="sty_lb_search" TabOrder="18" Text="Rev.&#32;#&#32;" Top="155" VAlign="Middle" Width="107"></Static>
		<Static Align="Right" Height="20" Id="Static6" Left="5" Style="sty_lb_search" TabOrder="18" Text="Quot&#32;#&#32;" Top="133" VAlign="Middle" Width="107"></Static>
		<Edit BindDataset="ds_header" Border="Flat" CheckLength="Byte" Column="QTNUM" Height="20" Id="ed_qtnum" ImeMode="keep,native" Left="115" LeftMargin="4" MaxLength="30" OnCharChanged="Common_Edit_OnCharChanged" RightMargin="4" Style="sty_ipt_form" TabOrder="5" Top="133" Width="85"></Edit>
		<Edit BindDataset="ds_header" Border="Flat" Column="DOCREQNO" Enable="FALSE" Height="20" Id="ed_docreqno" ImeMode="english" Left="115" LeftMargin="4" MaxLength="10" RightMargin="4" Style="sty_ipt_form" TabOrder="1" Top="45" Width="136"></Edit>
		<Combo BindDataset="ds_header" Border="Flat" CodeColumn="CODE" Column="ZRQFLG" DataColumn="CODE_NAME" Enable="FALSE" Height="20" Id="cb_zrqflg" InnerDataset="ds_zrqflg" Left="114" Style="sty_ipt_form" TabOrder="2" Top="66" Width="138"></Combo>
		<Calendar BindDataset="ds_header" Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="ZRQDAT" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Enable="FALSE" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_zrqdat" Left="115" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="3" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="89" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="136"></Calendar>
		<MaskEdit BindDataset="ds_header" Border="Flat" BorderColor="user13" Column="QTSER" DecimalLen="0" Enable="FALSE" Height="20" Id="me_qtser" Left="115" MaxLength="3" TabOrder="6" Top="155" Width="85"></MaskEdit>
		<FileDialog Bottom="40" FilePath="c:\" Filter="*.*|*.jpeg|*.gif|" Height="24" Id="fileDialog" Left="616" Right="640" TabOrder="26" Top="16" Width="24"></FileDialog>
		<File Bottom="72" Height="24" Id="f_tmp" Left="616" Right="640" TabOrder="27" Top="48" Width="24"></File>
		<FileDialog Bottom="40" FilePath="c:\" Height="24" Id="saveDialog" Left="664" Right="688" TabOrder="25" Top="16" Type="Save" Width="24"></FileDialog>
		<Button Appearance="FLAT" Height="18" Id="btn_Qtnum" ImageID="btn_icon_search" Left="202" OnClick="btn_Qtnum_OnClick" TabOrder="20" Text="Button0" Top="134" Transparent="TRUE" Width="18"></Button>
		<Edit BindDataset="ds_header" Border="Flat" Column="GSNAM" Enable="FALSE" Height="20" Id="ed_gsnam" ImeMode="keep,native" Left="222" LeftMargin="4" MaxLength="10" RightMargin="4" Style="sty_ipt_form" TabOrder="21" Top="133" Width="222"></Edit>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoFitEndLine="Hide" BindDataset="dsContReqAppend" BkColor2="default" BoldHead="true" Border="Flat" Bottom="432" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="35" Height="168" Id="grd_detail" InputPanel="FALSE" LineColor="user20" LineType="ExHORZ" MinWidth="100" OnCellDBLClick="grd_detail_OnCellDblClick" OnExpandUp="grd_detail_OnExpandUp" OnHeadClick="grd_list_OnHeadClick" Right="456" RowHeight="20" Style="sty_grid" TabOrder="23" TabStop="true" Top="264" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="456">
			<contents>
				<format id="Default">
					<columns>
						<col width="26"/>
						<col width="248"/>
						<col width="173"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user21" display="text" font="굴림,9" text="No"/>
						<cell align="center" col="1" color="user21" display="text" font="굴림,9" text="File&#32;Path"/>
						<cell col="2" color="user21" font="굴림,9" text="File&#32;Name"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" display="text" expr="currow+1"/>
						<cell align="left" bkcolor2="user22" col="1" colid="ZATTPATH" display="text"/>
						<cell align="left" col="2" colid="ZATTFN_OR" expandimage="btn_icon_next_01" expandshow="expr:decode(getrowtype(currow),&#32;&apos;insert&apos;,&#32;&apos;true&apos;,&#32;&apos;false&apos;)"/>
					</body>
				</format>
			</contents>
		</Grid>
		<CyHttpFile Height="24" Id="httpFile" Left="79" Top="230" Width="24"></CyHttpFile>
		<File Bottom="254" Height="24" Id="fdFile" Left="56" Right="80" TabOrder="26" Top="230" Width="24"></File>
		<FileDialog AppendExtDefault="TRUE" Bottom="254" Filter="Acrobet&#32;Reader(*.pdf)|*.pdf|CAD&#32;Files(*.dwg)|*.dwg|" Height="24" Id="fdAttachedFile" Left="32" MultiSelect="TRUE" Right="56" TabOrder="24" Top="230" Width="24"></FileDialog>
		<FileDialog Bottom="254" Filter="Acrobet&#32;Reader(*.pdf)|*.pdf|CAD&#32;Files(*.dwg)|*.dwg|" Height="24" Id="fdFileDownload" Left="8" Right="32" TabOrder="27" Top="230" Type="Save" Width="24"></FileDialog>
		<Edit Border="Flat" Enable="FALSE" Height="24" Id="edt_zseq" ImeMode="english" Left="379" LeftMargin="4" MaxLength="10" RightMargin="4" Style="sty_ipt_form" TabOrder="23" Top="44" Visible="FALSE" Width="72"></Edit>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_download" ImageID="btn_sub_05" Left="368" LeftMargin="12" OnClick="btn_download_OnClick" Style="sty_btn" TabOrder="25" Text="Download" Top="240" Transparent="TRUE" Width="85"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_add" ImageID="btn_sub_04" Left="208" LeftMargin="12" OnClick="btnAttachFile_OnClick" Style="sty_btn" TabOrder="24" Text="Add&#32;File" Top="240" Transparent="TRUE" Width="75"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_delete" ImageID="btn_sub_05" Left="282" LeftMargin="12" OnClick="btn_del_list_detail_OnClick" Style="sty_btn" TabOrder="26" Text="Delete&#32;Files" Top="240" Transparent="TRUE" Width="85"></Button>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */   
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::nsfRequest.js";	// 공통 스크립트 
#include "LIB::common_hdel.js";	// 공통 스크립트  /* GNY 추가 */

//#include "LIB::common_coms.js";	// 파일업/다운로드 */
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var F_FRM_TITLE = "Dwg Request";
var pGubun;
var pZseq;
var pZrqflg;
var gZrqflg;
var pZrqcn;
var pZrmk;
var gMsg;
var pGsnam;
var imgUploadFlg = "";
//var _F_FILE_DIR = "";	// 로컬에서 현재 선택한 파일 디렉토리 
//var _F_FILE_NAME = "";	// 로컬에서 현재 선택한 파일  명 
//var _F_FILE_SIZE = 0;	// 파일 사이즈 
//var _F_FILE_DELETE = false;

//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	gfn_initForm(false); 	// Form 로드 이벤트 맨 첫줄에 기술 
	
	gfn_translation(obj, G_LANG);	//언어
	
	fn_init_form(); 	// 폼 초기화
	div_btn.fn_loadUseBtn("", "의뢰", "", "");   	// 화면제목 설정 및 버튼 활성화
}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================

/********************************************************************************
* 기      능   : 폼 초기화
********************************************************************************/
function fn_init_form() {

	pGubun = pGubun;
	pDocreqno = pDocreqNo;
	pZseq = pZseq;
	pZrqflg = pZrqflg;
	//gZrqflg = sZrqflg;	
	pFID = pFID;
	pGsnam = pGsnam;
	
		ed_qtnum.Enable = false;//decode(pZrqflg, "20", true, "52", true, false);	
		ed_Zrqcn.Enable = decode(pZrqflg, "20", true, "52", true, false);
		ed_zrmk.Enable = decode(pZrqflg, "20", true, "52", true, false);
		
		btn_add.Visible = decode(pZrqflg, "20", true, "52", true, false);
		btn_delete.Visible = decode(pZrqflg, "20", true, "52", true, false);
		btn_download.Visible = decode(pZrqflg, "20", true, "52", true, false);
		btn_Qtnum.Enable = false;//decode(pZrqflg, "20", true, "52", true, false);
		//btn_save.Visible = decode(pZrqflg, "20", true, "52", true, false);
	
	// 최종 변경된 셀정보 초기화
	F_CHG_COLNUM = "";	             // 변경된 컬럼번호
	F_CHG_ROWNUM = "";	             // 변경된 행번호
	F_MAX_SERNO  = 0;	             // 최종순번

	//코드콤보 설정 
	var codeArr = ["SD104"];
	var dsObjArr = [ds_zrqflg];
	var addTypeArr = [G_CODE_ALL];
	gfn_searchCommCode(codeArr, dsObjArr, addTypeArr);	
		
	if(pGubun == "U") {
		me_qtser.Enable = false;
	} else if(pGubun == "S") {
		fn_headerQuery();
		fn_fileQuery();
	} else if(pGubun == "10") {
		fn_fileQuery();
	} else if(pGubun == "D") {
		gZrqflg = sZrqflg;
		pZrqcn = pZrqcn;
		pZrmk = pZrmk;
	}
	
} 

/********************************************************************************
* 기      능   : 조회 1
********************************************************************************/
function fn_query() {	
	ds_temp.ClearData();		 
	ds_list.ClearData();	
}

/********************************************************************************
* 기      능   : 저장 
********************************************************************************/
function fn_save() {
	//변경여부 확인
	if(ds_header.GetUpdate() == false && dsContReqAppend.GetUpdate() == false) 
	{ 
		gfn_showAlert("CW00006", F_FRM_TITLE);
		return false; 
	} 
	
	if(ed_qtnum.Text =="" || ed_qtnum.Text = null){
		gfn_showAlert("CW10205");	//=견적번호를 입력해주십시오
		ed_qtnum.SetFocus();
	   return;
	}	
		
	if(ed_gsnam.Text =="" || ed_gsnam.Text == null){
		gfn_showAlert("CW10217", "Quot Name");		//견적명이 입력되지 않았습니다.
		ed_gsnam.SetFocus();
	   return false;
	}	 
	
	if (gZrqflg = "52") {
		if(dsContReqAppend.rowcount == 0) {
			gfn_showAlert("CW10216", "Dwg Upload");	//도면제안 할 첨부파일을 추가하십시오.
			return false;
		}
		
		for(var i=0; i<dsContReqAppend.rowcount; i++) {
			if(dsContReqAppend.GetColumn(i, "ZATTFN") == "" || dsContReqAppend.GetColumn(i, "ZATTFN") == null) {
				gfn_showAlert("CW10215");		//첨부파일을 입력하십시오.
				return false;
			}
		}
	}
	
	if(!gfn_showConfirm("CI10003")){		//저장 하시겠습니까?
	   return false;
	}	
		
	//도면의뢰 상태에서 수정
	if (pGubun == "S") {
		//변경된 첨부파일 있으면 파일업로드 후 파일저장
		if (dsContReqAppend.GetUpdate() == true) {		
			fn_fileUpload();
		}
		if (ds_header.GetUpdate() == true) {
			fn_headerUpdate();
		}
	}
	//진행상태 변경
	else if(pGubun == "D")
	{
		ds_header.SetColumn(0, "DOCREQNO", pDocreqno);
		ds_header.SetColumn(0, "ZSEQ", pZseq);
		ds_header.SetColumn(0, "ZRQFLG", gZrqflg);
		ds_header.SetColumn(0, "ZRQDAT", pDocreqno);
		ds_header.SetColumn(0, "ZWRITER", G_USER_ID);
		ds_header.SetColumn(0, "QTNUM", pQtnum);
		ds_header.SetColumn(0, "GSNAM", pGsnam);
		ds_header.SetColumn(0, "QTSER", pQtser);

		nsfRequest("addDetail"															// srvId
					, "ses0240/addDetail"												// url
					, "ds_list=ds_header"												// inDsList
					, "ds_error=ds_error"												// outDsList
					, ""																// strParam
					, "fn_afterAdddetail"													// CallBackFunc
					);	
	}
	fn_createWait("",this);     // 처리중입니다. 메시지 처리		
}


/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}

/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {
}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================

/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {

	gMsg = "SAVE";
	
    if (pGubun == "I") //신규
    {
		cal_zrqdat.Text = gfn_getCurrDate();
	
		cb_zrqflg.value = pZrqflg;	// D도면의뢰고정
		ed_zwriter.Text = G_USER_ID;
	}
    else if(pGubun == "S") {	//조회	

		ed_docreqno.Value = pDocreqno;
		cb_zrqflg.Value = pZrqflg;
		cal_zrqdat.Text = pzrqdat;
		ed_Zrqcn.Text = pZrqcn;
		ed_zwriter.Text = pZwriter;
		ed_Zrmk.Text = pZrmk;
		ed_qtnum.Text = pQtnum;
		me_qtser.Value = pQtser;
		ed_gsnam.Text = pGsnam;
		edt_zseq.Text = pZseq;

		btn_add.Visible = decode(pZrqflg, "52", true, false);
		btn_delete.Visible = decode(pZrqflg,  "52", true, false);
		btn_Qtnum.Enable = false;//decode(pZrqflg, "20", true, "52", true, false);
		
		if(pZwriter != G_USER_ID)
		{				
			ed_docreqno.Enable = false;
			cb_zrqflg.Enable = false;		
			cal_zrqdat.Enable = false;
			ed_Zrqcn.Enable = false;
			ed_zwriter.Enable = false;
			ed_Zrmk.Enable = false;
			ed_qtnum.Enable = false;
			btn_Qtnum.Enable = false;
			me_qtser.Enable = false;			
			
			//btn_save.Enable = false;
			btn_add.Visible = false;
			btn_delete.Visible = false;
		}
		ed_gsnam.Enable = false;
		
	}	
	else if(pGubun == "D") {	//진행단계
		ed_docreqno.Value = pDocreqno;
		gZrqflg = sZrqflg;
		cal_zrqdat.Text = pzrqdat;	
		cb_zrqflg.value = gZrqflg;	// D도면의뢰고정
		ed_zwriter.Text = G_USER_ID;		
		gMsg = sMsg;
		ed_qtnum.Text = pQtnum;
		ed_gsnam.Text = pGsnam;
		me_qtser.Value = pQtser;
		
		ed_qtnum.enable = false;
		btn_Qtnum.Enable = false;
		me_qtser.enable = false;
		
		ed_Zrqcn.Enable = true;
		ed_Zrmk.Enable = true;
	}
}

/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	fn_destroyWait();
} 

/********************************************************************************
* 기      능   : 저장 Callback
********************************************************************************/
function fn_afterSave(errCode, errMsg) {
	fn_destroyWait();

	if (ds_error.rowcount > 0) gfn_showAlert(ds_error.GetColumn(0,"ERRMSG"));

	if (pgubun == "D")
	{
		if (gZrqflg == "52") {
			//변경된 첨부파일 있으면 파일업로드 후 파일저장
			if (dsContReqAppend.GetUpdate() == true) {		
				fn_fileUpload();
			}
		}
	}
	else
	{
		parent.fn_query(); 
	}

	fn_close();
}
/********************************************************************************
* 기      능   : Detail 추가저장 Callback
********************************************************************************/
function fn_afterAdddetail() {
	if (ds_error.rowcount > 0) gfn_showAlert(ds_error.GetColumn(0,"ERRMSG"));
	
	if (dsContReqAppend.GetUpdate() == true) {		
		fn_fileUpload();
	}
	
	fn_afterFileSave();
}
/********************************************************************************
* 기      능   :  파일정보 DB저장 후 Callback
********************************************************************************/
function fn_afterFileSave() {
	//Header Status Update
	nsfRequest("statusUpdate"
			, "ses0240/statusUpdate"
			, "ds_cond=ds_cond ds_header=ds_header"
			, "ds_header=ds_header ds_error=ds_error"
			, ""
			, "fn_afterStatusUpdate");		
}
/********************************************************************************
* 기      능   :  진행상태 변경 후 Callback
********************************************************************************/
function fn_afterStatusUpdate() {
	if (ds_error.rowcount > 0) gfn_showAlert(ds_error.GetColumn(0,"ERRMSG"));
	
	parent.fn_query();
	close();
}

//=========================================================================================
// [ PART 5 ]
// User Function 정의 : 사용자정의 함수
//=========================================================================================
/********************************************************************************
* 기      능   :  헤더정보 조회
********************************************************************************/
function fn_headerQuery() {
	ds_cond.ClearData();
	ds_cond.InsertRow(0);
	ds_cond.setColumn(0, "MANDT"   , G_MANDT         );    
	ds_cond.setColumn(0, "DOCREQNO", pDocreqno);
	ds_cond.setColumn(0, "ZSEQ", pZseq);
	
	nsfRequest("header"
			, "ses0240/header"
			, "ds_cond=ds_cond ds_header=ds_header"
			, "ds_header=ds_header ds_error=ds_error"
			, ""
			, "fn_afterQuery");
}
/********************************************************************************
* 기      능   :  첨부파일 조회
********************************************************************************/
function fn_fileQuery() {
	ds_cond.ClearData();
	ds_cond.InsertRow(0);
	ds_cond.setColumn(0, "MANDT"   , G_MANDT         );   
	ds_cond.setColumn(0, "ZWGBN"   , "M");
	ds_cond.setColumn(0, "DOCREQNO", pDocreqno);
	ds_cond.setColumn(0, "ZSEQ", pZseq);

	nsfRequest("query"
			, "ses0240/fileview"
			, "ds_cond=ds_cond ds_detail=ds_header dsContReqAppend=dsContReqAppend"
			, "dsContReqAppend=dsContReqAppend ds_error=ds_error"
			, ""
			, "fn_afterQuery");
}
/********************************************************************************
* 기      능   :  첨부파일 서버에 업로드
********************************************************************************/
function fn_fileUpload()
{	
	var consCd = dsContReqAppend.GetColumn(0, "G_MANDT");
	var pDocreqno = ds_header.GetColumn(0, "DOCREQNO");
	var fZseq = decode(pGubun, "D", toNumber(pZseq)+1, edt_zseq.text);//edt_zseq.text;
	var fileName = "";	
	
	//file서버에 이미지 저장
	for(var i = 0; i < dsContReqAppend.rowcount; i++)
	{
		if(dsContReqAppend.GetRowType(i) == "insert" || dsContReqAppend.GetRowType(i) == "update") {
		
			if(length(dsContReqAppend.getColumn(i, "ZATTFN")) != 0 && length(dsContReqAppend.getColumn(i, "ZATTPATH")) != 0)
			{
				dsContReqAppend.setColumn(i, "MANDT"  	, G_MANDT         );    
				dsContReqAppend.setColumn(i, "DOCREQNO"	, ds_header.GetColumn(0, "DOCREQNO"));
				dsContReqAppend.setColumn(i, "ZSEQ"		, fZseq);		
				dsContReqAppend.setColumn(i, "CUSER"	, G_USER_ID);
				dsContReqAppend.setColumn(i, "UUSER"	, G_USER_ID);
				dsContReqAppend.setColumn(i, "TEMP"		, dsContReqAppend.getColumn(i, "ZATTFN"));
				
				//파일명 만들기			
				fileName = "MN_" + pDocreqno + "_"+ fZseq + "_" + substr(GetDate(),8,13)+"."+gfn_getFileExt(dsContReqAppend.getColumn(i, "ZATTFN"));

				//파일업로드 서비스 호출
				var arr = tit_fileWrite(httpFile					//http객체
					, "SD"											//저장디렉토리
					, dsContReqAppend.getColumn(i, "ZATTPATH")		//로컬경로
					, dsContReqAppend.getColumn(i, "TEMP")			//로컬파일명
					, fileName										// 실제 db에 저장될 파일 이름
					, "U"											// time stamp를 붙이지 않을 경우 U 사용 
					, "");											//삭제할 이전 파일명 
				
				//------------------ log
				//trace("file path       > " +dsContReqAppend.getColumn(i, "ZATTPATH"));
				//trace("local file name > " +dsContReqAppend.getColumn(i, "TEMP")); 
				//trace("file name       > " +fileName); 
				//trace("arr             > " +arr);
				//------------------ log
				
				//업로드 성공인 경우
				if ( arr[0] == "S" ) {
					dsContReqAppend.setColumn(i, "ZATTFN", arr[2]);		
					dsContReqAppend.setColumn(i, "ZATTFN_OR", dsContReqAppend.getColumn(i, "TEMP"));	
				}
				//업로드 실패인 경우
				else if ( arr[0] != "S" )
				{
					gfn_showMsg("CW00035"); 
					return false;
				}
				
			} else {
				gfn_showAlert("CW10215");	//CW10215=첨부파일을 입력하십시오.
				return false;
			}//end if
		} //end if		

	} //end for
	
	if(ds_delFile.rowcount > 0) {
		for (var j=0; j<ds_delFile.rowcount; j++) {
			tit_fileDelete("SD", ds_delFile.getColumn(j, "ZATTFN"), "");
		}
	}

	//업로드 완료 후 
	fn_fileSave();	
}

/********************************************************************************
* 기      능   :  헤더정보  Update
********************************************************************************/
function fn_headerUpdate() {	
	ds_header.setColumn(0, "MANDT"		, G_MANDT);    	
	ds_header.setColumn(0, "CUSER"		, G_USER_ID);
	ds_header.setColumn(0, "UUSER"		, G_USER_ID);
	ds_header.SetColumn(0, "ZRQCN"		, decode(ds_header.GetColumn(0, "ZRQCN"), null, ' ', ds_header.GetColumn(0, "ZRQCN")));
	ds_header.SetColumn(0, "ZRMK"		, decode(ds_header.GetColumn(0, "ZRMK"), null, ' ', ds_header.GetColumn(0, "ZRMK")));
	
	nsfRequest("updateHeader"																	// srvId
		, "ses0240/updateHeader"															// url
		, "ds_list=ds_header"														// inDsList
		, "ds_error=ds_error"												    	// outDsList
		, ""																		// strParam
		, "fn_afterSave"															// CallBackFunc
		);
		
	fn_createWait("",this);     // 처리중입니다. 메시지 처리	
}

/********************************************************************************
* 기      능   :  파일정보 저장
********************************************************************************/
function fn_fileSave() {
	nsfRequest("fileSave"														// srvId
	, "ses0240/fileSave"														// url
	, "ds_file=dsContReqAppend:U ds_delFile=ds_delFile:A"		// inDsList
	, "dsContReqAppend=ds_file ds_error=ds_error"												    	// outDsList
	, ""																		// strParam
	, "fn_afterFileSave"															// CallBackFunc
	);
	
	fn_createWait("",this);     // 처리중입니다. 메시지 처리	
}


/********************************************************************************
* 기      능   :  파일 체크
********************************************************************************/
function fn_filecheck() {
	if(dsContReqAppend.rowcount == 0) {
		gfn_showAlert("CW10219"); 	//조회된 파일이 없습니다.
		return false;
	}	
	if(dsContReqAppend.GetRowType(dsContReqAppend.rowpos) == "insert") {
		return false;
	}
	return true;
}
/********************************************************************************
* 기      능   :  첨부파일 다운로드
********************************************************************************/
function fn_filedownload(nRow) {
	if(!fn_filecheck()) return;
	
	var svrFileName = dsContReqAppend.GetColumn(nRow, "ZATTFN");
	var orgFileName = dsContReqAppend.GetColumn(nRow, "ZATTFN_OR");
	var ext =     gfn_getFileExt(dsContReqAppend.getColumn(nRow, "ZATTFN"));
	
	fdFileDownload.FileName =orgFileName;
	fdFileDownload.Filter = "Acrobet Reader(*.pdf)|*.pdf|CAD Files(*.dwg)|*.dwg|";
	fdFileDownload.FilterIndex = decode(ext, "pdf","0", "1");
    fdFileDownload.open();
    

	var idx = indexOf(fdFileDownload.FileName, ".");
	var fdFileName = fdFileDownload.FileName;
   
    var fileName =  decode(idx, -1, fdFileName, substr(fdFileName, 0, indexOf(fdFileName, ".")));
    var localFileName = fileName + "." + ext;

	tit_fileRead(httpFile
		, "SD"						//저장 디렉토리
		, svrFileName	//서버에서 전송받을 이름	
        , fdFileDownload.FilePath	//로컬 경로
        , localFileName);	//로컬 파일명	
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 : 각 Component 별 이벤트 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회
********************************************************************************/
function fn_OnClick_btn(obj) {
	var fncName = "fn_" + substr(obj.id, 4); 
	eval( fncName + "()");
}

/********************************************************************************
* 기      능   : 정렬 처리 
********************************************************************************/
function grd_list_OnHeadClick(obj,nCell,nX,nY,nPivotIndex) {

	if( nCell == 0 ) gfn_selectAllGrid(obj,nCell,nCell,true);
	else             gfn_sortGrid(obj, nCell);
}

/********************************************************************************
* 기      능   : 견적번호 조회 팝업
********************************************************************************/
function btn_Qtnum_OnClick(obj)
{
	var qtnum = ed_qtnum.Text;
	var gsnam = ed_gsnam.Text;
	var arg  =  "qtnum=" + quote(qtnum ); // pop구분값 ( nation:국가 / area:운송지역 )
		arg += " gsnam=" + quote(gsnam); // 넘길 값
		
	var arr = gfn_openPopupUrl("COM::Com0250.xml", true, arg);

	if (arr != null && arr != 0)
	{
		ed_qtnum.Text = arr[0];
		ed_gsnam.Text = arr[1];
		ed_qtnum.SetFocus();
	}
}
/********************************************************************************
* 기      능   : 파일추가 클릭시 행 추가
********************************************************************************/
function btnAttachFile_OnClick(obj)
{
	var nRow = gfn_addGridRow(grd_detail, -1, "FLAG");	
	dsContReqAppend.setColumn(nRow, "MANDT"  , G_MANDT         );    
	dsContReqAppend.setColumn(nRow, "ZWGBN"  , "M"   );
	dsContReqAppend.setColumn(nRow, "CUSER"  , G_USER_ID);
	dsContReqAppend.setColumn(nRow, "UUSER"  , G_USER_ID);
}

/********************************************************************************
* 기      능   :  첨부파일 입력
********************************************************************************/
function grd_detail_OnExpandUp(obj,nRow,nCell,strVal,nPivotIndex)
{
	if ( nCell == 2 ) {
		var arr = gfn_openFileMgr(
		    "SD"
			, dsContReqAppend.getColumn(nRow, "ZATTFN")//FileDialog.FileName
			, dsContReqAppend.getColumn(nRow, "ZATTPATH")//FileDialog.FilePath
			, imgUploadFlg
		);
	
		if ( arr != null ) {
			var ext = gfn_getFileExt(arr[1]);
			if (ext != toLower("pdf") && ext != toLower("dwg")) {
				gfn_showAlert("CW10218", "PDF or DWG"); 	//PDF 또는 DWG파일만 가능합니다.
				return false;
			} else {
			   dsContReqAppend.setColumn(nRow, "ZATTPATH",arr[0]) ; // 디렉토리 정보 
			   dsContReqAppend.setColumn(nRow, "ZATTFN",arr[1]); // 파일명 
			   dsContReqAppend.setColumn(nRow, "ZATTFN_OR",arr[1]); 
		   }
		}
	} 
}

/********************************************************************************
* 기      능   : 첨부파일 삭제
********************************************************************************/
function btn_del_list_detail_OnClick(obj)
{
	if(!fn_filecheck()) return;
	
	if (dsContReqAppend.GetRowType(dsContReqAppend.rowpos) == "normal") {
		ds_delFile.InsertRow(0);
		ds_delFile.CopyRow(0,"dsContReqAppend", dsContReqAppend.row);
		dsContReqAppend.DeleteRow(dsContReqAppend.rowpos);
	} else {
		gfn_deleteGridRow( grd_detail, dsContReqAppend.row, "FLAG" );
	}
}

/********************************************************************************
* 기      능   :  그리드 더블클릭시 
********************************************************************************/
function grd_detail_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{	
	fn_filedownload(nRow);	
}

/********************************************************************************
* 기      능   :  다운로드 버튼 클릭시
********************************************************************************/
function btn_download_OnClick(obj)
{
	fn_filedownload(dsContReqAppend.rowpos);
}

/********************************************************************************
* 기      능   : 코드값 변경시 코드명 초기화
********************************************************************************/
function Common_Edit_OnCharChanged(obj,strPreText,strPostText)
{
	switch(obj.id) {
		case "ed_qtnum" :
			ed_gsnam.Text = "";
			break;
	}
}

]]></Script>
</Window>