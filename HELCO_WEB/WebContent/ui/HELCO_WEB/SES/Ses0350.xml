<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="562" Id="Ses0038" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="부분원가&#32;관리" Top="8" Ver="1.0" Width="978" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_block">
				<Contents>
					<colinfo id="NO" size="256" type="STRING"/>
					<colinfo id="MANDT" size="256" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="3" type="STRING"/>
					<colinfo id="QTSEQ" size="3" type="STRING"/>
					<colinfo id="BLSEQ" size="256" type="STRING"/>
					<colinfo id="BDMNG" size="256" type="STRING"/>
					<colinfo id="SALES" size="256" type="STRING"/>
					<colinfo id="ZCTOTAL" size="256" type="STRING"/>
					<colinfo id="BLOCKNAME" size="256" type="STRING"/>
					<colinfo id="MAKTX" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_check" OnColumnChanged="ds_check_OnColumnChanged">
				<Contents>
					<colinfo id="FLAG" size="1" type="STRING"/>
					<colinfo id="MANDT" size="3" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="QTSEQ" size="256" type="STRING"/>
					<colinfo id="PSPID" size="24" type="STRING"/>
					<colinfo id="POSID" size="24" type="STRING"/>
					<colinfo id="ATYPE" size="30" type="STRING"/>
					<colinfo id="GUBUN" size="1" type="STRING"/>
					<colinfo id="BLSEQ" size="6" type="STRING"/>
					<colinfo id="BLNUM" size="10" type="STRING"/>
					<colinfo id="BLNAM" size="50" type="STRING"/>
					<colinfo id="MESSG" size="50" type="STRING"/>
					<colinfo id="STATE" size="1" type="STRING"/>
					<colinfo id="SERIA" size="3" type="STRING"/>
					<colinfo id="ZITEM" size="50" type="STRING"/>
					<colinfo id="ZCHAR" size="50" type="STRING"/>
					<colinfo id="ZQUTY" size="5" type="STRING"/>
					<colinfo id="ZAMNT" size="15" type="STRING"/>
					<colinfo id="ZTOTL" size="15" type="STRING"/>
					<colinfo id="BIGO" size="50" type="STRING"/>
					<colinfo id="TEX1" size="200" type="STRING"/>
					<colinfo id="TEX2" size="200" type="STRING"/>
					<colinfo id="ADDT01" size="15" type="STRING"/>
					<colinfo id="VKBUR" size="256" type="STRING"/>
					<colinfo id="VKGRP" size="256" type="STRING"/>
					<colinfo id="ZKUNNR" size="256" type="STRING"/>
					<colinfo id="SHANGH" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="MANDT" size="3" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="QTSEQ" size="256" type="STRING"/>
					<colinfo id="GUBUN" size="1" type="STRING"/>
					<colinfo id="FR_QTDAT" size="8" type="STRING"/>
					<colinfo id="TO_QTDAT" size="8" type="STRING"/>
					<colinfo id="VKBUR" size="256" type="STRING"/>
					<colinfo id="VKGRP" size="256" type="STRING"/>
					<colinfo id="ZKUNNR" size="256" type="STRING"/>
					<colinfo id="FR_ZESTDAT" size="256" type="STRING"/>
					<colinfo id="TO_ZESTDAT" size="256" type="STRING"/>
					<colinfo id="ZPRGFLG" size="256" type="STRING"/>
					<colinfo id="SMAN" size="256" type="STRING"/>
					<colinfo id="FR_CDATE" size="256" type="STRING"/>
					<colinfo id="TO_CDATE" size="256" type="STRING"/>
					<colinfo id="PSPID" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_header">
				<Contents>
					<colinfo id="MANDT" size="256" summ="default" type="STRING"/>
					<colinfo id="QTNUM" size="256" summ="default" type="STRING"/>
					<colinfo id="QTSER" size="256" summ="default" type="STRING"/>
					<colinfo id="QTDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="VKBUR" size="256" summ="default" type="STRING"/>
					<colinfo id="VKGRP" size="256" summ="default" type="STRING"/>
					<colinfo id="ZKUNNR" size="256" summ="default" type="STRING"/>
					<colinfo id="ZPRGFLG" size="256" summ="default" type="STRING"/>
					<colinfo id="VBELN" size="256" summ="default" type="STRING"/>
					<colinfo id="GSNAM" size="256" summ="default" type="STRING"/>
					<colinfo id="WAERK" size="256" summ="default" type="STRING"/>
					<colinfo id="ZKUNNR_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="CDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="FINL" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="BIGO" size="256" summ="default" type="STRING"/>
					<colinfo id="AUART" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSUM_ZCOST" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zpstat">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_error">
				<Contents>
					<colinfo id="IDX" size="256" type="STRING"/>
					<colinfo id="ERRMSG" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_vkgrp">
				<Contents>
					<colinfo id="CODE" size="9" type="STRING"/>
					<colinfo id="CODE_NAME" size="60" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_vkbur">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="DTEXT2" size="90" type="STRING"/>
					<colinfo id="DTEXT3" size="120" type="STRING"/>
					<colinfo id="DTEXT4" size="9" type="STRING"/>
					<colinfo id="CODE2" size="2" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_spart_cd">
				<Contents>
					<colinfo id="CODE" size="1" type="STRING"/>
					<colinfo id="CODE_NAME" size="1" type="STRING"/>
					<record>
						<CODE></CODE>
						<CODE_NAME>-&#32;선택&#32;-</CODE_NAME>
					</record>
					<record>
						<CODE>10</CODE>
						<CODE_NAME>승강기</CODE_NAME>
					</record>
					<record>
						<CODE>20</CODE>
						<CODE_NAME>주차</CODE_NAME>
					</record>
					<record>
						<CODE>30</CODE>
						<CODE_NAME>물류</CODE_NAME>
					</record>
					<record>
						<CODE>40</CODE>
						<CODE_NAME>PSD</CODE_NAME>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_qtgbn">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
					<record>
						<CODE>A</CODE>
						<CODE_NAME>실행가</CODE_NAME>
					</record>
					<record>
						<CODE>B</CODE>
						<CODE_NAME>예산가</CODE_NAME>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zbdtyp">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zprgflg">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_sukum">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zregn">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_shangh">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
					<record>
						<CODE>국내</CODE>
						<CODE_NAME>국내</CODE_NAME>
					</record>
					<record>
						<CODE>상해</CODE>
						<CODE_NAME>상해</CODE_NAME>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_exchange">
				<Contents>
					<colinfo id="MANDT" size="256" summ="default" type="STRING"/>
					<colinfo id="KURST" size="256" summ="default" type="STRING"/>
					<colinfo id="BASEDT" size="256" summ="default" type="STRING"/>
					<colinfo id="FCURR" size="256" summ="default" type="STRING"/>
					<colinfo id="TCURR" size="256" summ="default" type="STRING"/>
					<colinfo id="SDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="UKURS" size="256" summ="default" type="STRING"/>
					<colinfo id="AUART" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_apply" OnColumnChanged="ds_check_OnColumnChanged">
				<Contents>
					<colinfo id="FLAG" size="1" type="STRING"/>
					<colinfo id="MANDT" size="3" type="STRING"/>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="QTSEQ" size="256" type="STRING"/>
					<colinfo id="PSPID" size="24" type="STRING"/>
					<colinfo id="POSID" size="24" type="STRING"/>
					<colinfo id="ATYPE" size="30" type="STRING"/>
					<colinfo id="GUBUN" size="1" type="STRING"/>
					<colinfo id="BLSEQ" size="6" type="STRING"/>
					<colinfo id="BLNUM" size="10" type="STRING"/>
					<colinfo id="BLNAM" size="50" type="STRING"/>
					<colinfo id="MESSG" size="50" type="STRING"/>
					<colinfo id="STATE" size="1" type="STRING"/>
					<colinfo id="SERIA" size="3" type="STRING"/>
					<colinfo id="ZITEM" size="50" type="STRING"/>
					<colinfo id="ZCHAR" size="50" type="STRING"/>
					<colinfo id="ZQUTY" size="5" type="STRING"/>
					<colinfo id="ZAMNT" size="15" type="STRING"/>
					<colinfo id="ZTOTL" size="15" type="STRING"/>
					<colinfo id="BIGO" size="50" type="STRING"/>
					<colinfo id="TEX1" size="200" type="STRING"/>
					<colinfo id="TEX2" size="200" type="STRING"/>
					<colinfo id="ADDT01" size="15" type="STRING"/>
					<colinfo id="SEQ" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_reject">
				<Contents>
					<colinfo id="QTNUM" size="256" type="STRING"/>
					<colinfo id="QTSER" size="256" type="STRING"/>
					<colinfo id="PSPID" size="256" type="STRING"/>
					<colinfo id="SEQ" size="256" type="STRING"/>
					<colinfo id="ZPRGFLG" size="256" type="STRING"/>
					<colinfo id="FINL" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list">
				<Contents>
					<colinfo id="QTNUM" size="256" summ="default" type="STRING"/>
					<colinfo id="QTSER" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSUM_ZCOST" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_days">
				<Contents>
					<colinfo id="DAYS" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Grid AutoEnter="TRUE" AutoFitEndLine="Hide" BindDataset="ds_check" BkColor2="default" BoldHead="true" Border="Flat" Bottom="552" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="240" Id="grd_check" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" OnCellClick="grd_check_OnCellClick" Right="968" RowHeight="20" Style="sty_grid" TabOrder="1" TabStop="true" Top="312" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="960">
			<contents>
				<format id="Default">
					<columns>
						<col fix="left" width="30"/>
						<col fix="left" width="30"/>
						<col fix="left" width="80"/>
						<col fix="left" width="30"/>
						<col fix="left" width="30"/>
						<col fix="left" width="60"/>
						<col fix="left" width="70"/>
						<col fix="left" width="140"/>
						<col width="30"/>
						<col width="30"/>
						<col width="50"/>
						<col width="50"/>
						<col width="120"/>
						<col width="70"/>
						<col width="30"/>
						<col width="70"/>
						<col width="78"/>
						<col width="43"/>
						<col width="76"/>
						<col width="81"/>
						<col width="69"/>
						<col width="67"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="No"/>
						<cell align="center" col="1" color="user21" display="text" font="굴림,9" rowspan="2" text="변경"/>
						<cell align="center" col="2" color="user21" display="text" font="굴림,9" rowspan="2" text="견적번호"/>
						<cell align="center" col="3" color="user21" display="text" font="굴림,9" rowspan="2" text="견적&#10;차수"/>
						<cell align="center" col="4" color="user21" display="text" font="굴림,9" rowspan="2" text="일련&#10;번호"/>
						<cell align="center" col="5" color="user21" display="text" font="굴림,9" rowspan="2" text="프로젝트"/>
						<cell align="center" col="6" color="user21" display="text" font="굴림,9" rowspan="2" text="호기"/>
						<cell align="center" col="7" color="user21" display="text" font="굴림,9" rowspan="2" text="기종"/>
						<cell align="center" col="8" color="user21" display="text" font="굴림,9" rowspan="2" text="구분"/>
						<cell align="center" col="9" color="user21" display="text" font="굴림,9" rowspan="2" text="순번"/>
						<cell align="center" col="10" color="user21" display="text" font="굴림,9" rowspan="2" text="항목"/>
						<cell align="center" col="11" color="user21" display="text" font="굴림,9" rowspan="2" text="블럭번호"/>
						<cell align="center" col="12" color="user21" display="text" font="굴림,9" rowspan="2" text="블럭명"/>
						<cell align="center" col="13" color="user21" display="text" font="굴림,9" rowspan="2" text="메시지"/>
						<cell align="center" col="14" color="user21" display="text" font="굴림,9" rowspan="2" text="상태"/>
						<cell align="center" col="15" color="user21" display="text" font="굴림,9" rowspan="2" text="사양"/>
						<cell align="center" col="16" color="user21" display="text" font="굴림,9" rowspan="2" text="단가"/>
						<cell align="center" col="17" color="user21" display="text" font="굴림,9" rowspan="2" text="수량"/>
						<cell align="center" col="18" color="user21" display="text" font="굴림,9" rowspan="2" text="금액"/>
						<cell align="center" col="19" color="user21" display="text" font="굴림,9" rowspan="2" text="소계"/>
						<cell align="center" col="20" color="user21" colspan="2" display="text" font="굴림,9" text="특기사항"/>
						<cell align="center" col="20" color="user21" display="text" font="굴림,9" row="1" text="영업"/>
						<cell align="center" col="21" color="user21" display="text" font="굴림,9" row="1" text="설계"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" display="text" expr="currow+1"/>
						<cell align="center" bkcolor2="user22" bkimageid='expr:gfn_getFlagBkImageID(getColumn(currow,&#32;&quot;FLAG&quot;))' col="1" colid="FLAG" display="image"/>
						<cell align="center" bkcolor2="user22" col="2" colid="QTNUM" display="text"/>
						<cell align="center" bkcolor2="user22" col="3" colid="QTSER" display="text"/>
						<cell align="center" bkcolor2="user22" col="4" colid="QTSEQ" display="text"/>
						<cell align="center" bkcolor2="user22" col="5" colid="PSPID" display="text"/>
						<cell align="center" bkcolor2="user22" col="6" colid="SEQ" display="text"/>
						<cell align="center" bkcolor2="user22" col="6" colid="POSID" display="text"/>
						<cell align="center" bkcolor2="user22" col="7" colid="ATYPE" display="text"/>
						<cell align="center" bkcolor2="user22" col="8" colid="GUBUN" display="text"/>
						<cell align="center" bkcolor2="user22" col="9" colid="SERIA" display="text"/>
						<cell align="center" bkcolor2="user22" col="10" colid="BLSEQ" display="text"/>
						<cell align="center" bkcolor2="user22" col="11" colid="BLNUM" display="text"/>
						<cell align="center" bkcolor2="user22" col="12" colid="BLNAM" display="text"/>
						<cell align="center" bkcolor2="user22" col="13" colid="MESSG" display="text"/>
						<cell align="center" bkcolor2="user22" col="14" colid="STATE" display="text"/>
						<cell align="center" bkcolor2="user22" col="15" colid="ZCHAR" display="text" edit="normal"/>
						<cell align="right" bkcolor2="user22" col="16" colid="ZAMNT" display="number" edit="masknumber" Mask="###,###,###,##0"/>
						<cell align="right" bkcolor2="user22" col="17" colid="ZQUTY" display="text" edit="integer"/>
						<cell align="right" bkcolor2="user22" col="18" colid="ZTOTL" display="number" Mask="###,###,###,##0"/>
						<cell align="right" bkcolor2="user22" col="19" colid="ADDT01" display="number" Mask="###,###,###,##0"/>
						<cell align="center" bkcolor2="user22" col="20" colid="TEX1" display="text"/>
						<cell align="center" bkcolor2="user22" col="21" colid="TEX2" display="text" edit="normal"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Color="user6" Font="굴림,9,Bold" Height="20" Id="st_item" Left="29" TabOrder="3" Text="부분원가&#32;관리" Top="292" VAlign="Middle" Width="91"></Static>
		<Image Height="19" Id="Image0" ImageID="form_bl_title_sub" Left="16" TabOrder="2" Top="290" Width="11"></Image>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_minus" ImageID="btn_icon_minus" Left="801" LeftMargin="12" Style="sty_btn" TabOrder="4" Top="290" Transparent="TRUE" Visible="FALSE" Width="22"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_plus" ImageID="btn_icon_plus" Left="777" LeftMargin="12" Style="sty_btn" TabOrder="5" Top="290" Transparent="TRUE" Visible="FALSE" Width="22"></Button>
		<Shape BKColor="user0" Bottom="34" Height="26" Id="Shape0" Left="8" LineColor="user1" Right="970" TabOrder="6" Top="8" Type="Rectangle" Width="962"></Shape>
		<Shape BKColor="user0" Bottom="60" Height="26" Id="Shape2" Left="8" LineColor="user1" Right="970" TabOrder="7" Top="34" Type="Rectangle" Width="962"></Shape>
		<Static Align="Right" Height="24" Id="Static0" Left="9" Style="sty_lb_search" TabOrder="8" Text="신청기간&#32;" Top="9" VAlign="Middle" Width="76"></Static>
		<Static Align="Right" Height="24" Id="st_pst" Left="331" Style="sty_lb_search" TabOrder="9" Text="차수&#32;" Top="34" VAlign="Middle" Width="76"></Static>
		<Static Align="Center" Border="None" Color="user7" Font="굴림,9" Height="20" Id="Static1" Left="197" TabOrder="10" Text="~" Top="12" VAlign="Middle" Width="18"></Static>
		<Static Align="Right" Height="24" Id="st_soym_fm" Left="9" Style="sty_lb_search" TabOrder="11" Text="견적번호&#32;" Top="34" VAlign="Middle" Width="76"></Static>
		<Calendar Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="PCAPID" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_cdate_fm" Left="89" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="12" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="11" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="108"></Calendar>
		<Calendar Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="PCAPID" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_cdate_to" Left="213" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="13" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="11" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="108"></Calendar>
		<Static Align="Right" Height="24" Id="Static2" Left="331" Style="sty_lb_search" TabOrder="15" Text="부서&#32;/&#32;팀&#32;" Top="9" VAlign="Middle" Width="76"></Static>
		<Div BKColor="user0" Height="21" Id="div_vbvg" Left="411" OnLoadCompleted="fn_OnLoadCompleted" TabOrder="14" Text="Div0" Top="11" Url="COM::Coms011.xml" Width="278">
			<Contents></Contents>
		</Div>
		<Static Align="Right" Height="24" Id="Static3" Left="696" Style="sty_lb_search" TabOrder="17" Text="담당자&#32;" Top="9" VAlign="Middle" Width="76"></Static>
		<Div BKColor="user0" Height="22" Id="div_sman" Left="776" OnLoadCompleted="fn_OnLoadCompleted" TabOrder="16" Text="Div0" Top="11" Url="COM::Coms002.xml" Width="184">
			<Contents></Contents>
		</Div>
		<Grid AutoEnter="TRUE" AutoFitEndLine="Hide" BindDataset="ds_header" BkColor2="default" BoldHead="true" Border="Flat" Bottom="280" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="216" Id="grd_header" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" OnCellClick="grd_header_OnCellClick" OnHeadClick="grd_header_OnHeadClick" Right="971" RowHeight="20" Style="sty_grid" TabOrder="18" TabStop="true" Top="64" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="963">
			<contents>
				<format id="Default">
					<columns>
						<col fix="left" width="30"/>
						<col fix="left" width="60"/>
						<col fix="left" width="80"/>
						<col fix="left" width="30"/>
						<col fix="left" width="70"/>
						<col fix="left" width="36"/>
						<col fix="left" width="70"/>
						<col width="170"/>
						<col width="100"/>
						<col width="100"/>
						<col width="160"/>
						<col width="70"/>
						<col width="70"/>
						<col width="40"/>
					</columns>
					<head>
						<cell col="0" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="No"/>
						</cell>
						<cell col="1" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="비고"/>
						</cell>
						<cell col="2" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="견적번호"/>
						</cell>
						<cell col="3" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="견적&#10;차수"/>
						</cell>
						<cell col="4" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="프로젝트"/>
						</cell>
						<cell col="5" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="차수"/>
						</cell>
						<cell col="6" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="신청일"/>
						</cell>
						<cell col="7" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="공사명"/>
						</cell>
						<cell col="8" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="진행상태"/>
						</cell>
						<cell col="9" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="부서"/>
						</cell>
						<cell col="10" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="팀"/>
						</cell>
						<cell col="11" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="담당자"/>
						</cell>
						<cell col="12" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="담당자명"/>
						</cell>
						<cell col="13" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="통화"/>
						</cell>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" display="text" expr="currow+1"/>
						<cell align="center" bkcolor2="user22" col="1" colid="BIGO" display="text"/>
						<cell align="center" bkcolor2="user22" col="2" colid="QTNUM" display="text"/>
						<cell align="center" bkcolor2="user22" col="3" colid="QTSER" display="text"/>
						<cell align="center" bkcolor2="user22" col="4" colid="VBELN" display="text"/>
						<cell align="center" bkcolor2="user22" col="5" colid="SEQ" display="text"/>
						<cell align="center" bkcolor2="user22" col="6" colid="CDATE" display="text" expr='iif(CDATE==&quot;00000000&quot;,&#32;&quot;&quot;,&#32;CDATE)' Mask="####-##-##"/>
						<cell align="center" bkcolor2="user22" col="7" colid="GSNAM" display="text"/>
						<cell align="center" bkcolor2="user22" col="8" colid="ZPRGFLG" combocol="CODE" combodataset="ds_zpstat" combodisplayrowcnt="20" combotext="CODE_NAME" display="combo"/>
						<cell align="center" bkcolor2="user22" col="9" colid="VKBUR" combocol="CODE" combodataset="ds_vkbur" combodisplayrowcnt="20" combotext="CODE_NAME" display="combo"/>
						<cell align="center" bkcolor2="user22" col="10" colid="VKGRP" combocol="CODE" combodataset="ds_vkgrp" combodisplayrowcnt="20" combotext="CODE_NAME" display="combo"/>
						<cell align="center" bkcolor2="user22" col="11" colid="ZKUNNR" display="text"/>
						<cell align="center" bkcolor2="user22" col="12" colid="ZKUNNR_NM" display="text"/>
						<cell align="center" bkcolor2="user22" col="13" colid="WAERK" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Edit Border="Flat" CheckLength="Byte" Height="20" Id="ed_qtnum" ImeMode="none" Left="89" LeftMargin="4" MaxLength="10" RightMargin="4" Style="sty_ipt_form" TabOrder="20" Top="37" UpperOnly="TRUE" Width="110"></Edit>
		<Edit Border="Flat" CheckLength="Byte" Height="20" Id="ed_qtser" ImeMode="none" Left="412" LeftMargin="4" MaxLength="5" Number="TRUE" RightMargin="4" Style="sty_ipt_search" TabOrder="19" Top="37" UpperOnly="TRUE" Width="100"></Edit>
		<Edit Border="Flat" CheckLength="Byte" Height="21" Id="ed_pjt" ImeMode="english" Left="777" MaxLength="10" OnCharChanged="ed_pjt_OnCharChanged" Style="sty_ipt_search" TabOrder="21" Top="36" UpperOnly="TRUE" Width="79"></Edit>
		<Button Cursor="HAND" Height="19" Id="btn_pjt" ImageID="btn_icon_search" Left="857" OnClick="ufn_openPjt" TabOrder="22" Top="37" Transparent="TRUE" Width="18"></Button>
		<Edit Border="Flat" CheckLength="Byte" Enable="FALSE" Height="21" Id="ed_pjtnm" ImeMode="english" Left="877" MaxLength="6" Style="sty_ipt_search" TabOrder="23" Top="36" UpperOnly="TRUE" Width="81"></Edit>
		<Static Align="Right" Height="24" Id="st_pspid" Left="696" Style="sty_lb_search" TabOrder="24" Text="프로젝트&#32;" Top="34" VAlign="Middle" Width="76"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_apply" ImageID="btn_sub_04" Left="896" LeftMargin="12" OnClick="btn_apply_OnClick" Style="sty_btn" TabOrder="25" Text="원가반영" Top="290" Transparent="TRUE" Width="72"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_reject" ImageID="btn_sub_04" Left="824" LeftMargin="12" OnClick="btn_reject_OnClick" Style="sty_btn" TabOrder="26" Text="요청반려" Top="290" Transparent="TRUE" Width="72"></Button>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :      
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::nsfRequest.js";	// 공통 스크립트 
#include "LIB::common_hdel.js";	// 공통 스크립트  /* GNY 추가 */
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================

var F_FORM_ID 	= "Ses0350";
var F_FRM_ID	= "Ses0350";
var F_FRM_TITLE = "부분원가 관리";	// 공통코드 화면명
var F_FLAG      = "Q";				// 'Q' : 견적반영, 'P' : 계약반영
var checkRow;

//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {

	gfn_initForm(false);// Form 로드 이벤트 맨 첫줄에 기술 
	fn_init_form(); 	// 폼 초기화
}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 1
********************************************************************************/
var fn_query_chk = false; //중복조회 방지용 flag

function fn_query()
{

	var arr = ['신청기간', '12'];
	if(gfn_getDayCnt(ds_days, cal_cdate_fm.Value, cal_cdate_to.Value) > 365) {
		gfn_showAlert("CW10087", arr);
		cal_cdate_fm.SetFocus();
		return false;
	}

	if(!fn_query_chk) {
		fn_query_chk = true;
	} else {
		gfn_showAlert("CW10025", "조회중입니다..");
		return;
	}

	btn_reject.Visible = false;
	btn_apply.Visible  = false;

	F_FLAG = "Q";

    fn_createWait("",this);     // 처리중입니다. 메시지 처리

	ds_check.ClearData();

	ds_cond.DeleteAll();
	ds_cond.AddRow();
	ds_cond.setColumn(0, "MANDT"     , G_MANDT                 );
	ds_cond.SetColumn(0, "FR_CDATE"  , cal_cdate_fm.Value      );
	ds_cond.SetColumn(0, "TO_CDATE"  , cal_cdate_to.Value      );
	ds_cond.SetColumn(0, "VKBUR"     , div_vbvg.cb_frvb.Value  );
	ds_cond.SetColumn(0, "VKGRP"     , div_vbvg.cb_frvg.Value  );
	ds_cond.SetColumn(0, "SMAN"      , div_sman.ed_sman_cd.Text);
	ds_cond.SetColumn(0, "QTNUM"     , ed_qtnum.Text			);
	ds_cond.SetColumn(0, "QTSER"     , ed_qtser.Text			);
	ds_cond.SetColumn(0, "PSPID"     , ed_pjt.Text				);
	
	nsfRequest(  "header"
			   , "ses0350/header"
			   , "ds_cond=ds_cond ds_header=ds_header"
			   , "ds_header=ds_header ds_error=ds_error"
			   , ""
			   , "fn_afterQuery"
			  );
}

/********************************************************************************
* 기      능   : 조회 2
********************************************************************************/
function fn_detail()
{
	if ( ds_header.GetRowCount() == 0 ) {
		return;
	}
	
	fn_createWait("",this);     // 처리중입니다. 메시지 처리

	/*var qtnum     = "";
	var qtser     = "0";
	var qtseq     = "0";
	var gubun     = "";

	ds_cond.ClearData();
	ds_cond.AddRow();
	ds_cond.SetColumn(0, "QTNUM"   , qtnum);
	ds_cond.SetColumn(0, "QTSER"   , qtser);
	ds_cond.SetColumn(0, "QTSEQ"   , qtseq);
	ds_cond.SetColumn(0, "GUBUN"   , gubun);
	ds_cond.SetColumn(0, "FR_QTDAT", cal_qtdat_fm.Value);
	ds_cond.SetColumn(0, "TO_QTDAT", cal_qtdat_to.Value);
	ds_cond.SetColumn(0, "VKBUR"   , div_vbvg.cb_frvb.Value  );
	ds_cond.SetColumn(0, "VKGRP"   , div_vbvg.cb_frvg.Value  );
	ds_cond.SetColumn(0, "ZKUNNR"  , div_sman.ed_sman_cd.Text);*/

	ds_cond.ClearData();
	ds_cond.AddRow();
	ds_cond.setColumn(0, "MANDT", G_MANDT);
	ds_cond.SetColumn(0, "QTNUM", grd_header.GetCellText("Body", grd_header.CurrentRow, 2));
	ds_cond.SetColumn(0, "QTSER", grd_header.GetCellText("Body", grd_header.CurrentRow, 3));
	ds_cond.SetColumn(0, "PSPID", grd_header.GetCellText("Body", grd_header.CurrentRow, 4));	// PSPID
	
	ds_list.ClearData();
	ds_list.AddRow();
	ds_list.setColumn(0, "MANDT", G_MANDT);
	ds_list.SetColumn(0, "QTNUM", grd_header.GetCellText("Body", grd_header.CurrentRow, 2));
	ds_list.SetColumn(0, "QTSER", grd_header.GetCellText("Body", grd_header.CurrentRow, 3));
	ds_list.SetColumn(0, "PSPID", grd_header.GetCellText("Body", grd_header.CurrentRow, 4));	// PSPID
	ds_list.SetColumn(0, "SEQ"  , grd_header.GetCellText("Body", grd_header.CurrentRow, 5));	// PSPID
	nsfRequest(  "queryZ309"
			   , "ses0031/searchZ309"
			   , "ds_cond=ds_cond ds_t309=ds_check"
			   , "ds_check=ds_t309 ds_error=ds_error"
			   , ""
			   , "fn_afterQuery"
			  );
}

/********************************************************************************
* 기      능   : 폼 초기화
********************************************************************************/
function fn_init_form() {
	btn_reject.Visible = false;
	btn_apply.Visible = false;
	cal_cdate_fm.Text = gfn_getCurrDate();
	cal_cdate_to.Text = gfn_getCurrDate();
	
	var codeArr    = ["SD107", "BS101", "BS102", "BS403", "CS115", "VKBUR", "VKGRP", "ZSHANG"]; 	//코드콤보 설정
	var dsObjArr   = [ds_zpstat, ds_zprgflg, ds_sukum, ds_zbdtyp, ds_zregn, ds_vkbur, ds_vkgrp, ds_shangh];
	var addTypeArr = [G_CODE_ALL];
	gfn_searchCommCode(codeArr, dsObjArr, addTypeArr);
}

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}

/********************************************************************************
* 기      능   : 저장
********************************************************************************/
function fn_save() {
    // 변경정보 확인
	var chk = 0;
	chk = fn_validCheck();
	if (chk == 0)	{
		gfn_showAlert("CW00005");
		return false;
	}
   
	// 원가팀의뢰 및 원가산출완료의 경우에만 처리 가능
	if (F_FLAG == "Q")	{
		if (ds_header.GetColumn(ds_header.currow, "ZPRGFLG") != "41" &&
			ds_header.GetColumn(ds_header.currow, "ZPRGFLG") != "42")	{
			gfn_showAlert("CW00114", "견적의 진행상태가 저장이");
			 return false;
		}
	}else	{	// 계약변경의 경우
		if (ds_header.GetColumn(ds_header.currow, "FINL") != "R" &&
			ds_header.GetColumn(ds_header.currow, "FINL") != "S")	{
			gfn_showAlert("CW00114", "계약변경 진행상태가 저장이");
			 return false;
		}
	}

	if (gfn_showConfirm("CI00008") == true) {

		if (ds_check.GetRowCount() > 0) {
			fn_createWait("",this);     // 처리중입니다. 메시지 처리
			nsfRequest( "saveZsdt1054"
					   , "ses0031/saveZsdt1054"
					   , "ds_check=ds_check"
					   , "ds_check=ds_check ds_error=ds_error"
					   , "f_flag=" + quote(F_FLAG)	// 견적 또는 계약변경 구분
					   , "fn_afterSave"
					   );
		} else if (ds_check.GetRowCount() == 0) {
			gfn_showAlert("CW10035", "저장할 자료");
		}
	}
}

/********************************************************************************
* 기      능   : 저장 Validation check
********************************************************************************/
function fn_validCheck()
{
	var checkCnt = 0;
	for (var i = 0; i < ds_check.GetRowCount(); i++)	{
		if (length(trim(ds_check.GetColumn(i, "FLAG"))) > 0)	{
			checkCnt++;
		}
	}
	
	return checkCnt;
}

/********************************************************************************
* 기      능   : 삭제 
********************************************************************************/
function fn_delete() {

	if (gfn_showConfirm("CI00015", "부분원가 정보") == true) {

		var cnt  = 0;
		var flag = "";

		for (var i=0; i<ds_check.GetRowCount(); i++) {
			flag = ds_check.GetColumn(i, "FLAG");
			if (flag=="I") cnt++;
		}

		if (cnt == ds_check.GetRowCount()) {
			gnf_showAlert("CW10035", "삭제할 자료");
		} else {
			fn_createWait("",this);     // 처리중입니다. 메시지 처리

			for (var i=0; i<ds_check.GetRowCount(); i++) {
				ds_check.SetColumn(i, "FLAG", "D");
			}

			nsfRequest(   "deleteZsdt1054"
						, "ses0031/saveZsdt1054"
						, "ds_check=ds_check"
						, "ds_check=ds_check ds_error=ds_error"
						, ""
						, "fn_afterSave"
					   );
		}
	}
}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(svcId, errCode, errMsg) {

	fn_query_chk = false; //중복조회 방지용 flag
	fn_destroyWait();

	if(ds_error.rowcount() > 0) {
		gfn_showMsg("CE00001");
		if (svcId == "exchange")	{
			gfn_showAlert("CW10025", "기준일자 : " + ds_header.GetColumn(ds_header.currow, "QTDAT") + "의 환율정보가 없습니다.");
			ds_exchange.ClearData();
		}else	{
			gfn_showAlert("CE00001");
		}
		return;
	} else {	 
		gfn_showMsg("CI00002", ds_check.RowCount() + "");
	}

	switch (svcId) {
		case "header" : fn_destroyWait();
						grd_header_OnCellClick();
						//trace(ds_header.savexml());
						//fn_detail();

						// 2013.02.20 START 원가산출 기준 변경에 따라 제거 &&&&&
						// var qtdat  = ds_header.GetColumn(0, "QTDAT");
						// var zyear  = Substr(qtdat,0,4);
						// var zmonth = Substr(qtdat,4,2);

						// ds_exchange.ClearData();
						// ds_exchange.AddRow();
						// ds_exchange.SetColumn(0, "MANDT" , G_MANDT);
						// ds_exchange.SetColumn(0, "ZYEAR" , zyear  );
						// ds_exchange.SetColumn(0, "ZMONTH", zmonth );
						// nsfRequest("exchange", "ses0031/searchExchange", "ds_exchange=ds_exchange", "ds_exchange=ds_exchange", "", "fn_afterQuery");

						// return;
						// 2013.02.20 START 원가산출 기준 변경에 따라 제거 &&&&&
						break;
						
/* -----< 2018.03.05 원가반영 버튼 클릭 시 환율 체크 로직 Service 호출 by mj.Shin 	Start 
		case "exchange"  : 
						   ds_exchange.SetColumn(0, "MANDT" , G_MANDT);
						   ds_exchange.SetColumn(0, "SDATE", ds_header.GetColumn(ds_header.currow, "QTDAT") );	// 견적은 견적일자, 계약은 수주등록일자
						   ds_exchange.SetColumn(0, "WAERK", ds_header.GetColumn(ds_header.currow, "WAERK"));
						   ds_exchange.SetColumn(0, "AUART", ds_header.GetColumn(ds_header.currow, "AUART"));
						   break;

		case "queryZ309" : 	// 2013.02.20 START 원가산출 기준 변경에 따라 추가 &&&&&	
							ds_exchange.ClearData();
							ds_exchange.AddRow();
							ds_exchange.SetColumn(0, "MANDT"  , G_MANDT);
							ds_exchange.SetColumn(0, "KURST"  , F_FLAG);	// 견적, 계약구분
							ds_exchange.SetColumn(0, "FCURR"  , ds_header.GetColumn(ds_header.currow, "WAERK") );
							ds_exchange.SetColumn(0, "TCURR"  , "KRW");		// 환산통화 : KRW 
							ds_exchange.SetColumn(0, "BASEDT" , ds_header.GetColumn(ds_header.currow, "QTDAT") );	// 견적은 견적일자, 계약은 수주등록일자
							
							nsfRequest("exchange", "ses0031/searchExchangeRate", "ds_exchange=ds_exchange", "ds_exchange=ds_exchange ds_error=ds_error", "", "fn_afterQuery");
							// 2013.02.20 END 원가산출 기준 변경에 따라 추가 &&&&&
						   break;
  -----> 2018.03.05 원가반영 버튼 클릭 시 환율 체크 로직 Service 호출 by mj.Shin 	End */

		default         : break;
	}
}

/********************************************************************************
* 기      능   : 저장 Callback
********************************************************************************/
function fn_afterSave(svcId, errCode, errMsg) {

	fn_destroyWait();

	if(ds_error.rowcount > 0)	{
		gfn_showAlert(ds_error.GetColumn(0,"ERRMSG"));
		return;
	}

	switch (svcId) {
		case "saveZsdt1054"   : 
			gfn_showAlert("CI00003"); 
			fn_query();
			break;
		case "deleteZsdt1054" : 
			gfn_showAlert("CI00004");
			fn_query(); 
			break;
		case "saveZuam"       :
		        nsfRequest(  "getZuam"
						   , "ses0350/getZuam"
						   , "ds_list=ds_list"
						   , "ds_list=ds_list ds_error=ds_error"
					       , "f_flag=" + quote(F_FLAG)	// 견적 및 계약변경 구분.
				           , "fn_afterSave"
				          );
				          
		case "saveHeaderFlag" : 
			gfn_showAlert("CI00005"); 
			fn_detail();
			break;
		case "saveZuamReject" : 				// 2013.04.25 원가산출반려 처리 후 조회정보에서는 제거
			gfn_showAlert("CI00005"); 
			fn_query();
			break;
	    case "getZuam" :
	    	btn_reject.Visible = false;		// 2013.04.25 원가산출반려
	    	
	    	var bfcost; var afcost; var bfqtnum; var afqtnum; var waerk; var bfvbeln;
			//부분원가반영이전 단가		
			bfqtnum = ds_header.GetColumn(ds_header.currow,"QTNUM");
			//bfvbeln = ds_header.GetColumn(ds_header.currow,"VBELN");
			bfcost  = ds_header.GetColumn(ds_header.currow,"ZSUM_ZCOST");
			waerk   = ds_header.GetColumn(ds_header.currow,"WAERK");
			//부분원가반영이후 단가
			for( i = 0 ; i < ds_list.GetRowCount(); i++ ){
			    afqtnum = ds_list.GetColumn(i,"QTNUM");
				afcost  = ds_list.GetColumn(i,"ZSUM_ZCOST");
			}
			if (F_FLAG = "P"){		//null 값 확인하기 
		     bfcost = toNumber(bfcost) * 100;
		     afcost = toNumber(afcost) * 100;
			 gfn_showAlert("CW10025", bfvbeln+"; ("+waerk+")"+bfcost+"에서 ("+waerk+")"+afcost+"로변경되었습니다");
			} else 
			 gfn_showConfirm("CW10025", bfqtnum+"; ("+waerk+")"+bfcost+"에서 ("+waerk+")"+afcost+"로변경되었습니다");
			}
			fn_detail();
			break;	
		default               ;
			break;
	}
}
/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {
	//cb_zpstat.index = 0;
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 : 각 Component 별 이벤트 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회
********************************************************************************/
function fn_OnClick_btn(obj) {
	var fncName = "fn_" + substr(obj.id, 4); 
	eval( fncName + "()");
}

/********************************************************************************
* 기      능   : 그리드 row 추가 2012.12.18 사용하지 않음 
********************************************************************************/
// function btn_plus_OnClick(obj) {

	// var qtnum = ds_check.GetColumn(ds_check.currow, "QTNUM");
	// var qtser = ds_check.GetColumn(ds_check.currow, "QTSER");
	// var seria = ds_check.Max("SERIA");
	// var searchRow = ds_check.searchRow("GUBUN == " + quote("2") + " && SERIA =="+quote(seria));

	// var newRow = gfn_addGridRow(grd_check, -1, "FLAG"); // 추가된 행번호 수신(FLAG:I) 

	// ds_check.SetColumn(newRow, "MANDT", G_MANDT);
	// ds_check.SetColumn(newRow, "QTNUM", qtnum  );
	// ds_check.SetColumn(newRow, "QTSER", qtser  );
	// ds_check.SetColumn(newRow, "QTSEQ", ds_check.GetColumn(searchRow, "QTSEQ"));
	// ds_check.SetColumn(newRow, "ATYPE", ds_check.GetColumn(searchRow, "ATYPE"));
	// ds_check.SetColumn(newRow, "GUBUN", ds_check.GetColumn(searchRow, "GUBUN"));
	// ds_check.SetColumn(newRow, "SERIA", ParseInt(seria)+1);
// }

/********************************************************************************
* 기      능   : 그리드 row 삭제 2012.12.18 사용하지 않음 
********************************************************************************/
// function btn_minus_OnClick(obj) {

	// var seria    = "";
	// var flag     = ds_check.GetColumn(ds_check.row, "FLAG" );
	// var delSeria = ds_check.GetColumn(ds_check.row, "SERIA");
	// var qtnum;
	// var qtseq;
	// var addt01;
	// var str1;
	// var searchRow;
	// var ztotlSum;

	// if (flag == "I") {

		// ds_check.SetColumn(ds_check.row, "ZAMNT" , 0);
		// ds_check.SetColumn(ds_check.row, "ZQUTY" , 0);
		// ds_check.SetColumn(ds_check.row, "ZTOTL" , 0);

		// addt01 = ds_check.GetColumn(ds_check.row, "ADDT01");

		// if (addt01 != null)	{

			// qtnum = ds_check.GetColumn(ds_check.row, "QTNUM");
			// qtseq = ds_check.GetColumn(ds_check.row, "QTSEQ");
			// str1  = "QTNUM == "+quote(qtnum)+" && QTSEQ == "+quote(qtseq) + " && currow !=" + quote(ds_check.row);
			// searchRow = ds_check.searchRow(str1);
			// ztotlSum  = ds_check.CaseSum(str1, "ZTOTL");

			// if (searchRow >0) ds_check.SetColumn(searchRow, "ADDT01", ztotlSum);
		// }
		// gfn_deleteGridRow(grd_check, ds_check.row, "FLAG");
	// }
	// if (flag=="D") ds_check.SetColumn(ds_check.row, "FLAG", "U");

	// for (var i=0; i<ds_check.GetRowCount(); i++) {

		// flag  = ds_check.GetColumn(i, "FLAG" );
		// seria = ds_check.GetColumn(i, "SERIA");

		// if (flag == "I" && seria > delSeria) {
			// ds_check.SetColumn(i, "SERIA", ParseInt(seria)-1);
		// }
	// }
// }

/********************************************************************************
* 기      능   : 데이터 셋 값 변경
********************************************************************************/
function ds_check_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex) {

	if (varNewValue != varOldValue) { 	// 값이 변경되었을 경우 변경구분 컬럼 자동 SET 

		var flag = ds_check.GetColumn(nRow, "FLAG");
		if (flag != "I" && flag != "D") 
			gfn_changeFlag(obj, strColumnID, nRow, "FLAG"); // FLAG 변경 : U

		if (strColumnID == "ZAMNT" || strColumnID == "ZQUTY") {

			var usd   = ds_exchange.GetColumn(0, "KRWUSD");
			var jpy   = ds_exchange.GetColumn(0, "KRWJPY");
			var eur   = ds_exchange.GetColumn(0, "KRWEUR");

			var zamnt = ds_check.GetColumn(nRow, "ZAMNT");
			var zquty = ds_check.GetColumn(nRow, "ZQUTY");
			var ztotl = ParseFloat(zamnt) * ParseFloat(zquty);

			// 부분원가는 원화로 등록 
			// switch (svcId) {
				// case "KRW" : break;
				// case "USD" : ztotl = Round(ParseFloat(ztotl) / ParseFloat(usd), 0); break;
				// case "JPY" : ztotl = Round(ParseFloat(ztotl) / ParseFloat(jpy), 0); break;
				// case "EUR" : ztotl = Round(ParseFloat(ztotl) / ParseFloat(eur), 0); break;
				// default    : break;
			// }

			ds_check.SetColumn(nRow, "ZTOTL", ztotl);
			
			var qtnum = ds_check.GetColumn(nRow, "QTNUM");
			var qtser = ds_check.GetColumn(nRow, "QTSER");
			var qtseq = ds_check.GetColumn(nRow, "QTSEQ");
			// 2012.12.18 프로젝트 및 호기 추가
			var pspid = ds_check.GetColumn(nRow, "PSPID");
			var posid = ds_check.GetColumn(nRow, "POSID");

			var str1 = "QTNUM == "+quote(qtnum)     + " && QTSER == "+quote(qtser) + " && QTSEQ == "+quote(qtseq) +
			           " && PSPID == "+quote(pspid) + " && POSID == "+quote(posid);

			var str2 = " && FLAG != "+quote("D");
			var str3 = " && Length(ADDT01) > 0";

			var searchRow = ds_check.searchRow(str1 + str2 + str3);

			if (searchRow < 0)
				searchRow = ds_check.searchRow(str1 + str2);

			if (searchRow < 0)
				searchRow = ds_check.searchRow(str1);

			var ztotlSum = Round(ds_check.CaseSum(str1 + str2, "ZTOTL"), 0);
			    ztotl    = ds_check.GetColumn(searchRow, "ADDT01");

			if (ztotl != ztotlSum) 
				ds_check.SetColumn(searchRow, "ADDT01", ztotlSum);
		}

		ds_check.SetColumn(nRow, "STATE", "W");
	}
}

/********************************************************************************
* 기      능   : 원가반영 버튼 클릭
********************************************************************************/
function btn_apply_OnClick(obj) 	{

/* -----< 2018.03.05 원가반영 버튼 클릭 시 환율 체크 로직 Service 호출 by mj.Shin 	Start 
	if (ds_exchange.GetRowCount() < 1)	{
		if (ds_header.GetColumn(ds_header.row, "WAERK") != "KRW") {
			gfn_showAlert("CW10025", "환율정보가 존재하지 않아 처리할 수 없습니다.");
			return;
		}
	}
// -----> 2018.03.05 원가반영 버튼 클릭 시 환율 체크 로직 Service 호출 by mj.Shin 	END */

	var cnt = 0;

	ds_apply.ClearData();

	var jRow = 0;

	for (var ii = 0; ii < ds_check.GetRowCount(); ii++)	{

		if (toNumber(ds_check.GetColumn(ii, "ADDT01")) > 0	)	{
			jRow = ds_apply.AddRow();
			ds_apply.CopyRow(jRow, "ds_check", ii);
			// 2012.12.19 계약변경의 차수 정보 Mapping
			ds_apply.SetColumn(jRow, "SEQ", ds_header.GetColumn(ds_header.currow, "SEQ"));
			
			cnt++;
		}
	}

	// 2013.01.18 원가가 0로 저장되는 경우도 존재한다고 함
	//if (cnt == 0)	{
	//	gfn_showAlert("CW10025", "반영할 부분원가 정보가 없습니다.");
	//	return;
	//}

	// 반영 전 저장되도록 처리 2013.02.13
	//var sAlterMsg = "";
	//   sAlterMsg += "저장 후 원가를 반영하여 주시기 바랍니다.";
	//	sAlterMsg += "\n저장을 하지 않으시면 부분원가가 반영되지 않습니다.";
	
	//gfn_showAlert("CW10025", sAlterMsg);

	if (gfn_showConfirm("CI00024", "부분원가 반영") == true) 	{

		fn_createWait("",this);     // 처리중입니다. 메시지 처리
		var kurst = F_FLAG;
		if (F_FLAG != "Q") {
			kurst = "M";
		}

// -----< 2018.03.05 원가반영 버튼 클릭 시 환율 체크 로직 Service 호출 by mj.Shin 	Start 
		ds_exchange.ClearData();
		ds_exchange.AddRow();
		ds_exchange.SetColumn(0, "MANDT"  , G_MANDT);
		ds_exchange.SetColumn(0, "KURST"  , kurst);		// 환율유형 = 견적(Q), 계약(M)
		ds_exchange.SetColumn(0, "FCURR"  , ds_header.GetColumn(ds_header.currow, "WAERK") );
		ds_exchange.SetColumn(0, "TCURR"  , "KRW");		// 환산통화 : KRW 
		ds_exchange.SetColumn(0, "BASEDT" , ds_header.GetColumn(ds_header.currow, "QTDAT") );	// 견적은 견적일자, 계약은 수주등록일자		
		ds_exchange.SetColumn(0, "AUART", ds_header.GetColumn(ds_header.currow, "AUART"));									
		
// -----< 2018.03.05 원가반영 버튼 클릭 시 환율 체크 로직 Service 호출 by mj.Shin 	End 
		
		nsfRequest(  "saveZuam"
				   , "ses0031/saveZuam"
				   , "ds_check=ds_check ds_apply=ds_apply ds_exchange=ds_exchange"
				   , "ds_check=ds_check ds_error=ds_error"
				   , "f_flag=" + quote(F_FLAG)	// 견적 및 계약변경 구분.
						+ " f_gsnam="+quote(ds_header.GetColumn(ds_header.currow, "GSNAM"))
				   , "fn_afterSave"
				  );
	}
}

/********************************************************************************
* 기      능   : 그리드 클릭시 상세 조회
********************************************************************************/
function grd_header_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	if(ds_header.GetRowCount() > 0)	{
		F_FLAG = "Q";	// 견적

		if(ds_header.GetColumn(nRow, "ZPRGFLG") == "41" ||
		   ds_header.GetColumn(nRow, "ZPRGFLG") == "42" )	{	// 원가산출요청 및 완료
		    btn_apply.Text     = "견적반영";
			btn_apply.Visible  = true;
			grd_check.Editable = true;
			// 2013.04.25 원가요청반려 기능 추가
			if (ds_header.GetColumn(nRow, "ZPRGFLG") == "41")	{
				btn_reject.Visible = true;		// 2013.04.25 원가요청반려
			}else	{
				btn_reject.Visible = false;		// 2013.04.25 원가요청반려
			}
		}else if (ds_header.GetColumn(nRow, "ZPRGFLG") == "90")	{		// 계약정보
			if (length(trim(ds_header.GetColumn(nRow, "VBELN"))) > 0 &&
				length(trim(ds_header.GetColumn(nRow, "SEQ"))) > 0)	{ 
				F_FLAG = "P";	// 계약
	
				if (ds_header.GetColumn(nRow, "FINL") == "R" ||
					ds_header.GetColumn(nRow, "FINL") == "S")	{		// 계약건중 원가요청 및 완료시에만 수정가능
					btn_apply.Text     = "계약반영";
					btn_apply.Visible  = true;
					grd_check.Editable = true;
					if (ds_header.GetColumn(nRow, "FINL") == "R")	{
						btn_reject.Visible = true;		// 2013.04.25 원가요청반려
					}else	{
						btn_reject.Visible = false;		// 2013.04.25 원가요청반려
					}
				}else	{
					btn_reject.Visible = false;		// 2013.04.25 원가요청반려
					btn_apply.Visible  = false;
					grd_check.Editable = false;
				}
			}else	{
				btn_reject.Visible = false;		// 2013.04.25 원가요청반려
				btn_apply.Visible  = false;
				grd_check.Editable = false;
			}
		}else	{
			btn_reject.Visible = false;		// 2013.04.25 원가요청반려
			btn_apply.Visible  = false;
			grd_check.Editable = false;
		}

		fn_detail();
	}
}

/********************************************************************************
* 기      능   : 정렬 처리 
********************************************************************************/
function grd_header_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	var content = grd_header.Contents;

	if( nCell == 0 ) 
		gfn_selectAllGrid(obj,nCell,nCell,true);
	else {
		gfn_sortGrid(obj, nCell);
		grd_header.Contents = content;
	}
}

function ufn_openPjt(obj)
{
	var arg = "pjt=" + quote(ed_pjt.Text);
	var arr = gfn_openPopup("CS9601002A",true,arg);
	
	if (arr != null && arr != 0) {
		ed_pjt.Text   = arr[0];
		ed_pjtnm.Text = arr[2];
	}
}

/******************************************************
// 프로젝트번호  변경시 명칭 clear처리
******************************************************/
function ed_pjt_OnCharChanged(obj,strPreText,strPostText)
{
	if (strPreText != strPostText)
		ed_pjtnm.Text = "";
}

/******************************************************
// 상세 그리드 - 견적번호 클릭할 때, GUBUN==1이면 [견적원가등록] 화면 호출
******************************************************/
function grd_check_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	if ( nCell == obj.GetBindCellIndex("Body", "QTNUM") ||	// 견적
		 nCell == obj.GetBindCellIndex("Body", "PSPID") ||	// 계약변경
	     nCell == obj.GetBindCellIndex("Body", "ZAMNT") )
	{
		if ( ds_check.GetColumn(nRow, "GUBUN") == "1" ) 
		{
			var qtnum = ds_check.GetColumn(nRow, "QTNUM");
			var qtser = ds_check.GetColumn(nRow, "QTSER");
			var qtseq = ds_check.GetColumn(nRow, "QTSEQ");
			var pspid = ds_check.GetColumn(nRow, "PSPID");
			var posid = ds_check.GetColumn(nRow, "POSID");

			grd_check.SetCellProp("Body", obj.GetBindCellIndex("Body", "ZAMNT"), "edit", "none" );

			checkRow = nRow;

			// 견적의 경우 호출
			if (F_FLAG == "Q")	{
				var arg = " fa_mandt = " + quote(G_MANDT) + 
						  " fa_qtnum = " + quote(qtnum)   + 
						  " fa_qtser = " + quote(qtser)  +
						  " fa_qtseq = " + quote(qtseq)   + 
						  " fa_part = part";
	
				gfn_openPopUpUrlHdel("SES::Ses0171.xml", true, arg);
			}else	{
				var arg = " fa_mandt = " + quote(G_MANDT) +
						  " fa_pspid = " + quote(pspid)   +
						  " fa_posid = " + quote(posid)   +
						  " fa_seq = "   + quote(ds_header.GetColumn(ds_header.currow, "SEQ")) +	// 계약차수
						  " fa_part = part";
	
				gfn_openPopUpUrlHdel("SES::Ses0355.xml", true, arg);
			}
		}else	{
			grd_check.SetCellProp("Body", obj.GetBindCellIndex("Body", "ZAMNT"), "edit", "masknumber" );
		}
	}
}

// [견적원가등록] 화면에서 저장 후 상세 재조회
function fn_query_detail(addt01)
{
	ds_check.SetColumn(checkRow, "ZQUTY" , 1     );
	ds_check.SetColumn(checkRow, "ZAMNT" , addt01);
	ds_check.SetColumn(checkRow, "ADDT01", addt01);
//	fn_detail();
}

// 2013.04.25 원가산출반려 
function btn_reject_OnClick(obj)
{
	ds_reject.ClearData();

	if (gfn_showConfirm("CI00024", "부분원가요청을 반려") == true) 	{

		fn_createWait("",this);     // 처리중입니다. 메시지 처리

		var nRow = ds_reject.AddRow();
		
		ds_reject.SetColumn(nRow, "QTNUM", ds_header.GetColumn(ds_header.currow, "QTNUM"));
		ds_reject.SetColumn(nRow, "QTSER", ds_header.GetColumn(ds_header.currow, "QTSER"));
		ds_reject.SetColumn(nRow, "PSPID", ds_header.GetColumn(ds_header.currow, "VBELN"));
		ds_reject.SetColumn(nRow, "SEQ",   ds_header.GetColumn(ds_header.currow, "SEQ"));

		var vAuart   = ds_header.GetColumn(ds_header.currow, "AUART");
		var vZprgflg = "20";	// 국내본팀, 해외 : 견적상태
		if ( vAuart == "ZS02" || vAuart == "ZJ02")	{	// 국내대리점의 경우
			vZprgflg = "31"; // 국내대리점 : 원가산출요청 
		}
		trace("++"+vZprgflg);
		ds_reject.SetColumn(nRow, "ZPRGFLG", vZprgflg);		// 견적상태
		ds_reject.SetColumn(nRow, "FINL",    " ");			// 부분원가의뢰상태 이전의 상태로 되돌림

		nsfRequest(  "saveZuamReject"
				   , "ses0031/saveZuamReject"
				   , "ds_reject=ds_reject"
				   , "ds_reject=ds_reject ds_error=ds_error"
				   , "f_flag=" + quote(F_FLAG)	// 견적 및 계약변경 구분.
				   , "fn_afterSave"
				  );
	}
}
]]></Script>
</Window>