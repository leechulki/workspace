<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="562" Id="PP0104001A" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="작업일보&#32;등록" Top="8" Ver="1.0" Width="978" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="WKDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="WKBCD" size="256" summ="default" type="STRING"/>
					<record>
						<WKBCD></WKBCD>
						<WKDAT></WKDAT>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_wkkcd_cd">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_wkbcd_cd">
				<Contents>
					<colinfo id="CODE" size="6" summ="default" type="STRING"/>
					<colinfo id="CODE2" size="30" summ="default" type="STRING"/>
					<colinfo id="CODE3" size="60" summ="default" type="STRING"/>
					<colinfo id="CODE4" size="60" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="60" summ="default" type="STRING"/>
					<colinfo id="CODE5" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE6" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_wktyp_cd">
				<Contents>
					<colinfo id="CODE" size="3" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="60" summ="default" type="STRING"/>
					<colinfo id="MEINS" size="9" summ="default" type="STRING"/>
					<colinfo id="TIMEE" size="12" summ="default" type="STRING"/>
					<colinfo id="TIMES" size="12" summ="default" type="STRING"/>
					<colinfo id="WKTIM" size="13" summ="default" type="DECIMAL"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_arbpl_cd">
				<Contents>
					<colinfo id="CODE" size="24" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="120" summ="default" type="STRING"/>
					<colinfo id="VERWE" size="12" summ="default" type="STRING"/>
					<colinfo id="WERKS" size="12" summ="default" type="STRING"/>
					<colinfo id="KTEXT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_block_cd">
				<Contents>
					<colinfo id="CODE" size="27" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="90" summ="default" type="STRING"/>
					<colinfo id="ITEM_NAM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zppdwkncd_cd">
				<Contents>
					<colinfo id="GUBUN1" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN2" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN1_TEXT" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN2_TEXT" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN1_NAM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list" OnColumnChanged="ds_list_OnColumnChanged" OnRowPosChanged="ds_list_OnRowPosChanged">
				<Contents>
					<colinfo id="ARBPL" size="24" type="STRING"/>
					<colinfo id="CAPCD" size="30" type="STRING"/>
					<colinfo id="CAPNM" size="105" type="STRING"/>
					<colinfo id="CR_ID" size="30" type="STRING"/>
					<colinfo id="CRDAT" size="24" type="STRING"/>
					<colinfo id="CRTIM" size="18" type="STRING"/>
					<colinfo id="FLAG" size="9" type="STRING"/>
					<colinfo id="TIMEE" size="12" type="STRING"/>
					<colinfo id="TIMES" size="12" type="STRING"/>
					<colinfo id="WKBCD" size="6" type="STRING"/>
					<colinfo id="WKDAT" size="24" type="STRING"/>
					<colinfo id="WKKCD" size="3" type="STRING"/>
					<colinfo id="WKMCD" size="30" type="STRING"/>
					<colinfo id="WKMNM" size="105" type="STRING"/>
					<colinfo id="WKTYP" size="3" type="STRING"/>
					<colinfo id="TSUM" size="256" type="DECIMAL"/>
					<colinfo id="COCHK" size="3" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list_a" OnColumnChanged="ds_list_w_OnColumnchanged">
				<Contents>
					<colinfo id="ARBPL" size="24" type="STRING"/>
					<colinfo id="BLOCK_NO" size="27" type="STRING"/>
					<colinfo id="FLAG" size="9" type="STRING"/>
					<colinfo id="WKBCD" size="6" type="STRING"/>
					<colinfo id="WKDAT" size="24" type="STRING"/>
					<colinfo id="WKHR" size="7" type="DECIMAL"/>
					<colinfo id="WKMCD" size="30" type="STRING"/>
					<colinfo id="POSID" size="72" type="STRING"/>
					<colinfo id="POST1" size="120" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list_b" OnColumnChanged="ds_list_w_OnColumnchanged">
				<Contents>
					<colinfo id="FLAG" size="9" summ="default" type="STRING"/>
					<colinfo id="NWKHR" size="7" summ="default" type="DECIMAL"/>
					<colinfo id="WKBCD" size="6" summ="default" type="STRING"/>
					<colinfo id="WKDAT" size="24" summ="default" type="STRING"/>
					<colinfo id="WKMCD" size="30" summ="default" type="STRING"/>
					<colinfo id="WKNCD" size="9" summ="default" type="STRING"/>
					<colinfo id="WKNCD_DTL" size="256" summ="default" type="STRING"/>
					<colinfo id="ARBPL" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_wkmcd_cd">
				<Contents>
					<colinfo id="CODE" size="30" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="160" summ="default" type="STRING"/>
					<colinfo id="ROLNM" size="60" summ="default" type="STRING"/>
					<colinfo id="WKMNM" size="60" summ="default" type="STRING"/>
					<colinfo id="WKBCD" size="256" summ="default" type="STRING"/>
					<colinfo id="WKBNM" size="256" summ="default" type="STRING"/>
					<colinfo id="ARBPL" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_maxdat">
				<Contents>
					<colinfo id="MAXDAT" size="256" summ="default" type="STRING"/>
					<colinfo id="WKBCD" size="256" summ="default" type="STRING"/>
					<colinfo id="WKDAT" size="256" summ="default" type="STRING"/>
					<record>
						<MAXDAT></MAXDAT>
						<WKBCD></WKBCD>
						<WKDAT></WKDAT>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zrmon">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user0" Bottom="30" Height="30" Id="Shape0" Left="0" LineColor="user1" Right="978" TabOrder="1" Top="0" Type="Rectangle" Width="978"></Shape>
		<Static Align="Right" Height="28" Id="st_date" Left="1" Style="sty_lb_search" TabOrder="2" Text="작업일&#32;" Top="1" VAlign="Middle" Width="96"></Static>
		<Grid AutoFitEndLine="Hide" BindDataset="ds_list" BkColor2="default" BoldHead="true" Border="Flat" Bottom="552" ColSizing="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="468" Id="grd_list" InputPanel="FALSE" Left="11" LineColor="user20" LineType="ExHORZ" OnCellPosChanged="grd_list_OnCellPosChanged" OnHeadClick="grd_list_OnHeadClick" Right="316" RowHeight="20" ScrollCell="true" Style="sty_grid" TabOrder="3" TabStop="true" Top="84" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="305">
			<contents>
				<format id="Default">
					<columns>
						<col width="25"/>
						<col width="102"/>
						<col width="75"/>
						<col width="83"/>
					</columns>
					<head>
						<cell bkimageid="icon_grid_sel" col="0" color="user21" display="text" font="굴림,9"/>
						<cell col="1" color="user21" display="text" font="굴림,9" text="작업반"/>
						<cell col="2" color="user21" display="text" font="굴림,9" text="사번"/>
						<cell col="3" color="user21" display="text" font="굴림,9" text="성명"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" bkimageid='expr:gfn_getFlagBkImageID(getColumn(currow,&#32;&quot;FLAG&quot;))' col="0" display="text"/>
						<cell align="left" bkcolor2="user22" col="1" colid="WKBCD" combocol="CODE" combodataset="ds_wkbcd_cd" combotext="CODE_NAME" display="combo" suppress="1"/>
						<cell align="center" bkcolor2="user22" col="2" colid="WKMCD" display="text"/>
						<cell bkcolor2="user22" col="3" colid="WKMNM" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Align="Right" Height="28" Id="st_wkbcd" Left="200" Style="sty_lb_search" TabOrder="4" Text="작업반&#32;" Top="1" VAlign="Middle" Width="96"></Static>
		<Combo BindDataset="ds_cond" Border="Flat" CodeColumn="CODE" Column="WKBCD" DataColumn="CODE5" Height="20" Id="cb_wkbcd" InnerDataset="ds_wkbcd_cd" Left="298" OnCharChanged="cb_wkbcd_OnChanged" Style="sty_ipt_search_ind" TabOrder="5" Top="4" Width="191"></Combo>
		<Grid AutoEnter="TRUE" AutoFitEndLine="Hide" BindDataset="ds_list_a" BkColor2="default" BoldHead="true" Border="Flat" Bottom="384" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="144" Id="grd_list_a" InputPanel="FALSE" Left="320" LineColor="user20" LineType="ExHORZ" OnCellClick="grd_OnCellClick" OnExpandEdit="grd_list_OnExpandEdit" OnExpandUp="grd_wbs_OnExpandUp" OnHeadClick="grd_list_OnHeadClick" Right="963" RowHeight="20" ScrollCell="true" Style="sty_grid" TabOrder="6" TabStop="true" Top="240" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="643">
			<contents>
				<format id="Default">
					<columns>
						<col width="25"/>
						<col width="65"/>
						<col width="154"/>
						<col width="65"/>
						<col width="129"/>
						<col width="76"/>
						<col width="92"/>
						<col width="180"/>
					</columns>
					<head>
						<cell bkimageid="icon_grid_sel" col="0" color="user21" display="text" font="굴림,9"/>
						<cell col="1" color="user21" display="text" font="굴림,9" text="Block&#32;No."/>
						<cell col="2" color="user21" display="text" font="굴림,9" text="Block&#32;No.&#32;명"/>
						<cell col="3" color="user21" display="text" font="굴림,9" text="규격"/>
						<cell col="4" color="user21" display="text" font="굴림,9" text="규격명"/>
						<cell col="5" color="user21" display="text" font="굴림,9" text="M/H"/>
						<cell col="6" color="user21" display="text" font="굴림,9" text="WBS"/>
						<cell col="7" color="user21" display="text" font="굴림,9" text="현장명"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" bkimageid='expr:gfn_getFlagBkImageID(getColumn(currow,&#32;&quot;FLAG&quot;))' col="0" display="text"/>
						<cell align="left" bkcolor2="user22" col="1" colid="BLOCK_NO" combocol="CODE" combodataset="ds_block_cd" combodisplayrowcnt="15" combotext="ITEM_NAM" display="combo" edit="normal" expandimage="btn_icon_post" expandshow="true" expandsize="18"/>
						<cell align="left" bkcolor2="user22" col="2" colid="BLOCK_NO" combocol="CODE" combodataset="ds_block_cd" combodisplayrowcnt="20" combotext="CODE_NAME" display="combo"/>
						<cell align="left" bkcolor2="user22" col="3" colid="ARBPL" combocol="CODE" combodataset="ds_arbpl_cd" combodisplayrowcnt="15" combotext="KTEXT" display="combo" edit="normal" expandimage="btn_icon_post" expandshow="true" expandsize="18"/>
						<cell align="left" bkcolor2="user22" col="4" colid="ARBPL" combocol="CODE" combodataset="ds_arbpl_cd" combodisplayrowcnt="20" combotext="CODE_NAME" display="combo"/>
						<cell align="right" bkcolor2="user22" col="5" colid="WKHR" display="text" edit="number"/>
						<cell align="left" bkcolor2="user22" col="6" colid="POSID" combodisplayrowcnt="20" display="text" edit="normal" expandimage="btn_icon_search" expandshow="true" expandsize="18"/>
						<cell align="left" bkcolor2="user22" col="7" colid="POST1" combodisplayrowcnt="20"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Height="24" Id="st_man" Left="11" Style="sty_lb_form_group" TabOrder="7" Text="&#32;작업자&#32;" Top="60" VAlign="Middle" Width="305"></Static>
		<Shape BKColor="user12" Bottom="160" Height="26" Id="Shape6" Left="320" LineColor="user13" Right="963" TabOrder="15" Top="134" Type="Rectangle" Width="643"></Shape>
		<Shape BKColor="user12" Bottom="135" Height="26" Id="Shape4" Left="320" LineColor="user13" Right="963" TabOrder="14" Top="109" Type="Rectangle" Width="643"></Shape>
		<Shape BKColor="user12" Bottom="110" Height="26" Id="Shape2" Left="320" LineColor="user13" Right="963" TabOrder="8" Top="84" Type="Rectangle" Width="643"></Shape>
		<Static Align="Right" Height="24" Id="st_wkdat" Left="321" Style="sty_lb_form_basic" TabOrder="10" Text="작업일자&#32;" Top="85" VAlign="Middle" Width="84"></Static>
		<Shape BKColor="user12" Bottom="185" Height="26" Id="Shape3" Left="320" LineColor="user13" Right="963" TabOrder="9" Top="159" Type="Rectangle" Width="643"></Shape>
		<Shape BKColor="user12" Bottom="210" Height="26" Id="Shape7" Left="320" LineColor="user13" Right="963" TabOrder="10" Top="184" Type="Rectangle" Width="643"></Shape>
		<Static Align="Right" Height="24" Id="st_wker" Left="321" Style="sty_lb_form_basic" TabOrder="11" Text="작업자&#32;" Top="110" VAlign="Middle" Width="84"></Static>
		<Static Align="Right" Height="24" Id="st_gutae" Left="321" Style="sty_lb_form_basic" TabOrder="12" Text="근태코드&#32;" Top="160" VAlign="Middle" Width="84"></Static>
		<Static Align="Right" Height="24" Id="st_wkhr" Left="321" Style="sty_lb_form_basic" TabOrder="13" Text="작업시간&#32;" Top="185" VAlign="Middle" Width="84"></Static>
		<Static Height="24" Id="st_si" Left="320" Style="sty_lb_form_group" TabOrder="17" Text="&#32;실작업&#32;내역" Top="214" VAlign="Middle" Width="643"></Static>
		<Static Height="24" Id="st_wk" Left="320" Style="sty_lb_form_group" TabOrder="18" Text="&#32;작업정보" Top="60" VAlign="Middle" Width="643"></Static>
		<Grid AutoEnter="TRUE" AutoFitEndLine="Hide" BindDataset="ds_list_b" BkColor2="default" BoldHead="true" Border="Flat" Bottom="552" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="144" Id="grd_list_b" InputPanel="FALSE" Left="320" LineColor="user20" LineType="ExHORZ" OnCellClick="grd_OnCellClick" OnExpandEdit="grd_list_OnExpandEdit2" OnHeadClick="grd_list_OnHeadClick" Right="963" RowHeight="20" ScrollCell="true" Style="sty_grid" TabOrder="19" TabStop="true" Top="408" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="643">
			<contents>
				<format id="Default">
					<columns>
						<col width="25"/>
						<col width="90"/>
						<col width="106"/>
						<col width="110"/>
						<col width="136"/>
						<col width="71"/>
						<col width="89"/>
					</columns>
					<head>
						<cell bkimageid="icon_grid_sel" col="0" color="user21" display="text" font="굴림,9"/>
						<cell col="1" color="user21" display="text" font="굴림,9" text="비작업&#32;코드(주)"/>
						<cell col="2" color="user21" display="text" font="굴림,9" text="비작업&#32;코드(부)"/>
						<cell col="3" color="user21" display="text" font="굴림,9" text="코드명(주)"/>
						<cell col="4" color="user21" display="text" font="굴림,9" text="코드명(부)"/>
						<cell col="5" color="user21" display="text" font="굴림,9" text="M/H"/>
						<cell col="6" color="user21" display="text" font="굴림,9" text="작업장"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" bkimageid='expr:gfn_getFlagBkImageID(getColumn(currow,&#32;&quot;FLAG&quot;))' col="0" display="text"/>
						<cell align="left" bkcolor2="user22" col="1" colid="WKNCD" combocol="GUBUN1" combodataset="ds_zppdwkncd_cd" combodisplayrowcnt="15" combotext="GUBUN1" display="normal" expandsize="18"/>
						<cell align="left" bkcolor2="user22" col="2" colid="WKNCD_DTL" combocol="GUBUN2" combodataset="ds_zppdwkncd_cd" combodisplayrowcnt="15" combotext="GUBUN1_NAM" display="combo" edit="normal" expandimage="btn_icon_post" expandshow="true" expandsize="18"/>
						<cell align="left" bkcolor2="user22" col="3" colid="WKNCD" combocol="GUBUN1" combodataset="ds_zppdwkncd_cd" combodisplayrowcnt="20" combotext="GUBUN1_TEXT" display="combo"/>
						<cell align="left" bkcolor2="user22" col="4" colid="WKNCD_DTL" combocol="GUBUN2" combodataset="ds_zppdwkncd_cd" combodisplayrowcnt="20" combotext="GUBUN2_TEXT" display="combo"/>
						<cell align="right" bkcolor2="user22" col="5" colid="NWKHR" display="text" edit="number"/>
						<cell align="left" bkcolor2="user22" col="6" colid="ARBPL" combocol="CODE" combodataset="ds_arbpl_cd" combodisplayrowcnt="15" combotext="KTEXT" display="combo" edit="normal" expandimage="btn_icon_post" expandshow="true" expandsize="18"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Height="24" Id="st_bi" Left="320" Style="sty_lb_form_group" TabOrder="20" Text="&#32;비작업&#32;내역" Top="386" VAlign="Middle" Width="643"></Static>
		<Button Cursor="HAND" Height="20" Id="bt_add_grd2" ImageID="btn_icon_plus" Left="909" LeftMargin="12" OnClick="bt_add_grd2_OnClick" Style="sty_btn" TabOrder="22" Top="388" Transparent="TRUE" Width="22"></Button>
		<Button Cursor="HAND" Height="20" Id="bt_del_grd2" ImageID="btn_icon_minus" Left="932" LeftMargin="12" OnClick="bt_del_grd2_OnClick" Style="sty_btn" TabOrder="21" Top="388" Transparent="TRUE" Width="22"></Button>
		<Button Cursor="HAND" Height="20" Id="bt_del_grd1" ImageID="btn_icon_minus" Left="932" LeftMargin="12" OnClick="bt_del_grd1_OnClick" Style="sty_btn" TabOrder="23" Top="216" Transparent="TRUE" Width="22"></Button>
		<Button Cursor="HAND" Height="20" Id="bt_add_grd1" ImageID="btn_icon_plus" Left="909" LeftMargin="12" OnClick="bt_add_grd1_OnClick" Style="sty_btn" TabOrder="24" Top="216" Transparent="TRUE" Width="22"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_delWk" ImageID="btn_sub_05" Left="98" LeftMargin="12" OnClick="btn_delWk_OnClick" Style="sty_btn" TabOrder="25" TabStop="FALSE" Text="작업자&#32;삭제" Top="35" Transparent="TRUE" Width="86"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_addWk" ImageID="btn_sub_05" Left="11" LeftMargin="12" OnClick="btn_addWk_OnClick" Style="sty_btn" TabOrder="26" TabStop="FALSE" Text="작업자&#32;생성" Top="35" Transparent="TRUE" Width="85"></Button>
		<Calendar BindDataset="ds_cond" Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="WKDAT" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_wkdat" Left="100" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" OnChanged="cal_wkdat_OnChanged" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_search_ind" SundayTextColor="user35" TabOrder="27" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="5" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="97"></Calendar>
		<Static Align="Right" Height="24" Id="st_wkban" Left="503" Style="sty_lb_form_basic" TabOrder="28" Text="작업반&#32;" Top="85" VAlign="Middle" Width="84"></Static>
		<Static Align="Right" Height="24" Id="st_wkjang" Left="738" Style="sty_lb_form_basic" TabOrder="29" Text="작업반장&#32;" Top="85" VAlign="Middle" Width="84"></Static>
		<Static Align="Right" Height="24" Id="st_wkplace" Left="321" Style="sty_lb_form_basic" TabOrder="30" Text="작업장&#32;" Top="135" VAlign="Middle" Width="84"></Static>
		<MaskEdit BindDataset="ds_list" BKColor="user0" Border="Flat" Column="WKDAT" Height="20" Id="md_wkdat" InputPanel="FALSE" Left="408" Mask="####.##.##" OnChanged="md_wkdat_OnChanged" Readonly="TRUE" Style="sty_ipt_form" TabOrder="31" Top="88" Type="STRING" Value="MaskEdit0" Width="92"></MaskEdit>
		<Edit BindDataset="ds_list" BKColor="user0" Border="Flat" Column="CAPNM" Height="20" Id="ed_capnm" ImeMode="english" Left="824" LeftMargin="4" MaxLength="100" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="32" TabStop="FALSE" Top="87" Width="108"></Edit>
		<Edit BindDataset="ds_list" BKColor="user0" Border="Flat" Column="WKMNM" Height="20" Id="ed_wkmnm" ImeMode="english" Left="490" LeftMargin="4" MaxLength="100" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="33" TabStop="FALSE" Top="112" Width="189"></Edit>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="WKKCD" DataColumn="CODE_NAME" Height="20" Id="cb_wkkcd" InnerDataset="ds_wkkcd_cd" Left="408" OnChanged="cb_wkkcd_OnChanged" Style="sty_ipt_form" TabOrder="34" Top="160" Width="159"></Combo>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="WKTYP" DataColumn="CODE_NAME" Height="20" Id="cb_wktyp" InnerDataset="ds_wktyp_cd" Left="407" OnChanged="cb_wktyp_OnChanged" Style="sty_ipt_form" TabOrder="35" Top="186" Width="159"></Combo>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="ARBPL" DataColumn="CODE_NAME" Editable="TRUE" Height="20" Id="cb_wkbcd1" InnerDataset="ds_arbpl_cd" Left="407" Style="sty_ipt_form" TabOrder="36" Top="136" Width="287"></Combo>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="WKBCD" DataColumn="CODE_NAME" Enable="FALSE" Height="20" Id="cb_wkbcdnm" InnerDataset="ds_wkbcd_cd" Left="613" Style="sty_ipt_form" TabOrder="37" Top="86" Width="123"></Combo>
		<Edit BindDataset="ds_list" BKColor="user0" Border="Flat" Column="WKBCD" Height="20" Id="Edit1" ImeMode="english" Left="592" LeftMargin="4" MaxLength="100" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="38" TabStop="FALSE" Top="87" Width="22"></Edit>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="WKTYP" DataColumn="MEINS" Enable="FALSE" Height="20" Id="Combo1" InnerDataset="ds_wktyp_cd" Left="794" Style="sty_ipt_form" TabOrder="39" Top="186" Width="51"></Combo>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="WKTYP" DataColumn="WKTIM" Enable="FALSE" Height="20" Id="cb_wktim" InnerDataset="ds_wktyp_cd" Left="702" Style="sty_ipt_form" TabOrder="40" Top="186" Width="91"></Combo>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="WKTYP" DataColumn="TIMES" Enable="FALSE" Height="20" Id="cb_times" InnerDataset="ds_wktyp_cd" Left="567" Style="sty_ipt_form" TabOrder="41" Top="186" Width="67"></Combo>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="WKTYP" DataColumn="TIMEE" Enable="FALSE" Height="20" Id="cb_timee" InnerDataset="ds_wktyp_cd" Left="634" Style="sty_ipt_form" TabOrder="42" Top="186" Width="67"></Combo>
		<Combo BindDataset="ds_list" Border="Flat" CodeColumn="CODE" Column="WKMCD" DataColumn="CODE_NAME" Enable="FALSE" Height="20" Id="cb_wkmcd" InnerDataset="ds_wkmcd_cd" Left="408" OnChanged="cb_wkmcd_OnChanged" Style="sty_ipt_form" TabOrder="43" Top="112" Width="81"></Combo>
	</Form>
	<Script><![CDATA[﻿﻿﻿﻿﻿﻿/*
 ******************************************************************************************
 * 기      능   : 생산 작업반 반장이 작업시간을 등록 관리
 * 작  성  자   : 
 * 작성  일자   : 2011.01.06
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================

//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	// Form 로드 이벤트 맨 첫줄에 기술 
	gfn_initForm();
	// 현재 조회 일자 설정 
	cal_wkdat.value = gfn_getCurrDate();

	tit_clearActionInfo();

	tit_addSearchActionInfo("pp01:PP0104001A_S1");
	tit_addSearchActionInfo("pp01:PP0104001A_S2");
	tit_addSearchActionInfo("pp01:PP0104001A_S3");
	tit_addSearchActionInfo("pp01:PP0104001A_S4");
	tit_addSearchActionInfo("pp01:PP0104001A_S5");
	tit_addSearchActionInfo("pp01:PP0104001A_S11");

	tit_callService(
        ""
        , ""
        , ""
        , "ds_wkkcd_cd=ds_wkkcd_cd ds_wkbcd_cd=ds_wkbcd_cd ds_wktyp_cd=ds_wktyp_cd ds_arbpl_cd=ds_arbpl_cd ds_block_cd=ds_block_cd ds_zppdwkncd_cd=ds_zppdwkncd_cd"
        , ""
        , "fn_afterCombo"
        , true
        , true);
	
	gfn_showMsg("CI00007");
}

function fn_afterCombo()
{
	//  작업반 설정 
	cb_wkbcd.Index = ds_wkbcd_cd.RowCount;	

	//  작업반장 설정 
	cb_wkmcd.Index = ds_wkbcd_cd.RowCount;	

	ds_wktyp_cd.insertRow(0);
	ds_wktyp_cd.setColumn(0, "CODE", "");
	ds_wktyp_cd.setColumn(0, "CODE_NAME", "");
	ds_wktyp_cd.setColumn(0, "MEINS", "");
	ds_wktyp_cd.setColumn(0, "TIMEE", "");
	ds_wktyp_cd.setColumn(0, "TIMES", "");
	ds_wktyp_cd.setColumn(0, "WKTIM", 0);
}
/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {
}
/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}
//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================

/********************************************************************************
* 기      능   : 조회
********************************************************************************/
function fn_query() {
	// 필수 입력사항 및 일자 체크 
	if ( gfn_isNull(cal_wkdat, true) ) {
		gfn_showMsg("CW00001","조회일자");
		return;
	}
	
	if ( gfn_isNull(cb_wkbcd, true) ) {
		gfn_showMsg("CW00001","작업반");
		return;
	}	
	
	ds_list.ClearData();
	ds_list_a.ClearData();
	ds_list_b.ClearData();
	
	// sort mark 삭제 
	gfn_clearGridSortMark(grd_list);
	

	tit_clearActionInfo();

	tit_addSearchActionInfo("pp01:PP0104001A_S6");	
	tit_addSearchActionInfo("pp01:PP0104001A_S7");	
	tit_addSearchActionInfo("pp01:PP0104001A_S8");	
	tit_addSearchActionInfo("pp01:PP0104001A_S9");	
	tit_addSearchActionInfo("pp01:PP0104001A_S12");	
	
	//trace(ds_cond.savexml());
	tit_callService(
		""
		, ""
		, "ds_cond=ds_cond"
		, "ds_list=ds_list ds_list_a=ds_list_a ds_list_b=ds_list_b ds_wkmcd_cd=ds_wkmcd_cd ds_zrmon=ds_zrmon"
		, ""
		, "fn_afterQuery"
		, true);

}

/********************************************************************************
* 기      능   : 작업일보 등록
********************************************************************************/
function fn_save() {
    // Message 영역 초기화
	global.FRM_BOTTOM.img_msgType.imageId = "";
	global.FRM_BOTTOM.st_msg.value = "";
			
	//월 마감시 비활성화 
	if ( ds_zrmon.GetColumn(0,"CODE") == "X"  ) {
		gfn_showAlert("CW10025", "당월 마감으로 저장 불가");
		return;
	}
	
    //변경값 확인
	if ( !gfn_isChangeDs(ds_list, false) && !gfn_isChangeDs(ds_list_a, false)  && !gfn_isChangeDs(ds_list_b, false)) {
		gfn_showAlert("CW00005");
		return;
	}
    // 조건변경값 확인
	if ( gfn_isChangeDs(ds_cond, false) ) {
		gfn_showAlert("CW00056");
		return;
	}
	
	
	
	//  데이터 check
	for (var i =0; i < ds_list.rowcount; i++)
	{
	    if (ds_list.GetColumn(i,"FLAG") != "D")
		{
		//trace(ds_list.GetColumn(i, "WKMNM"));
		//trace(length(ds_list.GetColumn(i,"FLAG")));
		//trace(parseFloat(ds_list.GetColumn(i, "TSUM")));
	    //trace(parseFloat(ds_wktyp_cd.GetColumn(ds_wktyp_cd.FindRow("CODE",ds_list.GetColumn(i, "WKTYP")),"WKTIM")));
	    
		// 승인 이후는 수정 금지 2012.10.22 hss
		if (length(ds_list.GetColumn(i,"FLAG")) > 0 && ds_list.GetColumn(i,"COCHK") == "X")
		{
			gfn_showAlert("CW00240", "[ "+ds_list.GetColumn(i,"WKMNM") + " ]");
			ds_list.rowpos = i;
			return;
		}
		if (length(ds_list.GetColumn(i,"FLAG")) > 0 && ds_list.GetColumn(i,"FLAG") != "D")
		{
			if(length(ds_list.GetColumn(i,"WKMCD")) < 1 || length(ds_list.GetColumn(i,"WKMNM")) < 1)
			{
				gfn_showAlert("CW00001","작업자");
				ds_list.rowpos = i;
				return;
			}
			if(length(ds_list.GetColumn(i,"ARBPL")) < 1)
			{
				gfn_showAlert("CW00001","작업장");
				ds_list.rowpos = i;
				return;
			}
			if(length(ds_list.GetColumn(i,"WKKCD")) < 1 && length(ds_list.GetColumn(i,"WKTYP")) < 1)
			{
				gfn_showAlert("CW00001","작업시간 유형");
				ds_list.rowpos = i;
				return;
			} 
			 //근태코드 입력 시 작업시간 입력되면 경고 20.04.23
			if(length(ds_list.GetColumn(i,"WKKCD")) > 1 && length(ds_list.GetColumn(i,"WKTYP")) > 1)
			{
			    gfn_showAlert("CW10025", "근태코드 입력시 작업시간 입력 불가");
				ds_list.rowpos = i;
				return;
			}
			//작업시간 <>  실작업 + 비작업 경고 20.04.23
			if(parseFloat(ds_list.GetColumn(i, "TSUM")) <> parseFloat(ds_wktyp_cd.GetColumn(ds_wktyp_cd.FindRow("CODE",ds_list.GetColumn(i, "WKTYP")),"WKTIM")))
			{
			    //trace(parseFloat(ds_list.GetColumn(i, "TSUM")));
			    //trace(parseFloat(ds_wktyp_cd.GetColumn(ds_wktyp_cd.FindRow("CODE",ds_list.GetColumn(i, "WKTYP")),"WKTIM")));
			    gfn_showAlert("CW10025", ds_list.GetColumn(i, "WKMNM") + " / 작업 입력시간과  M/H 전체 합계 불일치 합니다.");
				ds_list.rowpos = i;
				return;
			}
			//작업시간 정상근무 
			if( ds_list.GetColumn(i,"WKTYP") = "8" ) {
				for (var j =0; j < ds_list_a.rowcount; j++)				{			
				    //블럭 입력 누락시 경고 20.04.24
					if( length(ds_list_a.GetColumn(j,"block_no")) < 1)  {
						gfn_showAlert("CW10025", ds_list.GetColumn(i, "WKMNM") + " / BLOCK NO나 BLOCK 명이 누락되었습니다.");
						ds_list.rowpos = i;
						return;
					}
				}
			}
		}
		/* 로직이 이상함  160929 jsw
		if (parseFloat(ds_list.GetColumn(i, "TSUM"))  > 0 && (parseFloat(ds_list.GetColumn(i, "TSUM")) != parseFloat(ds_wktyp_cd.GetColumn(ds_wktyp_cd.FindRow("CODE",ds_list.GetColumn(i,"WKTYP")),"WKTIM"))
		         || (ds_list.GetColumn(i, "WKKCD") != "" && ds_list.GetColumn(i, "WKKCD") != "Z")))
		{
			gfn_showAlert("CW00230","["+st_man+" : "+ds_list.GetColumn(i, "WKMNM")+"] ");
			ds_list.rowpos = i;
			return;
		}*/
		var lv_wkdate = gfn_getWorkingDate_pp(0,"1000",ds_list.GetColumn(0,"WKDAT"));
		//trace("!!"+lv_wkdate);
		//trace(ds_list.savexml());
		//trace("!"+gfn_getWorkingDate(0,"1000",ds_list.GetColumn(0,"WKDAT")));
		
		if ( ds_list.GetColumn(0,"WKTYP") == "1" || ds_list.GetColumn(0,"WKTYP") == "3" || 
		     ds_list.GetColumn(0,"WKTYP") == "4" || ds_list.GetColumn(0,"WKTYP") == "A"   ) {
			gfn_showAlert("CW10025", "작업시간유형 1, 3, 4, A 입력 불가");
			return;
			
		} else if ( ds_list.GetColumn(0,"WKTYP") == "5" || ds_list.GetColumn(0,"WKTYP") == "6" || 
		            ds_list.GetColumn(0,"WKTYP") == "B" || ds_list.GetColumn(0,"WKTYP") == "F"   ) {  //"5주말특근 F토일철야 : 평일엔 입력 불가
		            			
		    if ( ds_list.GetColumn(0,"WKDAT") == lv_wkdate ) { //작업일이 워킹데이이면 
				gfn_showAlert("CW10025", "주중에 주말 작업시간유형 5, 6, B, F 입력 불가");
				return;
	        }
		} else {
			if ( ds_list.GetColumn(0,"WKDAT") != lv_wkdate ) { //작업일이 워킹데이가 아니면 
				gfn_showAlert("CW10025", "주말에 주중 작업시간유형 2, 7, 8, 9, C, D, E 입력 불가");
				return;
	        }
		}
		}
	}	

	var wkbcd_check = "08|10";
	for (var i =0; i < ds_list_a.rowcount; i++)
	{
		if (ds_list_a.GetColumn(i,"FLAG") != "D")
		{
			if(length(ds_list_a.GetColumn(i,"BLOCK_NO")) < 1)
			{
				gfn_showAlert("CW00001","BLOCK_NO");
				ds_list.rowpos = ds_list.FindRow("WKMCD",ds_list_a.GetColumn(i,"WKMCD"));
				return;
			}
			if(length(ds_list_a.GetColumn(i,"ARBPL")) < 1)
			{
				gfn_showAlert("CW00001","작업장");
				ds_list.rowpos = ds_list.FindRow("WKMCD",ds_list_a.GetColumn(i,"WKMCD"));
				return;
			}
			
			//  특정 작업반의 경우 wbs 필수 입력  2012.10.22 hss
			if(IndexOf(wkbcd_check,ds_list_a.GetColumn(i,"WKBCD")) > 0 && length(ds_list_a.GetColumn(i,"POSID")) < 1)
			{
				gfn_showAlert("CW00241","[ "+ds_list.GetColumn(ds_list.FindRow("WKMCD",ds_list_a.GetColumn(i,"WKMCD")),"WKMNM") + " ]");
				ds_list.rowpos = ds_list.FindRow("WKMCD",ds_list_a.GetColumn(i,"WKMCD"));
				return;
			}
		}
	}	


	for (var i =0; i < ds_list_b.rowcount; i++)
	{
		if (ds_list_b.GetColumn(i,"FLAG") != "D")
		{
			if(length(ds_list_b.GetColumn(i,"WKNCD")) < 1)
			{
				gfn_showAlert("CW00001","비작업 코드");
				ds_list.rowpos = ds_list.FindRow("WKMCD",ds_list_b.GetColumn(i,"WKMCD"));
				return;
			}
		}
	}	
	
	
     // 자료가 없으면 리턴
	if (ds_list.rowcount < 1){
		gfn_showAlert("CW00010");
		return;
	}

	
	if (!gfn_showConfirm("CI00010")) {
		return;
	}


	tit_clearActionInfo();

	// 저장 처리 
	tit_addSaveActionInfo(
	"pp01:PP0104001A_I1"
	, "pp01:PP0104001A_U1"
	, "pp01:PP0104001A_D1"
	, "FLAG"
	, ""
	, -1
	, "");
	
	tit_addSaveActionInfo(
	"pp01:PP0104001A_I2"
	, "pp01:PP0104001A_U2"
	, "pp01:PP0104001A_D2"
	, "FLAG"
	, ""
	, -1
	, "");

	tit_addSaveActionInfo(
		"pp01:PP0104001A_I3"
		, "pp01:PP0104001A_U3"
		, "pp01:PP0104001A_D3"
		, "FLAG"
		,""
		, 0
		, "");


//	tit_showDs(ds_list);
	// 저장 처리 
    //trace(ds_list.savexml());
    //trace(ds_list_a.savexml());
    //trace(ds_list_b.savexml());
	tit_callService(
		""
		, ""
		, "ds_cond=ds_cond ds_list=ds_list:A ds_list_a=ds_list_a:A ds_list_b=ds_list_b:A"
		, ""
		, ""
		, "fn_afterSave");
}


/********************************************************************************
* 기      능   : 취소  
********************************************************************************/
function fn_cancel() {
	ds_list.reset();
	ds_list_a.reset();
	ds_list_b.reset();
}



/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}
/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {
	gfn_exportExcel(grd_list, G_USER_ID );
}
//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	// 메시지 처리 
	gfn_showSearchMsg(grd_list, errCode, errMsg);
    
	if (errCode == 0 && ds_list.RowCount() > 0)
	{
		btn_addWk.Enable = true;
		btn_delWk.Enable = true;
				
		ds_list.row = 0;
		ds_list_a.Filter("WKMCD == "+quote(ds_list.GetColumn(0,"WKMCD")));
		ds_list_b.Filter("WKMCD == "+quote(ds_list.GetColumn(0,"WKMCD")));
				
		set_Tsum();
		
		ds_wkmcd_cd.AddRow();
	}	
	//trace(ds_list.savexml());
		//  데이터 check
	for (var i =0; i < ds_list.rowcount; i++)
	{
	    if (ds_list.GetColumn(i,"FLAG") != "D")
		{	    
		    //trace(parseFloat(ds_list.GetColumn(i, "TSUM")));
			//trace(parseFloat(ds_wktyp_cd.GetColumn(ds_wktyp_cd.FindRow("CODE",ds_list.GetColumn(i, "WKTYP")),"WKTIM")));
			
			//작업시간 <>  실작업 + 비작업 경고 20.04.23						
			if(parseFloat(ds_list.GetColumn(i, "TSUM")) <> parseFloat(ds_wktyp_cd.GetColumn(ds_wktyp_cd.FindRow("CODE",ds_list.GetColumn(i, "WKTYP")),"WKTIM")))
			{
			    //trace(parseFloat(ds_list.GetColumn(i, "TSUM")));
			    //trace(parseFloat(ds_wktyp_cd.GetColumn(ds_wktyp_cd.FindRow("CODE",ds_list.GetColumn(i, "WKTYP")),"WKTIM")));
			    gfn_showAlert("CW10025", ds_list.GetColumn(i, "WKMNM") + " / 작업 입력시간과  M/H 전체 합계 불일치 합니다.");
				ds_list.rowpos = i;
				return;
			}
			//작업시간 정상근무 
			if( ds_list.GetColumn(i,"WKTYP") = "8" ) 
			{
				for (var j =0; j < ds_list_a.rowcount; j++)				
				{			
				    //블럭 입력 누락시 경고 20.04.24
					if( length(ds_list_a.GetColumn(j,"block_no")) < 1)  
					{
						gfn_showAlert("CW10025", ds_list.GetColumn(i, "WKMNM") + " /BLOCK NO나 BLOCK 명이 누락되었습니다.");
						ds_list.rowpos = i;
						return;
					}
				}
			}
		}
	}
	
	if (ds_list.RowCount() == 0)
	{
	    //btn_addWk.Enable = false;
		//btn_delWk.Enable = false;
		
		tit_clearActionInfo();
	
		tit_addSearchActionInfo("pp01:PP0104001A_S10");	
		
		tit_callService(
			""
			, ""
			, "ds_cond=ds_cond"
			, "ds_maxdat=ds_maxdat"
			, ""
			, "fn_afterMaxQuery"
			, true);		
	}
	
	//trace(ds_zrmon.savexml());
	//월 마감시 비활성화 
	if ( ds_zrmon.GetColumn(0,"CODE") == "X"  ) {
		btn_addWk.Enable = false;
		btn_delWk.Enable = false;
	}
		
}

// 최근 저장 일자 조회 후 복사 처리
function fn_afterMaxQuery(errCode, errMsg) {
	if (errCode == 0 && ds_maxdat.RowCount() > 0)
	{	    
		var arr = "fa_wkdat=" + quote(gfn_formatDate(ds_maxdat.GetColumn(0,"WKDAT"))) +" fa_maxdat=" + quote(ds_maxdat.GetColumn(0,"MAXDAT"));

		if (length(ds_maxdat.GetColumn(0,"MAXDAT")) > 0 && gfn_openPopup("PP0104001B",true, arr) == "Y")
		{ 
			// 이전 데이터 복사 처리
			tit_clearActionInfo();
			
			tit_addMultiActionInfo("pp01:PP0104001A_I4");
			tit_addMultiActionInfo("pp01:PP0104001A_I5");
			tit_addMultiActionInfo("pp01:PP0104001A_I6");
			tit_callService(
			 ""
			, ""
			, "ds_maxdat=ds_maxdat:A"
			, ""
			, ""
			, "fn_afterCopy"
			, "");
			
		}		
	}
	
}


// 복사후 조회
function fn_afterCopy(errCode, errMsg) {
	if (errCode == 0)
	{   
	    fn_query();
	}	
}



/********************************************************************************
* 기      능   : 저장 Callback  
********************************************************************************/
function fn_afterSave(errCode, errMsg) {
	if ( errCode!= 0 ) {
		gfn_showMsg("CE00001");
	} else {
		gfn_showMsg("CI00003");
		fn_query();
	}
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
// 사용자 정의 함수는 ufn_xxxx() 형태로 작성 
//=========================================================================================

//=========================================================================================
// [ PART 6 ]
// component Event 정의 : 각 Component 별 이벤트 
//=========================================================================================

/********************************************************************************
* 기      능   : 그리드 헤더 클릭시 정렬 처리 
********************************************************************************/
function grd_list_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	if ( nCell == 0 ) 
	{
		gfn_selectGridCol(obj);
	} 
	else if ( nCell > 1 ) 
	{
		gfn_sortGrid(obj, nCell);
	}
}


//작업자 추가
function btn_addWk_OnClick(obj)
{
    //trace("!!"+cb_wkbcd.Value);
    //trace(ds_wkbcd_cd.FindRow("CODE",cb_wkbcd.value));
    //trace(ds_wkbcd_cd.savexml());
    //ds_wkbcd_cd.FindRow("CODE",cb_wkbcd.value);
	ds_list.fireevent = false;
	ds_list.AddRow();
	ds_list.SetColumn(ds_list.rowpos,"FLAG","I");
	ds_list.SetColumn(ds_list.rowpos,"WKDAT",ds_cond.GetColumn(0,"WKDAT")); //ds_list.GetColumn(ds_cond.pos-1,"WKDAT")); 2020.04.27
	ds_list.SetColumn(ds_list.rowpos,"WKBCD",ds_wkbcd_cd.GetColumn(ds_wkbcd_cd.FindRow("CODE",cb_wkbcd.value),"CODE"));  //ds_list.GetColumn(ds_list.rowpos-1,"WKBCD"));
	ds_list.SetColumn(ds_list.rowpos,"CAPCD",ds_wkbcd_cd.GetColumn(ds_wkbcd_cd.FindRow("CODE",cb_wkbcd.value),"CODE_NAME"));
	ds_list.SetColumn(ds_list.rowpos,"CAPNM",ds_wkbcd_cd.GetColumn(ds_wkbcd_cd.FindRow("CODE",cb_wkbcd.value),"CODE3"));
	cb_wkmcd.Enable = true;
	ds_list.fireevent = true;
		
	grd_list_OnCellPosChanged(obj,ds_list.rowpos);
}


// 작업자 삭제
function btn_delWk_OnClick(obj)
{
	ds_list.fireevent = false;
	if (ds_list.GetColumn(ds_list.rowpos,"FLAG") == "I")
	{
		ds_list.DeleteRow(ds_list.rowpos);
		ds_list.fireevent = true;
	} else {
		ds_list.SetColumn(ds_list.rowpos,"FLAG","D");
		// 실작업 삭제
		for (var i =0; i < ds_list_a.rowcount; i++)
		{
			if (ds_list_a.GetColumn(i,"WKMCD") == ds_list.GetColumn(ds_list.rowpos,"WKMCD"))
			{
				ds_list_a.SetColumn(i,"FLAG", "D");
			}
		}
        //비작업 삭제
		for (var i =0; i < ds_list_b.rowcount; i++)
		{
			if (ds_list_b.GetColumn(i,"WKMCD") == ds_list.GetColumn(ds_list.rowpos,"WKMCD"))
			{
				ds_list_b.SetColumn(i,"FLAG", "D");
			}
		}
		ds_list.fireevent = true;
	}
	ds_list.fireevent = true;
}



// 작업자 선택시 내용 변경
function grd_list_OnCellPosChanged(obj,nRow,nCell,nOldRow,nOldCell,nPivotIndex,nOldPivotIndex)
{
	ds_list_a.Filter("WKMCD == "+quote(ds_list.GetColumn(nRow,"WKMCD")) +" && FLAG != 'D' ");
	ds_list_b.Filter("WKMCD == "+quote(ds_list.GetColumn(nRow,"WKMCD")) +" && FLAG != 'D' ");
	set_Tsum();
}


// 실작업 내용 입력
function bt_add_grd1_OnClick(obj)
{
	ds_list_a.fireevent = false;
	
	ds_list_a.AddRow();
	

	if (length(ds_list.GetColumn(ds_list.rowpos,"WKMCD")) < 8 || length(cb_wkbcd1.Value) < 1)
	{
		var arr = ["실작업","작업자(작업장)"];
		gfn_showAlert("CW00004", arr);
		ds_list_a.DeleteRow(ds_list_a.rowpos);
		ds_list_a.fireevent = true;
		return;
	}

	if (length(ds_list.GetColumn(ds_list.rowpos,"WKTYP")) < 1 )
	{
		var arr = ["실작업","작업시간 유형"];
		gfn_showAlert("CW00004", arr);
		ds_list_a.DeleteRow(ds_list_a.rowpos);
		cb_wktyp.SetFocus();
		ds_list_a.fireevent = true;
		return;
	}
	
	if (ds_list_a.rowcount > 1 && length(ds_list_a.GetColumn(ds_list_a.rowpos-1,"BLOCK_NO")) < 1)
	{
		gfn_showAlert("CW00208","BLOCK_NO");    // block_no 필수 입력
		ds_list_a.DeleteRow(ds_list_a.rowpos);
		ds_list_a.fireevent = true;
		return;
	}
	ds_list_a.SetColumn(ds_list_a.rowpos,"FLAG","I");
	ds_list_a.SetColumn(ds_list_a.rowpos,"WKDAT", ds_list.GetColumn(ds_list.rowpos,"WKDAT"));
	ds_list_a.SetColumn(ds_list_a.rowpos,"WKBCD", ds_list.GetColumn(ds_list.rowpos,"WKBCD"));
	ds_list_a.SetColumn(ds_list_a.rowpos,"WKMCD", cb_wkmcd.Value);
	ds_list_a.SetColumn(ds_list_a.rowpos,"ARBPL", cb_wkbcd1.Value);
	ds_list_a.SetColumn(ds_list_a.rowpos,"WKHR",0);
	ds_list_a.fireevent = true;
	set_Tsum();
	if (ds_list.GetColumn(ds_list.rowpos,"FLAG") != "I") {
		ds_list.SetColumn(ds_list.rowpos,"FLAG", "U");
	}
	//ds_list.SetColumn(ds_list.FindRow("WKMCD",obj.GetColumn(nRow,"WKMCD")),"FLAG", "U");
}

//실작업 내용 삭제
function bt_del_grd1_OnClick(obj)
{
	ds_list_a.fireevent = false;
	if (ds_list_a.GetColumn(ds_list_a.rowpos,"FLAG") == "I")
	{
		ds_list_a.DeleteRow(ds_list_a.rowpos);
		ds_list_a.fireevent = true;
	} else {
		ds_list_a.SetColumn(ds_list_a.rowpos,"FLAG","D");
		ds_list_a.fireevent = true;
	}
	ds_list_a.fireevent = true;
	set_Tsum();
	if (ds_list.GetColumn(ds_list.rowpos,"FLAG") != "I") {
	ds_list.SetColumn(ds_list.rowpos,"FLAG", "U");
	}
}


//비작업 내용 입력 
function bt_add_grd2_OnClick(obj)
{
	ds_list_b.fireevent = false;
	
	
	if (ds_list_b.rowcount > 1){
	ds_list_b.AddRow();
	if (length(ds_list.GetColumn(ds_list.rowpos,"WKMCD")) < 8 || length(cb_wkbcd1.Value) < 1)
	{
		var arr = ["비작업","작업자(작업장)"];
		gfn_showAlert("CW00004", arr);
		ds_list_b.DeleteRow(ds_list_b.rowpos);
		ds_list_b.fireevent = true;
		return;
	}

	if (length(ds_list.GetColumn(ds_list.rowpos,"WKTYP")) < 1 )
	{
		var arr = ["비작업","작업시간 유형"];
		gfn_showAlert("CW00004", arr);
		ds_list_b.DeleteRow(ds_list_b.rowpos);
		cb_wktyp.SetFocus();
		ds_list_b.fireevent = true;
		return;
	}
	
	if (ds_list_b.rowcount > 1 && length(ds_list_b.GetColumn(ds_list_b.rowpos-1,"WKNCD")) < 1)
	{
		gfn_showAlert("CW00208","비작업 코드");    // 비작업 코드 필수 입력
		ds_list_b.DeleteRow(ds_list_b.rowpos);
		ds_list_b.fireevent = true;
		return;
	}
	ds_list_b.SetColumn(ds_list_b.rowpos,"FLAG","I");
	ds_list_b.SetColumn(ds_list_b.rowpos,"WKDAT", ds_list.GetColumn(ds_list.rowpos,"WKDAT"));
	ds_list_b.SetColumn(ds_list_b.rowpos,"WKBCD", ds_list.GetColumn(ds_list.rowpos,"WKBCD"));
	ds_list_b.SetColumn(ds_list_b.rowpos,"WKMCD", cb_wkmcd.Value);
	
	} else { //비작업 row가 없을때만 기본셋팅 20.04.27
		ds_list_b.AddRow();
		ds_list_b.SetColumn(ds_list_b.rowpos,"FLAG","I");
		ds_list_b.SetColumn(ds_list_b.rowpos,"WKDAT", ds_list.GetColumn(ds_list.rowpos,"WKDAT"));
		ds_list_b.SetColumn(ds_list_b.rowpos,"WKBCD", ds_list.GetColumn(ds_list.rowpos,"WKBCD"));
		ds_list_b.SetColumn(ds_list_b.rowpos,"WKMCD", cb_wkmcd.Value);
		ds_list_b.SetColumn(ds_list_b.rowpos,"WKNCD", "B06");
		ds_list_b.SetColumn(ds_list_b.rowpos,"WKNCD_DTL", "B0601");
		ds_list_b.SetColumn(ds_list_b.rowpos,"NWKHR", "0.2");
		ds_list_b.SetColumn(ds_list_b.rowpos,"ARBPL", ds_list.GetColumn(ds_list.rowpos,"ARBPL"));
		
		set_Tsum();
		
		ds_list_b.AddRow();
		ds_list_b.SetColumn(ds_list_b.rowpos,"FLAG","I");
		ds_list_b.SetColumn(ds_list_b.rowpos,"WKDAT", ds_list.GetColumn(ds_list.rowpos,"WKDAT"));
		ds_list_b.SetColumn(ds_list_b.rowpos,"WKBCD", ds_list.GetColumn(ds_list.rowpos,"WKBCD"));
		ds_list_b.SetColumn(ds_list_b.rowpos,"WKMCD", cb_wkmcd.Value);
		ds_list_b.SetColumn(ds_list_b.rowpos,"WKNCD", "B13");
		ds_list_b.SetColumn(ds_list_b.rowpos,"WKNCD_DTL", "B1301");
		ds_list_b.SetColumn(ds_list_b.rowpos,"NWKHR", "0.3");
		ds_list_b.SetColumn(ds_list_b.rowpos,"ARBPL", ds_list.GetColumn(ds_list.rowpos,"ARBPL"));
		
		set_Tsum();
		
		
	}
	
	ds_list_b.fireevent = true;
	set_Tsum();
	if (ds_list.GetColumn(ds_list.rowpos,"FLAG") != "I") {
	ds_list.SetColumn(ds_list.rowpos,"FLAG", "U");
	}
	
}


// 비작업 내용 삭제
function bt_del_grd2_OnClick(obj)
{
	ds_list_b.fireevent = false;
	if (ds_list_b.GetColumn(ds_list_b.rowpos,"FLAG") == "I")
	{
		ds_list_b.DeleteRow(ds_list_b.rowpos);
		ds_list_b.fireevent = true;
	} else {
		ds_list_b.SetColumn(ds_list_b.rowpos,"FLAG","D");
		ds_list_b.fireevent = true;
	}
	ds_list_b.fireevent = true;
	set_Tsum();
	if (ds_list.GetColumn(ds_list.rowpos,"FLAG") != "I") {
	ds_list.SetColumn(ds_list.rowpos,"FLAG", "U");	
	}
}

// 작업자 변경
function cb_wkmcd_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
    ds_list.fireevent = false;
	var wkdata = ds_wkmcd_cd.GetColumn(nNewIndex,"CODE");
	
	for (var i = 0; i < ds_list.RowCount(); i++)
	{
		if(ds_list.GetColumn(i, "FLAG") != "I" && ds_list.GetColumn(i, "WKMCD") == wkdata)
		{
			gfn_showAlert("CW00018", "작업자는");
			cb_wkmcd.Value = "";
			ds_list.fireevent = true;
			return;
		}
	}

	ds_list.SetColumn(ds_list.rowpos,"WKMNM", ds_wkmcd_cd.GetColumn(nNewIndex,"WKMNM"));
	ds_list.SetColumn(ds_list.rowpos,"ARBPL", ds_wkmcd_cd.GetColumn(nNewIndex,"ARBPL"));  //20.04.27 작업자 선택시 작업장 셋팅 
	ds_list.fireevent = true;
}

// 신규 작업자의 경우만 작업자 변경이 가능
function ds_list_OnRowPosChanged(obj,nOldRow,nRow)
{
	if (ds_list.GetColumn(nRow,"FLAG") == "I")
	{
		cb_wkmcd.Enable = true;
	} else {
		cb_wkmcd.Enable = false;
	}
	set_Tsum();
}

//  입력이나 삭제가 아닌경우 flag를 u로 변경
function ds_list_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	ds_list.fireevent = false;
	if (ds_list.GetColumn(nRow,"FLAG") != "I" && ds_list.GetColumn(nRow,"FLAG") != "D"){
		ds_list.SetColumn(nRow,"FLAG", "U");
		ds_list.fireevent = true;
	}
	ds_list.fireevent = true;
}

function ds_list_w_OnColumnchanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	obj.fireevent = false;
	
	var wktim = 0.0;
    var iSRow;

    obj.setColumn(nRow,strColumnID,toUpper(varNewValue));
    
	if (strColumnID == "WKNCD")
	{
		var isDat = ds_zppdwkncd_cd.FindRow("CODE",toUpper(varNewValue),0,ds_zppdwkncd_cd.rowcount);
		
		if(isDat == -1){
			gfn_showMsg("CW00071","비작업 코드");
			ds_list_b.setColumn(nRow,"WKNCD","");
			obj.fireevent = true;
			return;	
		}

		for(var i = 0; i < ds_list_b.rowcount; i++)
		{
			var iSRow = ds_list_b.FindRow("WKNCD",ds_list_b.GetColumn(i,"WKNCD"),0,i);
			if(iSRow == -1) {
				obj.fireevent = true;
				continue;
			} else {	
				gfn_showAlert("CW00018","비작업 코드는");
				ds_list_b.setColumn(nRow,"WKNCD","");
				obj.fireevent = true;
				return;
			}
		}
	}
	if (strColumnID == "BLOCK_NO")
	{
		var isDat = ds_block_cd.FindRow("CODE",toUpper(varNewValue),0,ds_block_cd.rowcount);

		if(isDat == -1){
			gfn_showMsg("CW00071","BLOCK_NO");
			ds_list_a.setColumn(nRow,"BLOCK_NO","");
			obj.fireevent = true;
			return;	
		}
		
		for(var i = 0; i < ds_list_a.rowcount; i++)
		{
			var iSRow = ds_list_a.FindRow("BLOCK_NO",ds_list_a.GetColumn(i,"BLOCK_NO"),0,i);

			if(iSRow == -1){
				obj.fireevent = true;
				continue;
			} else {	
				gfn_showAlert("CW00018","BLOCK_NO 는");
				ds_list_a.setColumn(nRow,"BLOCK_NO","");
				obj.fireevent = true;
				return;
			}
		}
	}
	if (strColumnID == "ARBPL")
	{
		var isDat = ds_arbpl_cd.FindRow("CODE",toUpper(varNewValue),0,ds_arbpl_cd.rowcount);

		if(isDat == -1){
			gfn_showMsg("CW00071","규격");
			ds_list_a.setColumn(nRow,"ARBPL",cb_wkbcd1.Value);
			obj.fireevent = true;
			return;	
		}

		// for(var i = 0; i < ds_list_a.rowcount; i++)
		// {
			// var iSRow = ds_list_a.FindRow("ARBPL",ds_list_a.GetColumn(i,"ARBPL"),0,i);

			// if(iSRow == -1){	
				// continue;
			// } else {	
				// gfn_showAlert("CW00018","규격은");
				// ds_list_a.setColumn(nRow,"ARBPL","");
				// return;
			// }
		// }
	}
	if (strColumnID == "WKHR" || strColumnID == "NWKHR")
	{
		for (var i = 0; i < ds_list_a.rowcount(); i++)
		{
			if (ds_list_a.GetColumn(i,"FLAG") != "D")
			{
				wktim += parseFloat(ds_list_a.GetColumn(i,"WKHR"));
			}
		}
		for (var i = 0; i < ds_list_b.RowCount(); i++)
		{
			if (ds_list_b.GetColumn(i,"FLAG") != "D")
			{
				wktim += parseFloat(ds_list_b.GetColumn(i,"NWKHR"));
			}
		}

		if (wktim > parseFloat(cb_wktim.text))
		{
			var arr = ["M/H의 합", "작업시간"];
			gfn_showAlert("CW00190", arr);
			//obj.deleteRow(obj.rowpos);
			//obj.fireevent = true;
			return;
		}
		ds_list.fireevent = false;
		ds_list.SetColumn(ds_list.rowpos,"TSUM", ToString(wktim));
		ds_list.fireevent = true;
	}
    
    if (strColumnID == "WKNCD_DTL") //비작업 부 변경 시 비작업 주 변경  20190227
	{
	
		var isDat = ds_zppdwkncd_cd.FindRow("GUBUN2",toUpper(varNewValue),0,ds_zppdwkncd_cd.rowcount);  //비작업 부 선택 ROW
	    //trace("!!"+isDat);
		ds_list_b.setColumn(nRow,"WKNCD",ds_zppdwkncd_cd.GetColumn(isDat,"GUBUN1")); //비작업코드(주)
		//trace(ds_zppdwkncd_cd.GetColumn(isDat,"GUBUN1"));
				
	}
	
	if (obj.GetColumn(nRow,"FLAG") != "I" && obj.GetColumn(nRow,"FLAG") != "D"){
		
		obj.SetColumn(nRow,"FLAG", "U");
		//20.05.06
		ds_list.SetColumn(ds_list.FindRow("WKMCD",obj.GetColumn(nRow,"WKMCD")),"FLAG", "U");
		//trace(ds_list.savexml());
		
		obj.fireevent = true;
	}
	obj.fireevent = true;
}


function grd_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	if (obj.GetCellProp("body",nCell,"edit") == "combo")
	{
		obj.SetCellProp("body",nCell,"edit","normal");
	}
}

function grd_list_OnExpandEdit(obj,nRow,nCell,strVal,nPivotIndex)
{
	if (nCell != 6)
	{
		obj.SetCellProp("body",nCell,"edit","combo");
	}
}

function set_Tsum()
{
	var wktim = 0.0;
	
	if ( ds_list_a.rowcount() > 0 ) {
	for (var i = 0; i < ds_list_a.rowcount(); i++)
	{
		if (ds_list_a.GetColumn(i,"FLAG") != "D")
		{		    
			wktim += parseFloat(ds_list_a.GetColumn(i,"WKHR"));
			//trace("aaa"+ds_list.rowpos);
			//trace(wktim);
		}
	}
	}
	if ( ds_list_b.rowcount() > 0 ) {
	for (var i = 0; i < ds_list_b.RowCount(); i++)
	{
		if (ds_list_b.GetColumn(i,"FLAG") != "D")
		{
			wktim += parseFloat(ds_list_b.GetColumn(i,"NWKHR"));
			//trace("bbb"+ds_list.rowpos);
			//trace(wktim);
		}
	}
	}

	ds_list.fireevent = false;
	ds_list.SetColumn(ds_list.rowpos,"TSUM", wktim);

	ds_list.fireevent = true;
}
function cb_wkkcd_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	if(cb_wkkcd.Value != "")
	{
		cb_wktyp.Index = 0;
		
		ds_list_a.fireevent = false;
		ds_list_b.fireevent = false;
		
		for (var i = ds_list_a.RowCount()-1; i >= 0 ; i--)
		{
			ds_list_a.SetColumn(i,"FLAG","D");
		}
		for (var i = ds_list_b.RowCount()-1; i >= 0 ; i--)
		{
			ds_list_b.SetColumn(i,"FLAG","D");
		}

		ds_list_a.fireevent = true;
		ds_list_b.fireevent = true;

		ds_list_a.Filter("WKMCD == "+quote(ds_list.GetColumn(ds_list.currow,"WKMCD")) +" && FLAG != 'D' ");
	    ds_list_b.Filter("WKMCD == "+quote(ds_list.GetColumn(ds_list.currow,"WKMCD")) +" && FLAG != 'D' ");
		set_Tsum();
		
		ds_list.SetColumn(ds_list.currow,"TIMES","");  //clear 20190228
		ds_list.SetColumn(ds_list.currow,"TIMEE","");  //clear 20190228 		
	}
}

function cb_wktyp_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	if (cb_wkkcd.Value != "" && cb_wkkcd.Value != "Z")
	{
	    ds_list.SetColumn(ds_list.currow,"WKKCD","");  //작업시간 입력시 근태코드 초기화 20.04.27
	    //gfn_showAlert("CW00230",st_gutae.value);
		//return;
	}
}


// WBS 검색 추가 2012.10.22 hss
function grd_wbs_OnExpandUp(obj,nRow,nCell,strVal,nPivotIndex)
{
		
	var posid= null;
	posid = gfn_openPopup("MM0901004A", true);

    if (posid !=null) {
		ds_list_a.SetColumn(nRow,"POSID",posid[4]);
		ds_list_a.SetColumn(nRow,"POST1",posid[2]);	
    }
}

function grd_list_OnExpandEdit2(obj,nRow,nCell,strVal,nPivotIndex)
{
	obj.SetCellProp("body",nCell,"edit","combo");
}

var _WORKING_DATE = "";
function gfn_getWorkingDate_pp(nDayCnt, sWerks, sFromDate) {
	if ( length( sFromDate ) == 0 ) {
		sFromDate = gfn_getCurrDate();
	}
	
	if ( length( sWerks) == 0 ) {
		return "";
	}
	
	sFromDate = replace(sFromDate, ".", "");
	
	var nRow = gds_workingday.searchRow("DAYS== " + quote(nDayCnt) 
		+ " && FROM_DATE==" + quote( sFromDate )
		+ " && WERKS == " + quote( sWerks ) );
	
	if ( nRow >= 0 ) {
		return gds_workingday.getColumn(nRow, "WORKING_DATE");
	}
	
	tit_callService(
        "COMM_ACT"
        , "getWorkingDay"
        , ""
        , ""
        , "DATE_FROM=" + quote(sFromDate) + " DAYS=" 
				+ quote(nDayCnt) +" WERKS=" + quote(sWerks)
        , ""
        , false
        , true
        , true);
    
    nRow = gds_workingday.addRow();    
    gds_workingday.setColumn(nRow, "DAYS", nDayCnt);
    gds_workingday.setColumn(nRow, "FROM_DATE", sFromDate);
    gds_workingday.setColumn(nRow, "WERKS", sWerks);
    gds_workingday.setColumn(nRow, "WORKING_DATE", replace(_WORKING_DATE, "-", ""));
    
	return replace(_WORKING_DATE, "-", "");
}


]]></Script>
</Window>