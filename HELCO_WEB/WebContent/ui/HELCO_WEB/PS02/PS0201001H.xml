<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="568" Id="PS0201001H" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="이미지&#32;뷰어" Top="8" Ver="1.0" Width="896" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond" UseClientLayout="1">
				<Contents>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="CDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="CNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="F_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN_DESC" size="256" summ="default" type="STRING"/>
					<colinfo id="CONSULT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_file" OnRowPosChanged="ds_file_OnRowPosChanged" UseClientLayout="1">
				<Contents>
					<colinfo id="CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO2" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME2" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="CFNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="CFDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="DEL_FNAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_file2">
				<Contents>
					<colinfo id="CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO2" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME2" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="CFNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="CFDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="DEL_FNAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_temp">
				<Contents>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO2" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME2" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="CFNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="CFDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="DEL_FNAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_fileList" OnRowPosChanged="ds_file_OnRowPosChanged" UseClientLayout="1">
				<Contents>
					<colinfo id="CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO2" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME2" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="CFNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="CFDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="DEL_FNAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_master2" UseClientLayout="1">
				<Contents>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="EXPLO" size="256" summ="default" type="STRING"/>
					<colinfo id="CNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FRAME_AFQ" size="256" summ="default" type="STRING"/>
					<colinfo id="AFQ" size="256" summ="default" type="STRING"/>
					<colinfo id="FRAME_DATE" size="256" summ="default" type="STRING"/>
					<colinfo id="MATNR_DATE" size="256" summ="default" type="STRING"/>
					<colinfo id="HOOK_DATE" size="256" summ="default" type="STRING"/>
					<colinfo id="CONSULT" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="256" summ="default" type="STRING"/>
					<colinfo id="EXPLM" size="256" summ="default" type="STRING"/>
					<colinfo id="BIGO" size="256" summ="default" type="STRING"/>
					<colinfo id="CONSULTER1" size="256" summ="default" type="STRING"/>
					<colinfo id="CONSULTER2" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME1" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH1" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP1" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE1" size="256" summ="default" type="STRING"/>
					<colinfo id="CFNAME1" size="256" summ="default" type="STRING"/>
					<colinfo id="CFDATE1" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME2" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH2" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP2" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE2" size="256" summ="default" type="STRING"/>
					<colinfo id="CFNAME2" size="256" summ="default" type="STRING"/>
					<colinfo id="CFDATE2" size="256" summ="default" type="STRING"/>
					<colinfo id="CDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="F_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN_DESC" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user12" Bottom="99" Height="26" Id="Shape2" Left="8" LineColor="user13" Right="888" TabOrder="9" Top="73" Type="Rectangle" Width="880"></Shape>
		<Shape BKColor="user12" Bottom="74" Height="26" Id="Shape3" Left="8" LineColor="user13" Right="594" TabOrder="21" Top="48" Type="Rectangle" Width="586"></Shape>
		<Shape BKColor="user12" Bottom="99" Height="26" Id="Shape0" Left="8" LineColor="user13" Right="444" TabOrder="20" Top="73" Type="Rectangle" Width="436"></Shape>
		<FileDialog Bottom="32" Filter="All(*.*)|*.*|jpg&#32;File(*.jpg)|*.jpg|jpeg&#32;File(*.jpeg)|*.jpeg|bmp&#32;File(*.bmp)|*.jpeg|gif&#32;File(*.gif)|*.gif|pdf&#32;File(*.pdf)|*.pdf|" Height="24" Id="fileDialog" Left="960" MultiSelect="TRUE" Right="984" TabOrder="12" Top="8" Width="24"></FileDialog>
		<FileDialog Bottom="32" Filter="All(*.*)|*.*|jpg&#32;File(*.jpg)|*.jpg|jpeg&#32;File(*.jpeg)|*.jpeg|bmp&#32;File(*.bmp)|*.jpeg|gif&#32;File(*.gif)|*.gif|pdf&#32;File(*.pdf)|*.pdf|" Height="24" Id="saveDialog" Left="1008" Right="1032" TabOrder="10" Top="8" Type="Save" Width="24"></FileDialog>
		<Static Color="user5" Font="굴림,10,Bold" Height="20" Id="st_title" Left="28" TabOrder="1" Text="이미지&#32;뷰어" Top="8" VAlign="Middle" Width="192"></Static>
		<WebBrowser Border="Flat" Height="457" Id="webBrowser" Left="944" PageUrl="about:blank" Silent="True" Style="sty_ipt_form" TabOrder="2" Top="104" Visible="FALSE" Width="584"></WebBrowser>
		<Image Cursor="HAND" Font="돋움,9,Bold" Height="20" Id="img_close" Left="863" OnClick="img_close_OnClick" Static="FALSE" TabOrder="3" Text="X" Top="8" Transparent="TRUE" Width="20"></Image>
		<File Bottom="64" Height="24" Id="f_tmp" Left="960" Right="984" TabOrder="13" Top="40" Width="24"></File>
		<Edit Align="CENTER" BindDataset="ds_cond" Border="Flat" Column="CNAME" Height="20" Id="Edit4" Left="359" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="4" Top="51" Width="82"></Edit>
		<Static Align="Center" Height="24" Id="Static23" Left="294" Style="sty_lb_form_basic" TabOrder="5" Text="납기일" Top="49" VAlign="Middle" Width="63"></Static>
		<Edit Align="CENTER" BindDataset="ds_cond" Border="Flat" Column="GBN_DESC" Height="20" Id="Edit6" Left="242" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="6" Top="51" Width="50"></Edit>
		<Edit BindDataset="ds_cond" Border="Flat" Column="CONSULT" Height="20" Id="Edit5" Left="85" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="7" Top="76" Width="800"></Edit>
		<Static Align="Center" Height="24" Id="Static24" Left="9" Style="sty_lb_form_basic" TabOrder="8" Text="프로젝트명" Top="74" VAlign="Middle" Width="74"></Static>
		<Static Align="Center" Height="24" Id="Static25" Left="9" Style="sty_lb_form_basic" TabOrder="10" Text="프로젝트&#32;" Top="49" VAlign="Middle" Width="74"></Static>
		<Static Align="Center" Height="24" Id="Static26" Left="177" Style="sty_lb_form_basic" TabOrder="11" Text="총대수" Top="49" VAlign="Middle" Width="63"></Static>
		<Static Align="Center" Height="24" Id="Static58" Left="9" Style="sty_lb_form_basic" TabOrder="12" Text="날짜" Top="49" VAlign="Middle" Width="74"></Static>
		<Static Align="Center" Height="24" Id="Static0" Left="9" Style="sty_lb_form_basic" TabOrder="13" Text="내용" Top="74" VAlign="Middle" Width="74"></Static>
		<Static Align="Center" Height="24" Id="Static5" Left="177" Style="sty_lb_form_basic" TabOrder="14" Text="구분" Top="49" VAlign="Middle" Width="63"></Static>
		<Static Align="Center" Height="24" Id="Static6" Left="294" Style="sty_lb_form_basic" TabOrder="15" Text="작성자" Top="49" VAlign="Middle" Width="63"></Static>
		<Grid AutoEnter="TRUE" AutoFitEndLine="Hide" AutoScrollBar="AlwaysVert" BindDataset="ds_file" BkColor2="default" BoldHead="true" Border="Flat" Bottom="380" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="220" Id="grd_list" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" OnCellDBLClick="grd_list_OnCellDblClick" OnHeadClick="grd_list_OnHeadClick" Right="298" RowHeight="20" Style="sty_grid" TabOrder="16" TabStop="true" Top="160" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="290">
			<contents>
				<format id="Default">
					<columns>
						<col width="20"/>
						<col width="252"/>
					</columns>
					<head>
						<cell align="center" col="0" display="checkbox"/>
						<cell col="1" display="text" text="첨부파일&#32;리스트"/>
					</head>
					<body>
						<cell align="left" bkcolor2="user22" col="0" colid="CHK" display="checkbox" edit="checkbox"/>
						<cell align="left" bkcolor2="user22" col="1" colid="FNAME2" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_fileAdd" ImageID="btn_sub_04" Left="154" LeftMargin="12" OnClick="btn_fileAdd_OnClick" Style="sty_btn" TabOrder="17" TabStop="FALSE" Text="파일추가" Top="136" Transparent="TRUE" Width="72"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_fileDel" ImageID="btn_sub_04" Left="227" LeftMargin="12" OnClick="btn_fileDel_OnClick" Style="sty_btn" TabOrder="18" TabStop="FALSE" Text="파일삭제" Top="136" Transparent="TRUE" Width="72"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_fileDown" ImageID="btn_sub_06" Left="8" OnClick="btn_fileDown_OnClick" Style="sty_btn" TabOrder="19" Text="&#32;&#32;&#32;파일&#32;다운로드" Top="136" Transparent="TRUE" Width="96"></Button>
		<Static Align="Center" Height="24" Id="Static1" Left="444" Style="sty_lb_form_basic" TabOrder="23" Text="첨부파일" Top="49" VAlign="Middle" Width="63"></Static>
		<Edit Align="CENTER" BindDataset="ds_cond" Border="Flat" Column="F_CNT" Height="20" Id="Edit0" Left="509" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="22" Top="51" Width="82"></Edit>
		<MaskEdit Align="Center" BindDataset="ds_cond" Border="Flat" BorderColor="user13" Column="CDATE" Cursor="IBEAM" Height="20" Id="mae_vdatu" Left="85" Mask="####.##.##" MaxLength="8" Readonly="TRUE" Style="sty_ipt_form" TabOrder="24" Top="51" Type="STRING" Value="MaskEdit0" Width="90"></MaskEdit>
		<Div Height="32" Id="div_btn" Left="-2" TabOrder="25" Text="Div0" Url="WB01::CommBtnForm.xml" Width="896">
			<Contents></Contents>
		</Div>
		<Static Font="Default,8" Height="12" Id="Static14" Left="16" TabOrder="26" Text="*&#32;PDF&#32;파일은&#32;더블클릭으로&#32;오픈하시기&#32;바랍니다." Top="105" Width="278"></Static>
		<Image Border="Flat" FillType="STRETCH" Height="457" Id="img_sitePic" Left="304" OnClick="img_sitePic_OnClick" Style="sty_ipt_form" TabOrder="27" Top="103" Width="584"></Image>
		<Static Font="Default,8" Height="12" Id="Static21" Left="16" TabOrder="28" Text="*&#32;원본이미지&#32;조회는&#32;아래&#32;리스트에서&#32;더블클릭&#32;하세요." Top="121" Width="277"></Static>
		<Static Font="Default,8,Bold" Height="12" Id="Static2" Left="16" TabOrder="29" Text="*&#32;이미지&#32;미리보기는&#32;파일&#32;확장자가" Top="393" Width="278"></Static>
		<Static Font="Default,8,Bold" Height="12" Id="Static3" Left="16" TabOrder="30" Text="&#32;&#32;bmp,&#32;jpg,&#32;gif인&#32;경우만&#32;지원합니다." Top="409" Width="278"></Static>
		<CyHttpFile Height="24" Id="httpFile" Left="1008" Top="40" Width="24"></CyHttpFile>
	</Form>
	<Script><![CDATA[#include "LIB::tit_comm_0001.js";
#include "LIB::commons.js";	// 공통 스크립트 

/**
*	화면 로드 
**/
var _F_FILE_DIR = "";	// 로컬에서 현재 선택한 파일 디렉토리 
var _F_FILE_NAME = "";	// 로컬에서 현재 선택한 파일  명 
var _F_FILE_SIZE = 0;	// 파일 사이즈 
var _F_FILE_DELETE = false;
var F_SIZE = 1024 * 10096;	// 4096K

function fn_OnLoadCompleted(obj)
{
	
    gfn_initForm();
	gfn_initDs(ds_cond, true);	
	ds_master2.Copy(ds_master);

	
	if(GBN <> 'N' && PRE_CID <> G_USER_ID)
	{
		btn_fileAdd.Enable = false;
		btn_fileDel.Enable = false;
	}
	
	ds_cond.SetColumn(0,"PSPID", PRE_PSPID);
	ds_cond.SetColumn(0,"GBN", PRE_GBN) ;
	  
	ds_cond.SetColumn(0,"SEQNO", gfn_fillZero(PRE_SEQNO, 3)) ;
	  
	ds_cond.SetColumn(0,"CDATE", PRE_CDATE) ;
	ds_cond.SetColumn(0,"CNAME", PRE_CNAME) ;
	ds_cond.SetColumn(0,"F_CNT", PRE_FCNT) ;
	ds_cond.SetColumn(0,"CONSULT", PRE_CONSULT);
	
	if(PRE_GBN == 'A') ds_cond.SetColumn(0, "GBN_DESC", "전화");
	else if(PRE_GBN == 'B') ds_cond.SetColumn(0, "GBN_DESC", "방문");
	else if(PRE_GBN == 'C') ds_cond.SetColumn(0, "GBN_DESC", "전산");
	else if(PRE_GBN == 'D') ds_cond.SetColumn(0, "GBN_DESC", "메일");

	// #첨부파일 조회
	ufn_selectFile();

	//parent.close();
}

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	parent.fn_query(); 
	close();
}

/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	// 첨부파일 수 재세팅
	ds_cond.SetColumn(0, "F_CNT", ds_file.rowcount);
	
	
	//첨부파일 보여주기
	ufn_showImage(0);
}

/********************************************************************************
* 기      능   : 파일 다운로드
********************************************************************************/
function btn_fileDown_OnClick(obj)
{
	if(ds_file.rowcount == 0) return;
	
	var nRow = ds_file.rowposition;
	
	var svrFileName = ds_file.GetColumn(nRow, "FNAME_APP");
	var orgFileName = ds_file.GetColumn(nRow, "FNAME");
	var ext         = gfn_getFileExt(ds_file.getColumn(nRow, "FNAME"));

	saveDialog.FileName = orgFileName;
	saveDialog.Filter = "All(*.*)|*.*";	//"Acrobet Reader(*.pdf)|*.pdf|CAD Files(*.dwg)|*.dwg|";
	saveDialog.FilterIndex = "";		//decode(ext, "pdf","0", "1");
    var sRtn = saveDialog.open();
	
	if(sRtn != "1") return;
	
	var idx = ufn_lastIndexOf(saveDialog.FileName);
	var fdFileName = saveDialog.FileName;
    var fileName =  decode(idx, -1, fdFileName, substr(fdFileName, 0, ufn_lastIndexOf(fdFileName)-1));
    var localFileName = fileName + "." + ext;


	var rMsg = tit_fileRead(
						httpFile
						, "PS"			// 저장 디렉토리
						, svrFileName			// 서버에서 전송받을 이름
						, saveDialog.FilePath	// 로컬 경로
						, localFileName			// 로컬 파일명
	);
	
	if ( rMsg[0] == "E" ) {
		if ( length(trim(rMsg[1])) > 0 ) {
			gfn_showAlert("CW10025", rMsg[1]);
		} else {
			gfn_showAlert("CW10025", "파일 다운로드에 실패하였습니다.");
		}
	} else {
		gfn_showAlert("CW10025", "파일을 다운로드 하였습니다.");
	}
	
    
}

/********************************************************************************
* 기      능   : 파일 추가
********************************************************************************/
function btn_fileAdd_OnClick(obj)
{
	
	var fileName = "";
	
	if(ds_file.rowcount >= 30)
	{
		gfn_openMsgWin("추가할 수 있는 파일 개수를 초과했습니다.\n (최대 30개 저장가능)","","A");
		return;
	}
	
	var sRtn = fileDialog.open();
	
	if(sRtn == 0) return;
	
	
	if ( length(fileDialog.FilePath) == 0 
		|| length(fileDialog.FileName ) == 0 ) {
		return;
	}

	var fileSize = f_tmp.GetLength(fileDialog.FilePath + "\\" + fileDialog.FileName );
	if ( fileSize <= 0 ) {
		gfn_showAlert("CW00048");
		return;
	}

	if ( fileSize > toNumber(F_SIZE)) {
		gfn_showAlert("CW00047", "10 Mbytes" );	
		return;
	}

	/*
	//한글제목 입력금지(한글제목깨짐)
	for( var i = 0; i < length( fileDialog.FileName); i++ ) {
		if ( lengthb(charAt( fileDialog.FileName, i)) == 2 ) {
			gfn_showMsg("CW00213");
			return;
		}
	}
	*/

	
	
	// 파일정보
	if(length(fileDialog.FileName) > 0 )
	{
		var thumbext = fileDialog.FileName; //파일을 추가한 input 값
	
		thumbext = substr(thumbext, ufn_lastIndexOf(thumbext)); //확정자값 가져오기 
		thumbext = ToLower(thumbext); //소문자로 변경

	    if(thumbext != "jpg" && thumbext != "jpeg" && thumbext != "png" &&  thumbext != "gif" &&  thumbext != "bmp"  && thumbext != "pdf")
	    { // 확장자를 확인
			global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
		    global.FRM_BOTTOM.st_msg.color = "yellow";       
			global.FRM_BOTTOM.st_msg.value = "이미지 파일(jpg, jpeg, png, gif, bmp, pdf)만 등록 가능합니다.";
			return false;
		}
	  
		if(ds_file.rowcount < 30)
		{
			ds_temp.ClearData();
			ds_temp.addRow();
			ds_temp.setColumn(0, "PSPID", ds_cond.getColumn(0, "PSPID"));
			ds_temp.setColumn(0, "SEQNO", ds_cond.GetColumn(0, "SEQNO"));
			
			ds_temp.setColumn(0, "FNAME", fileDialog.FileName);
			ds_temp.setColumn(0, "FSIZE", fileSize);
			ds_temp.setColumn(0, "FPATH", fileDialog.FilePath);
			
			if(length(ds_temp.getColumn(0, "FNAME")) != 0 && length(ds_temp.getColumn(0, "FPATH")) != 0)
			{
				//fileName = left(GetDate(),8)+"_"+right(GetDate(),6)+"_"+ds_list_i.getColumn(i, "HNO")+ds_list_i.getColumn(i, "CHASU")+"."+gfn_getFileExt(ds_list_i.getColumn(i, "FNAME"));
				fileName = left(GetDate(),8) +"_"+ right(GetDate(),6) +"_"+ ds_temp.getColumn(0, "SEQNO") +"_"+ G_USER_ID + "_" + ds_temp.getColumn(0, "PSPID") +"."+ gfn_getFileExt(ds_temp.getColumn(0, "FNAME"));
				var arr = tit_fileWrite(httpFile
					, "PS"
					, ds_temp.getColumn(0, "FPATH")
					, ds_temp.getColumn(0, "FNAME")
					, fileName// 실제 db에 저장될 파일 이름
					, "U"	  // time stamp를 붙이지 않을 경우 U 사용 
					, ds_temp.GetColumn(0,"DEL_FNAME"));    // ds_list_i.getColumn(i, "DEL_FNAME") );//삭제할 이전 파일명 
				if ( arr[0] == "S" ) {
					ds_temp.setColumn(0, "FNAME_APP", fileName);
				}
				else if ( arr[0] != "S" )
				{
					gfn_showMsg("CW00035"); 
					return;
				}
				
				// 파일 추가 저장
				tit_clearActionInfo();	
				tit_addSingleActionInfo("ps02:PS0201001G_I1");
				tit_callService(
					""
					, ""        
					, "ds_temp=ds_temp"
					, ""
					, ""
					, "fn_afterFileAdd"
					, ""
					, ""
					,true  // ""
					);
			}

		}
		else
		{
			gfn_openMsgWin("추가할 수 있는 파일 개수를 초과했습니다.\n (최대 30개 저장가능)","","A");
			return;
		}
	
	  //ds_list.setColumn(i, "GBN", cb_gbn.Value);
	}

}

/********************************************************************************
* 기      능   : 파일 삭제
********************************************************************************/
function btn_fileDel_OnClick(obj)
{
	if(ds_file.rowcount == 0) return;
	
	var nChkRow = ds_file.SearchRow("CHK == '1'");
	
	if(nChkRow < 0) return;
	
	for(var i=0; i<ds_file.rowcount; i++)
	{
		var sFileName = ds_file.GetColumn(i, "FNAME");
		var sChk      = ds_file.GetColumn(i, "CHK");
		
		if(length(sFileName) != 0 && sChk == "1")
		{
			var arr = tit_fileDelete("PS",ds_file.getColumn(i, "FNAME_APP"), false);
		}
	}
	
	// 체크된 파일만 삭제처리
	ds_file.Filter("CHK==1");
	ds_file2.copyF(ds_file);
	ds_file.unFilter();
	


	// 파일 삭제 저장
	tit_clearActionInfo();	
	tit_addMultiActionInfo("ps02:PS0201001G_D1");
	tit_callService(
		""
		, ""        
		, "ds_file=ds_file2"
		, ""
		, ""
		, "fn_afterFileAdd"
		, ""
		, ""
		,true  // ""
		);
}

/********************************************************************************
* 기      능   : 파일 저장,삭제 후, Callback
********************************************************************************/
function fn_afterFileAdd()
{
	ds_file.clearData();
	
	// 저장 후, 파일리스트 재조회
	tit_clearActionInfo();		
	tit_addSearchActionInfo("ps02:PS0201001G_S1");	// 첨부파일 정보
	
	tit_callService(
	 ""
	, ""
	, "ds_cond=ds_cond"
	, "ds_file=ds_file"
	, ""
	, "fn_afterQuery"
	, ""
	, ""
	, true);
}

/********************************************************************************
* 기      능   : 첨부파일 그리드 헤드 클릭 시
********************************************************************************/
function grd_list_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	if ( nCell == 0 ) {
		// 현재 처리할 format 기억
		gfn_selectAllGrid(obj,nCell,nCell,true);
	}
}

/********************************************************************************
* 기      능   : Row 포지션 변경 시, 그림 보여주기
********************************************************************************/
function ds_file_OnRowPosChanged(obj,nOldRow,nRow)
{
	// # WebBrowser에 이미지 표시
	ufn_showImage(nRow);
	
}

/********************************************************************************
* 기      능   : 이미지 파일일 경우 열어줌
********************************************************************************/
function ufn_isImage(fileNm) {
	var s = toUpperCase(right( fileNm, 4));
	if ( s == ".JPG" || s == ".GIF" || s == ".PNG" || s == ".BMP") {
		return true;
	} else if ( toUpperCase(right( fileNm, 5)) == ".JPEG") {
		return true;
	}
	
	return false;
}



/********************************************************************************
* 기      능   : 첨부파일 조회
********************************************************************************/
function ufn_selectFile()
{
	// 첨부파일 SELECT 해오기
	tit_clearActionInfo();
	tit_addSearchActionInfo("ps02:PS0201001G_S1");	// 첨부파일 정보
	
	tit_callService(
	 ""
	, ""
	, "ds_cond=ds_cond"
	, "ds_file=ds_file"
	, ""
	, ""
	, ""
	, ""
	, true);
	
	
	
}

/********************************************************************************
* 기      능   : 첨부파일 더블 클릭 시 파일오픈
********************************************************************************/
function grd_list_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	if(nCell != 0)
	{
		if( length(ds_file.getColumn(nRow, "FNAME")) > 0) {
		   // 첨부 파일 처리 
		   fn_createWait("", this);
		
			var FilePath = "c:\\Temp" ;		
			var FileExec = "c:\\Temp\\" + ds_file.getColumn(nRow, "FNAME");

			saveDialog.FileName = ds_file.getColumn(nRow, "FNAME");
			
			var rMsg = tit_fileRead(
										httpFile
										, "PS"  	  // 저장 디렉토리
										, ds_file.getColumn(nRow, "FNAME_APP")	// 서버에서 전송받을 이름
										, FilePath    // 로컬 경로
										, ds_file.getColumn(nRow, "FNAME")    // 로컬 파일명
									   );
	
				fn_destroyWait();
				if ( rMsg[0] == "E" ) {
					if ( length(trim(rMsg[1])) > 0 ) {
					  //  ExecShell(FileExec);
						gfn_showAlert("CW10025", rMsg[1]);
					} else {
	
						gfn_showAlert("CW10025", "파일 다운로드에 실패하였습니다.");
					}
				} else {	
					ExecShell(FileExec);		
				}	
					
					
			 }
	}
}

function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}    

function ufn_showImage(nRow)
{
	img_sitePic.ImageID = "";

	//webBrowser.pageUrl = "about:blank";
	//WebBrowser.run();
					
	if(ds_file.rowcount == 0) return;
	if(nRow < 0) return;
	
	
	var sServerDir      =  "PS";
	var sLocalFileName  =  ds_file.GetColumn(nRow, "FNAME");
	var sLocalFileDir  =  ds_file.GetColumn(nRow, "FPATH");
	
	var sServerFileName =  ds_file.GetColumn(nRow, "FNAME_APP");
	
	if ( length( sServerFileName) > 0) {
		if( ufn_isImage( sServerFileName )  ) {
				img_sitePic.ImageID = tit_getServerDir(sServerDir, sServerFileName);
				//trace(tit_getServerDir(sServerDir, sServerFileName));
				//webBrowser.pageUrl = tit_getServerDir(sServerDir, sServerFileName);
				//WebBrowser.run();
			}
		/*	
		if ( length( sLocalFileName ) > 0 ) {
			if ( f_tmp.GetLength(sLocalFileDir + "\\" + sServerFileName) >0 ) {
				// 로컬에 저장된 정보 다시 표시 
				_F_FILE_DIR =  sLocalFileDir;
				_F_FILE_NAME = sServerFileName;
	
				if( ufn_isImage( sServerFileName )  ) {
					img_sitePic.ImageID = sLocalFileDir + "\\" + sLocalFileName;
					//trace(sLocalFileDir + "\\" + sServerFileName);
					//webBrowser.pageUrl = sLocalFileDir + "\\" + sLocalFileName;
					//WebBrowser.run();
				}	
			} else {
				gfn_showAlert("Not found :" + sLocalFileDir + "\\" + sLocalFileName );
				sLocalFileName = "";
				sServerFileName = "";
			}
		} else {

			if( ufn_isImage( sServerFileName )  ) {
				img_sitePic.ImageID = tit_getServerDir(sServerDir, sServerFileName);
				//trace(tit_getServerDir(sServerDir, sServerFileName));
				//webBrowser.pageUrl = tit_getServerDir(sServerDir, sServerFileName);
				//WebBrowser.run();
			}	
		}	*/
	}
	/*
	if(length(sServerFileName) != 0)
	{
		if( ufn_isImage( sServerFileName )  ) {
			webBrowser.pageUrl = tit_getServerDir(sServerDir, sServerFileName);
			WebBrowser.run();
		}
	}
	else
	{
		webBrowser.pageUrl = "about:blank";
		WebBrowser.run();
	}
	*/
}

function ufn_lastIndexOf(sParmString)
{
	var j = 0;//.위치 
	var k = 0;// 결과위치 
	var k = 0;//.위치 -1 
	
	
	while(true) 
	{ 
		r = pos(sParmString,".",j);
		
		if (r == -1) 
		{ 
			break; 
		} 
		
		j=r+1; 
	
	} 
	k = j; 
	
	return k;
}

/*
function ufn_fileWidthHeightChk()
{
	tit_clearActionInfo();
	tit_callService(
          "PS0201001A_ACT"
        , "ftpFileCheck"
        , "ds_cond=ds_cond"
        , "ds_head=ds_head"
        , ""
        , "fn_afterQuery1"
        , false);
}
*/
function img_sitePic_OnClick(obj,nX,nY)
{
	
}
]]></Script>
</Window>