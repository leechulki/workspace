<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="324" Id="PS0201001E" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="착.준공계획수정&#32;변경사유" Top="8" Ver="1.0" Width="800" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_list_p" OnColumnChanged="ds_list_p_OnColumnChanged">
				<Contents>
					<colinfo id="POSID" size="255" type="STRING"/>
					<colinfo id="PSPID" size="256" type="STRING"/>
					<colinfo id="CLOSI" size="256" type="STRING"/>
					<colinfo id="TXT01" size="256" type="STRING"/>
					<colinfo id="REAQU" size="256" type="STRING"/>
					<colinfo id="REASO" size="256" type="STRING"/>
					<colinfo id="BLOCK" size="256" type="STRING"/>
					<colinfo id="REMOV" size="256" type="STRING"/>
					<colinfo id="CHANG" size="256" type="STRING"/>
					<colinfo id="GBN" size="256" type="STRING"/>
					<colinfo id="ZZCOMP2" size="256" type="STRING"/>
					<colinfo id="ZZPMNUM" size="256" type="STRING"/>
					<colinfo id="NAMEP" size="256" type="STRING"/>
					<colinfo id="ZZTEMNO" size="256" type="STRING"/>
					<colinfo id="NAMET" size="256" type="STRING"/>
					<colinfo id="ZZLIFNR" size="256" type="STRING"/>
					<colinfo id="ZZACTSS" size="256" type="STRING"/>
					<colinfo id="CHASU" size="256" type="STRING"/>
					<colinfo id="CDATE" size="256" type="STRING"/>
					<colinfo id="CDATE1" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond_p">
				<Contents>
					<colinfo id="PSPID" size="256" type="STRING"/>
					<colinfo id="POSID" size="256" type="STRING"/>
					<record>
						<POSID></POSID>
						<PSPID></PSPID>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_reaso_cd">
				<Contents>
					<colinfo id="REASO" size="256" summ="default" type="STRING"/>
					<colinfo id="TXT01" size="256" summ="default" type="STRING"/>
					<colinfo id="DTEXT1" size="256" summ="default" type="STRING"/>
					<record>
						<DTEXT1></DTEXT1>
						<REASO></REASO>
						<TXT01></TXT01>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_reaqu_cd">
				<Contents>
					<colinfo id="REAQU" size="256" type="STRING"/>
					<colinfo id="REAQU_NAME" size="256" type="STRING"/>
					<record>
						<REAQU></REAQU>
						<REAQU_NAME></REAQU_NAME>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list_p2">
				<Contents>
					<colinfo id="POSID" size="255" type="STRING"/>
					<colinfo id="PSPID" size="256" type="STRING"/>
					<colinfo id="CLOSI" size="256" type="STRING"/>
					<colinfo id="TXT01" size="256" type="STRING"/>
					<colinfo id="REAQU" size="256" type="STRING"/>
					<colinfo id="REASO" size="256" type="STRING"/>
					<colinfo id="BLOCK" size="256" type="STRING"/>
					<colinfo id="REMOV" size="256" type="STRING"/>
					<colinfo id="CHANG" size="256" type="STRING"/>
					<colinfo id="ZZCOMP2" size="256" type="STRING"/>
					<colinfo id="ZZPMNUM" size="256" type="STRING"/>
					<colinfo id="NAMEP" size="256" type="STRING"/>
					<colinfo id="ZZTEMNO" size="256" type="STRING"/>
					<colinfo id="NAMET" size="256" type="STRING"/>
					<colinfo id="ZZLIFNR" size="256" type="STRING"/>
					<colinfo id="ZZACTSS" size="256" type="STRING"/>
					<colinfo id="CHASU" size="256" type="STRING"/>
					<colinfo id="CDATE" size="256" type="STRING"/>
					<colinfo id="CDATE1" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list_p2_0">
				<Contents>
					<colinfo id="POSID" size="255" type="STRING"/>
					<colinfo id="PSPID" size="256" type="STRING"/>
					<colinfo id="CLOSI" size="256" type="STRING"/>
					<colinfo id="TXT01" size="256" type="STRING"/>
					<colinfo id="REAQU" size="256" type="STRING"/>
					<colinfo id="REASO" size="256" type="STRING"/>
					<colinfo id="BLOCK" size="256" type="STRING"/>
					<colinfo id="REMOV" size="256" type="STRING"/>
					<colinfo id="CHANG" size="256" type="STRING"/>
					<colinfo id="ZZCOMP2" size="256" type="STRING"/>
					<colinfo id="ZZPMNUM" size="256" type="STRING"/>
					<colinfo id="NAMEP" size="256" type="STRING"/>
					<colinfo id="ZZTEMNO" size="256" type="STRING"/>
					<colinfo id="NAMET" size="256" type="STRING"/>
					<colinfo id="ZZLIFNR" size="256" type="STRING"/>
					<colinfo id="ZZACTSS" size="256" type="STRING"/>
					<colinfo id="CHASU" size="256" type="STRING"/>
					<colinfo id="CDATE" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list_mod">
				<Contents>
					<colinfo id="POSID" size="255" type="STRING"/>
					<colinfo id="PSPID" size="256" type="STRING"/>
					<colinfo id="CLOSI" size="256" type="STRING"/>
					<colinfo id="TXT01" size="256" type="STRING"/>
					<colinfo id="REAQU" size="256" type="STRING"/>
					<colinfo id="REASO" size="256" type="STRING"/>
					<colinfo id="BLOCK" size="256" type="STRING"/>
					<colinfo id="REMOV" size="256" type="STRING"/>
					<colinfo id="CHANG" size="256" type="STRING"/>
					<colinfo id="GBN" size="256" type="STRING"/>
					<colinfo id="ZZCOMP2" size="256" type="STRING"/>
					<colinfo id="ZZPMNUM" size="256" type="STRING"/>
					<colinfo id="NAMEP" size="256" type="STRING"/>
					<colinfo id="ZZTEMNO" size="256" type="STRING"/>
					<colinfo id="NAMET" size="256" type="STRING"/>
					<colinfo id="ZZLIFNR" size="256" type="STRING"/>
					<colinfo id="ZZACTSS" size="256" type="STRING"/>
					<colinfo id="CHASU" size="256" type="STRING"/>
					<colinfo id="CDATE" size="256" type="STRING"/>
					<colinfo id="CDATE1" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_leadtime">
				<Contents>
					<colinfo id="PSPID" size="255" summ="default" type="STRING"/>
					<colinfo id="POSID" size="256" summ="default" type="STRING"/>
					<colinfo id="LEAD_TIME" size="256" summ="default" type="STRING"/>
					<colinfo id="REQ_DATE2" size="256" summ="default" type="STRING"/>
					<colinfo id="PACFDT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user12" Bottom="70" Height="26" Id="Shape1" Left="8" LineColor="user13" Right="248" TabOrder="1" Top="44" Type="Rectangle" Width="240"></Shape>
		<Static Align="Right" Height="24" Id="Static4" Left="9" Style="sty_lb_form_basic" TabOrder="2" Text="자료구분&#32;" Top="45" VAlign="Middle" Width="86"></Static>
		<Edit Border="Flat" Height="20" Id="st_gubun" Left="97" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="3" Top="47" Width="148"></Edit>
		<Grid AutoEnter="TRUE" AutoFitEndLine="Hide" BindDataset="ds_list_p" BkColor2="default" BoldHead="true" Border="Flat" Bottom="316" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="242" Id="grd_list_p" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" Right="792" RowHeight="20" Style="sty_grid" TabOrder="4" TabStop="true" Top="74" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="784">
			<contents>
				<format id="Default">
					<columns>
						<col width="55"/>
						<col width="65"/>
						<col width="30"/>
						<col width="65"/>
						<col width="120"/>
						<col width="370"/>
						<col width="65"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user21" display="text" font="굴림,9" text="프로젝트"/>
						<cell align="center" col="1" color="user21" display="text" font="굴림,9" text="호기"/>
						<cell align="center" col="2" color="user21" display="text" font="굴림,9" text="차수"/>
						<cell align="center" col="3" color="user21" display="text" font="굴림,9" text="입력일"/>
						<cell align="center" col="4" color="user21" display="text" font="굴림,9" text="변경사유"/>
						<cell align="center" col="5" color="user21" display="text" font="굴림,9" text="변경사유&#32;내역"/>
						<cell align="center" col="6" color="user21" display="text" font="굴림,9" text="원인부서"/>
					</head>
					<body>
						<cell bkcolor2="user22" col="0" colid="PSPID" display="text"/>
						<cell bkcolor2="user22" col="1" colid="POSID" display="text"/>
						<cell align="center" bkcolor2="user22" col="2" colid="CHASU" display="text"/>
						<cell align="center" bkcolor2="user22" col="3" colid="CDATE" display="text" Mask="####.##.##"/>
						<cell align="left" bkcolor2="user22" bkimagealign="right" bkimageid="icon_grid_edit" col="4" colid="REASO" combocol="REASO" combodataset="ds_reaso_cd" combodisplayrowcnt="15" combotext="TXT01" display="combo" edit="combo"/>
						<cell align="left" bkcolor2="user22" bkimagealign="right" bkimageid="icon_grid_edit" checklength="Byte" col="5" colid="TXT01" display="text" edit="normal" limit="60"/>
						<cell align="left" bkcolor2="user22" bkimagealign="right" bkimageid="icon_grid_edit" col="6" colid="REAQU" combocol="REAQU" combodataset="ds_reaqu_cd" combotext="REAQU_NAME" display="combo" edit="combo"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Div Height="36" Id="div_btn" TabOrder="5" Text="Div0" Url="WB01::CommBtnForm.xml" Width="800">
			<Contents></Contents>
		</Div>
		<Static Height="13" Id="st_reaso" Left="75" TabOrder="6" Text="변경사유" Top="366" Visible="FALSE" Width="40"></Static>
		<Static Height="13" Id="st_reaqu" Left="176" TabOrder="7" Text="원인부서" Top="368" Visible="FALSE" Width="40"></Static>
	</Form>
	<Script><![CDATA[﻿﻿﻿﻿﻿﻿/*
 ******************************************************************************************
 * 기      능   : 설치협력사, 설치사무소 및 설치부가 착준공계획정보를 입력하기 위하여 
 *                프로젝트 정보를 조회하는 화면
                  SAP RPC 연동 
 * 작  성  자   : 
 * 작성  일자   : 2008.04.08
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var saveFlg = 'N';
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	// Form 로드 이벤트 맨 첫줄에 기술 
	gfn_initForm();

	ds_cond_p.SetColumn(0,"PSPID",ds_list5.GetColumn(ds_list5.row,"PSPID"));
	ds_cond_p.SetColumn(0,"POSID",ds_list5.GetColumn(ds_list5.row,"POSID"));
	tit_clearActionInfo();
	if( gubun == 'A' )
	{
		st_gubun.value = "착공예정일";
		tit_addSearchActionInfo("ps02:PS0201001E_S1");
		tit_addSearchActionInfo("ps02:PS0201001E_S7");
	}
	else if( gubun == 'B' )
	{
		st_gubun.value = "준공예정일";
		tit_addSearchActionInfo("ps02:PS0201001E_S2");
	}
	
	tit_addSearchActionInfo("ps02:PS0201001E_S3");
	tit_addSearchActionInfo("ps02:PS0201001E_S4");
	tit_callService(
		""
		, ""
		, "ds_cond=ds_cond_p"
		, "ds_list_p=ds_list ds_leadtime=ds_leadtime ds_reaso_cd=ds_reaso_cd ds_reaqu_cd=ds_reaqu_cd"
		, ""
		, "fn_afterSearchP"
		, true,true);
	
	gfn_showMsg("CI00007");
}
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterSearchP(errCode, errMsg) {
	var rows = ds_list_p.AddRow();
	
	ds_list_p.SetColumn( rows,"PSPID",ds_cond_p.GetColumn(0,"PSPID"));
	ds_list_p.SetColumn( rows,"POSID",ds_cond_p.GetColumn(0,"POSID"));

	if(ds_list_p.rowcount > 1 )
	{
		ds_list_p.SetColumn( rows,"CLOSI",ds_list_p.GetColumn(0,"CLOSI"));
		ds_list_p.SetColumn( rows,"BLOCK",ds_list_p.GetColumn(0,"BLOCK"));
		//ds_list_p.SetColumn( rows,"CHASU",parseInt(ds_list_p.GetColumn(rows-2,"CHASU"))+1);
		ds_list_p.SetColumn( rows,"ZZACTSS",ds_list5.GetColumn(ds_list5.row,"ZZACTSS"));
		ds_list_p.SetColumn( rows,"ZZCOMP2",replace(ds_list5.GetColumn(ds_list5.row,"ZZCOMP2"),'-',''));
		ds_list_p.SetColumn( rows,"ZZPMNUM",ds_list5.GetColumn(ds_list5.row,"ZZPMNUM"));
		ds_list_p.SetColumn( rows,"NAMEP",ds_list5.GetColumn(ds_list5.row,"NAMEP"));
		ds_list_p.SetColumn( rows,"ZZTEMNO",ds_list5.GetColumn(ds_list5.row,"ZZTEMNO"));
		ds_list_p.SetColumn( rows,"NAMET",ds_list5.GetColumn(ds_list5.row,"NAMET"));
		ds_list_p.SetColumn( rows,"ZZLIFNR",ds_list5.GetColumn(ds_list5.row,"ZZLIFNR"));
	}
	else
	{
		ds_list_p.SetColumn( rows,"CLOSI","1");
		ds_list_p.SetColumn( rows,"BLOCK","1");
		//ds_list_p.SetColumn( rows,"CHASU","1");
		ds_list_p.SetColumn( rows,"ZZACTSS",ds_list5.GetColumn(ds_list5.row,"ZZACTSS"));
		ds_list_p.SetColumn( rows,"ZZCOMP2",replace(ds_list5.GetColumn(ds_list5.row,"ZZCOMP2"),'-',''));
		ds_list_p.SetColumn( rows,"ZZPMNUM",ds_list5.GetColumn(ds_list5.row,"ZZPMNUM"));
		ds_list_p.SetColumn( rows,"NAMEP",ds_list5.GetColumn(ds_list5.row,"NAMEP"));
		ds_list_p.SetColumn( rows,"ZZTEMNO",ds_list5.GetColumn(ds_list5.row,"ZZTEMNO"));
		ds_list_p.SetColumn( rows,"NAMET",ds_list5.GetColumn(ds_list5.row,"NAMET"));
		ds_list_p.SetColumn( rows,"ZZLIFNR",ds_list5.GetColumn(ds_list5.row,"ZZLIFNR"));
	}
		
	if( gubun == 'A' )	// 착공예정일 변경
	{
		ds_list_p.SetColumn( rows,"REMOV",replace(ds_list5.GetOrgColumn(ds_list5.row,"ZZSHIP1"),'-',''));
		ds_list_p.SetColumn( rows,"CHANG",replace(ds_list5.GetColumn(ds_list5.row,"ZZSHIP1"),'-',''));
		
		if(Substr(ds_list5.GetColumn(ds_list5.row, "PSPID"),0,1) <> 'J')
		{
			var cal_date = "";
			var sZzchakg = ds_list5.GetColumn(ds_list5.row, "ZZCHAKG");
			var sZzship1 = replace(ds_list5.GetColumn(ds_list5.row,"ZZSHIP1"),'-','');
			var sToday   = gfn_getCurrDate();
			// 준공 LeadTime 적용 2020-11-30 우동훈 책임 요청
			var sLeadTime = ds_leadTime.GetColumn(0,"LEAD_TIME");	// ZPST0048 - LEAD TIME
			//var sReqDate2 = ds_leadTime.GetColumn(0,"REQ_DATE2");	// 확정검사요청일(ZPST0200-REQ_DATE2)
			//var sPacfdt   = ds_leadTime.GetColumn(0,"PACFDT");		// QC검사일(ZQMT019-PACFDT)
			//Trace(ds_leadTime.saveXML());
			// 리드타임이 존재, 착공확정 이전만(출하전)
			if(sLeadTime <> '' && sZzchakg <> 'X')
			{
				// 착공예정일 + LeadTime
				cal_date = gfn_getAfterDate(sZzship1, sLeadTime);
				
				//Trace("Lead Time : "+sLeadTime);
				//Trace("착공확정  : "+sZzchakg);
				//Trace("출하예정일 : " + sZzship1);
				//Trace(cal_date);
			}
			
			// 준공예정일 세팅 처리
			if(cal_date <> '')
			{
				ds_list5.setcolumn(ds_list5.row,"ZZCOMP2",replace(cal_date,'-',''));
			}
		}
		

	}
	else if (gubun == 'B')	// 준공예정일 변경
	{
		ds_list_p.SetColumn( rows,"REMOV",replace(ds_list5.GetOrgColumn(ds_list5.row,"ZZCOMP2"),'-',''));
		ds_list_p.SetColumn( rows,"CHANG",replace(ds_list5.GetColumn(ds_list5.row,"ZZCOMP2"),'-',''));
	}
	
	// 메시지 처리 
	gfn_showSearchMsg(grd_list_p, errCode, errMsg);
}
/********************************************************************************
* 기      능   : 저장
********************************************************************************/
function fn_save() {
	if ( !gfn_isChangeDs(ds_list_p, true, "")){
		return;
	}
	// 변경사유 필수체크
	if ( length( ds_list_p.getColumn(parseInt(ds_list_p.rowcount)-1, "REASO")) == 0 ) {
		gfn_showMsg("CW00001",st_reaso.value);
		ds_list_p.row = parseInt(ds_list_p.rowcount)-1;
		return;
	}// 원인부서 필수체크
	else if ( length( ds_list_p.getColumn(parseInt(ds_list_p.rowcount)-1, "REAQU")) == 0 ) {
		gfn_showMsg("CW00001",st_reaqu.value);
		ds_list_p.row = parseInt(ds_list_p.rowcount)-1;
		return;
	}
//	ds_list_p2.AddRow();
//	ds_list_p2.CopyRow(0, ds_list_p, parseInt(ds_list_p.rowcount)-1);

	if( gubun == 'A' )
	{
        ds_list5.SetColumn( ds_list5.row,"CLOSI", "0");
        ds_list5.SetColumn( ds_list5.row,"BLOCK", "1");
        ds_list5.SetColumn( ds_list5.row,"CHASU", "1");
        //ds_list5.SetColumn( ds_list5.row,"CHASU", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"CHASU"));
        ds_list5.SetColumn( ds_list5.row,"QUART", "1");
        ds_list5.SetColumn( ds_list5.row,"REMOV", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"REMOV"));
        ds_list5.SetColumn( ds_list5.row,"CHANG", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"CHANG"));
        ds_list5.SetColumn( ds_list5.row,"REASO", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"REASO"));
        ds_list5.SetColumn( ds_list5.row,"TXT01", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"TXT01"));
        ds_list5.SetColumn( ds_list5.row,"REAQU", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"REAQU"));
        ds_list5.SetColumn( ds_list5.row,"CNAME", G_USER_ID);
        ds_list5.SetColumn( ds_list5.row,"CDATE", SUBSTR(gfn_getCurrDate(),0,4)+"-"+SUBSTR(gfn_getCurrDate(),4,2)+"-"+SUBSTR(gfn_getCurrDate(),6,2));
	}
	else if (gubun == 'B')
	{
        ds_list5.SetColumn( ds_list5.row,"CHASU1", "1");
        //ds_list5.SetColumn( ds_list5.row,"CHASU1", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"CHASU"));
        ds_list5.SetColumn( ds_list5.row,"REMOV1", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"REMOV"));
        ds_list5.SetColumn( ds_list5.row,"CHANG1", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"CHANG"));
        ds_list5.SetColumn( ds_list5.row,"REASO1", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"REASO"));
        ds_list5.SetColumn( ds_list5.row,"TXT011", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"TXT01"));
        ds_list5.SetColumn( ds_list5.row,"REAQU1", ds_list_p.GetColumn( parseInt(ds_list_p.rowcount)-1,"REAQU"));
        ds_list5.SetColumn( ds_list5.row,"CNAME1", G_USER_ID);                                                                                        
        ds_list5.SetColumn( ds_list5.row,"CDATE1", SUBSTR(gfn_getCurrDate(),0,4)+"-"+SUBSTR(gfn_getCurrDate(),4,2)+"-"+SUBSTR(gfn_getCurrDate(),6,2));
	}
	fn_afterSave(0, "");

/*
	tit_clearActionInfo();
	if(gubun == 'A')
		tit_addSelectExActionInfo("ps02:PS0201001E_S5", "ps02:PS0201001E_I1", "ps02:PS0201001E_I2");
	else if (gubun == 'B')	
		tit_addSelectExActionInfo("ps02:PS0201001E_S6", "ps02:PS0201001E_I3", "ps02:PS0201001E_I4");
		
	tit_addSaveActionInfo("ps02:PS0201001E_U1");
	tit_addSaveActionInfo("ps02:PS0201001E_U2");
	tit_callService(
		""
		, ""
		, "ds_list=ds_list_p2:A"
		, ""
		, ""
		, "fn_afterSave");
*/		
}

/********************************************************************************
* 기      능   : 저장 Callback  
********************************************************************************/
function fn_afterSave(errCode, errMsg) {
	ds_list_p2.ClearData();
	ds_list_p.ApplyChange();

	if ( errCode!= 0 ) {
		if( gubun == 'A' )
		{
			ds_list5.setcolumn(ds_list5.row,"ZZSHIP1",ds_list5.getorgcolumn(ds_list5.row,"ZZSHIP1"));
		}
		else if( gubun == 'B' )
		{
			ds_list5.setcolumn(ds_list5.row,"ZZCOMP2",ds_list5.getorgcolumn(ds_list5.row,"ZZCOMP2"));
		}
	
		gfn_showMsg("CE00001");
	} else {
		saveFlg = 'Y';
		div_btn.btn_save.enable = false;
		ds_list5.setcolumn(ds_list5.row,"GUBUN","Y");
		gfn_showMsg("CI00003");
	}
}
/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {
}
/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}
//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================

/********************************************************************************
* 기      능   : 삽입 
********************************************************************************/
function fn_insert() {

}
/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {

	if( saveFlg == 'N' && gubun == 'A' )
	{
		ds_list5.setcolumn(ds_list5.row,"ZZSHIP1",ds_list5.getorgcolumn(ds_list5.row,"ZZSHIP1"));
	}
	else if( saveFlg == 'N' && gubun == 'B' )
	{
		ds_list5.setcolumn(ds_list5.row,"ZZCOMP2",ds_list5.getorgcolumn(ds_list5.row,"ZZCOMP2"));
	}

	close();
}
/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {
}
//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================

//변경사유 클릭 시 미사용 코드 선택 불가 => 공백처리(신성철 요청) -- LEH
function ds_list_p_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
   if(strColumnID == "REASO") 
   {  
     if(ds_list_p.getColumn(parseInt(ds_list_p.rowcount)-1, "REASO") == '103' or ds_list_p.getColumn(parseInt(ds_list_p.rowcount)-1, "REASO") == '104' 
        or ds_list_p.getColumn(parseInt(ds_list_p.rowcount)-1, "REASO") == '105' or ds_list_p.getColumn(parseInt(ds_list_p.rowcount)-1, "REASO") == '110' 
        or ds_list_p.getColumn(parseInt(ds_list_p.rowcount)-1, "REASO") == '301' or ds_list_p.getColumn(parseInt(ds_list_p.rowcount)-1, "REASO") == '401')
     {
        ds_list_p.SetColumn(parseInt(ds_list_p.rowcount)-1,"REASO", '');
       
      
        global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
	    global.FRM_BOTTOM.st_msg.color = "yellow";       
	    global.FRM_BOTTOM.st_msg.value = "미사용 코드는 사용 할 수 없습니다. 다시 선택하여 주십시오." ;
	  
	    return ;
     }
   }
}

/********************************************************************************
* 기      능   : 수정(변경사유, 변경사유내역 수정)
********************************************************************************/
function fn_change()
{
	ds_list_mod.ClearData();
	
	for(var i=0;i<ds_list_p.GetRowCount();i++)
	{
		if(ds_list_p.GetRowType(i) == 'update')
		{
			var nAddRow = ds_list_mod.AddRow();
			ds_list_mod.CopyRow(nAddRow,ds_list_p,i);
		}
	}
	
	//Trace(ds_list_mod.saveXML());	// REASO(변경사유), TXT01(변경사유 내역) 변경
	
	if(ds_list_mod.GetRowCount() > 0)
	{
		tit_clearActionInfo();
	
		if(gubun == 'A')
		{
			tit_addMultiActionInfo("ps02:PS0201001E_U3");	// 착공
		}
		else
		{
			tit_addMultiActionInfo("ps02:PS0201001E_U4");	// 준공
		}
		
		tit_callService(
			""
			, ""
			, "ds_list_mod=ds_list_mod"
			, ""
			, ""
			, "fn_afterSave2"
			, ""
			, ""
			, true);
	}
	else
	{
		alert("변경 내역이 없습니다.");
	}
	
}

function fn_afterSave2(errCode, errMsg)
{	
	alert("변경사항이 저장되었습니다.");
}
]]></Script>
</Window>