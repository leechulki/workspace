<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="544" Id="CS3301001A" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="매출&#32;및&#32;기성비&#32;조정" Top="8" Ver="1.0" Width="1232" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_condData">
				<Contents>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="PJT" size="256" summ="default" type="STRING"/>
					<colinfo id="HNO" size="256" summ="default" type="STRING"/>
					<colinfo id="GKD" size="256" summ="default" type="STRING"/>
					<colinfo id="USD" size="256" summ="default" type="STRING"/>
					<colinfo id="UGS" size="256" summ="default" type="STRING"/>
					<colinfo id="UHJ" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="CRS" size="256" summ="default" type="STRING"/>
					<colinfo id="TGB" size="256" summ="default" type="STRING"/>
					<record>
						<CRS></CRS>
						<CST>B01</CST>
						<GKD></GKD>
						<GNO></GNO>
						<HNO>S01</HNO>
						<PJT>000067</PJT>
						<SEQ>99</SEQ>
						<TGB></TGB>
						<UGS></UGS>
						<UHJ></UHJ>
						<UPN>000067</UPN>
						<USD></USD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_pjt">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_hno">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset CanColumnChange="ds_list_CanColumnChange" DataSetType="Dataset" Id="ds_list" OnColumnChanged="ds_list_OnColumnChanged">
				<Contents>
					<colinfo id="CHECK" size="256" summ="default" type="STRING"/>
					<colinfo id="TOT" size="13" summ="default" type="INT"/>
					<colinfo id="BAM" size="256" summ="default" type="STRING"/>
					<colinfo id="IY1" size="256" summ="default" type="STRING"/>
					<colinfo id="IY2" size="256" summ="default" type="STRING"/>
					<colinfo id="IY3" size="256" summ="default" type="STRING"/>
					<colinfo id="IY4" size="256" summ="default" type="STRING"/>
					<colinfo id="RET" size="256" summ="default" type="STRING"/>
					<colinfo id="JAR" size="256" summ="default" type="STRING"/>
					<colinfo id="TIS" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ1" size="256" summ="default" type="STRING"/>
					<colinfo id="GND1" size="256" summ="default" type="STRING"/>
					<colinfo id="ISR1" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ2" size="256" summ="default" type="STRING"/>
					<colinfo id="GND2" size="256" summ="default" type="STRING"/>
					<colinfo id="ISR2" size="256" summ="default" type="STRING"/>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="PJT" size="256" summ="default" type="STRING"/>
					<colinfo id="HNO" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT" size="13" summ="default" type="DECIMAL"/>
					<colinfo id="VAT" size="13" summ="default" type="DECIMAL"/>
					<colinfo id="JYM" size="256" summ="default" type="STRING"/>
					<colinfo id="YYM" size="256" summ="default" type="STRING"/>
					<colinfo id="GYM" size="256" summ="default" type="STRING"/>
					<colinfo id="FLAG1" size="256" summ="default" type="STRING"/>
					<colinfo id="FLAG2" size="256" summ="default" type="STRING"/>
					<colinfo id="PST" size="256" summ="default" type="STRING"/>
					<colinfo id="PST_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="RMK" size="256" summ="default" type="STRING"/>
					<colinfo id="YDT" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="PER" size="256" summ="default" type="STRING"/>
					<colinfo id="HMT" size="256" summ="default" type="STRING"/>
					<colinfo id="DMT" size="256" summ="default" type="STRING"/>
					<colinfo id="HAM" size="256" summ="default" type="STRING"/>
					<colinfo id="DAM" size="256" summ="default" type="STRING"/>
					<colinfo id="HYN" size="256" summ="default" type="STRING"/>
					<colinfo id="DYN" size="256" summ="default" type="STRING"/>
					<colinfo id="ACMT" size="256" summ="default" type="STRING"/>
					<colinfo id="ACAM" size="256" summ="default" type="STRING"/>
					<colinfo id="ACYN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="PJT" size="256" summ="default" type="STRING"/>
					<colinfo id="HNO" size="256" summ="default" type="STRING"/>
					<colinfo id="GKD" size="256" summ="default" type="STRING"/>
					<colinfo id="USD" size="256" summ="default" type="STRING"/>
					<colinfo id="UGS" size="256" summ="default" type="STRING"/>
					<colinfo id="UHJ" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="CRS" size="256" summ="default" type="STRING"/>
					<colinfo id="TGB" size="256" summ="default" type="STRING"/>
					<colinfo id="CHK" size="256" summ="default" type="STRING"/>
					<record>
						<CHK></CHK>
						<CRS></CRS>
						<CST></CST>
						<GKD></GKD>
						<GNO></GNO>
						<HNO></HNO>
						<PJT></PJT>
						<SEQ></SEQ>
						<TGB></TGB>
						<UGS></UGS>
						<UHJ></UHJ>
						<UPN></UPN>
						<USD></USD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_usd">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_condData127">
				<Contents>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="PJT" size="256" summ="default" type="STRING"/>
					<colinfo id="HNO" size="256" summ="default" type="STRING"/>
					<colinfo id="GKD" size="256" summ="default" type="STRING"/>
					<colinfo id="USD" size="256" summ="default" type="STRING"/>
					<colinfo id="UGS" size="256" summ="default" type="STRING"/>
					<colinfo id="UHJ" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="ISR" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond2">
				<Contents>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="PJT" size="256" summ="default" type="STRING"/>
					<colinfo id="HNO" size="256" summ="default" type="STRING"/>
					<colinfo id="GKD" size="256" summ="default" type="STRING"/>
					<colinfo id="USD" size="256" summ="default" type="STRING"/>
					<colinfo id="UGS" size="256" summ="default" type="STRING"/>
					<colinfo id="UHJ" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="ISR" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<record>
						<CODE/>
						<CODE_NAME/>
						<CST></CST>
						<GKD></GKD>
						<GNO></GNO>
						<HNO></HNO>
						<ISR></ISR>
						<PJT></PJT>
						<SEQ></SEQ>
						<UGS></UGS>
						<UHJ></UHJ>
						<UPN></UPN>
						<USD></USD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_maechul">
				<Contents>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="GND" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="JYM" size="256" summ="default" type="STRING"/>
					<colinfo id="VBELN" size="256" summ="default" type="STRING"/>
					<colinfo id="TIS" size="256" summ="default" type="STRING"/>
					<colinfo id="PST" size="256" summ="default" type="STRING"/>
					<colinfo id="VKBUR" size="256" summ="default" type="STRING"/>
					<colinfo id="GYM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_maechulE">
				<Contents>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="GND" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="JYM" size="256" summ="default" type="STRING"/>
					<colinfo id="VBELN" size="256" summ="default" type="STRING"/>
					<colinfo id="TIS" size="256" summ="default" type="STRING"/>
					<colinfo id="PST" size="256" summ="default" type="STRING"/>
					<colinfo id="VKBUR" size="256" summ="default" type="STRING"/>
					<colinfo id="GYM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_rcond">
				<Contents>
					<colinfo id="ZPROGRAM" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
					<record>
						<GBN></GBN>
						<ZPROGRAM></ZPROGRAM>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Static Font="맑은&#32;고딕,10" Height="24" Id="st_text" Left="16" TabOrder="22" Text="상주여부" Top="72" Width="248"></Static>
		<Shape BKColor="user0" Bottom="66" Height="30" Id="Shape0" Left="0" LineColor="user1" Right="978" TabOrder="1" Top="36" Type="Rectangle" Width="978"></Shape>
		<Static Align="Right" Height="20" Id="Static0" Left="5" Style="sty_lb_search" TabOrder="2" Text="Proj&#32;No&#32;" Top="41" VAlign="Middle" Width="80"></Static>
		<Static Align="Right" Height="20" Id="Static1" Left="169" Style="sty_lb_search" TabOrder="3" Text="호기&#32;" Top="41" VAlign="Middle" Width="80"></Static>
		<Static Align="Right" Height="20" Id="Static2" Left="313" Style="sty_lb_search" TabOrder="4" Text="계약구분" Top="41" VAlign="Middle" Width="80"></Static>
		<Edit BindDataset="ds_cond" Border="Flat" Column="GKD" DisableBKColor="user5" Enable="FALSE" Height="20" Id="ed_gkd" Left="394" Style="sty_ipt_search" TabOrder="5" Top="41" Width="83"></Edit>
		<Combo BindDataset="ds_cond" Border="Flat" CodeColumn="CODE" Column="HNO" DataColumn="CODE_NAME" Height="20" Id="cb_hno" InnerDataset="ds_hno" Left="249" OnChanged="ufn_setInitUsd" Style="sty_ipt_search" TabOrder="6" Top="40" Width="62"></Combo>
		<Static Align="Right" Height="20" Id="Static5" Left="480" Style="sty_lb_search" TabOrder="7" Text="계약시작일" Top="41" VAlign="Middle" Width="80"></Static>
		<Grid AutoFitEndLine="Hide" BindDataset="ds_list" BkColor2="default" BoldHead="true" Border="Flat" Bottom="536" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="440" Id="grd_list" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" OnKillFocus="grd_list_OnKillFocus" OnMouseOver="grd_list_OnMouseOver" Right="1224" RowHeight="20" Style="sty_grid" TabOrder="8" TabStop="true" Top="96" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="1216">
			<contents>
				<format id="Default">
					<columns>
						<col width="25"/>
						<col width="55"/>
						<col width="55"/>
						<col width="30"/>
						<col width="60"/>
						<col width="55"/>
						<col width="55"/>
						<col width="65"/>
						<col width="55"/>
						<col width="60"/>
						<col width="55"/>
						<col width="45"/>
						<col width="60"/>
						<col width="55"/>
						<col width="55"/>
						<col width="65"/>
						<col width="30"/>
						<col width="30"/>
						<col width="55"/>
						<col width="30"/>
						<col width="60"/>
						<col width="60"/>
						<col width="65"/>
						<col width="35"/>
						<col width="150"/>
					</columns>
					<head>
						<cell col="0" display="checkbox" rowspan="2"/>
						<cell col="1" display="text" rowspan="2">
							<cell align="center" col="0" color="user21" display="text" font="굴림,9" rowspan="2" text="기준년월"/>
						</cell>
						<cell col="2" color="user21" colspan="8" display="text" font="굴림,9" text="매출&#32;계획"/>
						<cell col="10" color="user21" colspan="12" display="text" font="굴림,9" text="기성비&#32;계획"/>
						<cell align="center" col="22" color="user21" display="text" font="굴림,9" rowspan="2" text="매출확정"/>
						<cell align="center" col="23" color="user21" display="text" font="굴림,9" rowspan="2" text="상태"/>
						<cell align="center" col="24" color="user21" display="text" font="굴림,9" rowspan="2" text="비고"/>
						<cell col="2" display="text" font="굴림,9" row="1" text="계획년월"/>
						<cell col="3" display="text" font="굴림,9" row="1" text="일자"/>
						<cell col="4" display="text" font="굴림,9" row="1" text="유지관리"/>
						<cell col="5" display="text" font="굴림,9" row="1" text="HRTS"/>
						<cell col="6" display="text" font="굴림,9" row="1" text="DI-PBX"/>
						<cell col="7" display="text" font="굴림,9" row="1" text="공기청정기"/>
						<cell col="8" display="text" font="굴림,9" row="1" text="부가세"/>
						<cell col="9" display="text" font="굴림,9" row="1" text="합계"/>
						<cell bkcolor="user23" col="10" color="user24" display="text" font="굴림,9" row="1" text="계획년월"/>
						<cell align="center" bkcolor="user23" col="11" color="user24" display="text" font="굴림,9" row="1" text="기성율"/>
						<cell align="center" bkcolor="user23" col="12" color="user24" display="text" font="굴림,9" row="1" text="기본"/>
						<cell align="center" bkcolor="user23" col="13" color="user24" display="text" font="굴림,9" row="1" text="HRTS"/>
						<cell align="center" bkcolor="user23" col="14" color="user24" display="text" font="굴림,9" row="1" text="DI-PBX"/>
						<cell align="center" bkcolor="user23" col="15" color="user24" display="text" font="굴림,9" row="1" text="공기청정기"/>
						<cell align="center" bkcolor="user23" col="16" color="user24" display="text" font="굴림,9" row="1" text="INC1"/>
						<cell align="center" bkcolor="user23" col="17" color="user24" display="text" font="굴림,9" row="1" text="INC2"/>
						<cell align="center" bkcolor="user23" col="18" color="user24" display="text" font="굴림,9" row="1" text="INC3"/>
						<cell align="center" bkcolor="user23" col="19" color="user24" display="text" font="굴림,9" row="1" text="INC4"/>
						<cell align="center" bkcolor="user23" col="20" color="user24" display="text" font="굴림,9" row="1" text="소급금액"/>
						<cell align="center" bkcolor="user23" col="21" color="user24" display="text" font="굴림,9" row="1" text="합계"/>
					</head>
					<body>
						<cell bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="0" colid="CHECK" display="checkbox" edit="expr:iif(TIS&gt;&apos;&apos;,&apos;none&apos;,&apos;checkbox&apos;)"/>
						<cell align="center" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="1" colid="JYM" display="text" Mask="####.##"/>
						<cell align="center" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="2" colid="YYM" display="text" limit="6" Mask="####.##"/>
						<cell align="center" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="3" colid="YDT" display="text" limit="6"/>
						<cell bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="4" colid="AMT" display="number"/>
						<cell bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="5" colid="HMT" display="number"/>
						<cell bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="6" colid="DMT" display="number"/>
						<cell bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="7" colid="ACMT" display="number"/>
						<cell bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="8" colid="VAT" display="number"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="9" colid="TOT" display="number" expr="AMT+HMT+DMT+ACMT+VAT"/>
						<cell align="center" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="10" colid="GYM" display="text" edit="expr:iif(PST&gt;&apos;A1&apos;,&apos;none&apos;,&apos;normal&apos;)" limit="6" Mask="####.##"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="11" colid="PER" display="number" expr="ROUND(((BAM+IY1+IY2+IY3+IY4+RET)/(AMT))*100,1)" Mask="##0.0"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="12" colid="BAM" display="number"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="13" colid="HAM" display="number" edit="expr:iif(HYN&#32;=&apos;N&apos;&#32;or&#32;PST&gt;&apos;A1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="14" colid="DAM" display="number" edit="expr:iif(DYN&#32;=&apos;N&apos;&#32;or&#32;PST&gt;&apos;A1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="15" colid="ACAM" display="number" edit="expr:iif(ACYN&#32;=&apos;N&apos;&#32;or&#32;PST&gt;&apos;A1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="16" colid="IY1" display="number" edit="expr:iif(PST&gt;&apos;A1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="17" colid="IY2" display="number" edit="expr:iif(PST&gt;&apos;A1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="18" colid="IY3" display="number" edit="expr:iif(PST&gt;&apos;A1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="19" colid="IY4" display="number" edit="expr:iif(PST&gt;&apos;A1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="20" colid="RET" display="number" edit="expr:iif(PST&gt;&apos;A1&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="21" colid="JAR" display="number" expr="BAM+HAM+DAM+ACAM+IY1+IY2+IY3+IY4+RET"/>
						<cell align="center" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="22" colid="TIS" display="text" Mask="####.##.##"/>
						<cell align="center" bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="23" colid="PST_NM" display="text"/>
						<cell bkcolor="expr:iif(trim(YYM)==trim(substr(gfn_getCurrDate(),0,6)),&apos;peachpuff&apos;,&apos;default&apos;)" col="24" colid="RMK" display="text" edit="expr:iif(PST&gt;&apos;A1&apos;,&apos;none&apos;,&apos;normal&apos;)"/>
					</body>
					<summary>
						<cell align="center" bkcolor="user25" col="0" color="user26" colspan="4" display="text" text="합&#32;&#32;계"/>
						<cell bkcolor="user25" col="4" color="user26" display="number" expr='ds_list.Sum(&quot;AMT&quot;)'/>
						<cell bkcolor="user25" col="5" color="user26" display="number" expr='ds_list.Sum(&quot;HMT&quot;)'/>
						<cell bkcolor="user25" col="6" color="user26" display="number" expr='ds_list.Sum(&quot;DMT&quot;)'/>
						<cell bkcolor="user25" col="7" color="user26" display="number" expr='ds_list.Sum(&quot;ACMT&quot;)'/>
						<cell bkcolor="user25" col="8" color="user26" display="number" expr='ds_list.Sum(&quot;VAT&quot;)'/>
						<cell bkcolor="user25" col="9" color="user26" display="number" expr='ds_list.Sum(&quot;TOT&quot;)'/>
						<cell bkcolor="user25" col="10" color="user26" display="text"/>
						<cell bkcolor="user25" col="11" color="user26" display="text"/>
						<cell bkcolor="user25" col="12" color="user26" display="number" expr='ds_list.Sum(&quot;BAM&quot;)'/>
						<cell bkcolor="user25" col="13" color="user26" display="number" expr='ds_list.Sum(&quot;HAM&quot;)'/>
						<cell bkcolor="user25" col="14" color="user26" display="number" expr='ds_list.Sum(&quot;DAM&quot;)'/>
						<cell bkcolor="user25" col="15" color="user26" display="number" expr='ds_list.Sum(&quot;ACAM&quot;)'/>
						<cell bkcolor="user25" col="16" color="user26" display="number" expr='ds_list.Sum(&quot;IY1&quot;)'/>
						<cell bkcolor="user25" col="17" color="user26" display="number" expr='ds_list.Sum(&quot;IY2&quot;)'/>
						<cell bkcolor="user25" col="18" color="user26" display="number" expr='ds_list.Sum(&quot;IY3&quot;)'/>
						<cell bkcolor="user25" col="19" color="user26" display="number" expr='ds_list.Sum(&quot;IY4&quot;)'/>
						<cell bkcolor="user25" col="20" color="user26" display="number" expr='ds_list.Sum(&quot;RET&quot;)'/>
						<cell bkcolor="user25" col="21" color="user26" display="number" expr='ds_list.Sum(&quot;BAM&quot;)+ds_list.Sum(&quot;IY1&quot;)+ds_list.Sum(&quot;IY2&quot;)+ds_list.Sum(&quot;IY3&quot;)+ds_list.Sum(&quot;IY4&quot;)'/>
						<cell bkcolor="user25" col="22" color="user26" display="text"/>
						<cell bkcolor="user25" col="23" color="user26" display="text"/>
						<cell bkcolor="user25" col="24" color="user26" display="text"/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Combo BindDataset="ds_cond" Border="Flat" CodeColumn="CODE" Column="PJT" DataColumn="CODE_NAME" Height="20" Id="cb_pjt" InnerDataset="ds_pjt" Left="85" OnChanged="ufn_setInitHno" Style="sty_ipt_search" TabOrder="9" Top="40" Width="82"></Combo>
		<Static Align="Right" Height="20" Id="Static3" Left="645" Style="sty_lb_search" TabOrder="10" Text="유상개시일" Top="41" VAlign="Middle" Width="80"></Static>
		<Static Align="Right" Height="20" Id="Static4" Left="810" Style="sty_lb_search" TabOrder="11" Text="계약만기일" Top="41" VAlign="Middle" Width="80"></Static>
		<MaskEdit BindDataset="ds_cond" Border="Flat" Column="UGS" Cursor="IBEAM" DisableBKColor="user5" Enable="FALSE" Height="20" Id="med_ugs" Left="726" LeftMargin="4" Mask="####.##.##" Style="sty_ipt_search" TabOrder="12" Top="41" Type="STRING" Width="82"></MaskEdit>
		<MaskEdit BindDataset="ds_cond" Border="Flat" Column="UHJ" Cursor="IBEAM" DisableBKColor="user5" Enable="FALSE" Height="20" Id="med_uhj" Left="891" LeftMargin="4" Mask="####.##.##" OnChanged="med_uhj_OnChanged" Style="sty_ipt_search" TabOrder="13" Top="41" Type="STRING" Width="82"></MaskEdit>
		<Div Height="36" Id="div_btn" TabOrder="14" Text="Div0" ToolTipFont="Default,0" Url="WB01::CommBtnForm.xml" Width="1224">
			<Contents></Contents>
		</Div>
		<Combo BindDataset="ds_cond" Border="Flat" CodeColumn="CODE" Column="USD" DataColumn="CODE_NAME" Height="20" Id="cb_usd" InnerDataset="ds_usd" Left="560" OnChanged="ufn_setInitHeader" Style="sty_ipt_search" TabOrder="15" Top="40" Width="82"></Combo>
		<Edit BindDataset="ds_cond" Border="Flat" Column="SEQ" Height="18" Id="ed_seq" Left="488" TabOrder="16" Text="SEQ" Top="560" Visible="FALSE" Width="54"></Edit>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_copy" ImageID="btn_sub_05" Left="886" LeftMargin="12" OnClick="btn_copy_OnClick" Style="sty_btn" TabOrder="17" Text="Copy&#32;Tool" Top="71" Transparent="TRUE" Width="83"></Button>
		<Checkbox Height="17" Id="chk_all2" Left="764" TabOrder="18" Text="기성&#32;전체&#32;적용" Top="73" Value="FALSE" Width="100"></Checkbox>
		<Checkbox DisableBKColor="user12" Enable="FALSE" Height="17" Id="chk_all1" Left="656" OnClick="Checkbox0_OnClick" TabOrder="19" Text="매출&#32;전체&#32;적용" Top="73" Value="FALSE" Width="100"></Checkbox>
		<Static Align="Right" Height="20" Id="st_z99" Left="313" Style="sty_lb_search" TabOrder="20" Text="상주&#32;순번&#32;" Top="72" VAlign="Middle" Width="80"></Static>
		<Combo BindDataset="ds_cond2" Border="Flat" CodeColumn="CODE" Column="ISR" DataColumn="CODE_NAME" Height="20" Id="cb_sangjuList" InnerDataset="ds_condData127" Left="393" OnChanged="ufn_afterSetInitHeader2" Style="sty_ipt_search" TabOrder="21" Top="71" Width="150"></Combo>
		<Checkbox Height="17" Id="chk_z99" Left="1232" TabOrder="23" Text="상주&#32;변경" Top="32" Value="FALSE" Width="100"></Checkbox>
		<Button ButtonStyle="TRUE" Cursor="HAND" Enable="FALSE" Height="20" Id="btn_maechul" ImageID="btn_sub_05" Left="987" LeftMargin="12" OnClick="btn_maechul_OnClick" Style="sty_btn" TabOrder="24" Text="월&#32;매출확정" Top="71" Transparent="TRUE" Visible="FALSE" Width="83"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Enable="FALSE" Height="20" Id="btn_cancel" ImageID="btn_sub_05" Left="987" LeftMargin="12" OnClick="btn_cancel_OnClick" Style="sty_btn" TabOrder="25" Text="매출확정취소" Top="42" Transparent="TRUE" Visible="FALSE" Width="83"></Button>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::common_cs.js";	// 서비스 공통 스크립트
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var t_med_usd, t_med_uhj;
var idx = 0;
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
var upn;
var cst;
var gbn;
var t_gym;
var t_pst;

var vMaechul_auth = "";
var vCancel_auth = "";
var vSangju_auth = "";

function fn_OnLoadCompleted(obj) {
	gfn_initForm();	
	ds_cond.SetColumn(0,"UPN",upn);
	ds_cond.SetColumn(0,"CST",cst);	
	
	div_btn.btn_query.visible = false;
	st_z99.Visible = false;
	cb_sangjuList.Visible = false;
	
	
	/*
	if( G_USER_ID == "2021153" or G_USER_ID == "2018209" or G_USER_ID == "2018900" or G_USER_ID == "2029758" or G_USER_ID == "2999999") {
		st_z99.Visible = true;
		cb_sangjuList.Visible = true;
	}
	*/
	//=================위의 상주관련 선택 공통권한으로 뺌==================
	gfn_initDs(ds_rcond, true);
	ds_rcond.SetColumn(0, "ZPROGRAM", "CS3301001A");
	ds_rcond.SetColumn(0, "GBN", "03");	
	vSangju_auth = gfn_getAuth(ds_rcond);
	ds_rcond.ClearData();
	
	if(vSangju_auth == true) {
		st_z99.Visible = true;
		cb_sangjuList.Visible = true;
	}
	//======================================================================
	
	
	if (vkbur == "H100"){
		//============== 자회사 매출확정 버튼 권한 ===============================	
		if (G_SAP_USER_VBCD == "H100"){
			vMaechul_auth = "1";
		} else {
			gfn_initDs(ds_rcond, true);
			ds_rcond.SetColumn(0, "ZPROGRAM", "CS3301001A");
			ds_rcond.SetColumn(0, "GBN", "02");	
			vMaechul_auth = gfn_getAuth2(ds_rcond);
			ds_rcond.ClearData();
			if (G_USER_ID == "2999999")
				vMaechul_auth = "1";
		}
		
		if (vMaechul_auth == "1"){
			btn_maechul.Visible = true;
			if (vkbur=="H100")
				btn_maechul.Enable = true;
			else
				btn_maechul.Enable = false;
		}
		//============== 자회사 매출확정 버튼 권한 ===============================	
	
		//============== 자회사 매출취소 버튼 권한 ===============================	
		gfn_initDs(ds_rcond, true);
		ds_rcond.SetColumn(0, "ZPROGRAM", "CS3301001A");
		ds_rcond.SetColumn(0, "GBN", "01");	
		vCancel_auth = gfn_getAuth(ds_rcond);
		ds_rcond.ClearData();
		if (vCancel_auth == "1"){
			btn_cancel.Visible = true;
			if (vkbur=="H100")
				btn_cancel.Enable = true;
			else
				btn_cancel.Enable = false;
		}
		//============== 자회사 매출취소 버튼 권한 ===============================	
	} else {
		btn_maechul.Visible = false;
		btn_cancel.Visible = false;
	}

	ufn_setInitPjt();
	
}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 1
********************************************************************************/
function fn_query() {
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs33:CS3301001A_S4");

	t_med_usd = cb_usd.value;
	t_med_uhj = med_uhj.value;

	ds_cond.SetColumn(0,"USD",substr(t_med_usd,0,6));
	ds_cond.SetColumn(0,"UHJ",substr(t_med_uhj,0,6));
	
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond"
        , "ds_list=ds_list"
        , ""
        , "fn_afterQuery"
        , true
        , true
        , true);
}
function fn_query2() {
//TRACE(DS_COND2.SaveXML());

	ds_cond2.SetColumn(0,"USD",substr(cb_usd.value,0,6));
	ds_cond2.SetColumn(0,"UHJ",substr(med_uhj.value,0,6));
	
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs33:CS3301001A_S7");

	tit_callService(
        ""
        , ""
        , "ds_cond2=ds_cond2"
        , "ds_list=ds_list"
        , ""
        , "fn_afterQuery"
        , true
        , true
        , true);
}
/********************************************************************************
* 기      능   : 저장 
********************************************************************************/
function fn_save() {
	ds_list.FireEvent=false;
	var z = 0;
	for(var i=0; i<ds_list.GetRowCount(); i++) {
		ds_list.SetColumn(i,"FLAG1","");
		ds_list.SetColumn(i,"FLAG2","");
		if(ds_list.GetColumn(i,"CHECK") == 1) {
			var strJar;
			var strTot;
			var strAmt;
			var strVat;
			var strSut;

			if(length(trim(ds_list.GetColumn(i,"YDT"))) < 2) {
				gfn_showAlert("일자 입력을 정확히 하십시요.");
				ds_list.FireEvent=true;
				return;
			}
			if(ds_list.GetColumn(i, "PST") == 'A6') {
//			if(trim(t_gym) >= ds_list.GetColumn(i,"GYM")) {
				var arr = [parseInt(i) + 1];
				gfn_showMsg("CW00179", arr);
				ds_list.FireEvent=true;
				return;
			} else {
				if(gbn == "Y") { //영세율 적용여부가 '예' 인 경우
					strJar = ds_list.GetColumn(i,"BAM") + ds_list.GetColumn(i,"HAM") + ds_list.GetColumn(i,"DAM") + ds_list.GetColumn(i,"ACAM") + ds_list.GetColumn(i,"IY1") +ds_list.GetColumn(i,"IY2") +ds_list.GetColumn(i,"IY3") + ds_list.GetColumn(i,"IY4") + ds_list.GetColumn(i,"RET");
					strSut = ds_list.GetColumn(i,"AMT") + ds_list.GetColumn(i,"HMT") + ds_list.GetColumn(i,"DMT") + ds_list.GetColumn(i,"ACMT");
					strTot = strSut;
					strVat = 0;
				} else { //영세율 적용여부가 '아니오' 인 경우
					strJar = ds_list.GetColumn(i,"BAM") + ds_list.GetColumn(i,"HAM") + ds_list.GetColumn(i,"DAM") + ds_list.GetColumn(i,"ACAM") + ds_list.GetColumn(i,"IY1") +ds_list.GetColumn(i,"IY2") +ds_list.GetColumn(i,"IY3") + ds_list.GetColumn(i,"IY4") + ds_list.GetColumn(i,"RET");
					strSut = ds_list.GetColumn(i,"AMT") + ds_list.GetColumn(i,"HMT") + ds_list.GetColumn(i,"DMT") + ds_list.GetColumn(i,"ACMT");
					strVat = parseInt(round((strSut * 1.1),1) / 10) * 10;
					strVat = (strSut * 0.1) + (strVat - (strSut * 1.1));
					strTot = (strSut + strVat);
				}

				ds_list.SetColumn(i,"JAR",strJar);
				ds_list.SetColumn(i,"TOT",strTot);
				ds_list.SetColumn(i,"VAT",strVat);

				if(ds_list.GetColumn(i,"TIS") > "") {
					ds_list.SetColumn(i,"GND1","X");
				} else {
					ds_list.SetColumn(i,"GND1",ds_list.GetOrgColumn(i,"GND1"));
				}

				if(ds_list.GetColumn(i,"YYM") !=null && ds_list.GetColumn(i,"YYM")!=""){
					ds_list.SetColumn(i,"FLAG1","U");
				}
				ds_list.SetColumn(i,"FLAG2","U");
				z++;
			}
		}
	}

	ds_list.FireEvent=true;

	if(z == 0) {
		gfn_showMsg("CW00005");
		return;		
	}
	
	if(chk_z99.Value == true) {
		ufn_136Update2();
	} else {
		ufn_131136Update();
	}

	calc_Amt();
}
/********************************************************************************
* 기      능   : 상주 기성 수정 시 ( 관리자 용 )
********************************************************************************/
function ufn_136Update2() {
	
	tit_clearActionInfo();
	tit_addSaveActionInfo("", "cs33:CS3301001A_U2", "", "FLAG2");	
	tit_callService(
        ""
        , ""
        , "ds_list=ds_list:A"
        , ""
        , ""
        , "fn_afterSave2"
        , true
        , true
        , true);
}
/********************************************************************************
* 기      능   : 정기보수 
********************************************************************************/
function ufn_131136Update() {
	var sql1 = "";
	var sql2 = "";
	var sql3 = "";
	var sql4 = "";

	if(chk_all1.Value == false && chk_all2.Value == false) { // 하나 호기 적용
		sql1 = "cs33:CS3301001A_U1"; // ZCST131 UPDATE(정기보수)
		sql2 = "cs33:CS3301001A_U2"; // ZCST136 UPDATE(정기보수)
		sql3 = "cs33:CS3301001A_U3"; // ZCST131 UPDATE(인원상주)
		sql4 = "cs33:CS3301001A_U4"; // ZCST136 UPDATE(인원상주)
	} else if(chk_all1.Value == true && chk_all2.Value == false) { // 매출 전체 적용
		sql1 = "cs33:CS3301001A_U5"; // ZCST131 UPDATE(정기보수) : 전체
		sql3 = "cs33:CS3301001A_U7"; // ZCST131 UPDATE(인원상주) : 전체
	} else if(chk_all1.Value == false && chk_all2.Value == true) { // 기성 전체 적용
		sql2 = "cs33:CS3301001A_U6"; // ZCST136 UPDATE(정기보수) : 전체
		sql4 = "cs33:CS3301001A_U8"; // ZCST136 UPDATE(인원상주) : 전체
	} else {
		sql1 = "cs33:CS3301001A_U5"; // ZCST131 UPDATE(정기보수) : 전체
		sql2 = "cs33:CS3301001A_U6"; // ZCST136 UPDATE(정기보수) : 전체
		sql3 = "cs33:CS3301001A_U7"; // ZCST131 UPDATE(인원상주) : 전체
		sql4 = "cs33:CS3301001A_U8"; // ZCST136 UPDATE(인원상주) : 전체
	}

	tit_clearActionInfo();
	
	if(chk_all1.Value == false && chk_all2.Value == false) { // 하나 호기 적용
		tit_addSaveActionInfo("", sql1, "", "FLAG1");
		tit_addSaveActionInfo("", sql2, "", "FLAG2");
		tit_addSaveActionInfo("", sql3, "", "FLAG1");
		tit_addSaveActionInfo("", sql4, "", "FLAG2");
	} else if(chk_all1.Value == true && chk_all2.Value == false) { // 매출 전체 적용
		tit_addSaveActionInfo("", sql1, "", "FLAG1");
		tit_addSaveActionInfo("", sql3, "", "FLAG1");
	} else if(chk_all1.Value == false && chk_all2.Value == true) { // 기성 전체 적용
		tit_addSaveActionInfo("", sql2, "", "FLAG2");
		tit_addSaveActionInfo("", sql4, "", "FLAG2");
	} else {
		tit_addSaveActionInfo("", sql1, "", "FLAG1");
		tit_addSaveActionInfo("", sql2, "", "FLAG2");
		tit_addSaveActionInfo("", sql3, "", "FLAG1");
		tit_addSaveActionInfo("", sql4, "", "FLAG2");
	}

	tit_callService(
        ""
        , ""
        , "ds_list=ds_list:A"
        , ""
        , ""
        , "fn_afterSave"
        , true
        , true
        , true);
}

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}

/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {
	// Excel Export 
	gfn_saveToExcel(grd_list, true );	
}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	// 메시지 처리 
	gfn_showSearchMsg(grd_list);
	
	chk_all1.value = false;
	chk_all2.value = false;
	cb_usd.Index = idx;
	ds_cond.SetColumn(0,"USD",t_med_usd);
	ds_cond.SetColumn(0,"UHJ",t_med_uhj);

	t_gym = "000000";
	t_pst = "";

	for(var i=0; i<ds_list.GetRowCount(); i++) {
		if(trim(ds_list.GetColumn(i, "PST")) == "A6") {
			if(trim(t_gym) < trim(ds_list.GetColumn(i, "GYM"))) {
				t_gym = trim(ds_list.GetColumn(i, "GYM"));
			}
			t_pst = trim(ds_list.GetColumn(i, "PST"));
		}

		if(trim(t_pst) <> "A6") {
			t_gym = gfn_getBeforeMonth(trim(ds_list.GetColumn(0, "JYM")), 1);
		}
	} 
	
	if( length(cb_sangjuList.Value) > 0 ){
		st_text.Text = "상주계약 매출 및 기성비 계획";
		chk_z99.Value = true;
	} else {
		st_text.Text = "";
		chk_z99.Value = false;
	}
	if (vkbur == "H100"){
		if (btn_maechul.Visible == true){
			if (gno == ds_list.GetColumn(0, "GNO")){
				btn_maechul.Enable = true;
			} else {
				btn_maechul.Enable = false;
			}
		}
		if (btn_cancel.Visible == true){
			if (gno == ds_list.GetColumn(0, "GNO")){
				btn_cancel.Enable = true;
			} else {
				btn_cancel.Enable = false;
			}
		}
	
		if (btn_cancel.Visible == true && btn_cancel.Enable == true && vkbur == "H100" && gno == ds_list.GetColumn(0, "GNO")){
			grd_list.SetCellProp("BODY",0, "edit","checkbox");
		} else {
			grd_list.SetCellProp("BODY",0, "edit","expr:iif(TIS>'','none','checkbox')");
		}
	}
/*
	if(G_USER_ID == "2018454" || G_USER_ID == "2017750" || G_USER_ID == "2021200") {
		btn_copy.Enable = true;
		div_btn.btn_save.Enable = true;
	} else {
		btn_copy.Enable = false;
		div_btn.btn_save.Enable = false;
	}
*/
}

/********************************************************************************
* 기      능   : 저장 Callback  
********************************************************************************/
function fn_afterSave(errCode, errMsg) {
	if(errCode != 0) {
		gfn_showMsg("CE00001");
	} else {
		gfn_showMsg("CI00005");
		fn_query();
	}
}
/********************************************************************************
* 기      능   : 저장 Callback  
********************************************************************************/
function fn_afterSave2(errCode, errMsg) {
	if(errCode != 0) {
		gfn_showMsg("CE00001");
	} else {
		gfn_showMsg("CI00005");
		fn_query2();
	}
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
// 사용자 정의 함수는 ufn_xxxx() 형태로 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 사용자 정의 함수  
********************************************************************************/
function ufn_setInitPjt() {
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs33:CS3301001A_S1");

	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond"
        , "ds_pjt=ds_pjt"
        , ""
        , "ufn_afterSetInitPjt"
        , true
        , true
        , true);
}

function ufn_afterSetInitPjt() {
	cb_pjt.Index = 0;
	ufn_setInitHno();
}

function ufn_setInitHno() {	

	tit_clearActionInfo();
	tit_addSearchActionInfo("cs33:CS3301001A_S2");
	
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond"
        , "ds_hno=ds_hno"
        , ""
        , "ufn_afterSetInitHno"
        , true
        , true
        , true);
}

function ufn_afterSetInitHno() {
	cb_hno.Index = 0;
	ufn_setInitUsd();
}

function ufn_setInitUsd() {	
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs33:CS3301001A_S5");
	
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond"
        , "ds_usd=ds_usd"
        , ""
        , "ufn_afterSetInitUsd"
        , true
        , true
        , true);
}

function ufn_afterSetInitUsd() {
	cb_usd.Index = 0;
	ed_seq.value = ds_usd.GetColumn(0,"SEQ");
	ufn_setInitHeader();
}

function ufn_setInitHeader() {
	// 상주 순번 리스트 초기화
	cb_sangjuList.value = "";
	
	ds_cond.SetColumn(0,"SEQ",ds_usd.GetColumn(cb_usd.Index,"SEQ"));
	ds_cond.SetColumn(0,"GNO",ds_usd.GetColumn(cb_usd.Index,"GNO"));
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs33:CS3301001A_S3");
	tit_addSearchActionInfo("cs33:CS3301001A_S6"); // 상주 정보 set
	idx = cb_usd.Index;
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond"
        , "ds_condData=ds_condData ds_condData127=ds_condData127"
        , ""
        , "ufn_afterSetInitHeader"
        , true
        , true
        , true);	
}

function ufn_afterSetInitHeader() {
	cb_usd.Index = idx;

	if(ds_condData.GetRowCount()>0){
		ds_cond.Copy(ds_condData);		
	} else {
		ds_cond.SetColumn(0,"GKD","");
		ds_cond.SetColumn(0,"USD","");
		ds_cond.SetColumn(0,"UGS","");
		ds_cond.SetColumn(0,"UHJ","");		
	}

	//=============직영 + 중도해지시 추가=============
	if( length(trim(ds_cond.GetColumn(0, "CRS"))) > 0  && ds_cond.GetColumn(0, "TGB") == '1' )
	{
		ds_cond.SetColumn(0, "CHK", "X");
	}
    //================================================

	fn_query();
}

function ufn_afterSetInitHeader2() {

	var idx2 = ds_condData127.FindRow("ISR",cb_sangjuList.Value);
	
	ds_cond2.CopyRow(0, ds_condData127, idx2);

	fn_query2();
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 : 각 Component 별 이벤트 
//=========================================================================================
/********************************************************************************
* 기      능   : 그리드 헤더 클릭시 정렬 처리 
********************************************************************************/
function grd_list_OnHeadClick(obj,nCell,nX,nY,nPivotIndex) {
	if ( nCell == 0 ) {
		// 그리드 표시할 컬럼 선택 
		gfn_selectGridCol(obj);
	} else {
		// 그리드 정렬 처리 
		gfn_sortGrid(obj,nCell);
	}
}
function ds_list_CanColumnChange(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if (strColumnID == "CHECK"){
		if (vkbur != "H100" || gno != ds_list.getColumn(nRow, "GNO")){
			if (length(ds_list.GetColumn(nRow, "TIS")) > 0){
				return;
			}
		}
	}
}

/********************************************************************************
* 기      능   : 데이터셋 값 변경 시 - Flag 처리 
********************************************************************************/
function ds_list_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex) {
	var tmp_flag = false;
	var tmp_ugs = replace(med_ugs.value,'.','');
	var tmp_uhj = replace(med_uhj.value,'.','');

	tmp_ugs = substr(tmp_ugs,0,6);
	tmp_uhj = substr(tmp_uhj,0,6);

	if(strColumnID != "CHECK") {
		ds_list.FireEvent=false;
		ds_list.SetColumn(nRow,"CHECK","1");
		if(strColumnID == "YYM" || strColumnID == "GYM") {
			if(length(varNewValue) != 6) {
				gfn_showAlert("CW00011","6");
				ds_list.SetColumn(nRow,strColumnID,varOldValue);	
				ds_list.SetColumn(nRow,"CHECK","");	
			}
		}

		var tmp_gym = "";
		var tmp_pst = "";
		var tmp_yym = ds_list.GetColumn(nRow, "YYM");

		for(var i=0; i<ds_list.GetRowCount(); i++) {
			tmp_gym = ds_list.GetColumn(i, "GYM");
			tmp_pst = ds_list.GetColumn(i, "PST");

			if(tmp_yym == tmp_gym && tmp_pst == 'A6') {
				tmp_flag = true;
			}
		}

		if(strColumnID == "YYM") {
			if(tmp_flag == true || tmp_yym < tmp_ugs || tmp_yym > tmp_uhj) {
				gfn_showAlert("CW00187");
				ds_list.SetColumn(nRow,strColumnID,varOldValue);
				ds_list.SetColumn(nRow,"CHECK","");
				tmp_flag = false;
			}
		}		
		ds_list.FireEvent=true;	
	}
	calc_Amt();
}

function btn_copy_OnClick(obj) {
	var arg = "upn=" + quote(upn) +
			  " cst=" + quote(cst) +
			  " pjt=" + quote(cb_pjt.value) +
			  " hno=" + quote(cb_hno.value) +
			  " seq=" + quote(ed_seq.value) +
			  " usd=" + quote(t_med_usd) +
			  " uhj=" + quote(t_med_uhj) +
			  " hyn=" + quote(ds_list.GetColumn(0, "HYN")) +
			  " dyn=" + quote(ds_list.GetColumn(0, "DYN")) +
			  " acyn=" + quote(ds_list.GetColumn(0, "ACYN"));

	gfn_openPopup("CS3301001C", true, arg);
}

function calc_Amt() {
	var tmp_pergnd = gbn;
	
	if(tmp_pergnd == 'Y') {
		ds_list.FireEvent = false;
		for(var i=0; i<ds_list.RowCount(); i++) {
			if(ds_list.GetColumn(i, "CHECK") == true) {
				ds_list.SetColumn(i, "TOT", ds_list.GetColumn(i, "AMT") + ds_list.GetColumn(i, "HMT") + ds_list.GetColumn(i, "DMT") + ds_list.GetColumn(i, "ACMT"));
				ds_list.SetColumn(i, "VAT", 0);
			}
		}
		ds_list.FireEvent = true;
	} else {
		ds_list.FireEvent = false;
		for(var i=0; i<ds_list.RowCount(); i++) {
			var t_sut = ds_list.GetColumn(i, "AMT") + ds_list.GetColumn(i, "HMT") + ds_list.GetColumn(i, "DMT") + ds_list.GetColumn(i, "ACMT");
			var t_vat = parseInt(round((t_sut * 1.1),1) / 10) * 10;
			t_vat = (t_sut * 0.1) + (t_vat - (t_sut * 1.1));

			if(ds_list.GetColumn(i, "CHECK") == true) {
				if(Round((ds_list.GetColumn(i, "AMT") + ds_list.GetColumn(i, "HMT") + ds_list.GetColumn(i, "DMT") + ds_list.GetColumn(i, "ACMT")),0) == 0) {
					t_vat = 0;
				}
				ds_list.SetColumn(i, "VAT", t_vat);
				ds_list.SetColumn(i, "TOT", t_sut + t_vat);
			}
		}
		ds_list.FireEvent = true;
	}
}

function grd_list_OnKillFocus(obj) {
	calc_Amt();
}

function grd_list_OnMouseOver(obj,nPosX,nPosY,nRow,nCell,nPivotIndex) {
	grd_list.ToolTipText = ds_list.GetColumn(nRow, "RMK");
}



function btn_maechul_OnClick(obj)
{
	if (vVkbur != "H100"){
		alert("자회사의 매출정보가 아닙니다.");
		return;
	}
	if (G_SAP_USER_VBCD != "H100" && vMaechul_auth != "1"){
		alert("'매출확정' 권한이 없습니다.");
		return;
	}

	if (length(vbeln) == 0){
		alert("유상보수계약을 수주확정 후 매출확정하세요");
		return;
	}
	var vCheckCnt = ds_list.CaseCount("CHECK=='1'");
	var vRow = -1;
	if (vCheckCnt == 0){
		alert("'매출확정'할 월을 선택해 후 작업하세요");
		return;
	} else if (vCheckCnt > 1){
		alert("'매출확정'은 1개월만 처리할 수 있습니다.");
		return;
	} else {
		vRow = ds_list.FindRow("CHECK","1");
		if (ds_list.GetColumn(vRow, "TIS") != ""){
			alert("매출확정 처리된 월입니다.");
			return;
		}
		if (vRow > 0 && ds_list.GetColumn(vRow - 1, "TIS") == ""){
			alert("전월의 매출이 확정되지 않았습니다.");
			return;
		}
	}
		
	// 매출확정
	// 매출확정은 월단위로 처리하면, 매출확정 이후 기성자료를 완료(pst='A6')처리한다.
	ds_maechul.ClearData();
	ds_maechul.AddRow();
	ds_maechul.SetColumn(0, "UPN", upn);
	ds_maechul.SetColumn(0, "CST", cst);
	ds_maechul.SetColumn(0, "SEQ", ds_condData.GetColumn(0, "SEQ"));
	ds_maechul.SetColumn(0, "GND", gnd);
	ds_maechul.SetColumn(0, "GNO", gno);
	
	//ds_maechul.SetColumn(0, "JYM", ds_list.GetColumn(vRow, "JYM"));  //JYM 을 아래 YYM으로 변경
	ds_maechul.SetColumn(0, "JYM", ds_list.GetColumn(vRow, "YYM"));
	ds_maechul.SetColumn(0, "GYM", ds_list.GetColumn(vRow, "GYM"));
	
	ds_maechul.SetColumn(0, "VBELN", vbeln);
	ds_maechul.SetColumn(0, "TIS", today());
	ds_maechul.SetColumn(0, "PST", "A6");
	ds_maechul.SetColumn(0, "VKBUR", "H100");
	
	ds_maechulE.ClearData();
	ds_maechulE.AddRow();
	ds_maechulE.SetColumn(0, "UPN", upn);
	ds_maechulE.SetColumn(0, "CST", cst);
	ds_maechulE.SetColumn(0, "SEQ", ds_condData127.GetColumn(0, "SEQ"));
	ds_maechulE.SetColumn(0, "GND", "E");
	ds_maechulE.SetColumn(0, "GNO", gno);
	
	//ds_maechulE.SetColumn(0, "JYM", ds_list.GetColumn(vRow, "JYM"));
	ds_maechulE.SetColumn(0, "JYM", ds_list.GetColumn(vRow, "YYM"));
	ds_maechulE.SetColumn(0, "GYM", ds_list.GetColumn(vRow, "GYM"));
	
	ds_maechulE.SetColumn(0, "VBELN", vbeln);
	ds_maechulE.SetColumn(0, "TIS", today());
	ds_maechulE.SetColumn(0, "PST", "A6");
	ds_maechulE.SetColumn(0, "VKBUR", "H100");
	
	tit_clearActionInfo();
 	tit_addMultiActionInfo("cs33:CS3301001A_U9");	// ZCST131
 	tit_addMultiActionInfo("cs33:CS3301001A_U10");	// ZCST131	인원상주
 	tit_addMultiActionInfo("cs33:CS3301001A_U11");	// ZCST136
 	tit_addMultiActionInfo("cs33:CS3301001A_U12");	// ZCST136	인원상주
	tit_callService(
		""
		, ""
		, "ds_cs131=ds_maechul ds_cs131E=ds_maechulE ds_cs136=ds_maechul ds_cs136E=ds_maechulE"
		, ""
		, ""
		, "fn_afterMaechul"
		, true
		, false
		, false);	
}

function fn_afterMaechul(errCode, errMsg) {
	if(errCode != 0) {
		gfn_showMsg("CE00001");
	} else {
		gfn_showMsg("CI00003");
		fn_query();
	}
}
function btn_cancel_OnClick(obj)
{
	if (vVkbur != "H100"){
		alert("자회사의 매출정보가 아닙니다.");
		return;
	}
	
	if (vCancel_auth != "1"){
		alert("'매출취소'권한이 없습니다.");
		return;
	}
	
	var vCheckCnt = ds_list.CaseCount("CHECK=='1'");
	var vRow = -1;
	if (vCheckCnt == 0){
		alert("'매출취소'할 월을 선택해 후 작업하세요");
		return;
	} else if (vCheckCnt > 1){
		alert("'매출취소'은 1개월만 처리할 수 있습니다.");
		return;
	} else {
		vRow = ds_list.FindRow("CHECK","1");
		if (ds_list.GetColumn(vRow, "TIS") = ""){
			alert("매출확정 월이 아닙니다.");
			return;
		}
		if (vRow < ds_list.GetLastRow() && ds_list.GetColumn(vRow + 1, "TIS") != ""){
			alert("익월의 매출이 확정되어 있습니다.");
			return;
		}
	}
	// 매출확정 
	// 매출확정은 월단위로 처리하면, 매출확정 이후 기성자료를 완료(pst='A6')처리한다.
	ds_maechul.ClearData();
	ds_maechul.AddRow();
	ds_maechul.SetColumn(0, "UPN", upn);
	ds_maechul.SetColumn(0, "CST", cst);
	ds_maechul.SetColumn(0, "SEQ", ds_condData.GetColumn(0, "SEQ"));
	ds_maechul.SetColumn(0, "GND", gnd);
	ds_maechul.SetColumn(0, "GNO", gno);
	
	//ds_maechul.SetColumn(0, "JYM", ds_list.GetColumn(vRow, "JYM"));
	ds_maechul.SetColumn(0, "JYM", ds_list.GetColumn(vRow, "YYM"));
	ds_maechul.SetColumn(0, "GYM", ds_list.GetColumn(vRow, "GYM"));
	
	ds_maechul.SetColumn(0, "VBELN", "");
	ds_maechul.SetColumn(0, "TIS", "");
	ds_maechul.SetColumn(0, "PST", "A1");
	ds_maechul.SetColumn(0, "VKBUR", "H100");
	
	ds_maechulE.ClearData();
	ds_maechulE.AddRow();
	ds_maechulE.SetColumn(0, "UPN", upn);
	ds_maechulE.SetColumn(0, "CST", cst);
	ds_maechulE.SetColumn(0, "SEQ", ds_condData127.GetColumn(0, "SEQ"));
	ds_maechulE.SetColumn(0, "GND", "E");
	ds_maechulE.SetColumn(0, "GNO", gno);
	
	//ds_maechulE.SetColumn(0, "JYM", ds_list.GetColumn(vRow, "JYM"));
	ds_maechulE.SetColumn(0, "JYM", ds_list.GetColumn(vRow, "YYM"));
	ds_maechulE.SetColumn(0, "GYM", ds_list.GetColumn(vRow, "GYM"));
	
	ds_maechulE.SetColumn(0, "VBELN", "");
	ds_maechulE.SetColumn(0, "TIS", "");
	ds_maechulE.SetColumn(0, "PST", "A1");
	ds_maechulE.SetColumn(0, "VKBUR", "H100");
	
	tit_clearActionInfo();
 	tit_addMultiActionInfo("cs33:CS3301001A_U9");	// ZCST131
 	tit_addMultiActionInfo("cs33:CS3301001A_U10");	// ZCST131	인원상주
 	tit_addMultiActionInfo("cs33:CS3301001A_U11");	// ZCST136
 	tit_addMultiActionInfo("cs33:CS3301001A_U12");	// ZCST136	인원상주
	tit_callService(
		""
		, ""
		, "ds_cs131=ds_maechul ds_cs131E=ds_maechulE ds_cs136=ds_maechul ds_cs136E=ds_maechulE"
		, ""
		, ""
		, "fn_afterMaechul"
		, true
		, false
		, false);	

}


]]></Script>
</Window>