<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form DisableBKColor="user25" Height="584" Id="QM0701001P" Left="8" OnLoadCompleted="fn_OnLoadCompleted" PidAttrib="7" Title="원가절감&#32;검토내용" Top="8" Ver="1.0" Width="610" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="GJAHR" size="4" summ="default" type="STRING"/>
					<colinfo id="DEPT" size="4" summ="default" type="STRING"/>
					<colinfo id="ITEMNM" size="100" summ="default" type="STRING"/>
					<colinfo id="ITEM" size="256" summ="default" type="STRING"/>
					<colinfo id="MM" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<record>
						<DEPT></DEPT>
						<GJAHR></GJAHR>
						<GUBUN></GUBUN>
						<ITEM></ITEM>
						<ITEMNM></ITEMNM>
						<MM></MM>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_gjahr_cd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_dept_cd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_head">
				<Contents>
					<colinfo id="CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="DEPT" size="256" summ="default" type="STRING"/>
					<colinfo id="GJAHR" size="256" summ="default" type="STRING"/>
					<colinfo id="ITEM" size="256" summ="default" type="STRING"/>
					<colinfo id="ITEMNM" size="256" summ="default" type="STRING"/>
					<colinfo id="WAERK" size="256" summ="default" type="STRING"/>
					<colinfo id="QNTY" size="256" summ="default" type="STRING"/>
					<colinfo id="MM_SUM" size="256" summ="default" type="STRING"/>
					<colinfo id="TOT" size="256" summ="default" type="STRING"/>
					<colinfo id="ITEM_PR" size="256" summ="default" type="STRING"/>
					<colinfo id="ITEM_CH" size="256" summ="default" type="STRING"/>
					<colinfo id="BIGO" size="256" summ="default" type="STRING"/>
					<colinfo id="PLAN_M" size="256" summ="default" type="STRING"/>
					<colinfo id="NETWR_M" size="256" summ="default" type="STRING"/>
					<colinfo id="SVAMT" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="RATE" size="256" summ="default" type="STRING"/>
					<colinfo id="RATE2" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_mm">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<record>
						<CODE>01</CODE>
						<CODE_NAME>1월</CODE_NAME>
					</record>
					<record>
						<CODE>02</CODE>
						<CODE_NAME>2월</CODE_NAME>
					</record>
					<record>
						<CODE>03</CODE>
						<CODE_NAME>3월</CODE_NAME>
					</record>
					<record>
						<CODE>04</CODE>
						<CODE_NAME>4월</CODE_NAME>
					</record>
					<record>
						<CODE>05</CODE>
						<CODE_NAME>5월</CODE_NAME>
					</record>
					<record>
						<CODE>06</CODE>
						<CODE_NAME>6월</CODE_NAME>
					</record>
					<record>
						<CODE>07</CODE>
						<CODE_NAME>7월</CODE_NAME>
					</record>
					<record>
						<CODE>08</CODE>
						<CODE_NAME>8월</CODE_NAME>
					</record>
					<record>
						<CODE>09</CODE>
						<CODE_NAME>9월</CODE_NAME>
					</record>
					<record>
						<CODE>10</CODE>
						<CODE_NAME>10월</CODE_NAME>
					</record>
					<record>
						<CODE>11</CODE>
						<CODE_NAME>11월</CODE_NAME>
					</record>
					<record>
						<CODE>12</CODE>
						<CODE_NAME>12월</CODE_NAME>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_item_cd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_print">
				<Contents>
					<colinfo id="CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="DEPT" size="256" summ="default" type="STRING"/>
					<colinfo id="GJAHR" size="256" summ="default" type="STRING"/>
					<colinfo id="ITEM" size="256" summ="default" type="STRING"/>
					<colinfo id="ITEMNM" size="256" summ="default" type="STRING"/>
					<colinfo id="WAERK" size="256" summ="default" type="STRING"/>
					<colinfo id="QNTY" size="256" summ="default" type="STRING"/>
					<colinfo id="MM_SUM" size="256" summ="default" type="STRING"/>
					<colinfo id="TOT" size="256" summ="default" type="STRING"/>
					<colinfo id="ITEM_PR" size="256" summ="default" type="STRING"/>
					<colinfo id="ITEM_CH" size="256" summ="default" type="STRING"/>
					<colinfo id="BIGO" size="256" summ="default" type="STRING"/>
					<colinfo id="PLAN_M" size="256" summ="default" type="STRING"/>
					<colinfo id="NETWR_M" size="256" summ="default" type="STRING"/>
					<colinfo id="SVAMT" size="256" summ="default" type="STRING"/>
					<colinfo id="MM" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="RATE" size="256" summ="default" type="STRING"/>
					<colinfo id="RATE2" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_gubun_cd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
					<record>
						<CODE>A</CODE>
						<CODE_NAME>이월</CODE_NAME>
					</record>
					<record>
						<CODE>N</CODE>
						<CODE_NAME>신규</CODE_NAME>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user0" Bottom="70" Height="30" Id="Shape0" Left="0" LineColor="user1" Right="606" TabOrder="2" Top="40" Type="Rectangle" Width="606"></Shape>
		<Static Height="28" Id="st_gjahr" Left="2" Style="sty_lb_search" TabOrder="3" Text="&#32;1.&#32;항목명&#32;" Top="41" VAlign="Middle" Width="149"></Static>
		<Combo BindDataset="ds_cond" Border="Flat" CodeColumn="CODE" Column="MM" DataColumn="CODE_NAME" Height="28" Id="cb_mm" InnerDataset="ds_mm" Left="507" Style="sty_ipt_search_ind" TabOrder="0" Top="41" Width="97"></Combo>
		<Shape BKColor="user0" Bottom="99" Height="30" Id="Shape1" Left="0" LineColor="user1" Right="606" TabOrder="4" Top="69" Type="Rectangle" Width="606"></Shape>
		<Static Height="28" Id="Static1" Left="2" Style="sty_lb_search" TabOrder="5" Text="&#32;2.&#32;부서&#32;" Top="70" VAlign="Middle" Width="149"></Static>
		<Shape BKColor="user0" Bottom="128" Height="30" Id="Shape2" Left="0" LineColor="user1" Right="606" TabOrder="6" Top="98" Type="Rectangle" Width="606"></Shape>
		<Static Height="28" Id="Static2" Left="2" Style="sty_lb_search" TabOrder="7" Text="&#32;4.&#32;연간&#32;계획&#32;" Top="99" VAlign="Middle" Width="149"></Static>
		<Shape BKColor="user0" Bottom="157" Height="30" Id="Shape3" Left="0" LineColor="user1" Right="606" TabOrder="8" Top="127" Type="Rectangle" Width="606"></Shape>
		<Static Height="28" Id="Static3" Left="2" Style="sty_lb_search" TabOrder="9" Text="&#32;6.&#32;당월&#32;계획&#32;" Top="128" VAlign="Middle" Width="149"></Static>
		<Static Height="28" Id="Static4" Left="284" Style="sty_lb_search" TabOrder="10" Text="&#32;3.&#32;항목번호(&#32;이월&#32;/&#32;신규&#32;)" Top="70" VAlign="Middle" Width="150"></Static>
		<Static Height="28" Id="Static5" Left="284" Style="sty_lb_search" TabOrder="11" Text="&#32;5.&#32;누계&#32;실적&#32;(&#32;달성률&#32;)" Top="99" VAlign="Middle" Width="150"></Static>
		<Static Height="28" Id="Static6" Left="284" Style="sty_lb_search" TabOrder="12" Text="&#32;7.&#32;당월&#32;실적&#32;(&#32;달성률&#32;)" Top="128" VAlign="Middle" Width="150"></Static>
		<Shape BKColor="user0" Bottom="578" Height="397" Id="Shape4" Left="0" LineColor="user1" Right="607" TabOrder="13" Top="181" Type="Rectangle" Width="607"></Shape>
		<Static Align="Center" Height="361" Id="Static7" Left="2" Style="sty_lb_search" TabOrder="14" Text="절&#10;&#10;&#10;감&#10;&#10;&#10;내&#10;&#10;&#10;용" Top="185" VAlign="Middle" Width="35"></Static>
		<Static Align="Center" Height="180" Id="Static8" Left="38" Style="sty_lb_search" TabOrder="15" Text="변경&#32;전" Top="185" VAlign="Middle" Width="113"></Static>
		<Static Align="Center" Height="180" Id="Static9" Left="38" Style="sty_lb_search" TabOrder="16" Text="변경&#32;후" Top="366" VAlign="Middle" Width="113"></Static>
		<Static Align="Center" Height="28" Id="Static10" Left="2" Style="sty_lb_search" TabOrder="17" Text="기&#32;타&#32;사&#32;항" Top="547" VAlign="Middle" Width="149"></Static>
		<Edit BindDataset="ds_head" Border="Flat" Column="BIGO" Height="28" Id="Edit8" ImeMode="native" Left="151" MaxLength="1000" Style="sty_ipt_search" TabOrder="18" Top="547" UpperOnly="TRUE" Width="451"></Edit>
		<Shape BKColor="user0" Bottom="186" Height="30" Id="Shape5" Left="0" LineColor="user1" Right="606" TabOrder="19" Top="156" Type="Rectangle" Width="606"></Shape>
		<Static Height="28" Id="Static11" Left="2" Style="sty_lb_search" TabOrder="20" Text="&#32;8.&#32;수량&#32;" Top="157" VAlign="Middle" Width="149"></Static>
		<Static Height="28" Id="Static12" Left="284" Style="sty_lb_search" TabOrder="21" Text="&#32;9.&#32;절감단가" Top="157" VAlign="Middle" Width="150"></Static>
		<Static Align="Center" Height="28" Id="Static13" Left="436" Style="sty_lb_search" TabOrder="22" Text="해당월" Top="41" VAlign="Middle" Width="71"></Static>
		<Combo BindDataset="ds_cond" Border="Flat" CodeColumn="CODE" Column="DEPT" DataColumn="CODE_NAME" DisableBKColor="user27" Enable="FALSE" Height="28" Id="cb_dept" InnerDataset="ds_dept_cd" Left="152" Style="sty_ipt_search_ind" TabOrder="23" Top="70" Width="132"></Combo>
		<Edit BindDataset="ds_head" BKColor="seashell" Border="Flat" CheckLength="Byte" Column="ITEMNM" DisableBKColor="user5" Enable="FALSE" Height="28" Id="ed_itemnm" ImeMode="english" Left="152" MaxLength="6" Style="sty_ipt_search" TabOrder="24" Top="40" UpperOnly="TRUE" Width="283"></Edit>
		<Edit Align="CENTER" BindDataset="ds_cond" BKColor="seashell" Border="Flat" CheckLength="Byte" Color="user28" Column="ITEM" DisableBKColor="user5" Enable="FALSE" Height="28" Id="ed_item" ImeMode="english" Left="436" MaxLength="6" Style="sty_ipt_search" TabOrder="25" Top="70" UpperOnly="TRUE" Width="71"></Edit>
		<MaskEdit BindDataset="ds_head" BKColor="user5" Border="Flat" BorderColor="user1" Color="user28" Column="TOT" DisableBKColor="user5" Enable="FALSE" Height="28" Id="MaskEdit1" Left="436" Readonly="TRUE" Style="sty_ipt_form" TabOrder="26" Top="99" Width="92"></MaskEdit>
		<MaskEdit BindDataset="ds_head" BKColor="user5" Border="Flat" BorderColor="user1" Color="user28" Column="MM_SUM" DisableBKColor="user5" Enable="FALSE" Height="28" Id="MaskEdit0" Left="152" Readonly="TRUE" Style="sty_ipt_form" TabOrder="27" Top="99" Width="130"></MaskEdit>
		<MaskEdit BindDataset="ds_head" BKColor="user5" Border="Flat" BorderColor="user1" Color="user28" Column="PLAN_M" DisableBKColor="user5" Enable="FALSE" Height="28" Id="MaskEdit2" Left="152" Readonly="TRUE" Style="sty_ipt_form" TabOrder="28" Top="128" Width="130"></MaskEdit>
		<MaskEdit BindDataset="ds_head" BKColor="user5" Border="Flat" BorderColor="user1" Color="user28" Column="QNTY" DisableBKColor="user5" Enable="FALSE" Height="28" Id="MaskEdit3" Left="152" Readonly="TRUE" Style="sty_ipt_form" TabOrder="29" Top="157" Width="130"></MaskEdit>
		<MaskEdit BindDataset="ds_head" BKColor="user5" Border="Flat" BorderColor="user1" Color="user28" Column="NETWR_M" DisableBKColor="user5" Enable="FALSE" Height="28" Id="MaskEdit4" Left="436" Readonly="TRUE" Style="sty_ipt_form" TabOrder="30" Top="128" Width="92"></MaskEdit>
		<MaskEdit BindDataset="ds_head" BKColor="user5" Border="Flat" BorderColor="user1" Color="user28" Column="SVAMT" DisableBKColor="user5" Enable="FALSE" Height="28" Id="MaskEdit5" Left="436" Readonly="TRUE" Style="sty_ipt_form" TabOrder="31" Top="157" Width="165"></MaskEdit>
		<Combo BindDataset="ds_cond" Border="Flat" CodeColumn="CODE" Column="GUBUN" DataColumn="CODE_NAME" DisableBKColor="user5" Enable="FALSE" Face3dColor="user5" Height="28" Id="cb_gubun" ImeMode="none" InnerDataset="ds_gubun_cd" Left="507" Style="sty_ipt_search_ind" TabOrder="32" Top="70" Width="97"></Combo>
		<Div Height="32" Id="div_btn" TabOrder="33" Text="Div0" Url="WB01::CommBtnForm.xml" Width="616">
			<Contents></Contents>
		</Div>
		<TextArea BindDataset="ds_head" Column="ITEM_PR" Height="180" Id="ta_bigo1" ImeMode="none" Left="152" TabOrder="34" Top="185" VScroll="TRUE" Width="451"></TextArea>
		<TextArea BindDataset="ds_head" Column="ITEM_CH" Height="180" Id="TextArea0" ImeMode="none" Left="152" TabOrder="35" Top="366" VScroll="TRUE" Width="451"></TextArea>
		<MaskEdit BindDataset="ds_head" BKColor="user5" Border="Flat" BorderColor="user1" Color="user28" Column="RATE" DisableBKColor="user5" Enable="FALSE" Height="28" Id="MaskEdit6" Left="529" Readonly="TRUE" Style="sty_ipt_form" TabOrder="36" Top="99" Width="57"></MaskEdit>
		<MaskEdit BindDataset="ds_head" BKColor="user5" Border="Flat" BorderColor="user1" Color="user28" Column="RATE2" DisableBKColor="user5" Enable="FALSE" Height="28" Id="MaskEdit7" Left="529" Readonly="TRUE" Style="sty_ipt_form" TabOrder="37" Top="128" Width="57"></MaskEdit>
		<Static Align="Center" Height="10" Id="Static28" Left="586" TabOrder="38" Text="%" Top="110" Width="18"></Static>
		<Static Align="Center" Height="10" Id="Static0" Left="586" TabOrder="39" Text="%" Top="142" Width="18"></Static>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::utility.js";	// 다중 선택 
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================

//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	gfn_initForm();
	
	// 넘어온 param 처리
	if (isExistVar("P_GJAHR"))	{
		var curYear = parseInt(P_GJAHR) - 1;
		fn_makeYear(curYear,-2,0);
	}else	{
		var curYear = parseInt(substr(gfn_getCurrDate(),0,4)) - 1;
		fn_makeYear(curYear,-2,1);
	}

	http.Sync = true;

	// 원가절감 부서정보 조회
	var codeArr    = ["QM01"];
	var dsObjArr   = [ds_dept_cd];
	var addTypeArr = [G_CODE_NONE];
	gfn_searchCommCode(codeArr, dsObjArr, addTypeArr);

	http.Sync = false;
	
	//alert(P_GJAHR);
	
    cb_dept.Value = P_DEPT;
    ed_itemnm.value = P_ITEMNM;
    ed_item.value =  P_ITEM;
    cb_gubun.Value = P_GUBUN;
	//1월이 기본 세팅 
	cb_mm.Index = 0;
  
  
  
    if(cb_dept.Value == 'CK')
    {
      btn_save.Enable = false;
    }
  // fn_query();
}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {
	//
}

//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 
********************************************************************************/
function fn_query() {
	// HTTP SESSION TIMEOUT을 변경
	//http.TimeOut = 1800;
	
	ds_cond.SetColumn(0,"GJAHR",P_GJAHR);
 	ds_cond.SetColumn(0,"ITEM",P_ITEM);
    ds_cond.SetColumn(0,"DEPT",P_DEPT);


	tit_clearActionInfo();
	tit_addSearchActionInfo("qm07:QM0701001D_S1");

	tit_callService(
          ""
        , ""
        , "ds_cond=ds_cond"
        , "ds_head=ds_head"
        , ""
        , "fn_afterQuery"
        , true);
        
  }

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}

/********************************************************************************
* 기      능   : 확인버튼 클릭
********************************************************************************/
function fn_confirm()	{

}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	//gfn_showSearchMsg(grd_list, errCode, errMsg);
	//달성율 계산
	if(ds_head.GetColumn(0,"TOT") > 0)
    {
		//ds_head.SetColumn(0,"RATE", round( (ds_head.GetColumn(0,"MM_SUM") / ds_head.GetColumn(0,"TOT")) * 100 ,1) );
		ds_head.SetColumn(0,"RATE", round(( ds_head.GetColumn(0,"TOT") / ds_head.GetColumn(0,"MM_SUM") ) * 100 ,1) );
    }
  	if(ds_head.GetColumn(0,"NETWR_M") > 0)
    {
		//ds_head.SetColumn(0,"RATE2", round( (ds_head.GetColumn(0,"PLAN_M") / ds_head.GetColumn(0,"NETWR_M")) * 100 ,1) );
        ds_head.SetColumn(0,"RATE2", round(( ds_head.GetColumn(0,"NETWR_M") / ds_head.GetColumn(0,"PLAN_M")) * 100 ,1) ); 
    }
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
// 사용자 정의 함수는 ufn_xxxx() 형태로 작성 
//=========================================================================================

/********************************************************************************
* 기      능   : 저장
********************************************************************************/
function fn_save() 
{
 
    tit_clearActionInfo();		
	tit_addSelectExActionInfo("qm07:QM0701001D_S2", "qm07:QM0701001D_I1", "qm07:QM0701001D_U1");
	tit_callService(
		""
		, ""
		, "ds_head=ds_head"
		, ""
		, ""
		, "fn_afterSave"
		, ""
		, ""
		, true  // ""
		);
		
}

/********************************************************************************
* 기      능   : 저장2 Callback  
********************************************************************************/
function fn_afterSave(errCode, errMsg) {
	if ( errCode != 0 ) 
	{
		gfn_showMsg("CE00001");
	} 
	else 
	{
		gfn_showMsg("CI00003");	
	}
}	

/********************************************************************************
* 기      능   : 출력
********************************************************************************/
function fn_print() 
{     
   
   ds_print.ClearData();
   ds_print.copyF(ds_head);
   ds_head.unFilter();
   
   Dialog("qm07::QM0701001P.xml","");
}

/********************************************************************************
* 기      능   : 기준년도 계산(현재년도,당해년도에서 뺄 년수, 당해년도에서 더할 년수
********************************************************************************/
function fn_makeYear(curYear,sNum,eNum)
{
/*	var rowCnt = eNum-sNum;
	var row = 0;

	for(var i=rowCnt; i>-1; i--)
	{
		ds_gjahr_cd.AddRow();
		ds_gjahr_cd.SetColumn(row,"CODE",parseInt(curYear)+i+parseInt(sNum));
		ds_gjahr_cd.SetColumn(row,"CODE_NAME",(parseInt(curYear)+i+parseInt(sNum))+"년");
		row++;
	}
	//cb_gjahr.index = eNum;
*/
}

]]></Script>
</Window>