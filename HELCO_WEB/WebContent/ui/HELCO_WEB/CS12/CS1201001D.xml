<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="562" Id="cb_cst" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="인원상주" Top="8" Ver="1.0" Width="978" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_code_cond">
				<Contents>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<record>
						<CST></CST>
						<GNO></GNO>
						<UPN></UPN>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_date_cd">
				<Contents>
					<colinfo id="L_USD" size="256" type="STRING"/>
					<colinfo id="L_UHJ" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="CST" size="255" summ="default" type="STRING"/>
					<colinfo id="UPN" size="255" summ="default" type="STRING"/>
					<colinfo id="USD" size="256" summ="default" type="STRING"/>
					<colinfo id="UHJ" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<record>
						<CST></CST>
						<GNO></GNO>
						<UHJ></UHJ>
						<UPN></UPN>
						<USD></USD>
					</record>
				</Contents>
			</Dataset>
			<Dataset CanColumnChange="ds_list_CanColumnChange" DataSetType="Dataset" Editable="True" Id="ds_list" OnColumnChanged="ds_list_OnColumnChanged">
				<Contents>
					<colinfo id="BSU" size="15" summ="default" type="STRING"/>
					<colinfo id="CQT" size="13" summ="default" type="DECIMAL"/>
					<colinfo id="ISR" size="6" summ="default" type="STRING"/>
					<colinfo id="RTO" size="7" summ="default" type="DECIMAL"/>
					<colinfo id="SEQ" size="6" summ="default" type="STRING"/>
					<colinfo id="SFR" size="24" summ="default" type="STRING"/>
					<colinfo id="STO" size="24" summ="default" type="STRING"/>
					<colinfo id="FLAG" size="0" summ="default" type="STRING"/>
					<colinfo id="DBYN" size="256" summ="default" type="STRING"/>
					<colinfo id="CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="GND" size="256" summ="default" type="STRING"/>
					<colinfo id="SYO" size="256" summ="default" type="STRING"/>
					<colinfo id="UYO" size="256" summ="default" type="STRING"/>
					<colinfo id="AMT" size="13" summ="default" type="DECIMAL"/>
					<colinfo id="VAT" size="256" summ="default" type="STRING"/>
					<colinfo id="TOT" size="13" summ="default" type="DECIMAL"/>
					<colinfo id="AMBT" size="13" summ="default" type="DECIMAL"/>
					<colinfo id="VABT" size="256" summ="default" type="STRING"/>
					<colinfo id="TOBT" size="13" summ="default" type="DECIMAL"/>
					<colinfo id="AMTT" size="13" summ="default" type="DECIMAL"/>
					<colinfo id="VATT" size="256" summ="default" type="STRING"/>
					<colinfo id="TOTT" size="13" summ="default" type="DECIMAL"/>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
					<colinfo id="G_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="PST" size="256" summ="default" type="STRING"/>
					<colinfo id="TGB" size="256" summ="default" type="STRING"/>
					<colinfo id="M_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="CS604_US" size="256" summ="default" type="STRING"/>
					<colinfo id="BDGBN" size="256" summ="default" type="STRING"/>
					<colinfo id="GBU" size="256" summ="default" type="STRING"/>
					<record>
						<AMBT/>
						<AMT/>
						<AMTT/>
						<BDGBN></BDGBN>
						<BSU></BSU>
						<CHK></CHK>
						<CNT></CNT>
						<CQT/>
						<CS604_US></CS604_US>
						<CST></CST>
						<DBYN></DBYN>
						<FLAG></FLAG>
						<G_CNT></G_CNT>
						<GBU></GBU>
						<GND></GND>
						<ISR></ISR>
						<M_AMT></M_AMT>
						<PST></PST>
						<RTO/>
						<SEQ></SEQ>
						<SFR></SFR>
						<STO></STO>
						<SYO></SYO>
						<TGB></TGB>
						<TOBT/>
						<TOT/>
						<TOTT/>
						<UPN></UPN>
						<UYO></UYO>
						<VABT></VABT>
						<VAT></VAT>
						<VATT></VATT>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_bsu_cd">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="BSU_GB" size="256" summ="default" type="STRING"/>
					<colinfo id="USED" size="256" summ="default" type="STRING"/>
					<colinfo id="VKGRP" size="256" summ="default" type="STRING"/>
					<colinfo id="VKBUR" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_seq">
				<Contents>
					<colinfo id="SEQ" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_days">
				<Contents>
					<colinfo id="DAYS" size="256" type="STRING"/>
					<record>
						<DAYS></DAYS>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_temp_cd">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<record>
						<CODE></CODE>
						<CODE_NAME>-&#32;선택&#32;-</CODE_NAME>
					</record>
					<record>
						<CODE>N</CODE>
						<CODE_NAME>N</CODE_NAME>
					</record>
					<record>
						<CODE>Y</CODE>
						<CODE_NAME>Y</CODE_NAME>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cost">
				<Contents>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="NMT" size="256" summ="default" type="STRING"/>
					<colinfo id="JMT" size="256" summ="default" type="STRING"/>
					<colinfo id="KMT" size="256" summ="default" type="STRING"/>
					<colinfo id="HMT" size="256" summ="default" type="STRING"/>
					<colinfo id="DMT" size="256" summ="default" type="STRING"/>
					<colinfo id="CMT" size="256" summ="default" type="STRING"/>
					<colinfo id="GMT" size="256" summ="default" type="STRING"/>
					<colinfo id="COST" size="256" summ="default" type="STRING"/>
					<colinfo id="RAT" size="256" summ="default" type="STRING"/>
					<colinfo id="TAMT" size="256" summ="default" type="STRING"/>
					<colinfo id="SJT" size="256" summ="default" type="STRING"/>
					<colinfo id="RGS" size="256" summ="default" type="STRING"/>
					<colinfo id="RMR" size="256" summ="default" type="STRING"/>
					<record>
						<CMT></CMT>
						<COST></COST>
						<DMT></DMT>
						<GMT></GMT>
						<GNO></GNO>
						<HMT></HMT>
						<JMT></JMT>
						<KMT></KMT>
						<NMT></NMT>
						<RAT></RAT>
						<RGS></RGS>
						<RMR></RMR>
						<SJT></SJT>
						<TAMT></TAMT>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user0" Bottom="66" Height="30" Id="Shape0" Left="0" LineColor="user1" Right="978" TabOrder="1" Top="36" Type="Rectangle" Width="978"></Shape>
		<Static Align="Right" Height="20" Id="st_upn" Left="5" Style="sty_lb_search" TabOrder="2" Text="통합&#32;Proj.&#32;" Top="41" VAlign="Middle" Width="80"></Static>
		<Edit BindDataset="ds_cond" Border="Flat" Column="UPN" DisableBKColor="user5" Enable="FALSE" Height="20" Id="ed_upn" Left="87" Style="sty_ipt_search" TabOrder="3" Top="41" Width="52"></Edit>
		<Static Align="Center" Border="None" Color="user7" Font="굴림,9" Height="20" Id="Static13" Left="141" TabOrder="4" Text="-" Top="41" VAlign="Middle" Width="10"></Static>
		<Edit BindDataset="ds_cond" Border="Flat" Column="CST" DisableBKColor="user5" Enable="FALSE" Height="20" Id="ed_cst" Left="153" Style="sty_ipt_search" TabOrder="5" Top="41" Width="34"></Edit>
		<Static Align="Right" Height="20" Id="st_usd" Left="669" Style="sty_lb_search" TabOrder="6" Text="계약시작일" Top="41" VAlign="Middle" Width="80"></Static>
		<Calendar Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DisableBKColor="user5" DrawWeekSeparator="FALSE" EditAlign="CENTER" Enable="FALSE" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_usd_fm" Left="751" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_search" SundayTextColor="user35" TabOrder="8" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="41" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="100"></Calendar>
		<Static Align="Center" Border="None" Color="user7" Font="굴림,9" Height="20" Id="Static1" Left="853" TabOrder="7" Text="~" Top="41" VAlign="Middle" Width="18"></Static>
		<Calendar Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DisableBKColor="user5" DrawWeekSeparator="FALSE" EditAlign="CENTER" Enable="FALSE" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_usd_to" Left="873" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_search" SundayTextColor="user35" TabOrder="9" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="41" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="100"></Calendar>
		<Static Align="Right" Height="20" Id="st_nam" Left="189" Style="sty_lb_search" TabOrder="10" Text="고객명&#32;" Top="41" VAlign="Middle" Width="80"></Static>
		<Edit Border="Flat" DisableBKColor="user5" Enable="FALSE" Height="20" Id="ed_nam" Left="271" Style="sty_ipt_search" TabOrder="11" Top="41" Width="159"></Edit>
		<Edit Border="Flat" DisableBKColor="user5" Enable="FALSE" Height="20" Id="ed_spt" Left="514" Style="sty_ipt_search" TabOrder="13" Top="41" Width="153"></Edit>
		<Static Align="Right" Height="20" Id="st_spt" Left="432" Style="sty_lb_search" TabOrder="12" Text="현장명&#32;" Top="41" VAlign="Middle" Width="80"></Static>
		<Grid AutoEnter="TRUE" AutoFitEndLine="Hide" BindDataset="ds_list" BkColor2="default" BoldHead="true" Border="Flat" Bottom="556" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="456" Id="grd_list" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" OnCellClick="grd_list_OnCellClick" OnCellPosChanged="grd_list_OnCellPosChanged" OnExpandEdit="grd_list_OnExpandEdit" OnHeadClick="grd_list_OnHeadClick" Right="973" RowHeight="20" Style="sty_grid" TabOrder="14" TabStop="true" Top="100" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="965">
			<contents>
				<format id="Default">
					<columns>
						<col width="30"/>
						<col width="30"/>
						<col width="60"/>
						<col width="90"/>
						<col width="90"/>
						<col width="200"/>
						<col width="70"/>
						<col width="60"/>
						<col width="55"/>
						<col width="90"/>
						<col width="90"/>
						<col width="90"/>
						<col width="90"/>
						<col width="0"/>
						<col width="0"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user21" display="text" font="굴림,9"/>
						<cell col="1" display="text" font="굴림,9" text="선택"/>
						<cell col="2" display="text" font="굴림,9" text="일련번호"/>
						<cell col="3" display="text" font="굴림,9" text="상주기간(from)"/>
						<cell col="4" display="text" font="굴림,9" text="상주기간(to)"/>
						<cell col="5" display="text" font="굴림,9" text="보수협력사"/>
						<cell col="6" display="text" font="굴림,9" text="계약직&#32;여부"/>
						<cell col="7" display="text" font="굴림,9" text="상주시간"/>
						<cell col="8" display="text" font="굴림,9" text="분담이행"/>
						<cell col="9" display="text" font="굴림,9" text="기성지급조건율"/>
						<cell col="10" display="text" font="굴림,9" text="인원상주금액"/>
						<cell col="11" display="text" font="굴림,9" text="당사관리비"/>
						<cell col="12" display="text" font="굴림,9" text="협력사관리비"/>
						<cell col="13" display="text"/>
						<cell col="14" display="text"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" bkimageid='expr:gfn_getFlagBkImageID(getColumn(currow,&#32;&quot;FLAG&quot;))' col="0" display="text"/>
						<cell col="1" colid="CHK" display="expr:iif(PST&#32;==&#32;&apos;A6&apos;,&#32;&apos;null&apos;,&#32;&apos;checkbox&apos;)" edit="expr:iif(PST&#32;==&#32;&apos;A6&apos;,&#32;&apos;none&apos;,&#32;&apos;checkbox&apos;)"/>
						<cell align="center" bkcolor2="user22" col="2" colid="ISR" display="number"/>
						<cell align="center" bkcolor2="user22" col="3" colid="SFR" display="text" expandimage="btn_grid_icon_pen" expandshow="true" expandsize="18" Mask="####.##.##"/>
						<cell align="center" bkcolor2="user22" col="4" colid="STO" display="text" expandimage="btn_grid_icon_pen" expandshow="true" expandsize="18" Mask="####.##.##"/>
						<cell bkcolor2="user22" col="5" colid="BSU" combocol="CODE" combodataset="ds_bsu_cd" combodisplayrowcnt="10" combotext="CODE_NAME" display="combo" edit="expr:iif(getColumn(currow,&#32;&apos;DBYN&apos;)&#32;&lt;&gt;&#32;&apos;Y&apos;,&#32;&apos;combo&apos;,&#32;&apos;none&apos;)"/>
						<cell align="center" bkcolor2="user22" col="6" colid="TMP" combocol="CODE" combodataset="ds_temp_cd" combotext="CODE_NAME" display="combo" edit="expr:iif(getColumn(currow,&#32;&apos;DBYN&apos;)&#32;&lt;&gt;&#32;&apos;Y&apos;,&#32;&apos;combo&apos;,&#32;&apos;none&apos;)"/>
						<cell align="right" bkcolor2="user22" bkimagealign="left" bkimageid="icon_grid_edit" col="7" colid="HUR" display="number" edit="expr:iif(getColumn(currow,&#32;&apos;DBYN&apos;)&#32;&lt;&gt;&#32;&apos;Y&apos;,&#32;&apos;masknumber&apos;,&#32;&apos;none&apos;)"/>
						<cell align="center" bkcolor2="user22" col="8" colid="BDGBN" display="checkbox" edit="expr:iif(getColumn(currow,&#32;&apos;DBYN&apos;)&#32;&lt;&gt;&#32;&apos;Y&apos;,&#32;&apos;checkbox&apos;,&#32;&apos;none&apos;)"/>
						<cell align="right" bkcolor2="user22" col="9" colid="RTO" display="number" edit="expr:iif(getColumn(currow,&#32;&apos;DBYN&apos;)&#32;&lt;&gt;&#32;&apos;Y&apos;,&#32;&apos;masknumber&apos;,&#32;&apos;none&apos;)"/>
						<cell align="right" bkcolor2="user22" col="10" colid="TOTT" display="number" edit="expr:iif(getColumn(currow,&#32;&apos;DBYN&apos;)&#32;&lt;&gt;&#32;&apos;Y&apos;,&#32;&apos;masknumber&apos;,&#32;&apos;none&apos;)" Mask="###,###"/>
						<cell align="right" bkcolor2="user22" col="11" colid="TOT" display="number" edit="expr:iif(getColumn(currow,&#32;&apos;DBYN&apos;)&#32;&lt;&gt;&#32;&apos;Y&apos;,&#32;DECODE(BDGBN,&apos;1&apos;,&apos;masknumber&apos;,&apos;none&apos;),&#32;&apos;none&apos;)" Mask="###,###"/>
						<cell align="right" bkcolor2="user22" col="12" colid="TOBT" display="number" Mask="###,###"/>
						<cell col="13" colid="GBU" display="text"/>
						<cell col="14" colid="DBYN" display="text"/>
					</body>
					<summary>
						<cell align="center" bkcolor="user25" col="0" color="user26" colspan="10" display="text" text="Total"/>
						<cell align="right" bkcolor="user25" col="10" color="user26" display="number" expr='sum(&quot;TOTT&quot;)'/>
						<cell align="right" bkcolor="user25" col="11" color="user26" display="number" expr='sum(&quot;TOT&quot;)'/>
						<cell align="right" bkcolor="user25" col="12" color="user26" display="number" expr='sum(&quot;TOBT&quot;)'/>
						<cell col="13" display="text"/>
						<cell col="14" display="text"/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Div Height="36" Id="div_btn" TabOrder="15" Text="Div0" ToolTipFont="Default,0" Url="WB01::CommBtnForm.xml" Width="976">
			<Contents></Contents>
		</Div>
		<Button Cursor="HAND" Height="20" Id="btn_add" ImageID="btn_icon_plus" Left="919" LeftMargin="12" OnClick="fn_insert" Style="sty_btn" TabOrder="17" Top="74" Transparent="TRUE" Width="22"></Button>
		<Button Cursor="HAND" Height="20" Id="btn_del" ImageID="btn_icon_minus" Left="945" LeftMargin="12" OnClick="fn_delete" Style="sty_btn" TabOrder="16" Top="74" Transparent="TRUE" Width="22"></Button>
		<Calendar Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="146" Id="cal_temp" Left="1000" MonthOnly="TRUE" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" OnDayClick="cal_temp_OnDayClick" OnKillFocus="cal_temp_OnKillFocus" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="18" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="104" Value="20151230" Visible="FALSE" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="152"></Calendar>
		<Static Height="22" Id="st_sfr" Left="280" TabOrder="19" Text="상주기간(from)" Top="561" Visible="FALSE" Width="65"></Static>
		<Static Height="22" Id="st_sto" Left="352" TabOrder="20" Text="상주기간(to)" Top="561" Visible="FALSE" Width="65"></Static>
		<Static Height="22" Id="st_bsu" Left="424" TabOrder="21" Text="보수협력사" Top="561" Visible="FALSE" Width="65"></Static>
		<Static Height="22" Id="st_rto" Left="488" TabOrder="22" Text="기성지급조건율" Top="561" Visible="FALSE" Width="65"></Static>
		<Edit Height="18" Id="ed_gnd" Left="148" TabOrder="23" Top="79" Visible="FALSE" Width="70"></Edit>
		<Edit BKColor="user5" Height="18" Id="ed_max_seq" Left="232" TabOrder="24" Top="78" Visible="FALSE" Width="57"></Edit>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_save" ImageID="btn_sub_02" Left="666" LeftMargin="12" OnClick="btn_save_OnClick" Style="sty_btn" TabOrder="25" Text="등록" Top="74" Transparent="TRUE" Width="47"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_seungin_query" ImageID="btn_sub_06" Left="715" LeftMargin="12" OnClick="btn_seungin_query_OnClick" Style="sty_btn" TabOrder="27" Text="승인대상조회" Top="74" Transparent="TRUE" Width="95"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_seungin" ImageID="btn_sub_02" Left="812" LeftMargin="12" OnClick="btn_seungin_OnClick" Style="sty_btn" TabOrder="26" Text="승인" Top="74" Transparent="TRUE" Width="47"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_save_query" ImageID="btn_sub_06" Left="569" LeftMargin="12" OnClick="btn_save_query_OnClick" Style="sty_btn" TabOrder="28" Text="등록대상조회" Top="74" Transparent="TRUE" Width="95"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_reset" ImageID="btn_sub_02" Left="861" LeftMargin="12" OnClick="btn_reset_OnClick" Style="sty_btn" TabOrder="29" Text="리셋" Top="74" Transparent="TRUE" Width="47"></Button>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_query" ImageID="btn_sub_02" Left="520" LeftMargin="12" OnClick="btn_query_OnClick" Style="sty_btn" TabOrder="30" Text="조회" Top="74" Transparent="TRUE" Width="47"></Button>
		<Edit Height="18" Id="ed_gbu" Left="12" TabOrder="31" Top="79" Visible="FALSE" Width="30"></Edit>
		<Edit Height="18" Id="ed_bdgbn" Left="44" TabOrder="32" Top="79" Visible="FALSE" Width="30"></Edit>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var g_cnt = 0;
var g_max_chk = "N";
var chk_query = "query";

var vVkbur = "";
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {

	// Form 로드 이벤트 맨 첫줄에 기술 
	gfn_initForm();
	
	ed_upn.value = upn;
	ed_cst.value = cst;
	ed_nam.value = nam;
	ed_spt.value = spt;
	ed_gnd.value = gnd;
	ed_gbu.value = gbu;
	ed_bdgbn.value = bdgbn;
	vVkbur = gfn_getBsu(bsu, "VKBUR");
	
	fn_searchDate();
	fn_query();
}
/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {
/*
	if(chk_query == "query") {
		grd_list.SetCellProp("body",1,"Display","null");
		grd_list.SetCellProp("body",1,"Edit","none");
	} else {
		grd_list.SetCellProp("body",1,"Display","checkbox");
		grd_list.SetCellProp("body",1,"Edit","checkbox");
	}
*/
	gfn_showMsg("CI00007");
}
/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}
//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
function fn_searchDate() {
	gfn_initDs(ds_code_cond, true);
	ds_code_cond.setColumn(0, "UPN", upn);
	ds_code_cond.setColumn(0, "CST", cst);
	ds_code_cond.setColumn(0, "GNO", gno);

	tit_clearActionInfo();
	tit_addSearchActionInfo("cs12:CS1201001D_S1");

	tit_callService(
        ""
        , ""
        , "ds_cond=ds_code_cond"
        , "ds_date_cd=ds_list"
        , ""
        , "fn_afterSearchDate"
        , true);
}

function fn_searchSeq() {
	gfn_initDs(ds_code_cond, true);
	ds_code_cond.setColumn(0, "UPN", upn);
	ds_code_cond.setColumn(0, "CST", cst);

	tit_clearActionInfo();
	tit_addSearchActionInfo("cs12:CS1201001D_S4");

	tit_callService(
        ""
        , ""
        , "ds_cond=ds_code_cond"
        , "ds_seq=ds_list"
        , ""
        , "fn_afterSearchSeq"
        , true);
}

/********************************************************************************
* 기      능   : 조회 1
********************************************************************************/
function fn_query() {
	gfn_clearMsgBar();
	
	// sort mark 삭제 
	gfn_clearGridSortMark(grd_list);
	ds_list.row = -1;
	ds_list.ClearData();

	ds_cond.SetColumn(0, "UPN", upn);
	ds_cond.SetColumn(0, "CST", cst);
	ds_cond.SetColumn(0, "USD", usd);
	ds_cond.SetColumn(0, "UHJ", uhj);

	tit_clearActionInfo();
	tit_addSearchActionInfo("cs12:CS1201001D_S2");
	tit_addSearchActionInfo("cs12:CS1201001D_S3");
	
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_bsu_cond ds_cond=ds_cond"
        , "ds_bsu_cd=ds_bsu_list ds_list=ds_list"
        , ""
        , "fn_afterQuery"
        , true
        , ""
        , true);
        
//alert("aa");    
//ds_bsu_cd.Filter("USED=" + quote('X'));    
//ds_bsu_cd.Filter("USED==''");
//trace(ds_bsu_cd.SaveXML());
//alert("bb");
            
        
}

function fn_query2() {
	gfn_clearMsgBar();
	
	// sort mark 삭제 
	gfn_clearGridSortMark(grd_list);
	ds_list.row = -1;
	ds_list.ClearData();
	ds_cost.ClearData();

	ds_cond.SetColumn(0, "UPN", upn);
	ds_cond.SetColumn(0, "CST", cst);
	ds_cond.SetColumn(0, "USD", usd);
	ds_cond.SetColumn(0, "UHJ", uhj);
	ds_cond.SetColumn(0, "GNO", gno);

	tit_clearActionInfo();
	tit_addSearchActionInfo("cs12:CS1201001D_S5");
	tit_addSearchActionInfo("cs12:CS1201001D_S3");
	tit_addSearchActionInfo("cs12:CS1201001D_S7"); // 승인 전 정기보수 원가 불러오기
	
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_bsu_cond ds_cond=ds_cond"
        , "ds_bsu_cd=ds_bsu_list ds_list=ds_list ds_cost=ds_cost"
        , ""
        , "fn_afterQuery2"
        , true
        , ""
        , true);
        
//ds_bsu_cd.Filter("USED==''");             
        
}
/********************************************************************************
* 기      능   : 삽입 20
********************************************************************************/
function fn_insert() {
	gfn_clearMsgBar();

	if ( ds_list.rowCount() > 0 ) {
		var d_row = ds_list.GetLastRow() + 1;
		var g_sfr = ds_list.GetColumn(ds_list.GetLastRow(), "SFR");
		var g_sto = ds_list.GetColumn(ds_list.GetLastRow(), "STO");
		var g_bsu = ds_list.GetColumn(ds_list.GetLastRow(), "BSU");
		var g_rto = ds_list.GetColumn(ds_list.GetLastRow(), "RTO");
	
		if(length(g_sfr) == 0) {
			var arr = [d_row, st_sfr.value];
			gfn_showAlert("CW00055", arr);
			ds_list.row = ds_list.GetLastRow();
			return;
		}
	
		if(length(g_sto) == 0) {
			var arr = [d_row, st_sto.value];
			gfn_showAlert("CW00055", arr);
			ds_list.row = ds_list.GetLastRow();
			return;
		}
		
		if(length(g_bsu) == 0) {
			var arr = [d_row, st_bsu.value];
			gfn_showAlert("CW00055", arr);
			ds_list.row = ds_list.GetLastRow();
			return;
		}
	
		if(g_rto == null) {
			var arr = [d_row, st_rto.value];
			gfn_showAlert("CW00055", arr);
			ds_list.row = ds_list.GetLastRow();
			return;
		}
	}

	// 그리드에 row 추가 
	var newRow = gfn_addGridRow(grd_list, -1, "FLAG");
	var d_row = parseInt(ds_list.GetLastRow()) - 1;
	var g_row = parseInt(ds_list.GetColumn(d_row, "ISR")) + 1;
	ds_list.SetColumn(ds_list.currow, "ISR", g_row);
	
	ds_list.SetColumn(ds_list.currow, "SFR", usd);
	ds_list.SetColumn(ds_list.currow, "STO", uhj);
	ds_list.SetColumn(ds_list.currow, "BSU", bsu);
	ds_list.SetColumn(ds_list.currow, "GBU", ed_gbu.Text );
	ds_list.SetColumn(ds_list.currow, "TMP", "");
	ds_list.SetColumn(ds_list.currow, "HUR", 0);
	ds_list.SetColumn(ds_list.currow, "BDGBN", ed_bdgbn.Text);
	ds_list.SetColumn(ds_list.currow, "RTO", 0);
	ds_list.SetColumn(ds_list.currow, "TOTT", 0);
	ds_list.SetColumn(ds_list.currow, "TOT", 0);
	ds_list.SetColumn(ds_list.currow, "TOBT", 0);

//	grd_list.SetCellProp("body",1,"Display","null");
//	grd_list.SetCellProp("body",1,"Edit","none");
	
	if(g_max_chk == "N") {
		fn_searchSeq();
	}
}
/********************************************************************************
* 기      능   : Delete 
********************************************************************************/
function fn_delete() {
	gfn_clearMsgBar();
	
	if ( ds_list.rowCount() < 1 ) {
		// 삭제할 정보 없음. 
		gfn_showMsg("CW00013");
		return;
	}

	if(parseInt(ds_list.GetColumn(ds_list.row, "CNT")) > 0) {
//		gfn_showAlert("CW00063");
//		return;
	}

	// Grid 삭제 처리 
	gfn_deleteGridRow( grd_list, ds_list.row, "FLAG" );
}
/********************************************************************************
* 기      능   : 저장 
********************************************************************************/
function fn_save() {
	gfn_clearMsgBar();

	if ( ds_list.rowCount() < 1 ) {
		// 저장할 정보 없음. 
		gfn_showAlert("CW00010");
		return;
	}
	
	if ( !gfn_isChangeDs(ds_list, true) ) {
		return;
	}

	for(var i=0; i<ds_list.RowCount(); i++) {
		var g_sfr = ds_list.GetColumn(i, "SFR");
		var g_sto = ds_list.GetColumn(i, "STO");
		var g_bsu = ds_list.GetColumn(i, "BSU");
		var g_rto = ds_list.GetColumn(i, "RTO");

		if(length(g_sfr) == 0) {
			var arr = [parseInt(i) + 1, st_sfr.value];
			gfn_showAlert("CW00055", arr);
			ds_list.row = i;
			return;
		}
	
		if(length(g_sto) == 0) {
			var arr = [parseInt(i) + 1, st_sto.value];
			gfn_showAlert("CW00055", arr);
			ds_list.row = i;
			return;
		}
		
		if(parseInt(cal_usd_fm.value) > parseInt(g_sfr)) {
			var arr = [parseInt(i) + 1, st_sfr.value, st_usd.value];
			gfn_showAlert("CW00061", arr);
			ds_list.row = i;
			return;
		}

		if(parseInt(g_sfr) >= parseInt(g_sto)) {
			var arr = [parseInt(i) + 1, st_sto.value, st_sfr.value];
			gfn_showAlert("CW00061", arr);
			ds_list.row = i;
			return;
		}
		
		if(length(g_bsu) == 0) {
			var arr = [parseInt(i) + 1, st_bsu.value];
			gfn_showAlert("CW00055", arr);
			ds_list.row = i;
			return;
		}
	
		if(g_rto == null) {
			var arr = [parseInt(i) + 1, st_rto.value];
			gfn_showAlert("CW00055", arr);
			ds_list.row = i;
			return;
		}
		
		if(g_rto > 100) {
			var arr = [parseInt(i) + 1, st_rto.value];
			gfn_showAlert("CW00055", arr);
			ds_list.row = i;
			return;
		}

//		calc_Rto(i);

		var g_mon = 0;
		if(gfn_getDayCnt(ds_days, ds_list.GetColumn(i, "SFR"),ds_list.GetColumn(i, "STO")) < 366) {
			var t_mon = gfn_getMonthCnt(ds_list.GetColumn(i, "SFR"), ds_list.GetColumn(i, "STO"));
			if(t_mon == 13 && gfn_getDayCnt(ds_days, ds_list.GetColumn(i, "SFR"),ds_list.GetColumn(i, "STO")) < 366) {
				g_mon = 12;
			} else {
				g_mon = t_mon;
			}
		} else {
			g_mon = gfn_getMonthCnt(ds_list.GetColumn(i, "SFR"), ds_list.GetColumn(i, "STO"));
		}

		var g_seq = "";
		if(g_cnt > 0) {
			ds_list.SetColumn(i, "SEQ", ds_list.GetColumn(0, "SEQ"));
		} else {
			g_seq = ed_max_seq.value;
/*			
			if(parseInt(g_seq) < 10) {
				g_seq = "0" + g_seq;
			}
*/
			ds_list.SetColumn(i, "SEQ", g_seq);
		}

		ds_list.SetColumn(i, "G_CNT", g_cnt);
		ds_list.SetColumn(i, "UPN", ed_upn.value);
		ds_list.SetColumn(i, "CST", ed_cst.value);
		ds_list.SetColumn(i, "GND", ed_gnd.value);
		
		ds_list.SetColumn(i, "SYO", g_mon);
		ds_list.SetColumn(i, "UYO", g_mon);
		
		// 2018.09.18 전현정 DL 요청
		// 보수협력사 직영의 경우 계약직여부, 상주시간, 인원상주금액을 필수값으로 입력하도록 처리
		if(ds_bsu_cd.GetColumn(ds_bsu_cd.FindRow("CODE",ds_list.GetColumn(i,"BSU")),"BSU_GB") == 1) {
			if(length(ds_list.GetColumn(i, "TMP")) == 0) { // 계약직 여부
				gfn_showAlert("직영의 경우 계약직 여부를 입력해주시기 바랍니다.");
				return;
			}
			
			if(ToNumber(ds_list.GetColumn(i, "HUR")) <= 0) { // 상주시간
				gfn_showAlert("직영의 경우 상주시간을 입력해주시기 바랍니다.");
				return;
			}
			
			if(ToNumber(ds_list.GetColumn(i, "TOT")) <= 0) { // 인원상주금액
				gfn_showAlert("직영의 경우 인원상주금액을 입력해주시기 바랍니다.");
				return;
			}			
		}

		// 인원상주금액
		var g_tott = ds_list.GetColumn(i, "TOTT");
		if(g_tott == null) {
			g_tott = 0;
		}
		ds_list.SetColumn(i, "TOTT", g_tott);

		var g_amtt = 0;
		var g_vatt = 0;
		if(g_tott == 0) {
			g_amtt = 0;
			g_vatt = 0;
		} else {
			g_amtt = Round(((g_tott) / 1.1),0);
			g_vatt = g_tott - g_amtt;
		}
		ds_list.SetColumn(i, "AMTT", g_amtt);
		ds_list.SetColumn(i, "VATT", g_vatt);

		// 직영금액
		var g_tot = ds_list.GetColumn(i, "TOT");
		if(g_tot == null) {
			g_tot = 0;
		}
		ds_list.SetColumn(i, "TOT", g_tot);

		var g_amt = 0;
		var g_vat = 0;
		if(g_tot == 0) {
			g_amt = 0;
			g_vat = 0;
		} else {
			g_amt = Round(((g_tot) / 1.1),0);
			g_vat = g_tot - g_amt;
		}
		ds_list.SetColumn(i, "AMT", g_amt);
		ds_list.SetColumn(i, "VAT", g_vat);

		// 협력사금액
		var g_tobt = ds_list.GetColumn(i, "TOBT");
		if(g_tobt == null) {
			g_tobt = 0;
		}
		ds_list.SetColumn(i, "TOBT", g_tobt);

		var g_ambt = 0;
		var g_vabt = 0;
		if(g_tobt == 0) {
			g_ambt = 0;
			g_vabt = 0;
		} else {
			g_ambt = Round(((g_tobt) / 1.1),0);
			g_vabt = g_tobt - g_ambt;
		}
		ds_list.SetColumn(i, "AMBT", g_ambt);
		ds_list.SetColumn(i, "VABT", g_vabt);


		ds_list.SetColumn(i, "CQT", 0);

		var g_isr = parseInt(ds_list.GetColumn(i, "ISR"));
		if(g_isr < 10) {
			g_isr = "0" + g_isr;
		}
		ds_list.SetColumn(i, "ISR", g_isr);
	}

	tit_callService(
        "CS1201001D_ACT"
        , "save"
        , "ds_list=ds_list:A"
        , ""
        , ""
        , "fn_afterSave");
}

function fn_save2() {
	gfn_clearMsgBar();

	if ( ds_list.rowCount() < 1 ) {
		// 저장할 정보 없음. 
		gfn_showAlert("CW00010");
		return;
	}

	if ( !gfn_isChangeDs(ds_list, true) ) {
		return;
	}

	tit_callService(
        "CS1201001D_ACT"
        , "save2"
        , "ds_list=ds_list:A"
        , ""
        , ""
        , "fn_afterSave2");
}
/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	parent.fn_searchPersonInfo(); 
	close();
}
/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {
	// Excel Export 
	gfn_saveToExcel(grd_list, true );
}
/********************************************************************************
* 기      능   : 접수 5
********************************************************************************/
function fn_receipt() {

}
/********************************************************************************
* 기      능   : 승인 10
********************************************************************************/
function fn_approval() {

}
/********************************************************************************
* 기      능   : d결재 15
********************************************************************************/
function fn_decide() {

}
/********************************************************************************
* 기      능   : 취소 35
********************************************************************************/
function fn_cancel() {

}
/********************************************************************************
* 기      능   : print 40
********************************************************************************/
function fn_print() {

}
/********************************************************************************
* 기      능   : 발행 50
********************************************************************************/
function fn_out() {

}
/********************************************************************************
* 기      능   : 신청 55
********************************************************************************/
function fn_request() {

}
/********************************************************************************
* 기      능   : 전송 60
********************************************************************************/
function fn_trans() {

}
/********************************************************************************
* 기      능   : 반송 65
********************************************************************************/
function fn_sendback() {

}
/********************************************************************************
* 기      능   : 계산 70
********************************************************************************/
function fn_cal() {

}
/********************************************************************************
* 기      능   : 복사 75
********************************************************************************/
function fn_copy() {

}
/********************************************************************************
* 기      능   : 확인 80
********************************************************************************/
function fn_confirm() {

}

/********************************************************************************
* 기      능   : 복원 85
********************************************************************************/
function fn_reset() {
	ds_list.Reset();
}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================
function fn_afterSearchDate(errCode, errMsg) {
	cal_usd_fm.value = ds_date_cd.GetColumn(0, "L_USD");
	cal_usd_to.value = ds_date_cd.GetColumn(0, "L_UHJ");
}

function fn_afterSearchSeq(errCode, errMsg) {
	ed_max_seq.value = ds_seq.GetColumn(0, "SEQ");
	g_max_chk = "Y";
}

/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	// 메시지 처리 
	gfn_showMsg("CI00002", ds_list.RowCount()+"");
	if(ds_list.RowCount() > 0) {
		g_cnt = ds_list.RowCount();
	} else {
		g_cnt = 0;
	}
	chk_query = "query";
	btn_add.Enable = true;
	btn_del.Enable = true;
	btn_save.Enable = true;
	btn_seungin.Enable = false;
	grd_list.SetColProp(1,"Width",0);
//	grd_list.SetCellProp("body",1,"Display","null");
//	grd_list.SetCellProp("body",1,"Edit","none");
	if (vVkbur == "H100"){
		ds_bsu_cd.Filter("VKBUR=='H100'");
	} else {
		ds_bsu_cd.Filter("VKBUR!='H100'");
	}
}

function fn_afterQuery2(errCode, errMsg) {
	// 메시지 처리 
	gfn_showMsg("CI00002", ds_list.RowCount()+"");
	if(ds_list.RowCount() > 0) {
		g_cnt = ds_list.RowCount();
	} else {
		g_cnt = 0;
	}
	chk_query = "seungin_query";
	btn_add.Enable = false;
	btn_del.Enable = false;
	btn_save.Enable = false;
	btn_seungin.Enable = true;
	grd_list.SetColProp(1,"Width",30);
//	grd_list.SetCellProp("body",1,"Display","checkbox");
//	grd_list.SetCellProp("body",1,"Edit","checkbox");
	if (vVkbur == "H100"){
		ds_bsu_cd.Filter("VKBUR=='H100' && USED==''");
	} else {
		ds_bsu_cd.Filter("VKBUR!='H100' && USED==''");
	}
}

function fn_afterQuery3(errCode, errMsg) {
	// 메시지 처리 
	gfn_showMsg("CI00002", ds_list.RowCount()+"");
	if(ds_list.RowCount() > 0) {
		g_cnt = ds_list.RowCount();
	} else {
		g_cnt = 0;
	}
	chk_query = "query";
	btn_add.Enable = false;
	btn_del.Enable = false;
	btn_save.Enable = false;
	btn_seungin.Enable = false;
	grd_list.SetColProp(1,"Width",0);
//	grd_list.SetCellProp("body",1,"Display","null");
//	grd_list.SetCellProp("body",1,"Edit","none");
	if (vVkbur == "H100"){
		ds_bsu_cd.Filter("VKBUR=='H100' && USED==''");
	} else {
		ds_bsu_cd.Filter("VKBUR!='H100' && USED==''");
	}

}

/********************************************************************************
* 기      능   : 저장 Callback  
********************************************************************************/
function fn_afterSave(errCode, errMsg) {
	if ( errCode!= 0 ) {
		gfn_showMsg("CE00001");
	} else {
		gfn_showMsg("CI00003");
		fn_query();
	}
}

function fn_afterSave2(errCode, errMsg) {
	if ( errCode!= 0 ) {
		gfn_showMsg("CE00001");
	} else {
		//승인처리 성공 이후 시행율 계산
		fn_calCostS(); // 원가 및 시행율 계산
		fn_saveCost(); // 
		gfn_showMsg("CI00003");
		fn_query2();
	}
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
// 사용자 정의 함수는 ufn_xxxx() 형태로 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 사용자 정의 함수  
********************************************************************************/
function ufn_userfunction() {

}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 : 각 Component 별 이벤트 
//=========================================================================================
/********************************************************************************
* 기      능   : 그리드 헤더 클릭시 정렬 처리 
********************************************************************************/
function grd_list_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	if ( nCell == 0 ) {
		// 그리드 표시할 컬럼 선택 
		//gfn_selectGridCol(obj);
	} else {
		// 그리드 정렬 처리 (마지막 row의 값으로 일련번호 생성하므로 sorting 가 되면 값 지정을 할수가 없다.)
		//gfn_sortGrid(obj,nCell);
	}
}
/********************************************************************************
* 기      능   : 데이터셋 값 변경 시 - Flag 처리 
********************************************************************************/
function ds_list_CanColumnChange(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if (strColumnID == "BDGBN"){
		if (ds_list.GetColumn(nRow, "GBU") == "1"){
			return false;
		} else {
			if (ed_gbu.value == "3" && ed_bdgbn.value != "1"){
				return false;
			}
		}
	}
}

function ds_list_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
//	gfn_changeFlag( obj, strColumnID, nRow, "FLAG" );
	
	if(strColumnID == "CHK") {
		obj.fireevent = false;
		if(ds_list.GetColumn(nRow, "CHK") == true) {
			ds_list.SetColumn(nRow, "FLAG", "U");
		} else {
			ds_list.SetColumn(nRow, "FLAG", "");
		}
		obj.fireevent = true;
	} else if(strColumnID == "BSU") { 

		fn_setDetail(nRow);		
	} else if(strColumnID == "TMP") {

		fn_setDetail(nRow);		
	} else if (strColumnID == "RTO"){
		if (ds_list.GetColumn(nRow,"BDGBN") == "1"){
			if (toNumber(ds_list.GetColumn(nRow,"TOTT")) > 0){
				ds_list.SetColumn(nRow, "TOT", ceil(toNumber(ds_list.GetColumn(nRow,"TOTT")) * (100 - toNumber(ds_list.GetColumn(nRow,"RTO"))) / 100));
				ds_list.SetColumn(nRow, "TOBT", toNumber(ds_list.GetColumn(nRow,"TOTT")) - toNumber(ds_list.GetColumn(nRow,"TOT")));
			}
		}
	} else if (strColumnID == "TOTT"){
		if (toNumber(ds_list.GetColumn(nRow, "RTO")) == 0){
				ds_list.SetColumn(nRow, "TOT", ds_list.GetColumn(nRow,"TOTT"));
				ds_list.SetColumn(nRow, "TOBT", 0);
		} else {
			if (ds_list.GetColumn(nRow,"BDGBN") == "1"){
				ds_list.SetColumn(nRow, "TOT", ceil(toNumber(ds_list.GetColumn(nRow,"TOTT")) * (100 - toNumber(ds_list.GetColumn(nRow,"RTO"))) / 100));
				ds_list.SetColumn(nRow, "TOBT", toNumber(ds_list.GetColumn(nRow,"TOTT")) - toNumber(ds_list.GetColumn(nRow,"TOT")));
			} else {
				ds_list.SetColumn(nRow, "TOT", ds_list.GetColumn(nRow,"TOTT"));
				ds_list.SetColumn(nRow, "TOBT", 0);
			}
		}
	} else if (strColumnID == "TOT"){
		if (ds_list.GetColumn(nRow,"BDGBN") == "1"){
			ds_list.SetColumn(nRow, "TOBT", toNumber(ds_list.GetColumn(nRow,"TOTT")) - toNumber(ds_list.GetColumn(nRow,"TOT")));
		}
	} else if (strColumnId == "BDGBN"){
		if (ds_list.GetColumn(nRow, "BDGBN") == "1"){
			if (toNumber(ds_list.GetColumn(nRow, "TOTT")) != 0){
				ds_list.SetColumn(nRow, "TOT", ceil(toNumber(ds_list.GetColumn(nRow, "TOTT")) * (100 - toNumber(ds_list.GetColumn(nRow, "RTO"))) / 100));
				ds_list.SetColumn(nRow, "TOBT", toNumber(ds_list.GetColumn(nRow, "TOTT")) - toNumber(ds_list.GetColumn(nRow, "TOT")));
			}
		} else {
			if (toNumber(ds_list.GetColumn(nRow, "TOTT")) != 0){
				ds_list.SetColumn(nRow, "TOT", ds_list.GetColumn(nRow, "TOTT"));
				ds_list.SetColumn(nRow, "TOBT", 0);
			}
		}
	}
}

function fn_setDetail(nRow){
	var bsu    = ds_list.GetColumn(nRow, "BSU");
	var temp   = ds_list.GetColumn(nRow, "TMP");
	var idx    = ds_bsu_cd.FindRow("CODE", bsu );
	var gb     = ds_bsu_cd.GetColumn(idx, "BSU_GB");
	 // 직영의 경우 계약직 여부 체크
	if(gb == "1") {
		ds_list.SetColumn(nRow, "BDGBN", "");
		if(temp == "Y") {
			ds_list.SetColumn(nRow, "HUR" , 0);					
		}
		ds_list.SetColumn(nRow, "RTO" , 0);	
		ds_list.SetColumn(nRow, "GBU", gb);
	 // 협력의 경우 계약직 여부 초기 N 설정
	} else if (gb == "3") {
		ds_list.SetColumn(nRow, "TMP", "N");	
		ds_list.SetColumn(nRow, "HUR" , 0);	
		ds_list.SetColumn(nRow, "GBU", gb);
		if (ed_gbu.Text == "3"){
			ds_list.SetColumn(nRow, "BDGBN", ed_bdgbn.Text);
		}
	}


}
// 달력 처리 부분 
/********************************************************************************
* 기      능   : 그리드에서 날짜 입력시 
********************************************************************************/
function grd_list_OnExpandEdit(obj,nRow,nCell,strVal,nPivotIndex)
{
	if(ds_list.GetColumn(ds_list.row, "DBYN") == "Y") {
		gfn_showMsg("CW00060");
		return;
	} else {
		var rect = obj.GetCellRect(nRow, ncell);
	
		cal_temp.top = rect[1] + 125;
		cal_temp.Left = rect[0] + 40; 
		cal_temp.Visible = true;
		
		if(nCell == 3) {
			//cal_temp.value = ds_list.getColumn(nRow, "SFR");
		} else if(nCell == 4) {
			//cal_temp.value = ds_list.getColumn(nRow, "STO");
		}
		
		cal_temp.SetFocus();
	}
}

/********************************************************************************
* 기      능   : 달력에서 일자 선택했을 경우 
********************************************************************************/
function cal_temp_OnDayClick(obj,strText)
{
	/*
	if(grd_list.GetClickedCell() == 3)
		ds_list.SetColumn(ds_list.row, "SFR", strText);
	else if (grd_list.GetClickedCell() == 4)
		ds_list.SetColumn(ds_list.row, "STO", strText);
	*/
	obj.Visible = false;
}

/********************************************************************************
* 기      능   : 달력에서 포커스 잃었을 경우 
********************************************************************************/
function cal_temp_OnKillFocus(obj)
{
	obj.Visible = false;
}

function calc_Rto(nRow) {
	var t_rto = parseInt(ds_list.getColumn(nRow, "RTO"));

	if(t_rto > 100) {
		var arr = [nRow + 1, st_rto.value];
		gfn_showAlert("CW00055", arr);
		ds_list.row = nRow;
		return;
	}
}

function btn_save_query_OnClick(obj)
{
	fn_query();
}

function btn_save_OnClick(obj)
{
	fn_save();
}

function btn_reset_OnClick(obj)
{
	fn_reset();
}

function btn_seungin_query_OnClick(obj)
{
	fn_query2();
}

function btn_seungin_OnClick(obj)
{
	fn_save2();
}

function btn_query_OnClick(obj)
{
	gfn_clearMsgBar();
	
	// sort mark 삭제 
	gfn_clearGridSortMark(grd_list);
	ds_list.row = -1;
	ds_list.ClearData();

	ds_cond.SetColumn(0, "UPN", upn);
	ds_cond.SetColumn(0, "CST", cst);
	ds_cond.SetColumn(0, "USD", usd);
	ds_cond.SetColumn(0, "UHJ", uhj);

	tit_clearActionInfo();
	tit_addSearchActionInfo("cs12:CS1201001D_S6");
	tit_addSearchActionInfo("cs12:CS1201001D_S3");
	
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_bsu_cond ds_cond=ds_cond"
        , "ds_bsu_cd=ds_bsu_list ds_list=ds_list"
        , ""
        , "fn_afterQuery3"
        , true
        , ""
        , true);
        
//ds_bsu_cd.Filter("USED==''");
        
}

function grd_list_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	var bsu    = ds_list.GetColumn(nRow, "BSU");
	var temp   = ds_list.GetColumn(nRow, "TMP");
	// 업체 입력 후 계약직 여부 선택
	if(nCell == 6) { // "TEMP_YN"
		if(bsu == ""){
			alert("업체를 먼저 지정하세요.");
			ds_list.SetColumn(nRow, "TMP", "");	
			grd_list.SetCellPos(5);
		} 
	}	
}

function grd_list_OnCellPosChanged(obj,nRow,nCell,nOldRow,nOldCell,nPivotIndex,nOldPivotIndex)
{
	var bsu    = ds_list.GetColumn(nRow, "BSU");
	var temp   = ds_list.GetColumn(nRow, "TMP");
	var idx    = ds_bsu_cd.FindRow("CODE", bsu );
	var gb     = ds_bsu_cd.GetColumn(idx, "BSU_GB");
	
	if(temp == "Y"){
		ds_list.SetColumn(nRow, "HUR" , 0);
		ds_list.SetColumn(nRow, "RTO"  , 0);	
	}	
	if(gb == "3"){
		ds_list.SetColumn(nRow, "HUR" , 0);
	}	
}

function fn_calCostS() {

	var m_amt    = parseInt(ds_list.GetColumn(0, "M_AMT")) ;         // 임금
	var cs604_us = ds_list.GetColumn(0, "CS604_US") ;  // 정기보수 간접비율
	var tmp_amt = 2700000 ;  // 계약직 임금
	var wday = 20 ;
	var sjt = 0 ;    //  전체 상주 원가 
	var sjt_t = 0 ;  //  업체별 상주 원가 
	var smt = 0 ;  // 전체 상주 수주 ( vat 포함 )
	var smt_t = 0 ;  // 업체별 상주 수주 ( vat 포함 )
	var ums = 0 ;  // 개월수
	
	// 연차별 상주 정보 합산
	for(var i=0; i<ds_list.rowcount ; i++) {
	
		ums = gfn_getMonthCnt(ds_cost.GetColumn(0, "RGS"),ds_cost.GetColumn(0, "RMR"));
		smt_t = ds_list.GetColumn(i, "TOT") * ums ; 
		if(ds_list.GetColumn(i, "TGB") == "1") {
			if(ds_list.GetColumn(i, "TMP") == "N"){
				sjt_t = parseInt(ds_list.GetColumn(i, "HUR")) * m_amt * wday;
				sjt_t = sjt_t * ums;
			} else {
				sjt_t = tmp_amt;
				sjt_t = sjt_t * ums;
			}
		
		} else if(ds_list.GetColumn(i, "TGB") == "3") {
			sjt_t = ( parseInt(ds_list.GetColumn(i, "TOT")) * parseInt(ds_list.GetColumn(i, "RTO")) ) / 100 ;
			sjt_t = sjt_t * ums;
		
		} else {
			sjt_t = 0;
		}
		sjt += sjt_t ;
		smt += smt_t ;		
	}

	var nmt = parseInt(ds_cost.GetColumn(0, "NMT"));
	var jmt = parseInt(ds_cost.GetColumn(0, "JMT"));
	var kmt = parseInt(ds_cost.GetColumn(0, "KMT"));
	var hmt = parseInt(ds_cost.GetColumn(0, "HMT"));
	var dmt = parseInt(ds_cost.GetColumn(0, "DMT"));
	var cmt = parseInt(ds_cost.GetColumn(0, "CMT"));
	var cost  = 0;
	var costt = 0;
	var gmt = 0;
	var rat = 0 ;
	var tamt = parseInt(ds_cost.GetColumn(0, "TAMT"));
	
	cost =  nmt + jmt + kmt + hmt + dmt + cmt + sjt ; // 정기보수 직접비 + 상주 원가
	gmt = ( cost * cs604_us ) / 100;                 // 상주 원가 포함 간접비	
	costt = cost + gmt ;							  // 상주 총원가 ( 간접비 포함 )	
	tamt = tamt + smt ;                               // 정기보수 수주 + 인원상주 수주
	rat = round((costt / tamt * 100),1);

	ds_cost.SetColumn(0, "SJT", sjt);	
	ds_cost.SetColumn(0, "GMT", gmt);
	ds_cost.SetColumn(0, "COST", costt);
	ds_cost.SetColumn(0, "RAT", rat);
	ds_cost.SetColumn(0, "TAMT", tamt);
	//trace(ds_cost.SaveXML());
}
function fn_saveCost(){
	trace(ds_cost.SaveXML());
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs12:CS1201001B_I6");	
	tit_callService(
        ""
        , ""
        , "ds_cost=ds_cost"
        , ""
        , ""
        , ""
        , false
        , false
        , true);
}
]]></Script>
</Window>