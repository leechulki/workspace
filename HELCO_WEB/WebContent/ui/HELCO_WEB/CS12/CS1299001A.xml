<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="560" Id="CS1299001A" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="표준단가&#32;조회&#32;" Top="8" Ver="1.0" Width="980" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="PJT" size="256" summ="default" type="STRING"/>
					<colinfo id="ARA" size="256" summ="default" type="STRING"/>
					<colinfo id="BPM" size="256" summ="default" type="STRING"/>
					<colinfo id="BSU" size="256" summ="default" type="STRING"/>
					<colinfo id="TEM" size="256" summ="default" type="STRING"/>
					<colinfo id="DAT" size="256" summ="default" type="STRING"/>
					<colinfo id="DPT" size="256" summ="default" type="STRING"/>
					<colinfo id="PGMID" size="256" summ="default" type="STRING"/>
					<record>
						<ARA></ARA>
						<BPM></BPM>
						<BSU></BSU>
						<DAT></DAT>
						<DPT></DPT>
						<PGMID></PGMID>
						<PJT></PJT>
						<TEM></TEM>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list2">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_auth">
				<Contents>
					<colinfo id="GNUMB" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user0" Bottom="56" Height="56" Id="Shape0" Left="0" LineColor="user1" Right="978" TabOrder="1" Top="0" Type="Rectangle" Width="978"></Shape>
		<Div BKColor="user0" Height="20" Id="div_code" Left="88" OnLoadCompleted="fn_OnLoadCompleted" OnTimer="WB0199010A_OnTimer" TabOrder="3" Text="Div0" Top="5" Url="WB01::WB0199010A.xml" Width="415">
			<Contents></Contents>
		</Div>
		<Static Align="Right" Height="20" Id="st_bsu" Left="5" Style="sty_lb_search" TabOrder="2" Text="협력사&#32;" Top="5" VAlign="Middle" Width="80"></Static>
		<Grid AutoFitEndLine="Hide" BindDataset="ds_list2" BkColor2="default" BoldHead="true" Border="Flat" Bottom="552" ColSizing="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="488" Id="grd_list2" InputPanel="FALSE" Left="6" LineColor="user20" LineType="ExHORZ" OnCellDBLClick="grd_list2_OnCellDblClick" OnHeadClick="grd_list2_OnHeadClick" Right="972" RowHeight="20" Style="sty_grid" TabOrder="4" TabStop="true" Top="64" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="966">
			<contents>
				<format id="Default">
					<columns>
						<col fix="left" width="40"/>
						<col fix="left" width="60"/>
						<col fix="left" width="40"/>
						<col fix="left" width="60"/>
						<col fix="left" width="80"/>
						<col fix="left" width="120"/>
						<col fix="left" width="70"/>
						<col fix="left" width="120"/>
						<col fix="left" width="120"/>
						<col fix="left" width="40"/>
						<col fix="left" width="40"/>
						<col fix="left" width="60"/>
						<col fix="left" width="40"/>
						<col fix="left" width="40"/>
						<col fix="left" width="30"/>
						<col fix="left" width="0"/>
						<col fix="left" width="70"/>
						<col fix="left" width="45"/>
						<col fix="left" width="30"/>
						<col width="100"/>
						<col width="100"/>
						<col width="60"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user21" display="text" font="굴림,9" text="No"/>
						<cell align="center" col="1" color="user21" display="text" font="굴림,9" text="원PJT"/>
						<cell align="center" col="2" color="user21" display="text" font="굴림,9" text="호기"/>
						<cell align="center" col="3" color="user21" display="text" font="굴림,9" text="직영구분"/>
						<cell align="center" col="4" color="user21" display="text" font="굴림,9" text="팀"/>
						<cell align="center" col="5" color="user21" display="text" font="굴림,9" text="업체명"/>
						<cell align="center" col="6" color="user21" display="text" font="굴림,9" text="보수인수일"/>
						<cell align="center" bkcolor="user13" col="7" color="user21" display="text" font="굴림,9" text="사양"/>
						<cell align="center" bkcolor="user13" col="8" color="user21" display="text" font="굴림,9" text="전기기종"/>
						<cell align="center" col="9" color="user21" display="text" font="굴림,9" text="인승"/>
						<cell align="center" col="10" color="user21" display="text" font="굴림,9" text="용량"/>
						<cell align="center" col="11" color="user21" display="text" font="굴림,9" text="빌딩구분"/>
						<cell align="center" bkcolor="user1" col="12" color="user21" display="text" font="굴림,9" text="속도"/>
						<cell align="center" bkcolor="user1" col="13" color="user21" display="text" font="굴림,9" text="층수"/>
						<cell align="center" bkcolor="user1" col="14" color="user21" display="text" font="굴림,9" text="연차"/>
						<cell align="center" bkcolor="user1" col="15" color="user21" display="text" font="굴림,9" text="SEG(전)"/>
						<cell align="center" bkcolor="user1" col="16" color="user21" display="text" font="굴림,9" text="SEG"/>
						<cell align="center" bkcolor="user1" col="17" color="user21" display="text" font="굴림,9" text="기준층"/>
						<cell align="center" bkcolor="user1" col="18" color="user21" display="text" font="굴림,9" text="S/R"/>
						<cell align="center" bkcolor="user25" col="19" color="user21" display="text" font="굴림,9" text="FM표준보수료"/>
						<cell align="center" bkcolor="INFOBK" col="20" color="user21" display="text" font="굴림,9" text="POG표준보수료"/>
						<cell align="center" bkcolor="aliceblue" col="21" color="user21" display="text" font="굴림,9" text="요율"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" display="text" expr="currow+1"/>
						<cell align="center" bkcolor2="user22" col="1" colid="PJT" display="text"/>
						<cell align="center" bkcolor2="user22" col="2" colid="HNO" display="text"/>
						<cell align="center" bkcolor2="user22" col="3" colid="GBU_NM" display="text"/>
						<cell align="center" bkcolor2="user22" col="4" colid="VKGRP_NM" display="text"/>
						<cell align="left" bkcolor2="user22" col="5" colid="BSU_NM" display="text"/>
						<cell align="center" bkcolor2="user22" col="6" colid="ISD" display="text" Mask="####.##.##"/>
						<cell align="center" bkcolor2="user22" col="7" colid="ZSPEC1" display="text"/>
						<cell align="center" bkcolor2="user22" col="8" colid="ZSPEC12" display="text"/>
						<cell align="right" bkcolor2="user22" col="9" colid="ZSPEC5" display="text"/>
						<cell align="right" bkcolor2="user22" col="10" colid="ZSPEC6" display="text"/>
						<cell align="center" bkcolor2="user22" col="11" colid="ABG_NM" display="text"/>
						<cell align="right" bkcolor2="user22" col="12" colid="ZSPEC3" display="number"/>
						<cell align="right" bkcolor2="user22" col="13" colid="ZSPEC7" display="number"/>
						<cell align="center" bkcolor2="user22" col="14" colid="AGEK" display="text"/>
						<cell align="center" bkcolor2="user22" col="15" colid="SEG" display="text"/>
						<cell align="center" bkcolor2="user22" col="16" colid="STO" display="text"/>
						<cell align="right" bkcolor2="user22" col="17" colid="STD3" display="text"/>
						<cell align="center" bkcolor2="user22" col="18" colid="SRG" display="text"/>
						<cell align="right" bkcolor2="user22" col="19" colid="F10" display="number" Mask="###,###"/>
						<cell align="right" bkcolor2="user22" col="20" colid="P10" display="number" Mask="###,###"/>
						<cell align="right" bkcolor2="user22" col="21" colid="CS512_RAT" display="number" Mask="##0.###"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Align="Right" Height="20" Id="st_pjt" Left="5" Style="sty_lb_search" TabOrder="5" Text="Proj&#32;No&#32;" Top="32" VAlign="Middle" Width="80"></Static>
		<Edit BindDataset="ds_cond" Border="Flat" Column="PJT" Height="20" Id="ed_pjt" Left="88" MaxLength="6" Style="sty_ipt_search" TabOrder="6" Top="32" UpperOnly="TRUE" Width="82"></Edit>
		<Button Cursor="HAND" Height="18" Id="btn_pjt" ImageID="btn_icon_search" Left="174" OnClick="btn_pjt_OnClick" TabOrder="7" Text="Button0" Top="33" Width="18"></Button>
		<Static Align="Right" Height="20" Id="st_dat" Left="202" Style="sty_lb_search" TabOrder="9" Text="기준일자&#32;" Top="32" VAlign="Middle" Width="80"></Static>
		<Calendar BindDataset="ds_cond" Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="DAT" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_dat" Left="284" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_search" SundayTextColor="user35" TabOrder="8" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="32" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="100"></Calendar>
	</Form>
	<Script><![CDATA[﻿﻿﻿﻿﻿﻿﻿﻿/*
 ******************************************************************************************
 * 기      능   : 
 * 작  성  자   : 
 * 작성  일자   : 
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::nsfRequest.js";	// 공통 스크립트 
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================

//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	gfn_initForm(true);	
	cal_dat.Value = gfn_getCurrDate();
	fn_chkAuth();
}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}
var auth = false ;
function fn_chkAuth(){
	ds_auth.ClearData();
	
	tit_clearActionInfo();																	
	tit_addSearchActionInfo("cs12:CS1299002A_S1");									
	tit_callService(		
			""
			, ""							
			, ""							
			, "ds_auth=ds_auth"							
			, ""							
			, ""							
			, true							
			, false							
			, true); 
			
	if(ds_auth.RowCount() > 0) {
		auth = true;
	}
}

//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 1
********************************************************************************/
var user_grp = "";

function fn_query() {
	
	ds_list2.ClearData();
	//보수 3단 콤보 셋팅
	
	user_grp = gfn_getUserGroup();

	if(user_grp == '40') {
		if(gfn_isNull(div_code.cb_big, true, st_bsu.value))
			return;
	}

	if(user_grp == "10") { // 보수협력사일 경우
		ds_cond.SetColumn(0, "BSU", G_LGORT);
		ds_cond.SetColumn(0, "TEM", '');
		ds_cond.SetColumn(0, "BPM", '');
		ds_cond.SetColumn(0, "ARA", '');
	} else if(user_grp == "20") { // 보수PM일 경우
		ds_cond.SetColumn(0, "BSU", trim(div_code.cb_small.value));
		ds_cond.SetColumn(0, "TEM", '');
		ds_cond.SetColumn(0, "BPM", G_USER_ID);
		ds_cond.SetColumn(0, "ARA", '');
	} else if(user_grp == "30") { // 지방사무소일 경우
		ds_cond.SetColumn(0, "BSU", trim(div_code.cb_small.value));
		ds_cond.SetColumn(0, "TEM", G_SAP_USER_VGCD);
		ds_cond.SetColumn(0, "BPM", '');
		ds_cond.SetColumn(0, "ARA", '');
	} else if(user_grp == "40") { // 고객지원부일 경우
		ds_cond.SetColumn(0, "BSU", trim(div_code.cb_small.value));
		if(div_code.cb_big.value == '1') { // 협력사 콤보1이 지역일 경우
			ds_cond.SetColumn(0, "TEM", '');
			ds_cond.SetColumn(0, "BPM", '');
			ds_cond.SetColumn(0, "ARA", trim(div_code.cb_mid.value));
		} else if(div_code.cb_big.value == '2') { // 협력사 콤보1이 PM일 경우
			ds_cond.SetColumn(0, "TEM", '');
			ds_cond.SetColumn(0, "BPM", trim(div_code.cb_mid.value));
			ds_cond.SetColumn(0, "ARA", '');
		} else if(div_code.cb_big.value == '4') { // 부서
			ds_cond.SetColumn(0, "BSU", '');
			ds_cond.SetColumn(0, "DPT", trim(div_code.cb_mid.value));
			ds_cond.SetColumn(0, "TEM", trim(div_code.cb_small.value));
		} else { // 협력사 콤보1이 팀일 경우
			ds_cond.SetColumn(0, "TEM", trim(div_code.cb_mid.value));
			ds_cond.SetColumn(0, "BPM", '');
			ds_cond.SetColumn(0, "ARA", '');
		}
	}
	ds_cond.SetColumn(0, "PGMID", "STDPRICE");

	tit_callService(
        "CS1299001A_ACT"
        , "getStdPrice"
        , "ds_cond=ds_cond"
        , "ds_list2=ds_list"
        , ""
        , "fn_afterQuery");	

}
/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	
	if(auth == false) {
		grd_list2.SetCellProp("body",21,"display","null");
	}
	gfn_showMsg("CI00002",ds_list2.RowCount()+"");
}
//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
// 사용자 정의 함수는 ufn_xxxx() 형태로 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 사용자 정의 함수  
********************************************************************************/
function cb_tyyyy_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	if(cb_tyyyy.Value <> cb_fyyyy.Value){
		gfn_showAlert("시작 년도를 확인하십시오");
		cb_tyyyy.Value = cb_fyyyy.Value;
	}
}
function cb_fyyyy_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	cb_tyyyy.Value = cb_fyyyy.Value;
}

function cb_fmm_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	if(cb_tmm.Value < cb_fmm.Value){
		gfn_showAlert("시작 월을 확인하십시오");
		obj.Index = nOldIndex;
	}	
}
function grd_list_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	gfn_sortGrid(obj,nCell);
}

function grd_list2_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	gfn_sortGrid(obj,nCell);
}
/********************************************************************************
* 기      능   : 엑셀
********************************************************************************/
function fn_excel() {
	gfn_saveToExcel(grd_list2, true, , , , true); /*HEADER 포함하여 출력*/
}

function btn_upn_OnClick(obj)
{
	var arg = "upn="+quote(ed_upn.Text)+" cnt="+quote("0");
	gfn_openPopup("CS9601001A",true,arg);
	
}

function btn_trash_OnClick(obj)
{
	ds_cond.setColumn(0, "UPN", "");
	ds_cond.setColumn(0, "CST", "");
	ed_upn.value = "";
	ed_cst.value = "";
}

function grd_list2_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{

	if(auth == true) {

		if(ds_list2.RowCount() != 0) {
			var arg = "j="+quote(nRow);
					
			gfn_openPopup("CS1299002A", true, arg);
		}
	}
	
}]]></Script>
</Window>