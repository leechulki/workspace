<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form DragMode="TRUE" DropMode="TRUE" Height="562" Id="PS1205001A" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="안전관리&#32;사진업로드" Top="8" Ver="1.0" Width="978" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="GBN" size="255" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="SO_GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="SO_GBN2" size="256" summ="default" type="STRING"/>
					<record>
						<GBN></GBN>
						<PSPID></PSPID>
						<SO_GBN></SO_GBN>
						<SO_GBN2></SO_GBN2>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_fair">
				<Contents>
					<colinfo id="INP_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="165" summ="default" type="STRING"/>
					<colinfo id="POSID" size="48" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="48" summ="default" type="STRING"/>
					<colinfo id="PRONR" size="48" summ="default" type="STRING"/>
					<colinfo id="PROWRK" size="6" summ="default" type="STRING"/>
					<colinfo id="PRO_R" size="30" summ="default" type="STRING"/>
					<colinfo id="MDATE" size="105" summ="default" type="STRING"/>
					<colinfo id="MTIME" size="105" summ="default" type="STRING"/>
					<colinfo id="ERNAM" size="256" summ="default" type="STRING"/>
					<colinfo id="EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="ETIME" size="256" summ="default" type="STRING"/>
					<colinfo id="AENAM" size="256" summ="default" type="STRING"/>
					<colinfo id="VER" size="256" summ="default" type="STRING"/>
					<colinfo id="M_CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="COM_CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="AENAM" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="ORGFNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="FDATR" size="256" summ="default" type="STRING"/>
					<colinfo id="WGS84_X" size="256" summ="default" type="STRING"/>
					<colinfo id="WGS84_Y" size="256" summ="default" type="STRING"/>
					<colinfo id="INS_GBN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list">
				<Contents>
					<colinfo id="CHECK" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN_NM" size="165" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="48" summ="default" type="STRING"/>
					<colinfo id="POSID" size="48" summ="default" type="STRING"/>
					<colinfo id="POSID_DONG" size="48" summ="default" type="STRING"/>
					<colinfo id="CNT" size="6" summ="default" type="STRING"/>
					<colinfo id="CDATE" size="30" summ="default" type="STRING"/>
					<colinfo id="CNAME" size="105" summ="default" type="STRING"/>
					<colinfo id="CNAME2" size="105" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="COLOR" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_TMP" size="256" summ="default" type="STRING"/>
					<colinfo id="TYPE" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO_STEP" size="256" summ="default" type="STRING"/>
					<colinfo id="SAFE" size="256" summ="default" type="STRING"/>
					<colinfo id="SAFE_CK" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP1" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP1_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP1_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP2" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP2_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP2_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP3" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP3_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP3_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="APPR_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="APPR_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="PRONR" size="256" summ="default" type="STRING"/>
					<colinfo id="PROWRK" size="256" summ="default" type="STRING"/>
					<colinfo id="PRO_R" size="256" summ="default" type="STRING"/>
					<colinfo id="VER" size="256" summ="default" type="STRING"/>
					<colinfo id="PMMBPN" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSITE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN_NM2" size="256" summ="default" type="STRING"/>
					<colinfo id="ZZGUBUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list2">
				<Contents>
					<colinfo id="CHECK" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="165" summ="default" type="STRING"/>
					<colinfo id="POSID" size="48" summ="default" type="STRING"/>
					<colinfo id="POSID_DONG" size="48" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="48" summ="default" type="STRING"/>
					<colinfo id="TYPE" size="48" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="6" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="30" summ="default" type="STRING"/>
					<colinfo id="CDATE" size="105" summ="default" type="STRING"/>
					<colinfo id="CNAME" size="60" summ="default" type="STRING"/>
					<colinfo id="CNAME2" size="105" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="DEL" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO_STEP" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH2" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME2" size="256" summ="default" type="STRING"/>
					<colinfo id="FDATR" size="256" summ="default" type="STRING"/>
					<colinfo id="PRONR" size="256" summ="default" type="STRING"/>
					<colinfo id="PROWRK" size="256" summ="default" type="STRING"/>
					<colinfo id="PRO_R" size="256" summ="default" type="STRING"/>
					<colinfo id="VER" size="256" summ="default" type="STRING"/>
					<colinfo id="ZZGUBUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list_tmp">
				<Contents>
					<colinfo id="CHECK" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN_NM" size="165" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="48" summ="default" type="STRING"/>
					<colinfo id="POSID" size="48" summ="default" type="STRING"/>
					<colinfo id="POSID_DONG" size="48" summ="default" type="STRING"/>
					<colinfo id="CNT" size="6" summ="default" type="STRING"/>
					<colinfo id="CDATE" size="30" summ="default" type="STRING"/>
					<colinfo id="CNAME" size="105" summ="default" type="STRING"/>
					<colinfo id="CNAME2" size="105" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="COLOR" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_TMP" size="256" summ="default" type="STRING"/>
					<colinfo id="TYPE" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SAFE" size="256" summ="default" type="STRING"/>
					<colinfo id="SAFE_CK" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP1" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP1_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP1_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="DEVICE_GBN1" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP2" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP2_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP2_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="DEVICE_GBN2" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP3" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP3_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP3_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="DEVICE_GBN3" size="256" summ="default" type="STRING"/>
					<colinfo id="APPR_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="APPR_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="PRONR" size="256" summ="default" type="STRING"/>
					<colinfo id="PROWRK" size="256" summ="default" type="STRING"/>
					<colinfo id="PRO_R" size="256" summ="default" type="STRING"/>
					<colinfo id="VER" size="256" summ="default" type="STRING"/>
					<colinfo id="PMMBPN" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSITE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN_NM2" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list2_tmp">
				<Contents>
					<colinfo id="CHECK" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="165" summ="default" type="STRING"/>
					<colinfo id="POSID" size="48" summ="default" type="STRING"/>
					<colinfo id="POSID_DONG" size="48" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="48" summ="default" type="STRING"/>
					<colinfo id="TYPE" size="48" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="6" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="30" summ="default" type="STRING"/>
					<colinfo id="CDATE" size="105" summ="default" type="STRING"/>
					<colinfo id="CNAME" size="60" summ="default" type="STRING"/>
					<colinfo id="CNAME2" size="105" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="DEL" size="256" summ="default" type="STRING"/>
					<colinfo id="SET" size="256" summ="default" type="STRING"/>
					<colinfo id="PRONR" size="256" summ="default" type="STRING"/>
					<colinfo id="PROWRK" size="256" summ="default" type="STRING"/>
					<colinfo id="PRO_R" size="256" summ="default" type="STRING"/>
					<colinfo id="VER" size="256" summ="default" type="STRING"/>
					<colinfo id="ZZGUBUN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond2">
				<Contents>
					<colinfo id="GBN" size="255" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="POSID" size="256" summ="default" type="STRING"/>
					<colinfo id="SO_GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="SO_GBN2" size="256" summ="default" type="STRING"/>
					<colinfo id="TYPE" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO_STEP" size="256" summ="default" type="STRING"/>
					<colinfo id="SAFE" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP1_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP2_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="STEP3_DT" size="256" summ="default" type="STRING"/>
					<record>
						<GBN></GBN>
						<GNO></GNO>
						<POSID></POSID>
						<PSPID></PSPID>
						<SAFE></SAFE>
						<SO_GBN></SO_GBN>
						<SO_GBN2></SO_GBN2>
						<TYPE></TYPE>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond3">
				<Contents>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="48" summ="default" type="STRING"/>
					<colinfo id="POSID" size="48" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="SO_GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="TYPE" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SAFE" size="256" summ="default" type="STRING"/>
					<colinfo id="SAFE_CK" size="256" summ="default" type="STRING"/>
					<colinfo id="TYPE_CHK" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond_fair">
				<Contents>
					<colinfo id="PSPID" size="48" summ="default" type="STRING"/>
					<colinfo id="POSID" size="48" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="PRONR" size="256" summ="default" type="STRING"/>
					<colinfo id="PROWRK" size="256" summ="default" type="STRING"/>
					<colinfo id="PRO_R" size="256" summ="default" type="STRING"/>
					<colinfo id="COM_CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="FDATR" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="ORGFNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="FDATR" size="256" summ="default" type="STRING"/>
					<colinfo id="VER" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list3">
				<Contents>
					<colinfo id="CNT" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond_ms">
				<Contents>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="SO_GBN" size="256" summ="default" type="STRING"/>
					<colinfo id="SO_GBN2" size="256" summ="default" type="STRING"/>
					<record>
						<GUBUN></GUBUN>
						<PSPID></PSPID>
						<SO_GBN/>
						<SO_GBN2/>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_trans">
				<Contents>
					<colinfo id="MESGACCP" size="256" summ="default" type="STRING"/>
					<colinfo id="MESGTITL" size="256" summ="default" type="STRING"/>
					<colinfo id="MESGDESC" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list_cnt">
				<Contents>
					<colinfo id="COUNT1" size="256" summ="default" type="STRING"/>
					<colinfo id="COUNT2" size="256" summ="default" type="STRING"/>
					<colinfo id="COUNT3" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_confirm">
				<Contents>
					<colinfo id="NECESS_CK" size="255" summ="default" type="STRING"/>
					<colinfo id="CK" size="256" summ="default" type="STRING"/>
					<record>
						<CK></CK>
						<NECESS_CK></NECESS_CK>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_chk">
				<Contents>
					<colinfo id="CNT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_gbn">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="TYPE" size="256" summ="default" type="STRING"/>
					<colinfo id="TYPE_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="GNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_gbn2">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="TYPE" size="256" summ="default" type="STRING"/>
					<colinfo id="VER" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_finish_pic_cond">
				<Contents>
					<colinfo id="GUBUN" size="256" summ="default" type="STRING"/>
					<colinfo id="TYPE" size="256" summ="default" type="STRING"/>
					<colinfo id="VER" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_finish_pic">
				<Contents>
					<colinfo id="SEQNOTXT" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="F_EXT" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME_APP" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_rtn">
				<Contents>
					<colinfo id="INP_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="165" summ="default" type="STRING"/>
					<colinfo id="POSID" size="48" summ="default" type="STRING"/>
					<colinfo id="GUBUN" size="48" summ="default" type="STRING"/>
					<colinfo id="PRONR" size="48" summ="default" type="STRING"/>
					<colinfo id="PROWRK" size="6" summ="default" type="STRING"/>
					<colinfo id="PRO_R" size="30" summ="default" type="STRING"/>
					<colinfo id="MDATE" size="105" summ="default" type="STRING"/>
					<colinfo id="MTIME" size="105" summ="default" type="STRING"/>
					<colinfo id="ERNAM" size="256" summ="default" type="STRING"/>
					<colinfo id="EDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="ETIME" size="256" summ="default" type="STRING"/>
					<colinfo id="AENAM" size="256" summ="default" type="STRING"/>
					<colinfo id="VER" size="256" summ="default" type="STRING"/>
					<colinfo id="M_CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="COM_CHK" size="256" summ="default" type="STRING"/>
					<colinfo id="AENAM" size="256" summ="default" type="STRING"/>
					<colinfo id="FPATH" size="256" summ="default" type="STRING"/>
					<colinfo id="ORGFNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FNAME" size="256" summ="default" type="STRING"/>
					<colinfo id="FSIZE" size="256" summ="default" type="STRING"/>
					<colinfo id="FDATR" size="256" summ="default" type="STRING"/>
					<colinfo id="WGS84_X" size="256" summ="default" type="STRING"/>
					<colinfo id="WGS84_Y" size="256" summ="default" type="STRING"/>
					<colinfo id="INS_GBN" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_sms">
				<Contents>
					<colinfo id="FLAG" size="256" summ="default" type="STRING"/>
					<colinfo id="TRAN_PHONE" size="256" summ="default" type="STRING"/>
					<colinfo id="TRAN_CALLBACK" size="256" summ="default" type="STRING"/>
					<colinfo id="TRAN_STATUS" size="256" summ="default" type="STRING"/>
					<colinfo id="TRAN_DATE" size="256" summ="default" type="STRING"/>
					<colinfo id="TRAN_MSG" size="256" summ="default" type="STRING"/>
					<colinfo id="TRAN_SUBJECT" size="256" summ="default" type="STRING"/>
					<colinfo id="REQDATE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_reqdate">
				<Contents>
					<colinfo id="REQDATE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user0" Bottom="64" Height="64" Id="Shape0" Left="0" LineColor="user1" Right="978" TabOrder="3" Top="0" Type="Rectangle" Width="978"></Shape>
		<Radio BindDataset="ds_cond" BKColor="user0" Border="None" Column="SO_GBN2" Font="굴림,9" Height="18" Id="rd_gbn2" INDEX="-1" Left="416" OnChanged="rd_gbn2_OnChanged" Style="sty_ipt_form_radio" TabOrder="17" Top="34" Value="1" Width="290">
			<Contents>
				<Layout code="EL01" height="20" left="0" text="MR" top="0" width="80"/>
				<Layout code="EL02" height="20" left="90" text="MRL" top="0" width="80"/>
				<Layout code="EL03" height="20" left="180" text="NEW&#32;MRL" top="0" width="150"/>
			</Contents>
		</Radio>
		<Shape BKColor="user12" Bottom="93" Height="26" Id="Shape12" Left="8" LineColor="user13" Right="544" TabOrder="16" Top="67" Type="Rectangle" Width="536"></Shape>
		<Static Align="Right" Height="20" Id="Static5" Left="209" Style="sty_lb_search" TabOrder="9" Text="구분&#32;" Top="4" VAlign="Middle" Width="80"></Static>
		<Combo BindDataset="ds_cond" Border="Flat" CodeColumn="CODE" Column="GBN" DataColumn="CODE_NAME" Height="20" Id="cb_gbn" ImeMode="none" InnerDataset="ds_gbn" Left="291" OnChanged="cb_gbn_OnChanged" Style="sty_ipt_search" TabOrder="2" Top="3" Width="197"></Combo>
		<Grid AreaSelect="TRUE" AutoFitEndLine="Hide" BindDataset="ds_list" BkColor2="default" BoldHead="true" Border="Flat" Bottom="384" CellMoving="TRUE" ColSelect="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="288" Id="grd_list" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" OnCellClick="grd_list_OnCellClick" OnCellDBLClick="grd_list_OnCellDblClick" OnHeadClick="grd_list_OnHeadClick" Right="966" RowHeight="20" Style="sty_grid" TabOrder="10" TabStop="true" Top="96" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="958">
			<contents>
				<format id="Default">
					<columns>
						<col width="33"/>
						<col width="36"/>
						<col width="0"/>
						<col width="82"/>
						<col width="93"/>
						<col width="98"/>
						<col width="0"/>
						<col width="80"/>
						<col width="80"/>
						<col width="92"/>
						<col width="80"/>
						<col width="80"/>
						<col width="59"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user21" display="text" font="굴림,9" text="NO"/>
						<cell align="center" col="1" color="user21" display="checkbox" font="굴림,9"/>
						<cell align="center" col="2" color="user21" display="text" font="굴림,9" text="구분"/>
						<cell align="center" col="3" color="user21" display="text" font="굴림,9" text="프로젝트"/>
						<cell align="center" col="4" color="user21" display="text" font="굴림,9" text="동"/>
						<cell align="center" col="5" color="user21" display="text" font="굴림,9" text="호기"/>
						<cell align="center" col="6" color="user21" display="text" font="굴림,9" text="파일건수"/>
						<cell align="center" col="7" color="user21" display="text" font="굴림,9" text="분류"/>
						<cell align="center" col="8" color="user21" display="text" font="굴림,9" text="TYPE"/>
						<cell align="center" col="9" color="user21" display="text" font="굴림,9" text="생성일"/>
						<cell align="center" col="10" color="user21" display="text" font="굴림,9" text="생성ID"/>
						<cell align="center" col="11" color="user21" display="text" font="굴림,9" text="생성자"/>
						<cell align="center" col="12" color="user21" display="text" font="굴림,9" text="출처"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text" expr="currow+1"/>
						<cell align="center" bkcolor2="user22" col="1" colid="CHECK" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="checkbox" edit="checkbox"/>
						<cell bkcolor2="user22" col="2" colid="GBN_NM" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text" suppress="1"/>
						<cell align="center" bkcolor2="user22" col="3" colid="PSPID" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text"/>
						<cell align="center" bkcolor2="user22" col="4" colid="POSID_DONG" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text" font="굴림,9"/>
						<cell align="center" bkcolor2="user22" col="5" colid="POSID" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text"/>
						<cell align="center" bkcolor2="user22" col="6" colid="CNT" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text"/>
						<cell align="center" bkcolor2="user22" col="7" colid="TYPE" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text"/>
						<cell align="center" bkcolor2="user22" col="8" colid="TYPE" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text"/>
						<cell align="center" bkcolor2="user22" col="9" colid="CDATE" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text" Mask="####.##.##"/>
						<cell align="center" bkcolor2="user22" col="10" colid="CNAME" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text"/>
						<cell align="center" bkcolor2="user22" col="11" colid="CNAME2" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text" font="굴림,9"/>
						<cell align="center" bkcolor2="user22" col="12" colid="DEVICE_GBN" color='expr:iif(COLOR==&quot;X&quot;,&quot;red&quot;,&quot;default&quot;)' display="text" font="굴림,9"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Grid AreaSelect="TRUE" AutoFitEndLine="Hide" BindDataset="ds_list2" BkColor2="default" BoldHead="true" Border="Flat" Bottom="565" ColSelect="TRUE" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="173" Id="grd_list2" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" OnCellDBLClick="grd_list2_OnCellDblClick" OnHeadClick="grd_list2_OnHeadClick" Right="966" RowHeight="20" Style="sty_grid" TabOrder="11" TabStop="true" Top="392" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="958">
			<contents>
				<format id="Default">
					<columns>
						<col width="40"/>
						<col width="32"/>
						<col width="82"/>
						<col width="55"/>
						<col width="73"/>
						<col width="75"/>
						<col width="149"/>
						<col width="174"/>
						<col width="77"/>
						<col width="77"/>
						<col width="77"/>
						<col width="44"/>
					</columns>
					<head>
						<cell align="center" col="0" color="user34" display="text" font="굴림,9" text="NO"/>
						<cell align="center" col="1" color="user21" display="text" font="굴림,9" text="선택"/>
						<cell align="center" col="2" color="user21" display="text" font="굴림,9" text="프로젝트"/>
						<cell align="center" col="3" color="user21" display="text" font="굴림,9" text="동"/>
						<cell align="center" col="4" color="user21" display="text" font="굴림,9" text="호기"/>
						<cell align="center" col="5" color="user21" display="text" font="굴림,9" text="분류"/>
						<cell align="center" col="6" color="user21" display="text" font="굴림,9" text="파일명"/>
						<cell align="center" col="7" color="user21" display="text" font="굴림,9" text="저장파일명"/>
						<cell align="center" col="8" color="user21" display="text" font="굴림,9" text="생성일"/>
						<cell align="center" col="9" color="user21" display="text" font="굴림,9" text="생성ID"/>
						<cell align="center" col="10" color="user21" display="text" font="굴림,9" text="생성자"/>
						<cell align="center" col="11" color="user21" display="text" font="굴림,9" text="출처"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" display="text" expr="CURROW+1"/>
						<cell bkcolor2="user22" col="1" colid="CHECK" display="checkbox" edit="checkbox" suppress="1"/>
						<cell align="center" bkcolor2="user22" col="2" colid="PSPID" combodisplayrowcnt="10" display="text"/>
						<cell align="center" bkcolor2="user22" col="3" colid="POSID_DONG" display="text"/>
						<cell align="center" bkcolor2="user22" col="4" colid="POSID" combodisplayrowcnt="10" display="text"/>
						<cell align="center" bkcolor2="user22" col="5" colid="TYPE" display="text"/>
						<cell bkcolor="user1" col="6" colid="FNAME" display="text" suppress="1"/>
						<cell bkcolor2="user22" col="7" colid="FNAME_APP" display="text" suppress="1"/>
						<cell align="center" bkcolor2="user22" col="8" colid="CDATE" display="text" Mask="####.##.##"/>
						<cell align="center" bkcolor2="user22" col="9" colid="CNAME" combodisplayrowcnt="10" display="text"/>
						<cell align="center" bkcolor2="user22" col="10" colid="CNAME2" combodisplayrowcnt="10" display="text" font="굴림,9"/>
						<cell align="center" bkcolor2="user22" col="11" colid="DEVICE_GBN" combodisplayrowcnt="10" display="text" font="굴림,9"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Static Align="Right" DomainID="com.pjtno" Height="20" Id="st_pjt" Left="8" Style="sty_lb_search" TabOrder="12" Text="프로젝트번호&#32;" Top="4" VAlign="Middle" Width="92"></Static>
		<Edit BindDataset="ds_cond" Border="Flat" CheckLength="Byte" Column="PSPID" Height="20" Id="ed_pjt" ImeMode="english" Left="102" MaxLength="6" OnChanged="ed_pjt_OnChanged" Style="sty_ipt_search" TabOrder="1" Top="4" UpperOnly="TRUE" Width="78"></Edit>
		<Button Height="18" Id="Button0" ImageID="btn_icon_search" Left="182" OnClick="btn_pjt_OnClick" TabOrder="13" Text="Button0" Top="5" Width="18"></Button>
		<FileDialog Bottom="600" Height="24" Id="fileDialog" Left="224" Right="248" TabOrder="9" Top="576" Width="24"></FileDialog>
		<CyHttpFile Height="24" Id="httpFile" Left="260" Top="576" Width="24"></CyHttpFile>
		<File Bottom="600" Height="24" Id="f_tmp" Left="293" Right="317" TabOrder="11" Top="576" Width="24"></File>
		<Button Height="19" Id="btn_openFile" ImageID="btn_icon_polder" Left="521" OnClick="btn_openFile_OnClick" TabOrder="6" Text="Button0" Top="71" Width="19"></Button>
		<Edit Border="Flat" DragMode="TRUE" DropMode="TRUE" Enable="FALSE" Height="20" Id="ed_FileName" Left="136" LeftMargin="4" Readonly="TRUE" RightMargin="4" Style="sty_ipt_form" TabOrder="5" Top="70" Width="382"></Edit>
		<Static Height="24" Id="st_insuName" Left="9" Style="sty_lb_form_basic" TabOrder="14" Text="&#32;&#32;&#32;&#32;&#32;*&#32;&#32;&#32;첨부파일&#32;&#32;&#32;*&#32;&#32;&#32;&#32;&#32;" Top="68" VAlign="Middle" Width="124"></Static>
		<Checkbox BindDataset="ds_confirm" Column="NECESS_CK" Height="20" Id="cb_necess" Left="548" TabOrder="7" Text="사진업로드필수" Top="70" Width="104"></Checkbox>
		<Button ButtonStyle="TRUE" Height="27" Id="bt_confirm" Left="661" OnClick="bt_confirm_OnClick" TabOrder="8" Text="확&#32;&#32;인" Top="67" Width="57"></Button>
		<FileDialog Bottom="624" Height="24" Id="saveDialog" Left="383" Right="407" TabOrder="14" Top="600" Type="Save" Width="24"></FileDialog>
		<Static Align="Right" Height="21" Id="Static0" Left="8" Style="sty_lb_search" TabOrder="16" Text="부문&#32;" Top="32" VAlign="Middle" Width="92"></Static>
		<Radio BindDataset="ds_cond" BKColor="user0" Border="None" Column="SO_GBN" Font="굴림,9" Height="15" Id="rd_chk" INDEX="-1" Left="104" OnChanged="rd_chk_OnChanged" Style="sty_ipt_form_radio" TabOrder="3" Top="34" Value="1" Width="175">
			<Contents>
				<Layout code="10" height="20" left="0" text="E/L" top="0" width="40"/>
				<Layout code="11" height="20" left="40" text="E/S" top="0" width="40"/>
				<Layout code="12" height="20" left="83" text="M/W" top="0" width="50"/>
				<Layout code="20" height="20" left="132" text="주차" top="0" width="50"/>
			</Contents>
		</Radio>
		<Combo BindDataset="ds_cond" Border="Flat" CodeColumn="CODE" Column="SO_GBN2" DataColumn="CODE_NAME" Height="22" Id="cb_gbn2" InnerDataset="ds_gbn2" Left="283" OnChanged="cb_gbn2_OnChanged" Style="sty_ipt_search" TabOrder="4" Top="31" Width="120"></Combo>
		<Static Align="Right" Border="Flat" Height="22" Id="Static6" Left="101" Style="sty_ipt_search" TabOrder="16" Top="32" VAlign="Middle" Width="180"></Static>
		<Static Align="Right" Border="Flat" Height="22" Id="Static1" Left="407" Style="sty_ipt_search" TabOrder="16" Top="32" VAlign="Middle" Width="302"></Static>
		<Button ButtonStyle="TRUE" Font="굴림,9" Height="24" Id="btn_sample" Left="492" OnClick="btn_sample_OnClick" Style="sty_btn" TabOrder="21" Text="샘플보기" Top="2" Width="64"></Button>
		<Static Font="굴림,9" Height="16" Id="Static12" Left="608" TabOrder="22" Text="설치본부&#32;안전3단계&#32;운영은&#32;안전승인시스템으로&#32;변경운영됩니다." Top="8" Width="376"></Static>
		<Static Font="굴림,9" Height="16" Id="Static2" Left="608" TabOrder="23" Text="안전조치사진&#32;등록은&#32;[작업일보&#32;공정진행현황(현장이미지)]&#32;화면에서&#32;하시기&#32;바랍니다." Top="24" Width="475"></Static>
	</Form>
	<Script><![CDATA[
/*
 ******************************************************************************************
 * 기      능   :  안전관리 사진업로드
 * 작  성  자   :  방 기 태
 * 작성  일자   :  2012.06.20
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트

//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다.
//=========================================================================================
var userGroup;
var nRows;
var preTemno;
var zzgubun;
var zztype;
var F_SIZE = 1024 * 10096;	// 4096K
var selectedRow = -1;
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	trace('### fn_OnLoadCompleted ###');

	rd_gbn2_visible();

	// Form 로드 이벤트 맨 첫줄에 기술
	gfn_initForm();

	userGroup = gfn_getUserGroup();

	tit_clearActionInfo();
	tit_addSearchActionInfo("ps12:PS1205001A_S18");       //이전 : tit_addSearchActionInfo("ps12:PS1205001A_S17");
	tit_addSearchActionInfo("ps12:PS1205001A_S16");

	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond"
        , "ds_gbn2=ds_gbn2 ds_gbn=ds_gbn"
        , ""
        , ""
        , ""
        , ""
        , true);

    rd_chk.Index = 0;

    cb_gbn.Index = 0;

    ds_gbn2.FILTER("GUBUN==" + quote( rd_chk.Value)  );
    cb_gbn2.Index =  0;

    ds_gbn.FILTER("TYPE==" + quote( cb_gbn2.Value)  );
    cb_gbn.Index =  0;

	fn_confirm();
}

/********************************************************************************
* 기      능   : 사진업로드 필수 읽어 오기
********************************************************************************/
function fn_confirm()
{
	//사진 업로드 필수여부 체크
	tit_clearActionInfo();
	tit_addSearchActionInfo("ps12:PS1205001A_S3");
	tit_callService(
        ""
        , ""
        , ""
        , "ds_confirm=ds_confirm"
        , ""
        , ""
        , ""
        , ""
        , true);

	if(ds_confirm.GetColumn(0, "CK") > 0)
	{
		cb_necess.Enable = true;
		bt_confirm.Visible = true;
	}
	else
	{
		cb_necess.Enable = false;
		bt_confirm.Visible = false;
	}
}

/********************************************************************************
* 기      능   : form UnloadCompleted
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 조회
********************************************************************************/
function fn_query() {
  	fn_confirm();

	ds_list2.Clear();

	tit_clearActionInfo();

	tit_addSearchActionInfo("wb01:WB0199061A_S1");
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond"
        , "ds_list=ds_list"
        , ""
        , "fn_afterQuery"
        , ""
        , ""
        , true);

	ed_FileName.value = '';
}

/********************************************************************************
* 기      능   : 조회 Callback
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	gfn_showMsg("CI00002",ds_list.RowCount()+"");
	Trace(ds_list.saveXML());
	ds_list2.ClearData();
	if(ds_list.RowCount() > 0) {
		if (selectedRow > -1) {
			//fn_query2(selectedRow);
		} else {
			//fn_query2(0);
		}
	}

	if(ds_list.GetRowCount() > 0 && ds_list.GetColumn(0, "ZZGUBUN") <> '11' && ds_list.GetColumn(0, "ZZGUBUN") <> '12' && ds_list.GetColumn(0, "ZZGUBUN") <> '20')	// 주차가 아닐 경우, 조회불가.
	{
		ds_list.ClearData();
		gfn_openMsgWin("안전조치사진 등록은 아래 화면을 이용해 주세요\n[작업일보 공정진행현황(현장이미지)]");
		return;
	}
	
	fn_queryCnt();
	
	
}

function fn_queryCnt() {
	if(rd_chk.Value == "10") // E/L
  	{
    	tit_clearActionInfo();
		tit_addSearchActionInfo("wb01:WB0199061A_S7");
		tit_callService(
        	""
        	, ""
        	, "ds_cond=ds_cond"
        	, "ds_list_cnt=ds_list_cnt"
        	, ""
        	, "fn_afterQueryCnt"
        	, true);
  	}
}

function fn_afterQueryCnt(errCode, errMsg) {
	trace('@@@ fn_afterQueryCnt ###');

	var rd_gbn2_cnt1 = 'MR';
	var rd_gbn2_cnt2 = 'MRL';
	var rd_gbn2_cnt3 = 'NEW MRL';

	rd_gbn2.SetRadioProp(0, 'text', rd_gbn2_cnt1 + '(' + ds_list_cnt.GetColumn(0, 'COUNT1') + ')');
	rd_gbn2.SetRadioProp(1, 'text', rd_gbn2_cnt2 + '(' + ds_list_cnt.GetColumn(0, 'COUNT2') + ')');
	rd_gbn2.SetRadioProp(2, 'text', rd_gbn2_cnt3 + '(' + ds_list_cnt.GetColumn(0, 'COUNT3') + ')');

	var _so_gbn2 = ds_cond.GetColumn(0, 'SO_GBN2');
	trace('SO_GBN2 : ' + _so_gbn2);
	if (_so_gbn2 == 'EL01') {
		rd_gbn2.Index = 0;
	} else if (_so_gbn2 == 'EL02') {
		rd_gbn2.Index = 1;
	} else {
		rd_gbn2.Index = 2;
	}
}

/********************************************************************************
* 기      능   : grid double click 시 조회
********************************************************************************/
function fn_query2(nRow) {
	trace('$$$ fn_query2 !!!');

	ds_list2.ClearData();

	ds_cond2.ClearData();
	ds_cond2.AddRow();
	ds_cond2.setColumn(0, "GBN", ds_list.GetColumn(nRow,"GBN"));
	ds_cond2.setColumn(0, "PSPID", ds_list.GetColumn(nRow,"PSPID"));
	ds_cond2.setColumn(0, "POSID", ds_list.GetColumn(nRow,"POSID"));
	ds_cond2.setColumn(0, "SO_GBN", ds_list.GetColumn(nRow,"SO_GBN"));
	ds_cond2.setColumn(0, "GNO", ds_list.GetColumn(nRow, "GNO"));
	ds_cond2.setColumn(0, "GNO_STEP", ds_list.GetColumn(nRow, "GNO_STEP"));
	ds_cond2.setColumn(0, "STEP1_DT", ds_list.GetColumn(nRow,"STEP1_DT"));
	ds_cond2.setColumn(0, "STEP2_DT", ds_list.GetColumn(nRow,"STEP2_DT"));
	ds_cond2.setColumn(0, "STEP3_DT", ds_list.GetColumn(nRow,"STEP3_DT"));

	tit_clearActionInfo();
	tit_addSearchActionInfo("ps12:PS1205001A_S1", null, true);

	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond2"
        , "ds_list2=ds_list"
        , ""
        , "fn_afterQuery2"
        , ""
        , ""
        , true);
}

/********************************************************************************
* 기      능   : 조회 Callback
********************************************************************************/
function fn_afterQuery2(errCode, errMsg) {
	grd_list2.SetCellProp("head",0,"text",ds_list2.rowcount+" 건");
}

/********************************************************************************
* 기      능   : 첨부파일 열기
********************************************************************************/
function btn_openFile_OnClick(obj)
{
	fileDialog.open();

	if ( length(fileDialog.FilePath) == 0
		|| length(fileDialog.FileName ) == 0 ) {
		return;
	}

	var fileSize = f_tmp.GetLength(fileDialog.FilePath + "\\" + fileDialog.FileName );
	if ( fileSize <= 0 ) {
		gfn_showAlert("CW00048");
		return;
	}

	if ( fileSize > toNumber(F_SIZE)) {
		gfn_showAlert("CW00047", "10 Mbytes" );
		return;
	}

	// 그리드 저장 대상 로우
	if(ds_list.FindRow("CHECK", 1)==-1)
	{
		gfn_showMsg('CW00046');
		return;
	}

	ed_FileName.value = fileDialog.FileName;

	for(var i=0; i<ds_list.GetRowCount(); i++)
	{
		if(ds_list.GetColumn(i, "CHECK")==1)
		{
			// 파일정보
            ds_list.setColumn(i, "FNAME", fileDialog.FileName);

			ds_list.setColumn(i, "FSIZE", fileSize);
			ds_list.setColumn(i, "FPATH", fileDialog.FilePath);

			ds_list.setColumn(i, "GBN", cb_gbn.Value);

			ds_list.SetColumn(i, "FNAME_TMP",  cb_gbn.Text + "." + gfn_getFileExt(fileDialog.FileName));
		}
	}
}

/********************************************************************************
* 기      능   : 저장
********************************************************************************/
function fn_save() {

	if(gfn_isNull(ed_FileName, true, st_insuName.Value)) return false; // 첨부파일

	if (ds_list2.RowCount() > 0) {
		gfn_showAlert("기존 파일을 삭제하고 등록하세요.");
		return;
	}

	// 그리드 저장 대상 로우
	if(ds_list.FindRow("CHECK", 1)==-1)
	{
		gfn_showMsg('CW00046');
		return;
	}

	ds_list.Filter("CHECK==1");
	ds_list_tmp.copyF(ds_list);
	ds_list.unFilter();
	
	ds_sms.ClearData();

	if(fn_checkSave()){

		var fileName = left(GetDate(),8)+"_"+right(GetDate(),6)+"_"+ds_list_tmp.getColumn(0, "GBN")+"_"+ds_list_tmp.getColumn(0, "PSPID");
		
		
		var arr = tit_fileWrite(httpFile
						, "QM"
						, ds_list_tmp.getColumn(0, "FPATH")
						, ds_list_tmp.getColumn(0, "FNAME")
						, fileName// 실제 db에 저장될 파일 이름
						, "U"	  // time stamp를 붙이지 않을 경우 U 사용
						, "");    // ds_list_tmp.getColumn(i, "CS108_QAD") );//삭제할 이전 파일명
		
		if ( arr[0] == "S" )
		{
			for(var i=0; i<ds_list_tmp.GetRowCount(); i++)
			{
				ds_list_tmp.setColumn(i, "FNAME_APP", arr[2]);

				//=======update/insert (마스터)구분=================
				ds_cond3.ClearData();
				ds_cond3.AddRow();
				ds_cond3.setColumn(0, "GBN",   ds_list_tmp.GetColumn(i, "GBN"));
				ds_cond3.setColumn(0, "PSPID", ds_list_tmp.GetColumn(i, "PSPID"));
				ds_cond3.setColumn(0, "POSID", ds_list_tmp.GetColumn(i, "POSID"));
				ds_cond3.setColumn(0, "FNAME", ds_list_tmp.GetColumn(i, "FNAME"));
				ds_cond3.setColumn(0, "SO_GBN", ds_list_tmp.GetColumn(i, "SO_GBN"));


				tit_clearActionInfo();
				tit_addSelectExActionInfo("wb01:WB0199061A_S4", "wb01:WB0199061A_I1", "");

				tit_callService(
					""
					, ""
					, "ds_cond3=ds_cond3"
					, ""
					, ""
					, ""
					, ""
					, ""
					, true  // ""
				);

				if (Length(ds_list_tmp.GetColumn(i, 'PRONR')) > 0) {
					trace('pronr exists : ' + ds_list_tmp.GetColumn(i, 'PRONR'));

					ds_cond_fair.ClearData();
					ds_cond_fair.AddRow();
					ds_cond_fair.SetColumn(0, 'PSPID', ds_list_tmp.GetColumn(i, 'PSPID'));
					ds_cond_fair.SetColumn(0, 'POSID', ds_list_tmp.GetColumn(i, 'POSID'));
					ds_cond_fair.SetColumn(0, 'GUBUN', ds_list_tmp.GetColumn(i, 'ZZGUBUN'));
					ds_cond_fair.SetColumn(0, 'PRONR', ds_list_tmp.GetColumn(i, 'PRONR'));
					ds_cond_fair.SetColumn(0, 'PROWRK', ds_list_tmp.GetColumn(i, 'PROWRK'));
					ds_cond_fair.SetColumn(0, 'PRO_R', ds_list_tmp.GetColumn(i, 'PRO_R'));
					ds_cond_fair.SetColumn(0, 'VER', ds_list_tmp.GetColumn(i, 'VER'));
					ds_cond_fair.SetColumn(0, 'COM_CHK', '1');

					trace('PSPID : ' + ds_cond_fair.GetColumn(i, 'PSPID'));
					trace('POSID : ' + ds_cond_fair.GetColumn(i, 'POSID'));
					trace('GUBUN : ' + ds_cond_fair.GetColumn(i, 'GUBUN'));
					trace('PRONR : ' + ds_cond_fair.GetColumn(i, 'PRONR'));
					trace('PROWRK : ' + ds_cond_fair.GetColumn(i, 'PROWRK'));
					trace('PRO_R : ' + ds_cond_fair.GetColumn(i, 'PRO_R'));
					trace('VER : ' + ds_cond_fair.GetColumn(i, 'VER'));
					trace('COM_CHK : ' + ds_cond_fair.GetColumn(i, 'COM_CHK'));

					tit_clearActionInfo();
					tit_addSearchActionInfo("ps02:PS0208001A_S4");
					tit_addSearchActionInfo("ps02:PS0207004A_S2"); // 2021.06.01 근무시간, 휴일체크 : 근무시간이면 'CURRENT', 근무외시간 휴일이면 가까운 근무시간 리턴
					tit_callService(
						""
						, ""
						, "ds_cond_fair=ds_cond_fair"
						, "ds_fair=ds_fair ds_reqdate=ds_reqdate"
						, ""
						, ""
						, ""
						, ""
						, true  // ""
					);

					trace('공정표 데이터 존재 유무 : ' + ds_fair.RowCount());
					if (ds_fair.RowCount() > 0 && Length(ds_fair.GetColumn(0, 'MDATE')) > 0) {
						trace('계획 공정');
						
						arr = tit_fileWrite(httpFile
							, "PS"
							, ds_list_tmp.getColumn(0, "FPATH")
							, ds_list_tmp.getColumn(0, "FNAME")
							, fileName// 실제 db에 저장될 파일 이름
							, ""	  // time stamp를 붙이지 않을 경우 U 사용
							, "");    // ds_list_tmp.getColumn(i, "CS108_QAD") );//삭제할 이전 파일명
						
						trace('arr0 : ' + arr[0] + ', arr1 : ' + arr[1] + ', arr2 : ' + arr[2]);

						if (arr[0] == 'S') {

							ds_cond_fair.SetColumn(0, 'FPATH', arr[1]);
							ds_cond_fair.SetColumn(0, 'ORGFNAME', fileName);
							ds_cond_fair.SetColumn(0, 'FNAME', arr[2]);
							ds_cond_fair.SetColumn(0, 'FSIZE', arr[3]);

							trace('FPATH : ' + ds_cond_fair.GetColumn(i, 'FPATH'));
							trace('FNAME : ' + ds_cond_fair.GetColumn(i, 'FNAME'));
							trace('FSIZE : ' + ds_cond_fair.GetColumn(i, 'FSIZE'));

							tit_clearActionInfo();
							tit_addMultiActionInfo("ps02:PS0208001A_U4");
							tit_callService(
								""
								, ""
								, "ds_cond1=ds_cond_fair"
								, ""
								, ""
								, ""
								, ""
								, ""
								, true  // ""
							);
							
							var ver = ds_list_tmp.GetColumn(i, 'VER');							

							if ( ( ver == "003" || ver == "004" ) && ds_list_tmp.GetColumn(i, 'SAFE_CK') == 'X' ) {
							
								// SMS 전송
								var tel = ds_list_tmp.GetColumn( i , "PMMBPN");
								var txt;
								var msg = "[안전조치 사진등록] "
										+ ds_list_tmp.GetColumn( i , "POSID") + " "
										 + ds_list_tmp.GetColumn(i, "ZSITE_NM")+ "의 "
										 + ds_list_tmp.GetColumn(i, "GBN_NM2")+ " "
										 + "사진이 등록되었습니다. 안전조치를 확인하고 승인/반려 바랍니다. ";
										 
								var lv_reqdate = ds_reqdate.GetColumn(ds_reqdate.currow, "REQDATE");	
								
								var row = ds_sms.AddRow();
								
								// PM수신 
								ds_sms.SetColumn(row, "FLAG", "U");
								ds_sms.SetColumn(row, "TRAN_SUBJECT", "[안전조치 사진등록]");
								ds_sms.SetColumn(row, "TRAN_PHONE", tel);
								ds_sms.SetColumn(row, "TRAN_CALLBACK", '02-3670-1213'); // 2018 03 21 
								ds_sms.SetColumn(row, "TRAN_STATUS", "0");
								ds_sms.SetColumn(row, "TRAN_DATE", "");
								ds_sms.SetColumn(row, "TRAN_MSG", msg);
								ds_sms.SetColumn(row, "REQDATE", lv_reqdate);																
							}
							
						} else {
							gfn_showAlert(arr[1]);
						}

					} else {
						trace('계획 공정 아님');
					}
				} else {
					trace('공정표 데이터 없음!!!');
				}

				//=================안전 사진파일 임의로 고정파일명 지정=================
				ds_list_tmp.setColumn(i, "FNAME", ds_list_tmp.GetColumn(i, "FNAME_TMP") );
				//======================================================================

			}

			//디테일 INSERT
			tit_clearActionInfo();
			tit_addMultiActionInfo("wb01:WB0199061A_I2");
			tit_callService(
			  ""
			, ""
			, "ds_list_tmp=ds_list_tmp"
			, ""
			, ""
			, "fn_afterSave"
			, ""
			, ""
			, true);
		}
		else if ( arr[0] != "S" )
		{
			gfn_showMsg("CW00035");
			if (Length(arr[1]) > 0) {
				gfn_alert(arr[1]);
			}
			return;
		}
	}
}


/********************************************************************************
* 기      능   : 저장전에 자료 검증
********************************************************************************/
function fn_checkSave()
{
	//타입,기종, 구분 확인별로 저장확인
	for(var i=0; i<ds_list_tmp.GetRowCount(); i++)
	{
		if (substr(cb_gbn.Value,0,1) == 'H')
		{
			if( ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'ES01' &&  ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'MW01' &&  ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'ES' && ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'MW')
			{
				global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
				global.FRM_BOTTOM.st_msg.color = "yellow";
				global.FRM_BOTTOM.st_msg.value = "E/S가 아닙니다.";
				return false;
			}
		}
		else if(substr(cb_gbn.Value,0,1) == 'N')
		{
			if(ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'EL01' && ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'EL04')
            {
				global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
				global.FRM_BOTTOM.st_msg.color = "yellow";
				global.FRM_BOTTOM.st_msg.value = "E/L-MR 기종이 아닙니다.";
				return false;
			}
		}
		else if(substr(cb_gbn.Value,0,1) == 'O')
	 	{
  		    if(ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'EL02' && ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'EL05')
            {
				global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
				global.FRM_BOTTOM.st_msg.color = "yellow";
				global.FRM_BOTTOM.st_msg.value = "E/L-MRL 기종이 아닙니다.";
				return false;
			}
		}
		else if(substr(cb_gbn.Value,0,1) == 'P')
		{

			if(ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'EL03' && ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'EL06')
            {
				global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
				global.FRM_BOTTOM.st_msg.color = "yellow";
				global.FRM_BOTTOM.st_msg.value = "E/L-NEW MRL 기종이 아닙니다.";
				return false;
			}
		}

	    else if(substr(cb_gbn.Value,0,1) == 'Q')
	    {
	        if(ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'JC01')
	        {
	            global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
				global.FRM_BOTTOM.st_msg.color = "yellow";
				global.FRM_BOTTOM.st_msg.value = "주차-내부형 타입이 아닙니다.";
                return false;
	        }
	    }

	    else if(substr(cb_gbn.Value,0,1) == 'R')
	    {
	        if(ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'JC02')
	        {
	            global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
				global.FRM_BOTTOM.st_msg.color = "yellow";
				global.FRM_BOTTOM.st_msg.value = "주차-독립형 타입이 아닙니다.";
                return false;
	        }
	     }
	    else if(substr(cb_gbn.Value,0,1) == 'S')
	    {
	        if(ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'JC03')
	        {
	            global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
				global.FRM_BOTTOM.st_msg.color = "yellow";
				global.FRM_BOTTOM.st_msg.value = "주차-카트 타입이 아닙니다.";
                return false;
	        }
	     }
	     else if(substr(cb_gbn.Value,0,1) == 'T')
	    {
	       if(ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'JC04')
	        {
	            global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
				global.FRM_BOTTOM.st_msg.color = "yellow";
				global.FRM_BOTTOM.st_msg.value = "주차-각형 타입이 아닙니다.";
                return false;
            }
	     }
	    else if(substr(cb_gbn.Value,0,1) == 'U')
	    {
	       if(ds_list_tmp.GetColumn(i, "TYPE_CHK") != 'HIP')
	        {
	            global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
				global.FRM_BOTTOM.st_msg.color = "yellow";
				global.FRM_BOTTOM.st_msg.value = "대규모 입체 주차설비  타입이 아닙니다.";
                return false;
			}
		}

		ds_cond3.ClearData();
		ds_cond3.AddRow();
		ds_cond3.setColumn(0, "GBN", ds_list_tmp.GetColumn(i, "GBN"));
		ds_cond3.setColumn(0, "PSPID", ds_list_tmp.GetColumn(i, "PSPID"));
		ds_cond3.setColumn(0, "POSID", ds_list_tmp.GetColumn(i, "POSID"));

		ds_cond3.setColumn(0, "TYPE", ds_list_tmp.GetColumn(i,"TYPE"));
		ds_cond3.setColumn(0, "TYPE_CHK", ds_list_tmp.GetColumn(i,"TYPE_CHK"));

 	    ds_cond3.setColumn(0, "GNO", ds_list_tmp.GetColumn(i,"GNO"));
        ds_cond3.setColumn(0, "SAFE", ds_list_tmp.GetColumn(i,"SAFE"));
        ds_cond3.setColumn(0, "SAFE_CK", ds_list_tmp.GetColumn(i,"SAFE_CK"));

		ds_cond3.setColumn(0, "FNAME", ds_list_tmp.GetColumn(i, "FNAME_TMP"));

		tit_clearActionInfo();
		tit_addSearchActionInfo("wb01:WB0199061A_S3");

		tit_callService(
			""
			, ""
			, "ds_cond3=ds_cond3"
			, "ds_list3=ds_list3"
			, ""
			, ""
			, ""
			, ""
			, true);

		if( ds_list3.GetColumn(0, "CNT") > 0 )
		{
			global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
			global.FRM_BOTTOM.st_msg.color = "yellow";
			global.FRM_BOTTOM.st_msg.value = "같은 호기에 동일한 파일이 존재합니다.";
			return false;
		}

	  tit_clearActionInfo();
	  tit_addSearchActionInfo("ps12:PS1205001A_S15");
	  tit_callService(
         ""
        , ""
        , "ds_cond3=ds_cond3"
        , "ds_chk=ds_chk"
        , ""
        , ""
        , ""
        , ""
        , true);


     if(substr(cb_gbn.Value,1,1) == 1)
     {
        ds_chk.SetColumn(0,"CNT",1);
     }

     if(ds_chk.GetColumn(0,"CNT") == 0)
     {
         //alert("aaa");
          global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
		  global.FRM_BOTTOM.st_msg.color = "yellow";
		  global.FRM_BOTTOM.st_msg.value = "순서대로 입력해주세요.";
          return false;
     }
     
    ds_cond_fair.ClearData();
	ds_cond_fair.AddRow();
	ds_cond_fair.SetColumn(0, 'PSPID', ds_list_tmp.GetColumn(i, 'PSPID'));
	ds_cond_fair.SetColumn(0, 'POSID', ds_list_tmp.GetColumn(i, 'POSID'));
	ds_cond_fair.SetColumn(0, 'GUBUN', ds_list_tmp.GetColumn(i, 'ZZGUBUN'));
	ds_cond_fair.SetColumn(0, 'PRONR', ds_list_tmp.GetColumn(i, 'PRONR'));
	ds_cond_fair.SetColumn(0, 'PROWRK', ds_list_tmp.GetColumn(i, 'PROWRK'));
	ds_cond_fair.SetColumn(0, 'PRO_R', ds_list_tmp.GetColumn(i, 'PRO_R'));
	ds_cond_fair.SetColumn(0, 'VER', ds_list_tmp.GetColumn(i, 'VER'));
	ds_cond_fair.SetColumn(0, 'COM_CHK', '1');

	trace('PSPID : ' + ds_cond_fair.GetColumn(i, 'PSPID'));
	trace('POSID : ' + ds_cond_fair.GetColumn(i, 'POSID'));
	trace('GUBUN : ' + ds_cond_fair.GetColumn(i, 'GUBUN'));
	trace('PRONR : ' + ds_cond_fair.GetColumn(i, 'PRONR'));
	trace('PROWRK : ' + ds_cond_fair.GetColumn(i, 'PROWRK'));
	trace('PRO_R : ' + ds_cond_fair.GetColumn(i, 'PRO_R'));
	trace('VER : ' + ds_cond_fair.GetColumn(i, 'VER'));
	trace('COM_CHK : ' + ds_cond_fair.GetColumn(i, 'COM_CHK'));

	tit_clearActionInfo();
	tit_addSearchActionInfo("ps02:PS0208001A_S4");
	tit_callService(
		""
		, ""
		, "ds_cond_fair=ds_cond_fair"
		, "ds_rtn=ds_fair"
		, ""
		, ""
		, ""
		, ""
		, true  // ""
	);
    
     if(toNumber(ds_cond_fair.GetColumn(0, "PRONR")) > 1 && (ds_rtn.GetRowCount() == 0 || Length(ds_rtn.GetColumn(0, 'MDATE')) == 0))
     {
		var rtnMsg = "단계별 안전 조치가 작업일보의 일부 공정으로 변경되었습니다.\n"
		             +ds_cond_fair.GetColumn(0, "POSID")
		             +"호기의 경우, 계획공정이 입력되지 않아 안전 조치 완료 사진을 업로드 할 수 없습니다.\n"
		             + "먼저 작업일보에서 계획공정을 입력하시기 바랍니다.";
		gfn_OpenMsgWin(rtnMsg);
		return false;
     }
     
  }


  return true;
}

/********************************************************************************
* 기      능   : 닫기
********************************************************************************/
function fn_close() {
	close();
}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성
//=========================================================================================

/********************************************************************************
* 기      능   : 저장 Callback
********************************************************************************/
function fn_afterSave(errCode, errMsg) {

	if ( errCode!= 0 )
	{
		gfn_showMsg("CE00001");
	}
	else
	{
		gfn_showMsg("CI00003");
		
		
		////====================SMS발송===============================
		if(ds_sms.GetRowCount() > 0 ) {
		
			tit_clearActionInfo();
			tit_addSaveActionInfo(
				""
				, "ps02:PS0207004A_I2"
				, ""
				, "FLAG");
			tit_callService(
				"PDA_ACT"
				, ""
				, "ds_sms=ds_sms:A"
				, ""
				, ""
				//, "fn_afterSms");				
				, "");
		}
		
		

		//====================쪽지전송 시작===============================
		var arg = "";
		var param = "";
		var lv_mesgdesc = "";
		for(var i=0; i<ds_list_tmp.GetRowCount(); i++)
		{
			arg += "'"+ds_list_tmp.GetColumn(i,"POSID")+"'"+",";
		}
		if(substr(arg,length(arg)-1) == ",") arg = substr(arg,0,length(arg)-1);
		param = "  AND A.POSID_1 IN (" +arg+ ")";

		ds_cond_ms.ClearData();
		ds_cond_ms.AddRow();
		ds_cond_ms.setcolumn(0,"PSPID",ds_list_tmp.GetColumn(0,"PSPID") );
		ds_cond_ms.SetColumn(0,"GUBUN",param);


		tit_clearActionInfo();
		tit_addSearchActionInfo("ps12:PS1205001A_S2");
		tit_callService(
			""
			, ""
			, "ds_cond_ms=ds_cond_ms"
			, "ds_trans=ds_trans"
			, ""
			, ""  //"fn_afterQuery"
			, "" //true
			, ""
			, true);


		lv_mesgdesc = arg + '\n' + '호기의 [' + ds_list_tmp.GetColumn(0, "FNAME") + '] 파일이 입력되었습니다';
		for(var i=0; i<ds_trans.GetRowCount(); i++)
		{
			//if( ds_trans.GetColumn(i, "MESGACCP") == G_USER_ID)
			//{
			//	ds_trans.DeleteRow(i);
			//	i--;
			//}
			//else
			//{
				ds_trans.setcolumn(i, "MESGDESC", lv_mesgdesc);
			//}
		}

		tit_clearActionInfo();

		//tit_addSearchActionInfo("ps12:PS1205001A_I1");
		tit_addMultiActionInfo("ps12:PS1205001A_I1");

		tit_callService(
			""
			, ""
			, "ds_trans=ds_trans"
			, ""
			, ""
			, ""  //"fn_afterQuery"
			, "" //true
			, ""
			, true);

		//====================쪽지전송 끝===============================

	   fn_query3();
	}
}

/********************************************************************************
* 기      능   : 단계별 안전단계 자동 입력  //ZPSTW0207 , ZPSTW1502 인터페이스
********************************************************************************/
function fn_query3() {

	for(var i=0;  i<ds_list_tmp.GetRowCount();  i++)
	{
		if ((ds_list_tmp.GetColumn(i,"SAFE") = 'A' && ds_list_tmp.GetColumn(i,"SAFE_CK") = 'X') || ds_list_safe.GetColumn(i,"GNO_STEP") == '1')
		{
			ds_list_tmp.SetColumn(i,"STEP1","A");
			ds_list_tmp.SetColumn(i,"GUBUN","A");
			ds_list_tmp.SetColumn(i,"STEP1_DT",(gfn_getCurrDate()));

			// 1단계 등록자 ID
			ds_list_tmp.SetColumn(i, "STEP1_ID", g_user_id);
			// 1단계 출처
			ds_list_tmp.SetColumn(i, "DEVICE_GBN1", "S");
		}
		else if ((ds_list_tmp.GetColumn(i,"SAFE") = 'B' && ds_list_tmp.GetColumn(i,"SAFE_CK") = 'X') || ds_list_safe.GetColumn(i,"GNO_STEP") == '2')
		{
			ds_list_tmp.SetColumn(i,"STEP2","A");
			ds_list_tmp.SetColumn(i,"GUBUN","B");
			ds_list_tmp.SetColumn(i,"STEP2_DT",(gfn_getCurrDate()));

			// 2단계 등록자 ID
			ds_list_tmp.SetColumn(i, "STEP2_ID", g_user_id);
			// 2단계 출처
			ds_list_tmp.SetColumn(i, "DEVICE_GBN2", "S");
		}
		else if ((ds_list_tmp.GetColumn(i,"SAFE") = 'C' && ds_list_tmp.GetColumn(i,"SAFE_CK") = 'X') || ds_list_safe.GetColumn(i,"GNO_STEP") == '3')
		{
			ds_list_tmp.SetColumn(i,"STEP3","A");
			ds_list_tmp.SetColumn(i,"GUBUN","C");
			ds_list_tmp.SetColumn(i,"STEP3_DT",(gfn_getCurrDate()));

			// 3단계 등록자 ID
			ds_list_tmp.SetColumn(i, "STEP3_ID", g_user_id);
			// 3단계 출처
			ds_list_tmp.SetColumn(i, "DEVICE_GBN3", "S");
		}
	}

	fn_save2();
}

/********************************************************************************
* 기      능   : 저장  //ZPSTW1502
********************************************************************************/
function fn_save2()
{
	for(var i=0; i<ds_list_tmp.GetRowCount();  i++)
	{
		tit_clearActionInfo();
		tit_addSelectExActionInfo("ps12:PS1205001A_S10", "ps12:PS1205001A_I2", "ps12:PS1205001A_U2");
		tit_callService(
			""
			, ""
			, "ds_list_tmp=ds_list_tmp"
			, ""
			, ""
			, ""
			, ""
			, ""
			, true );
	}
	fn_query5();
}

/********************************************************************************
* 기      능   : 단계별 안전단계 자동 입력 //ZPSTW0207
********************************************************************************/
function fn_query5() {
	for(var i=0;  i<ds_list_tmp.GetRowCount();  i++)
	{
		if( length(ds_list_tmp.GetColumn(i,"GUBUN")) > 0)
		{
			tit_clearActionInfo();
			tit_addSelectExActionInfo("ps12:PS1205001A_S11", "ps12:PS1205001A_I3", "");
			tit_callService(
			""
		  , ""
		  , "ds_list_tmp=ds_list_tmp"
		  , ""
		  , ""
		  , ""
		  , ""
		  , ""
		  , true );
		}
	}

	fn_query();
}

//=========================================================================================
// [ PART 5 ]
// Detail Process Event 정의 ( User Define function )
// 사용자 정의 함수는 ufn_xxxx() 형태로 작성
//=========================================================================================

/********************************************************************************
* 기      능   : 마스터 클릭시
********************************************************************************/
function grd_list_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	selectedRow = nRow;
//	if ( nCell != 1 )
//	{
		fn_query2(nRow);
//	}
}

/********************************************************************************
* 기      능   : 마스터 더블 클릭시
********************************************************************************/
function grd_list_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{

}

/********************************************************************************
* 기      능   : 헤더클릭
********************************************************************************/
function grd_list_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	if ( nCell == 0 ) {
		return;
	}
	else if ( nCell == 1 ) {
		// 그리드 표시할 컬럼 선택
		gfn_selectAllGrid(obj,nCell,nCell,true);
	} else {
		// 그리드 정렬 처리
		gfn_sortGrid(obj,nCell);
	}
}

/********************************************************************************
* 기      능   : 헤더클릭
********************************************************************************/
function grd_list2_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	if ( nCell == 0 ) {
		return;
	}
	else if ( nCell == 1 ) {
		// 그리드 표시할 컬럼 선택
		//gfn_selectAllGrid(obj,nCell,nCell,true);
	} else {
		// 그리드 정렬 처리
		gfn_sortGrid(obj,nCell);
	}
}

function grd_list2_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	if ( nCell == 6 )
		if ( length(ds_list2.getColumn(nRow, "FNAME")) > 0) {
			// 첨부 파일 처리
			saveDialog.FileName = ds_list2.getColumn(nRow, "FNAME");//tit_getLocalFileName(ds_list2.getColumn(nRow, "FNAME"));

			if (saveDialog.open())
			{
				tit_fileRead(
					httpFile
					, "QM"
					, ds_list2.getColumn(nRow, "FNAME_APP")
					, saveDialog.FilePath
					, saveDialog.FileName);
			}
		}
	}
}

/********************************************************************************
* 기      능   : 팝업에서 프로젝트 선택시
********************************************************************************/

function btn_pjt_OnClick(obj)
{
	var arg = "pjt="+quote(ed_pjt.Text);

	gfn_openPopup("CS9601002A",true,arg);

	fn_query();
}

function prjExists() {
	if (ed_pjt.Text == '' || ed_pjt.Text == null) {
		return false;
	}
	return true;
}

/********************************************************************************
* 기      능   : Delete
********************************************************************************/
function fn_delete()
{
	// 그리드 저장 대상 로우
	if(ds_list2.FindRow("CHECK", 1)==-1)
	{
		//gfn_showMsg('CW00046');
		//return;

		global.FRM_BOTTOM.img_msgType.imageId = "bottom_icon_caution";
		global.FRM_BOTTOM.st_msg.color = "yellow";
		global.FRM_BOTTOM.st_msg.value = "하위 리스트에서 정보를 먼저 선택해 주십시오.";
		return ;
	}

	ds_list2.Filter("CHECK==1");
	ds_list2_tmp.copyF(ds_list2);
	ds_list2.unFilter();

	//디테일 DELETE
	tit_clearActionInfo();
	tit_addMultiActionInfo("wb01:WB0199061A_D1");

	var gno = ds_cond2.GetColumn(0, 'GNO_STEP');
	trace('gno : ' + gno);
	var args = '';
	if (gno == '1') {
		args = "STEP1_DT = '00000000', STEP1_ID = '', APPR1_DT = '00000000', APPR1_ID = '', RJCT1_DESC = '', DEVICE_GBN1 = ''";
	} else if (gno == '2') {
		args = "STEP2_DT = '00000000', STEP2_ID = '', APPR2_DT = '00000000', APPR2_ID = '', RJCT2_DESC = '', DEVICE_GBN2 = ''";
	} else if (gno == '3') {
		args = "STEP3_DT = '00000000', STEP3_ID = '', APPR3_DT = '00000000', APPR3_ID = '', RJCT3_DESC = '', DEVICE_GBN3 = ''";
	}
	if (Length(args) > 0) {
		//ds_list2_tmp.SetColumn(0, 'SET', args);
		trace('SET ' + args);
		tit_addMultiActionInfo("ps12:PS1205001A_U4");
	}

	tit_callService(
		  ""
		, ""
		, "ds_list2_tmp=ds_list2_tmp"
		, ""
		, " QUERY=" + quote( args )
		, "fn_afterDelete"
		, ""
		, ""
		, true);
}

/********************************************************************************
* 기      능   : 삭제 Callback
********************************************************************************/
function fn_afterDelete(errCode, errMsg) {
	if ( errCode!= 0 )
	{
		gfn_showMsg("CE00001");
	}
	else
	{
		gfn_showMsg("CI00004");


		//같은 호기에 동일 파일명이 없을시 서버파일 삭제 체크
		for(var i=0; i<ds_list2_tmp.GetRowCount(); i++)
		{
			ds_cond3.ClearData();
			ds_cond3.AddRow();
			ds_cond3.setColumn(0, "GBN", ds_list2_tmp.GetColumn(i, "GBN"));
			ds_cond3.setColumn(0, "PSPID", ds_list2_tmp.GetColumn(i, "PSPID"));
			ds_cond3.setColumn(0, "POSID", ds_list2_tmp.GetColumn(i, "POSID"));
			ds_cond3.setColumn(0, "FNAME", ds_list2_tmp.GetColumn(i, "FNAME"));

			tit_clearActionInfo();
			tit_addSearchActionInfo("wb01:WB0199061A_S6");
			tit_callService(
				""
				, ""
				, "ds_cond3=ds_cond3"
				, "ds_list3=ds_list3"
				, ""
				, ""
				, ""
				, ""
				, true);

			if( ds_list3.GetColumn(0, "CNT") == 0 )
			{
			    //파일삭제
				tit_fileDelete("QM", ds_list2_tmp.GetColumn(i, "FNAME_APP"), true);
			}


			ds_cond_fair.ClearData();
			ds_cond_fair.AddRow();
			ds_cond_fair.SetColumn(0, 'PSPID', ds_list2_tmp.GetColumn(i, 'PSPID'));
			ds_cond_fair.SetColumn(0, 'POSID', ds_list2_tmp.GetColumn(i, 'POSID'));
			ds_cond_fair.SetColumn(0, 'GUBUN', ds_list2_tmp.GetColumn(i, 'ZZGUBUN'));
			ds_cond_fair.SetColumn(0, 'PRONR', ds_list2_tmp.GetColumn(i, 'PRONR'));
			ds_cond_fair.SetColumn(0, 'PROWRK', ds_list2_tmp.GetColumn(i, 'PROWRK'));
			ds_cond_fair.SetColumn(0, 'PRO_R', ds_list2_tmp.GetColumn(i, 'PRO_R'));
			ds_cond_fair.SetColumn(0, 'VER', ds_list2_tmp.GetColumn(i, 'VER'));
			ds_cond_fair.SetColumn(0, 'COM_CHK', '0');
			ds_cond_fair.SetColumn(0, 'AENAM', '');
			ds_cond_fair.SetColumn(0, 'FPATH', '');
			ds_cond_fair.SetColumn(0, 'ORGFNAME', '');
			ds_cond_fair.SetColumn(0, 'FNAME', '');
			ds_cond_fair.SetColumn(0, 'FSIZE', '');

			trace('PSPID : ' + ds_cond_fair.GetColumn(i, 'PSPID'));
			trace('POSID : ' + ds_cond_fair.GetColumn(i, 'POSID'));
			trace('GUBUN : ' + ds_cond_fair.GetColumn(i, 'GUBUN'));
			trace('PRONR : ' + ds_cond_fair.GetColumn(i, 'PRONR'));
			trace('PROWRK : ' + ds_cond_fair.GetColumn(i, 'PROWRK'));
			trace('PRO_R : ' + ds_cond_fair.GetColumn(i, 'PRO_R'));
			trace('VER : ' + ds_cond_fair.GetColumn(i, 'VER'));
			trace('COM_CHK : ' + ds_cond_fair.GetColumn(i, 'COM_CHK'));
			trace('AENAM : ' + ds_cond_fair.GetColumn(i, 'AENAM'));
			trace('FPATH : ' + ds_cond_fair.GetColumn(i, 'FPATH'));
			trace('FNAME : ' + ds_cond_fair.GetColumn(i, 'FNAME'));
			trace('FSIZE : ' + ds_cond_fair.GetColumn(i, 'FSIZE'));

			tit_clearActionInfo();
			tit_addSearchActionInfo("ps02:PS0208001A_S4");
			tit_callService(
				""
				, ""
				, "ds_cond_fair=ds_cond_fair"
				, "ds_fair=ds_fair"
				, ""
				, ""
				, ""
				, ""
				, true  // ""
			);

			trace('공정표 데이터 존재 유무 : ' + ds_fair.RowCount());
			if (ds_fair.RowCount() > 0 && Length(ds_fair.GetColumn(0, 'MDATE')) > 0) {
				trace('공정표 데이터 존재');
				trace('MDATE : ' + ds_fair.GetColumn(0, 'MDATE'));

				tit_clearActionInfo();
				tit_addSingleActionInfo("ps02:PS0208001A_U5");
				tit_callService(
					""
					, ""
					, "ds_cond_fair=ds_cond_fair"
					, ""
					, ""
					, ""
					, ""
					, ""
					, true  // ""
				);
			}

		}

		//디테일이 모두 삭제될시 마스터도 삭제
		ds_cond3.ClearData();
		ds_cond3.AddRow();
		ds_cond3.setColumn(0, "GBN", ds_list2_tmp.GetColumn(0, "GBN"));
		ds_cond3.setColumn(0, "PSPID", ds_list2_tmp.GetColumn(0, "PSPID"));
		ds_cond3.setColumn(0, "POSID", ds_list2_tmp.GetColumn(0, "POSID"));

		tit_clearActionInfo();
		tit_addSearchActionInfo("wb01:WB0199061A_S5");
		tit_callService(
			""
			, ""
			, "ds_cond3=ds_cond3"
			, "ds_list3=ds_list3"
			, ""
			, ""
			, ""
			, ""
			, true);

		if( ds_list3.GetColumn(0, "CNT") == 0 )
		{
			tit_addSingleActionInfo("wb01:WB0199061A_D2");
			tit_callService(
				""
				, ""
				, "ds_cond3=ds_cond3"
				, ""
				, ""
				, ""
				, ""
				, ""
				, true);
		}

		ds_list2_tmp.DeleteAll();
		fn_query();
	}
}

function cb_gbn_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	trace('### cb_gbn_changed @@@');
	trace('[cb_gbn_changed] so_gbn2 : ' + ds_cond.GetColumn(0, "SO_GBN2"));
	trace('[cb_gbn_changed] gbn : ' + ds_cond.GetColumn(0, "GBN"));

	if (prjExists()) {
		fn_query();
	}
}

/********************************************************************************
* 기      능   : 확인 버튼 클릭시
********************************************************************************/
function bt_confirm_OnClick(obj)
{
	//사진 업로드 필수여부 체크
	tit_clearActionInfo();
	tit_addSearchActionInfo("ps12:PS1205001A_U1");
	tit_callService(
        ""
        , ""
        , "ds_confirm=ds_confirm"
        , ""
        , ""
        , ""
        , ""
        , ""
        , true);
}

/********************************************************************************
* 기      능   : 부문별 구분값 변경 2015.03.02 추가
********************************************************************************/

function rd_chk_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	//Trace(ds_gbn2.saveXML());
	//Trace(ds_cond.getColumn(0, "SO_GBN"));
	if(rd_chk.Value == "10") // E/L
	{
		rd_gbn2_visible();
	} else {
		rd_gbn2_invisible();
	}

    zzgubun = ds_cond.getColumn(0, "SO_GBN");
    ds_gbn2.Filter("GUBUN==" + quote(zzgubun));
	
	if(zzgubun = '10')
	{
		rd_gbn2.Index = 0;
	}
		cb_gbn2.Index = 0;
	//

    cb_gbn2_OnChanged();
}

// 부문값에 따른 기종. 타입별 구문
function cb_gbn2_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	
	zztype = ds_cond.GetColumn(0,"SO_GBN2");
	Trace(zztype);
	trace("TYPE==" + quote( zztype));
    ds_gbn.FILTER("TYPE==" + quote(zztype));
    cb_gbn.Index =  0;
	//Trace(ds_gbn.saveXML());
	if (prjExists()) {
    	fn_query();
    }
}

function rd_gbn2_visible() {
	cb_gbn2.Visible = false;
	rd_gbn2.Left = 293;
	rd_gbn2.Visible = true;
	Static1.Left = 283;
	Static1.Visible = true;
}

function rd_gbn2_invisible() {
	rd_gbn2.Left = 304;
	cb_gbn2.Visible = true;
	rd_gbn2.Visible = false;
	Static1.Left = 304;
	Static1.Visible = false;
}

function rd_gbn2_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex) {
	trace('!!!!! rd_gbn2_OnChanged !!!!!');

	zztype = ds_cond.GetColumn(0,"SO_GBN2");
	//trace("TYPE==" + quote( zztype));
    ds_gbn.FILTER("TYPE==" + quote( zztype));

	cb_gbn.Index =  0;

    trace('[rd_gbn2_OnChanged] so_gbn2 : ' + ds_cond.GetColumn(0, "SO_GBN2"));
    trace('[rd_gbn2_OnChanged] gbn : ' + ds_cond.GetColumn(0, "GBN"));

	if (prjExists()) {
    	fn_query();
	}
}

function btn_sample_OnClick() {
	var code = ds_gbn.GetColumn(cb_gbn.Index, 'CODE');
	// var type = ds_gbn.GetColumn(cb_gbn.Index, 'TYPE');
	var gno = ds_gbn.GetColumn(cb_gbn.Index, 'GNO');
	var seqno = ds_gbn.GetColumn(cb_gbn.Index, 'SEQNO');
	trace('[ds_gbn] code : ' + code + ', gno : ' + gno + ', seqno : ' + seqno);
	// code : N1, type : EL01, GNO : 1, SEQNO :

	var ver = ds_gbn2.GetColumn(cb_gbn2.Index, 'VER');
	var gubun = ds_gbn2.GetColumn(cb_gbn2.Index, 'GUBUN');
	var type = ds_gbn2.GetColumn(cb_gbn2.Index, 'TYPE');
	trace('[ds_gbn2] ver : ' + ver + ', gubun : ' + gubun + ', type : ' + type);

	ds_finish_pic_cond.ClearData();
	if (ds_finish_pic_cond.RowCount() == 0) {
		ds_finish_pic_cond.AddRow();
	}
	ds_finish_pic_cond.SetColumn(0, 'GUBUN', gubun);
	ds_finish_pic_cond.SetColumn(0, 'TYPE', type);
	ds_finish_pic_cond.SetColumn(0, 'VER', ver);
	ds_finish_pic_cond.SetColumn(0, 'SEQNO', seqno);

	trace('[ds_finish_pic_cond] gubun : ' + ds_finish_pic_cond.GetColumn(0, 'GUBUN') +
		', type : ' + ds_finish_pic_cond.GetColumn(0, 'TYPE') +
		', ver : ' + ds_finish_pic_cond.GetColumn(0, 'VER') +
		', seqno : ' + ds_finish_pic_cond.GetColumn(0, 'SEQNO')
	);

	tit_clearActionInfo();
	tit_addSearchActionInfo("ps12:PS1205001A_S19");
	tit_callService(
		""
		, ""
		, "ds_finish_pic_cond=ds_finish_pic_cond"
		, "ds_finish_pic=ds_finish_pic"
		, ""
		, "fn_afterSampleQuery"
		, ""
		, ""
		, true);
}

function fn_afterSampleQuery(errCode, errMsg) {
	if (ds_finish_pic.RowCount() > 0) {
		var fnameApp = ds_finish_pic.GetColumn(0, 'FNAME_APP');
		if (fnameApp == '') {
			gfn_showAlert('샘플 이미지[fname_app]가 존재하지 않습니다.');
			return;
		} else {
			var url = GF_FILE_SERVER_URL;
			if (IndexOf(url, "localhost")) {
				url = Replace(url, "localhost:8088", "203.242.37.24:8080");
			}
			var arg = "IMGURL=" + quote(Replace(url, "/HELCO_WEB/", "/") + 'upload/PS/' + fnameApp);
			trace('[fn_afterSampleQuery] arg : ' + arg);
			var arr = gfn_openPopupUrl("PS02::PS0209001C.xml", true, arg);
		}
	} else {
		gfn_showAlert('샘플 이미지[ds_finish_pic]가 존재하지 않습니다.');
	}
}

]]></Script>
</Window>