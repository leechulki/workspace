<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="528" Id="FS0301003B" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="WBS&#32;등록" Top="8" Ver="1.0" Width="752" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_error">
				<Contents>
					<colinfo id="IDX" size="256" type="STRING"/>
					<colinfo id="ERRMSG" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond">
				<Contents>
					<colinfo id="MANDT" size="3" summ="default" type="STRING"/>
					<colinfo id="OCNT_NUMB" size="20" summ="default" type="STRING"/>
					<colinfo id="PROJ_PSPID" size="24" summ="default" type="STRING"/>
					<colinfo id="PSPID" size="256" summ="default" type="STRING"/>
					<record>
						<MANDT></MANDT>
						<OCNT_NUMB></OCNT_NUMB>
						<PROJ_PSPID></PROJ_PSPID>
						<PSPID></PSPID>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zfst0309">
				<Contents>
					<colinfo id="MANDT" size="3" summ="default" type="STRING"/>
					<colinfo id="OCNT_NUMB" size="20" summ="default" type="STRING"/>
					<colinfo id="PROJ_PSPID" size="24" summ="default" type="STRING"/>
					<colinfo id="POSID" size="24" summ="default" type="STRING"/>
					<colinfo id="PROJ_PROFL" size="7" summ="default" type="STRING"/>
					<colinfo id="PROJ_POST1" size="40" summ="default" type="STRING"/>
					<colinfo id="PROJ_PRCTR" size="10" summ="default" type="STRING"/>
					<colinfo id="UP_WBS" size="24" summ="default" type="STRING"/>
					<colinfo id="STUFE" size="5" summ="default" type="INT"/>
					<colinfo id="POST1" size="40" summ="default" type="STRING"/>
					<colinfo id="ZZWBS01" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS02" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS03" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS04" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS05" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS06" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS07" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZGUBUN" size="2" summ="default" type="STRING"/>
					<colinfo id="BELKZ" size="1" summ="default" type="STRING"/>
					<colinfo id="PLAKZ" size="1" summ="default" type="STRING"/>
					<colinfo id="FAKKZ" size="1" summ="default" type="STRING"/>
					<colinfo id="PRCTR" size="10" summ="default" type="STRING"/>
					<colinfo id="ABGSL" size="6" summ="default" type="STRING"/>
					<colinfo id="STATE" size="1" summ="default" type="STRING"/>
					<colinfo id="MSG" size="100" summ="default" type="STRING"/>
					<colinfo id="CHK" size="1" summ="default" type="STRING"/>
					<colinfo id="REL" size="1" summ="default" type="STRING"/>
					<colinfo id="WRIT_DATE" size="8" summ="default" type="STRING"/>
					<colinfo id="WRIT_TIME" size="6" summ="default" type="STRING"/>
					<colinfo id="WRIT_USER" size="12" summ="default" type="STRING"/>
					<colinfo id="MODI_DATE" size="8" summ="default" type="STRING"/>
					<colinfo id="MODI_TIME" size="6" summ="default" type="STRING"/>
					<colinfo id="MODI_USER" size="12" summ="default" type="STRING"/>
					<colinfo id="FLAG" size="256" summ="default" type="STRING"/>
					<colinfo id="LEVEL" size="256" summ="default" type="STRING"/>
					<colinfo id="DIV" size="256" summ="default" type="STRING"/>
					<colinfo id="UP_WBS_TMP" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataObject="ds_zfst0309" DataSetType="Filter" Id="ds_zfst0309_f"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zfst0309_insert">
				<Contents>
					<colinfo id="MANDT" size="3" summ="default" type="STRING"/>
					<colinfo id="OCNT_NUMB" size="20" summ="default" type="STRING"/>
					<colinfo id="PROJ_PSPID" size="24" summ="default" type="STRING"/>
					<colinfo id="POSID" size="24" summ="default" type="STRING"/>
					<colinfo id="PROJ_PROFL" size="7" summ="default" type="STRING"/>
					<colinfo id="PROJ_POST1" size="40" summ="default" type="STRING"/>
					<colinfo id="PROJ_PRCTR" size="10" summ="default" type="STRING"/>
					<colinfo id="UP_WBS" size="24" summ="default" type="STRING"/>
					<colinfo id="STUFE" size="5" summ="default" type="INT"/>
					<colinfo id="POST1" size="40" summ="default" type="STRING"/>
					<colinfo id="ZZWBS01" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS02" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS03" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS04" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS05" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS06" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZWBS07" size="1" summ="default" type="STRING"/>
					<colinfo id="ZZGUBUN" size="2" summ="default" type="STRING"/>
					<colinfo id="BELKZ" size="1" summ="default" type="STRING"/>
					<colinfo id="PLAKZ" size="1" summ="default" type="STRING"/>
					<colinfo id="FAKKZ" size="1" summ="default" type="STRING"/>
					<colinfo id="PRCTR" size="10" summ="default" type="STRING"/>
					<colinfo id="ABGSL" size="6" summ="default" type="STRING"/>
					<colinfo id="STATE" size="1" summ="default" type="STRING"/>
					<colinfo id="MSG" size="100" summ="default" type="STRING"/>
					<colinfo id="CHK" size="1" summ="default" type="STRING"/>
					<colinfo id="REL" size="1" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Height="36" Id="div_btn" Left="2" TabOrder="1" Text="Div0" Top="3" Url="WB01::CommBtnForm.xml" Width="746">
			<Contents></Contents>
		</Div>
		<Grid AutoFit="TRUE" AutoFitEndLine="Hide" BindDataset="ds_zfst0309_f" BkColor2="default" BoldHead="true" Border="Flat" Bottom="520" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="20" Height="472" Id="grd_master" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" MinWidth="100" OnCellClick="grd_master_OnCellClick" Right="744" RowHeight="20" Style="sty_grid" TabOrder="2" TabStop="true" Top="48" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="736">
			<contents>
				<format id="Default">
					<columns>
						<col width="0"/>
						<col width="52"/>
						<col width="52"/>
						<col width="377"/>
						<col width="245"/>
						<col width="0"/>
						<col width="0"/>
					</columns>
					<head>
						<cell col="0" display="text"/>
						<cell col="1" colid="CHK" display="normal"/>
						<cell align="center" col="2" color="user21" display="text" font="굴림,9"/>
						<cell align="center" col="3" color="user21" display="text" font="굴림,9" text="프로젝트정의"/>
						<cell align="center" col="4" color="user21" display="text" font="굴림,9" text="프로젝트요소"/>
						<cell col="5" display="text" text="DIV"/>
						<cell col="6" display="text" text="LEVEL"/>
					</head>
					<body>
						<cell col="0" display="text"/>
						<cell col="1" colid="CHK" display="normal"/>
						<cell align="center" bkcolor2="user22" col="2" colid="FLAG" display="image"/>
						<cell align="left" bkcolor2="user22" col="3" colid="POST1" display="text"/>
						<cell align="left" bkcolor2="user22" col="4" colid="POSID" display="text"/>
						<cell col="5" colid="DIV" display="text"/>
						<cell col="6" colid="LEVEL" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : wbs 등록
 * 작  성  자   : 박수근
 * 작성  일자   : 2017.05.11
 * ----------------------------------------------------------------------------------------
 * HISTORY    :
 ******************************************************************************************
 */   
#include "LIB::commons.js";           // 공통 스크립트
#include "LIB::fs_common.js";         // 물류서비스 공통 스크립트

//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	gfn_initForm(); 	
	fn_init_form(); 	
}

/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}

/********************************************************************************
* 기      능   : 폼 초기화
********************************************************************************/
function fn_init_form() {
    // drinlDown 컴포넌트 인스턴스 생성
   	gfn_InitDrillDown(ds_zfst0309, grd_master, "true", "FLAG", "LEVEL", "POSID", "UP_WBS_TMP", "POST1", "CHK");
    ds_cond.SetColumn(0, "OCNT_NUMB", ocntNumb);
    ds_cond.SetColumn(0, "PSPID", pspid);
    ds_cond.SetColumn(0, "PROJ_PSPID", projPspid);
    fn_query();
} 

/********************************************************************************
* 기      능   : WBS 항목 조회
********************************************************************************/
function fn_query() {
    // 조회 스크립트
    tit_clearActionInfo();
    tit_addSearchActionInfo("fs03:FS0301003B_S1");
    tit_callService(
                    ""
                   ,""
                   ,"ds_cond=ds_cond"
                   ,"ds_zfst0309=ds_zfst0309"
                   ,""
                   ,"fn_afterQuery"
                   ,"true"
                   ,"true"
                   ,"true"
                   );
}

/********************************************************************************
* 기      능   : BS 항목 조회 Callback
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
    if(ds_error.rowcount() > 0) {
        gfn_showMsg("CE00001");
    } else {
        gfn_showMsg("CI00002", ds_zfst0309.rowCount() + "");
    }
}

/********************************************************************************
* 기      능   : WBS 항목 저장
********************************************************************************/
function fn_save() {
    if (gfn_showConfirm("WBS 구조를 저장 하시겠습니까?")) {
        ds_zfst0309_insert.ClearData();
        for(var i=0; i < ds_zfst0309.GetRowCount(); i++) {
            var chk = ds_zfst0309.GetColumn(i, "CHK");
            if( length(chk) > 0 ) {
                // 예산품목 정보를 등록한다.
                var nRow = ds_zfst0309_insert.AppendRow();
                ds_zfst0309_insert.CopyRow(nRow, "ds_zfst0309", i);
            }
        }
        if(ds_zfst0309_insert.GetRowCount() == 0 ) {
            gfn_openMsgWin("선택된 WBS 구조가 없습니다.", "", "A", "");
            return;
        }

		tit_clearActionInfo();
		tit_addSingleActionInfo("fs03:FS0301003A_D6_1"); // wbs요소 삭제
		tit_addMultiActionInfo("fs03:FS0301003A_I6");    // wbs요소 신규 입력
		tit_addSingleActionInfo("fs03:FS0301003A_D8_1"); // 네트워크 요소 삭제
		tit_addMultiActionInfo("fs03:FS0301003A_I8");    // 네트워크 요소 신규 입력
		tit_callService(
						""
					   ,""
					   ,"ds_cond=ds_cond ds_zfst0309=ds_zfst0309_insert"
					   ,""
					   ,""
					   ,"fn_afterSave"
					   ,"true"
					   ,"true"
					   ,"false"
					   );
	}
}

/********************************************************************************
* 기      능   : WBS 항목 저장 Callback
********************************************************************************/
function fn_afterSave(errCode, errMsg) {
    if( errCode != 0) {
        gfn_showMsg("CE00001");
    } else {
        gfn_openMsgWin("WBS 구조가 저장 되었습니다.", "", "A", "");
		var arr = "Y";
		close(arr);
    }
}

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	this.close("N");
}

/********************************************************************************
* 기      능   : 접기 와 펼치기
********************************************************************************/
function grd_master_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	var columnID = obj.GetCellProp("body",nCell,"colid");
	var value = obj.GetCellValue(nRow, nCell);
	switch ( columnID ){
	case "CHK":
	    if( value != "0" ) {
		    gfn_DrillDownCheckBox(obj, nRow);
	    }
		break;
	case "FLAG":
		ds_zfst0309_f.SetColumn(nRow, columnID, iif( value == '1' , '0', '1' ));
		ds_zfst0309_f.RecalcFilter();
		break;
	}
}]]></Script>
</Window>