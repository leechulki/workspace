<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="432" Id="CS0602001C" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="신규인수접수&#32;기안" Top="8" Ver="1.0" Width="856" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_cond_b">
				<Contents>
					<colinfo id="ZZBSU" size="256" summ="default" type="STRING"/>
					<colinfo id="PJT" size="256" summ="default" type="STRING"/>
					<colinfo id="DOCNO" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_hnoList">
				<Contents>
					<colinfo id="PJT" size="256" summ="default" type="STRING"/>
					<colinfo id="HNO" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSPEC1" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSPEC2" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSPEC3" size="256" summ="default" type="STRING"/>
					<colinfo id="ZZBSU" size="256" summ="default" type="STRING"/>
					<colinfo id="ZZBSU_B" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSITE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="ABG" size="256" summ="default" type="STRING"/>
					<colinfo id="AGB" size="256" summ="default" type="STRING"/>
					<colinfo id="FYN" size="256" summ="default" type="STRING"/>
					<colinfo id="ISD" size="256" summ="default" type="STRING"/>
					<colinfo id="ABR_NM_B" size="256" summ="default" type="STRING"/>
					<colinfo id="VKGRP_NM_B" size="256" summ="default" type="STRING"/>
					<colinfo id="DOCNO" size="256" summ="default" type="STRING"/>
					<colinfo id="REMARK" size="256" summ="default" type="STRING"/>
					<colinfo id="PRO" size="256" summ="default" type="STRING"/>
					<colinfo id="JUJ" size="256" summ="default" type="STRING"/>
					<colinfo id="BUJ" size="256" summ="default" type="STRING"/>
					<colinfo id="BLD" size="256" summ="default" type="STRING"/>
					<colinfo id="ATWRT" size="256" summ="default" type="STRING"/>
					<colinfo id="ATWTB" size="256" summ="default" type="STRING"/>
					<colinfo id="SUM_ZMUSAOCNT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_bsuInfo">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_insuInfo"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_abg_cd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_agb_cd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_fyn_cd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
					<record>
						<CODE>Y</CODE>
						<CODE_NAME>대상</CODE_NAME>
					</record>
					<record>
						<CODE>N</CODE>
						<CODE_NAME>미대상</CODE_NAME>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_saveList">
				<Contents>
					<colinfo id="PJT" size="256" summ="default" type="STRING"/>
					<colinfo id="HNO" size="256" summ="default" type="STRING"/>
					<colinfo id="ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSPEC1" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSPEC2" size="256" summ="default" type="STRING"/>
					<colinfo id="ZZBSU" size="256" summ="default" type="STRING"/>
					<colinfo id="ZZBSU_B" size="256" summ="default" type="STRING"/>
					<colinfo id="ZSITE_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="ABG" size="256" summ="default" type="STRING"/>
					<colinfo id="AGB" size="256" summ="default" type="STRING"/>
					<colinfo id="FYN" size="256" summ="default" type="STRING"/>
					<colinfo id="ISD" size="256" summ="default" type="STRING"/>
					<colinfo id="EQUAL" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_docno_gen">
				<Contents>
					<colinfo id="PFX" size="256" type="STRING"/>
					<colinfo id="DOCNO" size="256" type="STRING"/>
					<record>
						<PFX></PFX>
						<DOCNO></DOCNO>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_apInfo">
				<Contents>
					<colinfo id="APSTAT" size="256" summ="default" type="STRING"/>
					<colinfo id="DOCNO" size="256" summ="default" type="STRING"/>
					<colinfo id="APNUM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_decide">
				<Contents>
					<colinfo id="MANDT" size="256" summ="default" type="STRING"/>
					<colinfo id="DOCNO" size="256" summ="default" type="STRING"/>
					<colinfo id="DOCKIND" size="256" summ="default" type="STRING"/>
					<colinfo id="APPGUBN" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQNO" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQSTAT" size="256" summ="default" type="STRING"/>
					<colinfo id="APDPT1" size="256" summ="default" type="STRING"/>
					<colinfo id="APDPT1_N" size="256" summ="default" type="STRING"/>
					<colinfo id="APNUM" size="256" summ="default" type="STRING"/>
					<colinfo id="APRNK" size="256" summ="default" type="STRING"/>
					<colinfo id="APDATE" size="256" summ="default" type="STRING"/>
					<colinfo id="APTIM" size="256" summ="default" type="STRING"/>
					<colinfo id="APDESC" size="256" summ="default" type="STRING"/>
					<colinfo id="UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CST" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_apstat">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="DTEXT1" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_sms">
				<Contents>
					<colinfo id="TRAN_PHONE" size="256" summ="default" type="STRING"/>
					<colinfo id="TRAN_CALLBACK" size="256" summ="default" type="STRING"/>
					<colinfo id="TRAN_STATUS" size="256" summ="default" type="STRING"/>
					<colinfo id="TRAN_DATE" size="256" summ="default" type="STRING"/>
					<colinfo id="TRAN_MSG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zcst121">
				<Contents>
					<colinfo id="CS121_UPN" size="256" summ="default" type="STRING"/>
					<colinfo id="CS121_CST" size="256" summ="default" type="STRING"/>
					<colinfo id="CS121_SPT" size="256" summ="default" type="STRING"/>
					<colinfo id="CS121_NAM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_bsu_cd">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE2" size="256" summ="default" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="AREA" size="256" summ="default" type="STRING"/>
					<colinfo id="SRM_NAME" size="256" summ="default" type="STRING"/>
					<colinfo id="VKGRP" size="256" summ="default" type="STRING"/>
					<record>
						<AREA></AREA>
						<CODE></CODE>
						<CODE2></CODE2>
						<CODE_NAME></CODE_NAME>
						<SRM_NAME></SRM_NAME>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_bpm_cd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
					<colinfo id="BSU_HP" size="256" type="STRING"/>
					<colinfo id="BSU_GB" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_juj_cd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
					<colinfo id="BSU" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_buj_cd">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
					<colinfo id="BSU" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cond_plan">
				<Contents>
					<colinfo id="ZZBSU" size="256" summ="default" type="STRING"/>
					<colinfo id="PJT" size="256" summ="default" type="STRING"/>
					<colinfo id="DOCNO" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_bsuPlanInfo">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_rcond">
				<Contents>
					<colinfo id="ZPROGRAM" size="256" summ="default" type="STRING"/>
					<colinfo id="GBN" size="256" summ="default" type="STRING"/>
					<record>
						<GBN></GBN>
						<ZPROGRAM></ZPROGRAM>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Shape BKColor="user12" Bottom="201" Height="26" Id="Shape6" Left="7" LineColor="user13" Right="845" TabOrder="43" Top="175" Type="Rectangle" Width="838"></Shape>
		<Shape BKColor="user12" Bottom="121" Height="26" Id="Shape0" Left="7" LineColor="user13" Right="845" TabOrder="4" Top="95" Type="Rectangle" Width="838"></Shape>
		<Shape BKColor="user12" Bottom="252" Height="52" Id="Shape5" Left="7" LineColor="user13" Right="845" TabOrder="27" Top="200" Type="Rectangle" Width="838"></Shape>
		<Shape BKColor="user12" Bottom="171" Height="26" Id="Shape3" Left="7" LineColor="user13" Right="845" TabOrder="26" Top="145" Type="Rectangle" Width="838"></Shape>
		<Shape BKColor="user12" Bottom="146" Height="26" Id="Shape2" Left="7" LineColor="user13" Right="845" TabOrder="25" Top="120" Type="Rectangle" Width="838"></Shape>
		<Shape BKColor="user12" Bottom="66" Height="26" Id="Shape1" Left="7" LineColor="user13" Right="845" TabOrder="2" Top="40" Type="Rectangle" Width="838"></Shape>
		<Div Height="36" Id="div_btn" TabOrder="1" Text="Div0" ToolTipFont="Default,0" Url="WB01::CommBtnForm.xml" Width="856">
			<Contents></Contents>
		</Div>
		<Static Align="Center" Height="24" Id="st_isd" Left="63" Style="sty_lb_form_basic" TabOrder="3" Text="인수일" Top="41" VAlign="Middle" Width="70"></Static>
		<Static Align="Center" Height="24" Id="st_cs406_rname" Left="352" Style="sty_lb_form_basic" TabOrder="5" Text="대표자" Top="96" VAlign="Middle" Width="70"></Static>
		<Shape BKColor="user12" Bottom="91" Height="26" Id="Shape4" Left="7" LineColor="user13" Right="845" TabOrder="6" Top="65" Type="Rectangle" Width="838"></Shape>
		<Edit BindDataset="ds_bsuInfo" BKColor="khaki" Border="Flat" Column="VKGRP_NM" Enable="FALSE" Height="20" Id="ed_kunnr_nm" Left="294" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="8" Top="43" Width="110"></Edit>
		<Static Align="Center" Height="24" Id="st_vkgrp" Left="230" Style="sty_lb_form_basic" TabOrder="7" Text="인수팀" Top="41" VAlign="Middle" Width="62"></Static>
		<Static Align="Center" Height="24" Id="st_abg" Left="63" Style="sty_lb_form_basic" TabOrder="9" Text="빌딩구분" Top="66" VAlign="Middle" Width="70"></Static>
		<Static Align="Center" Height="24" Id="st_bsu2" Left="63" Style="sty_lb_form_basic" TabOrder="10" Text="업체명" Top="96" VAlign="Middle" Width="70"></Static>
		<Grid AutoFitEndLine="Hide" BindDataset="ds_hnoList" BkColor2="default" BoldHead="true" Border="Flat" Bottom="424" ColSizing="TRUE" DragMode="TRUE" DropMode="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" HeadBorder="Flat" HeadHeight="40" Height="168" Id="grd_list" InputPanel="FALSE" Left="8" LineColor="user20" LineType="ExHORZ" Right="846" RowHeight="20" Style="sty_grid" TabOrder="11" TabStop="true" Top="256" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="default" WheelScrollRow="1" Width="838">
			<contents>
				<format id="Default">
					<columns>
						<col width="30"/>
						<col width="60"/>
						<col width="0"/>
						<col width="40"/>
						<col width="150"/>
						<col width="0"/>
						<col width="80"/>
						<col width="100"/>
						<col width="0"/>
						<col width="60"/>
						<col width="81"/>
						<col width="100"/>
						<col width="0"/>
						<col width="150"/>
						<col width="80"/>
					</columns>
					<head>
						<cell col="0" display="text" font="굴림,9" text="No"/>
						<cell col="1" display="text" font="굴림,9" text="프로젝트"/>
						<cell col="2" display="text" font="굴림,9" text="호기"/>
						<cell col="3" display="text" font="굴림,9" text="호기"/>
						<cell col="4" display="text" font="굴림,9" text="현장명"/>
						<cell col="5" display="text" font="굴림,9" text="호기"/>
						<cell col="6" display="text" font="굴림,9" text="기종"/>
						<cell col="7" display="text" font="굴림,9" text="사양"/>
						<cell col="8" display="text" font="굴림,9" text="호기"/>
						<cell col="9" display="text" font="굴림,9" text="빌딩구분"/>
						<cell col="10" display="text" font="굴림,9" text="교체보수업체"/>
						<cell col="11" display="text" font="굴림,9" text="인수계획팀"/>
						<cell col="12" display="text" font="굴림,9" text="호기"/>
						<cell col="13" display="text" font="굴림,9" text="인수계획업체"/>
						<cell col="14" display="text" font="굴림,9" text="주소"/>
					</head>
					<body>
						<cell align="center" bkcolor2="user22" col="0" display="text" expr="currow+1"/>
						<cell align="center" bkcolor2="user22" col="1" colid="PJT" display="text"/>
						<cell align="center" bkcolor2="user22" col="2" colid="BELNR" display="text"/>
						<cell align="center" bkcolor2="user22" col="3" colid="HNO" display="text"/>
						<cell align="left" bkcolor2="user22" col="4" colid="ZSITE_NM" display="text"/>
						<cell align="center" bkcolor2="user22" col="5" colid="BELNR" display="text"/>
						<cell align="center" bkcolor2="user22" col="6" colid="ZSPEC1" display="text"/>
						<cell align="center" bkcolor2="user22" col="7" colid="ZSPEC2" display="text"/>
						<cell align="center" bkcolor2="user22" col="8" colid="BELNR" display="text"/>
						<cell align="center" bkcolor2="user22" col="9" colid="ABG" combocol="CODE" combodataset="ds_abg_cd" combotext="CODE_NAME" display="combo"/>
						<cell align="center" bkcolor2="user22" col="10" colid="ATWTB" display="text"/>
						<cell align="center" bkcolor2="user22" col="11" colid="VKGRP_NM_B" display="text"/>
						<cell align="center" bkcolor2="user22" col="12" colid="BELNR" display="text"/>
						<cell align="center" bkcolor2="user22" col="13" colid="ABR_NM_B" display="text"/>
						<cell align="left" bkcolor2="user22" col="14" colid="ADDR" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Edit Border="Flat" DisableBKColor="user5" Height="48" Id="ed_remark" Left="136" LeftMargin="4" MaxLength="500" RightMargin="4" Style="sty_ipt_form" TabOrder="12" Top="200" VAlign="TOP" Width="705"></Edit>
		<Static Align="Right" Height="50" Id="st_remark" Left="63" Style="sty_lb_form_basic" TabOrder="13" Text="인수업체&#32;&#10;&#32;변경사유&#32;&#10;&#32;(500자)&#32;" Top="201" VAlign="Middle" Width="70"></Static>
		<Static Align="Center" Height="24" Id="st_bsu" Left="407" Style="sty_lb_form_basic" TabOrder="14" Text="인수업체" Top="41" VAlign="Middle" Width="62"></Static>
		<Edit BindDataset="ds_bsuInfo" BKColor="khaki" Border="Flat" Column="ABR_NM" Enable="FALSE" Height="20" Id="ed_bsu_nm" Left="136" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="15" Top="98" Width="213"></Edit>
		<Static Align="Center" Height="24" Id="st_bpm" Left="702" Style="sty_lb_form_basic" TabOrder="16" Text="보수PM" Top="41" VAlign="Middle" Width="70"></Static>
		<Edit BindDataset="ds_bsuInfo" BKColor="khaki" Border="Flat" Column="IRUM" Enable="FALSE" Height="20" Id="ed_bpm" Left="774" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="17" Top="43" Width="66"></Edit>
		<Static Align="Center" Height="24" Id="st_fyn" Left="230" Style="sty_lb_form_basic" TabOrder="18" Text="FM대상" Top="66" VAlign="Middle" Width="62"></Static>
		<Static Align="Center" Height="24" Id="st_agb" Left="407" Style="sty_lb_form_basic" TabOrder="19" Text="시내구분" Top="66" VAlign="Middle" Width="62"></Static>
		<Static Align="Center" Height="24" Id="st_cs406_tel" Left="544" Style="sty_lb_form_basic" TabOrder="20" Text="전화번호" Top="96" VAlign="Middle" Width="70"></Static>
		<Static Align="Center" Height="24" Id="Static4" Left="352" Style="sty_lb_form_basic" TabOrder="21" Text="공동수급동의여부" Top="121" VAlign="Middle" Width="112"></Static>
		<Static Align="Center" Height="24" Id="st_cnt_all" Left="207" Style="sty_lb_form_basic" TabOrder="22" Text="유지관리대수" Top="121" VAlign="Middle" Width="85"></Static>
		<Static Align="Center" Height="24" Id="st_scp" Left="63" Style="sty_lb_form_basic" TabOrder="23" Text="유지관리범위" Top="121" VAlign="Middle" Width="85" WordWrap="TRUE"></Static>
		<Static Align="Center" Height="24" Id="st_tp" Left="63" Style="sty_lb_form_basic" TabOrder="24" Text="유지관리업구분" Top="146" VAlign="Middle" Width="112"></Static>
		<Edit BindDataset="ds_bsuInfo" Border="Flat" Column="CS406_RNAME" Enable="FALSE" Height="20" Id="ed_cs406_rname" Left="424" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="28" Top="98" Width="114"></Edit>
		<Edit BindDataset="ds_bsuInfo" Border="Flat" Column="CS406_TEL" Enable="FALSE" Height="20" Id="ed_cs406_tel" Left="619" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="29" Top="98" Width="120"></Edit>
		<MaskEdit BindDataset="ds_bsuInfo" Border="Flat" Column="CS406_SCP" DecimalLen="1" DigitLen="10" Enable="FALSE" Height="20" Id="med_scp" Left="150" NullValue="0" Style="sty_ipt_form" TabOrder="30" Top="123" Width="55"></MaskEdit>
		<Checkbox BindDataset="ds_bsuInfo" Column="TP1" Enable="FALSE" Height="18" Id="cb_tp1" Left="180" TabOrder="31" Text="고속엘리베이터" Top="149" Width="136"></Checkbox>
		<Checkbox BindDataset="ds_bsuInfo" Column="TP2" Enable="FALSE" Height="18" Id="cb_tp2" Left="324" OnClick="cb_tp2_OnClick" TabOrder="32" Text="중저속엘리베이터" Top="149" Width="136"></Checkbox>
		<Checkbox BindDataset="ds_bsuInfo" Column="TP3" Enable="FALSE" Height="18" Id="cb_tp3" Left="468" TabOrder="33" Text="에스컬레이터" Top="149" Width="136"></Checkbox>
		<Checkbox BindDataset="ds_bsuInfo" Column="TP4" Enable="FALSE" Height="18" Id="cb_tp4" Left="608" TabOrder="34" Text="휠체어리프트" Top="149" Width="136"></Checkbox>
		<Combo BindDataset="ds_hnoList" Border="Flat" CodeColumn="CODE" Column="AGB" DataColumn="CODE_NAME" Height="20" Id="cb_agb" INDEX="0" InnerDataset="ds_agb_cd" Left="470" Style="sty_ipt_form" TabOrder="35" Top="67" Width="88"></Combo>
		<Calendar BindDataset="ds_hnoList" Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="ISD" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_isd" Left="136" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="36" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="43" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="90"></Calendar>
		<Combo BindDataset="ds_hnoList" Border="Flat" CodeColumn="CODE" Column="ABG" DataColumn="CODE_NAME" Height="20" Id="cb_abg" INDEX="0" InnerDataset="ds_abg_cd" Left="135" OnChanged="cb_abg_OnChanged" Style="sty_ipt_form" TabOrder="37" Top="67" Width="90"></Combo>
		<Combo BindDataset="ds_hnoList" Border="Flat" CodeColumn="CODE" Column="FYN" DataColumn="CODE_NAME" Height="20" Id="cb_fyn" INDEX="0" InnerDataset="ds_fyn_cd" Left="293" Style="sty_ipt_form" TabOrder="38" Top="67" Width="91"></Combo>
		<Static Align="Center" BKColor="user20" Height="50" Id="st_title1" Left="8" Style="sty_lb_form_basic" TabOrder="39" Text="인수정보" Top="40" VAlign="Middle" Width="55"></Static>
		<Static Align="Center" BKColor="user20" Height="74" Id="st_title2" Left="8" Style="sty_lb_form_basic" TabOrder="40" Text="인수업체정보" Top="96" VAlign="Middle" Width="55" WordWrap="TRUE"></Static>
		<MaskEdit BindDataset="ds_bsuInfo" Border="Flat" Column="CNT_ALL" DecimalLen="1" DigitLen="10" Enable="FALSE" Height="20" Id="med_cnt_all" Left="294" NullValue="0" Style="sty_ipt_form" TabOrder="41" Top="123" Width="55"></MaskEdit>
		<Static Align="Center" BKColor="user20" Height="75" Id="st_title3" Left="8" Style="sty_lb_form_basic" TabOrder="42" Text="결재정보" Top="176" VAlign="Middle" Width="55" WordWrap="TRUE"></Static>
		<Static Align="Center" Height="24" Id="st_docno" Left="63" Style="sty_lb_form_basic" TabOrder="44" Text="결재번호" Top="176" VAlign="Middle" Width="70"></Static>
		<Static Align="Center" Height="24" Id="st_apstat" Left="351" Style="sty_lb_form_basic" TabOrder="45" Text="결재상태" Top="176" VAlign="Middle" Width="70"></Static>
		<Edit Border="Flat" DisableBKColor="wheat" DisableColor="user7" Enable="FALSE" Height="20" Id="ed_notice" Left="520" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="46" Top="178" Width="320"></Edit>
		<Edit Align="CENTER" BindDataset="ds_hnoList" Border="Flat" Column="DOCNO" Enable="FALSE" Height="20" Id="ed_docno" Left="136" LeftMargin="4" RightMargin="4" Style="sty_ipt_form" TabOrder="47" Top="178" Width="144"></Edit>
		<Combo BindDataset="ds_apInfo" Border="Flat" CodeColumn="CODE" Column="APSTAT" DataColumn="DTEXT1" Enable="FALSE" Height="20" Id="cb_apstat" InnerDataset="ds_apstat" Left="424" Style="sty_ipt_search" TabOrder="48" Top="177" Width="95"></Combo>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="20" Id="btn_wf_stat" ImageID="btn_sub_03" Left="288" LeftMargin="12" OnClick="btn_wf_stat_OnClick" Style="sty_btn" TabOrder="49" Text="확인" Top="178" Transparent="TRUE" Width="60"></Button>
		<Edit BindDataset="ds_bsuInfo" Column="ZZBSU" Height="20" Id="ed_pjt_param" Left="885" TabOrder="50" Text="pjt" Top="78" Width="80"></Edit>
		<Combo Border="Flat" CodeColumn="CODE" Column="LGORT" DataColumn="SRM_NAME" Height="20" Id="cb_bsu" INDEX="0" InnerDataset="ds_bsu_cd" Left="472" OnChanged="cb_bsu_OnChanged" Style="sty_ipt_form" TabOrder="51" Top="40" Width="211"></Combo>
		<Edit Height="20" Id="ed_bsu_param" Left="880" TabOrder="52" Text="bsu" Top="104" Width="80"></Edit>
		<Combo BindDataset="ds_hnoList" Border="Flat" CodeColumn="CODE" Column="JUJ" DataColumn="CODE_NAME" DisplayRowCnt="10" Height="20" Id="cb_juj" INDEX="0" InnerDataset="ds_juj_cd" Left="613" Style="sty_ipt_form" TabOrder="53" Top="67" Width="86"></Combo>
		<Combo BindDataset="ds_hnoList" Border="Flat" CodeColumn="CODE" Column="BUJ" DataColumn="CODE_NAME" DisplayRowCnt="10" Height="20" Id="cb_buj" INDEX="0" InnerDataset="ds_buj_cd" Left="753" Style="sty_ipt_form" TabOrder="54" Top="67" Width="88"></Combo>
		<Static Align="Center" Height="24" Id="Static0" Left="559" Style="sty_lb_form_basic" TabOrder="55" Text="주점검자" Top="66" VAlign="Middle" Width="52"></Static>
		<Static Align="Center" Height="24" Id="Static1" Left="701" Style="sty_lb_form_basic" TabOrder="56" Text="부점검자" Top="66" VAlign="Middle" Width="52"></Static>
		<Button ButtonStyle="TRUE" Cursor="HAND" Enable="FALSE" Height="20" Id="btn_admin" ImageID="btn_sub_08" Left="698" LeftMargin="12" OnClick="btn_admin_seungin" Style="sty_btn" TabOrder="57" Text="승인(관리자-운영)" Top="123" Transparent="TRUE" Visible="FALSE" Width="130"></Button>
	</Form>
	<Script><![CDATA[﻿﻿﻿﻿﻿﻿/*
 ******************************************************************************************
 * 기      능   : 신규인수접수 기안
 * 작  성  자   : 이 하 림 
 * 작성  일자   : 2018. 02. 12 
 * ----------------------------------------------------------------------------------------
 * HISTORY    : 
 ******************************************************************************************
 */
#include "LIB::commons.js";	// 공통 스크립트 
#include "LIB::common_cs.js";	// 서비스 스크립트 
//=========================================================================================
// [ PART 1 ]
// Form에서 사용될 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================
var FLAG_PST; // 작성 신규 OR 갱신 여부 체크 
var USER_GRP; // 권한 체크 
var FLAG_ADMIN_APPROVAL = true ; // 수신부서 결재 건 확인 ( 계획 불일치 )
var fa_docno = "";  // 결재문서번호
var fa_pjt = ;
var admin_auth = false;
//=========================================================================================
// [ PART 2 ]
// Form Loading / Unloading 시 작업 정의
//=========================================================================================
function fn_OnLoadCompleted(obj) {
	gfn_initForm();
	
	USER_GRP = gfn_getUserGroup();
	
	var codeArr = [ "CS116", "CS112", "WBAP_STAT"];
	var dsObjArr = [ ds_agb_cd, ds_abg_cd, ds_apstat];
	var addTypeArr = [G_CODE_NONE, G_CODE_NONE, G_CODE_NONE];
	gfn_searchCommCode(codeArr, dsObjArr, addTypeArr);
	
	// 신규인수접수 기안 강제승인 권한에 대한 버튼 활성화
	gfn_initDs(ds_rcond, true);
	ds_rcond.SetColumn(0, "ZPROGRAM", "CS0602001C");
	ds_rcond.SetColumn(0, "GBN", "01");	
	admin_auth = gfn_getAuth(ds_rcond);
	ds_rcond.ClearData();
	
	if(admin_auth == true) {
		btn_admin.Enable = true;
		btn_admin.Visible = true;
	}

}
/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/
function fn_completeInit(sCode, sDsObj, sCodeType) {

	// 인수 가능 업체 리스트 가져오기 
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs06:CS0602001A_S7");
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond_b"
        , "ds_bsu_cd=ds_list"
        , ""						
        , ""						
		, true							
		, false							
		, true);

	ds_bsu_cd.insertRow(0);
	ds_bsu_cd.setColumn(0, "CODE", "");
	ds_bsu_cd.setColumn(0, "SRM_NAME", "ALL");
	
	cb_bsu.value = "";
	
	// 서비스자회사 이관처리 되지 않도록 제외하고 필터. Han JH
	//--자회사 무상발주 수정  --> 20210626 --
	//ds_bsu_cd.Filter(" VKGRP!=" +quote("H11"));
	//========================================//
	
	fn_init();
}

function fn_init() {	

	ds_cond_b.ClearData();
	ds_cond_b.AddRow();
	
	//fn_juj();
	
//ALERT("gubun : " + gubun);	
	// 기안 최초 작성 시 
	if(gubun == "DRAFT") {
	
		//fn_juj();
//ALERT("1 : " + 	fa_pjt);
		ed_pjt_param.Text = fa_pjt;
//ALERT("2 : " + 	ed_pjt_param.Text);		
//TRACE(ds_bsuInfo.SaveXML());
		fn_setList();
		fn_setButtonStatus();
		//fn_query();
	} else {
	
		ed_docno.Text = fa_docno;
		ed_pjt_param.Text = fa_pjt;
		
	// 기안 작성 조회 시 
		fn_query2(); //  기안문서 조회
		fn_query3(); // 결재정보 조회 
		fn_get_app_status();
		fn_query(); // 업체정보 조회 
	}
	
}
/********************************************************************************
* 기      능   : 공통코드가 조회된 후의 Callback 함수 
********************************************************************************/

function fn_setList() {
	j = 0;
	k = 0;
	var t_hno, t_spc, t_flr, t_spd, t_zmussum;

//trace(ds_list2.saveXml());

	for(var i=0; i<ds_list2.RowCount(); i++) {
		
		ds_hnoList.AddRow();
		ds_hnoList.SetColumn(j, "PJT"     , ds_list2.GetColumn(i, "PJT"));
		ds_hnoList.SetColumn(j, "HNO"     , ds_list2.GetColumn(i, "HNO"));
		ds_hnoList.SetColumn(j, "ADDR"    , ds_list2.GetColumn(i, "ADDR"));
		ds_hnoList.SetColumn(j, "ZSPEC1"  , ds_list2.GetColumn(i, "TYP"));
		ds_hnoList.SetColumn(j, "ZSPEC2"  , ds_list2.GetColumn(i, "ZSPEC2"));
		ds_hnoList.SetColumn(j, "ZSPEC3"  , ds_list2.GetColumn(i, "ZSPEC3"));
		//ds_hnoList.SetColumn(j, "ZZBSU"   , ds_list2.GetColumn(i, "BSU"));
		ds_hnoList.SetColumn(j, "ZZBSU"   , "");
		ds_hnoList.SetColumn(j, "ZZBSU_B" , ds_list2.GetColumn(i, "ZZBSU_B"));
		ds_hnoList.SetColumn(j, "ABR_NM_B" , ds_list2.GetColumn(i, "ABR_NM_B"));
		ds_hnoList.SetColumn(j, "VKGRP_NM_B" , ds_list2.GetColumn(i, "VKGRP_NM_B"));
		ds_hnoList.SetColumn(j, "ZSITE_NM", ds_list2.GetColumn(i, "CS121_SPT"));
		ds_hnoList.SetColumn(j, "ABG", ds_list2.GetColumn(i, "ABG"));
		ds_hnoList.SetColumn(j, "AGB", ds_list2.GetColumn(i, "AGB"));
		ds_hnoList.SetColumn(j, "BLD", ds_list2.GetColumn(i, "BLD")); // 건물용도 
		
		ds_hnoList.SetColumn(j, "ATWRT", ds_list2.GetColumn(i, "ATWRT")); // 교체보수업체코드
		ds_hnoList.SetColumn(j, "ATWTB", ds_list2.GetColumn(i, "ATWTB")); // 교체보수업체명
		
		ds_hnoList.SetColumn(j, "PRO", ds_list2.GetColumn(i, "PRO"));
		ds_hnoList.SetColumn(j, "ISD", ds_list2.GetColumn(i, "FDT"));
		ds_hnoList.SetColumn(j, "FYN", ds_list2.GetColumn(i, "CS101_FYN"));
		
		//--자회사 무상발주 수정  --> 20210326 --
		t_zmussum = 0;
		t_zmussum = parseInt(ds_list2.GetColumn(i, "MSM")) + parseInt(ds_list2.GetColumn(i, "MBO"));
		ds_hnoList.SetColumn(j, "SUM_ZMUSAOCNT", t_zmussum);
		
		//ds_hnoList.SetColumn(j, "REMARK", "");
		
		j++;
	}

//trace(ds_hnoList.saveXml());
}
/********************************************************************************
* 기      능   : form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	return gfn_isFormUnload(obj);
}
//=========================================================================================
// [ PART 3 ]
// Main Process Event 정의(조회,입력,삭제,저장,인쇄,form닫기)
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 1
* 업체 정보 조회 
********************************************************************************/
function fn_query() {
	
	ds_cond_b.SetColumn(0, "ZZBSU",ds_hnoList.GetColumn(0, "ZZBSU"));
	
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs06:CS0602001C_S1");
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond_b"
        , "ds_bsuInfo=ds_list"
        , ""
        , "fn_afterQuery"
        , true
        , ""
        , true);
        
//alert("zzzzzzzzzz");      
        
    //ed_bsu_param.Text = ds_bsu_cd.GetColumn(ds_bsu_cd.FindRow("CODE", cb_bsu.Value), "CODE2") ; 	
}
/********************************************************************************
* 기      능   : 조회 2
* 기안 호기 리스트 
********************************************************************************/
function fn_query2() {
	
	ds_cond_b.SetColumn(0, "PJT"  , ed_pjt_param.Text);
	ds_cond_b.SetColumn(0, "DOCNO", ed_docno.Text);

	tit_clearActionInfo();
	tit_addSearchActionInfo("cs06:CS0602001C_S2");
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond_b"
        , " ds_hnoList=ds_list2"
        , ""						
        , ""						
		, true							
		, false							
		, true);
		
	
		
}
/********************************************************************************
* 기      능   : 조회 3
* 기안 결재 문서 상태 
********************************************************************************/
function fn_query3() {
		
	ds_apInfo.ClearData();
	
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs06:CS0602001C_S3");
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond_b"
        , "ds_apInfo=ds_list3"
        , ""						
        , ""						
		, true							
		, false							
		, true);
}
/********************************************************************************
* 기      능   : 기안  
********************************************************************************/
function fn_draft() {
	var lv_vkgrp = ds_bsu_cd.GetColumn(ds_bsu_cd.FindRow("CODE", cb_bsu.Value), "VKGRP") ;
	
	// 필수 항목 체크 
	for(var i=0; i<ds_hnoList.RowCount(); i++) {
		// 1. 시내구분 
		if(length(ds_hnoList.GetColumn(i, "AGB")) == 0)
		{
			gfn_showAlert("CW00001",st_agb.value);
			return;
		}
		// 2. 빌딩구분 
		if(length(ds_hnoList.GetColumn(i, "ABG")) == 0)
		{
			gfn_showAlert("CW00001",st_abg.value);
			return;
		}
		// 3. FM 대상 
		if(length(ds_hnoList.GetColumn(i, "FYN")) == 0)
		{
			gfn_showAlert("CW00001",st_fyn.value);
			return;
		}		
		
		// 자회사 지정시 무상 총개월수가 1개월 초과이어야 발주 가능
		if ( lv_vkgrp == 'H11' && parseInt(ds_hnoList.GetColumn(i, "SUM_ZMUSAOCNT")) <= 1 ) 
		{
			gfn_showAlert("CW00114", "자회사 발주시 무상개월수가 1개월 미만은 발주 ");
			return;
		}
	}	
		

	// 1. 시내구분 
	// if ( gfn_isNull(cb_agb, true) ) {
		// gfn_showAlert("CW00001",st_agb.value);
		// return;
	// }
	// 2. 빌딩구분 
	// if ( gfn_isNull(cb_abg, true) ) {
		// gfn_showAlert("CW00001",st_abg.value);
		// return;
	// }
	// 3. FM 대상 
	// if ( gfn_isNull(cb_fyn, true) ) {
		// gfn_showAlert("CW00001",st_fyn.value);
		// return;	
	// }
	// 4. 인수일  
	if ( cal_isd.Value > gfn_getCurrDate() ) {
		gfn_showAlert("CW00001",st_isd.value);
		return;
	}
	// 5. 협력사 
	if ( gfn_isNull(cb_bsu, true) ) {
		gfn_showAlert("CW00001",st_bsu.value);
		return;
	}
	// 6. 보수 PM 
	//--자회사 무상발주 수정  --> 20210626 --   && ds_bsu_cd.GetColumn(ds_bsu_cd.currow, "VKGRP") != 'H11'
	//var lv_vkgrp = ds_bsu_cd.GetColumn(ds_bsu_cd.FindRow("CODE", cb_bsu.Value), "VKGRP") ;
	if ( gfn_isNull(ed_bpm, true) && lv_vkgrp != 'H11') {
		gfn_showAlert("CW00001",st_bpm.value);
		return;
	}
	
	
	
	if ( cal_isd.Value > gfn_getCurrDate() ) {
		var arr = [st_isd.value, "현재일"];
		gfn_showAlert("CW00036", arr);
		return;
	}

	//  최초 기안시 에만 결재번호 생성
	if(ds_apInfo.GetColumn(0,"APSTAT") == "3") {
		
		fa_docno = ed_docno.Text;
	} else {			
		fn_docgen();
		ed_docno.Text = ds_docno_gen.GetColumn(0, "DOCNO");
		fa_docno = ds_docno_gen.GetColumn(0, "DOCNO");
	}
//return;	
	var appgubn = "S"; //내부 부서 결재
	
	if(ds_apInfo.GetColumn(0,"APSTAT") == "3") appgubn = "R"; // 수신부서 결재
	
    var arg = "fa_docno=" + quote(fa_docno) + " fa_dockind = " + quote(23) + " fa_appgubn=" + quote(appgubn);

	var returnFlag = gfn_openPopup2("CS0401001A", true, arg);
	
	if(returnFlag[0] == "S"){
	
		div_btn.btn_draft.enable = false ;
		/****************************************************/
		/* 최초 기안부서의 경우 ZCST103 생성 / ZCST101 UPDATE
		/* 수신부서의 기안의 경우 결재선리스트 생성 
		/****************************************************/
		if(appgubn == "S") {
			
			var p_spt = ""; 
		
		
			for(var i=0; i<ds_hnoList.RowCount(); i++) {
			
				ds_hnoList.SetColumn(i, "DOCNO"  , ds_docno_gen.GetColumn(0, "DOCNO"));
				
				ds_hnoList.SetColumn(i, "REMARK" , ed_remark.Text);		
				p_spt = ds_hnoList.GetColumn(i, "ZSITE_NM");
	
			}
			//TRACE(ds_docno_gen.SaveXML());
			//trace(ds_hnoList.saveXml());
			//return;
			tit_clearActionInfo();
			tit_addMultiActionInfo("cs06:CS0602001C_I1"); // zcst103 기안문서 INSERT 
			tit_addMultiActionInfo("cs06:CS0602001C_U1"); // ZCST101 결재문서번호 UPDATE	
			tit_addSingleActionInfo("cs04:CS0401002A_U8"); // ZWBAP01 프로젝트 - 현장명 


			tit_callService(
				""
				, ""
				, "ds_list=ds_hnoList"
				, ""
				, "PARAM1=" + quote(ed_pjt_param.Text) + " PARAM2="+quote(p_spt) + " DOCNO="+quote(fa_docno)+ " DOCKIND=" + quote(23)
				, "fn_afterSave"
				, true 
			);
			
		} else {
			fn_query2(); //  기안문서 조회
			fn_query3(); // 결재정보 조회 
			fn_get_app_status();
			fn_query(); // 업체정보 조회 
		}
	}
}


// 결재번호 생성
function fn_docgen() {	
	ds_docno_gen.ClearData();									
	ds_docno_gen.AddRow();									
	ds_docno_gen.SetColumn(0,"PFX","TOV");
										
	tit_clearActionInfo();									
	tit_addSearchActionInfo("wb01:DOC_CODE_GEN_S1",true);									
	tit_addSearchActionInfo("wb01:DOC_CODE_GEN_U1");										
	tit_callService(		
		""
		, ""							
		, "ds_docno_gen_i=ds_docno_gen"							
		, "ds_docno_gen=ds_docno_gen_o"							
		, ""							
		, ""							
		, true							
		, false							
		, true); //동기화 방식으로 서비스를 콜한다.
}

/********************************************************************************
* 기      능   : 삽입 20
********************************************************************************/
function fn_insert() {

}
/********************************************************************************
* 기      능   : Delete 
********************************************************************************/
function fn_delete() {
	
}
/********************************************************************************
* 기      능   : 저장 
********************************************************************************/
function fn_save() {

	ds_sms.ClearData();
	ds_zcst121.ClearData();
	
	for(var i=0; i<ds_hnoList.RowCount(); i++) {
		ds_hnoList.SetColumn(i, "CS101_GNO", ufn_getGno(i)); //관리번호 생성
	}
	
	var j = 0;
	var o_pjt, n_pjt;
	
	for(var i=0; i<ds_hnoList.RowCount(); i++) {
		if(j == 0) {
			o_pjt = "";
		} else {
			o_pjt = ds_hnoList.GetColumn(j-1, "PJT");
		}
		n_pjt = ds_hnoList.GetColumn(j, "PJT");
		
		if(o_pjt <> n_pjt) {

			var rows = ds_zcst121.AddRow();
			ds_zcst121.CopyRow(rows, "ds_hnoList"  , ds_hnoList.row);
			ds_zcst121.SetColumn(rows, "CS121_UPN" , ds_hnoList.GetColumn(ds_hnoList.row, "PJT"));
			ds_zcst121.SetColumn(rows, "CS121_CST" , "");
			ds_zcst121.SetColumn(rows, "CS121_SPT" , ds_hnoList.GetColumn(ds_hnoList.row, "ZSITE_NM"));
			ds_zcst121.SetColumn(rows, "CS121_NAM" , ds_hnoList.GetColumn(ds_hnoList.row, "KUNNR_NM")); 	
								
			var rows = ds_sms.AddRow();
			ds_sms.CopyRow(rows, "ds_hnoList"  , ds_hnoList.row);
			
			ds_sms.SetColumn(j, "TRAN_PHONE"   , ds_bsuInfo.GetColumn(0, "BSU_HP"));
			ds_sms.SetColumn(j, "TRAN_CALLBACK", "02-3670-0966");
			ds_sms.SetColumn(j, "TRAN_STATUS"  , "1");
			ds_sms.SetColumn(j, "TRAN_DATE"    , ""); //시스템 date(14자리)
			ds_sms.SetColumn(j, "TRAN_MSG"     , ufn_getMsg(i)); //메세지 생성
								
		}
		j++;
	}


//trace(ds_hnoList.SaveXML());
//ALERT("TEST");	
//return;
	//trace(ds_zcst121.SaveXML());
	//trace(ds_sms.SaveXML());
	
	
	
	tit_callService(
		"CS0602001A_ACT"
		, "takeOver"
        , "ds_list=ds_hnoList:A ds_list_m=ds_zcst121:A"
		, ""
		, ""
		, "fn_afterSave2");	
		
}
/********************************************************************************
* 기      능   : 관리번호 생성 
********************************************************************************/
function ufn_getGno(curRow) {
	var gno, pjt, pgb, hno, hgb;
	var g[10];

	pjt = ds_hnoList.GetColumn(curRow, "PJT");
	pgb = substr(ds_hnoList.GetColumn(curRow, "PJT"),0,1);
	hno = ds_hnoList.GetColumn(curRow, "HNO");
	hgb = substr(ds_hnoList.GetColumn(curRow, "HNO"),0,1);

	if(!(hgb == "L" || hgb == "S")) {
		return '';
	}

	switch(pgb) {
		case '0' :
		case '1' : g[0] = '1'; //자사
		case 'N' : g[0] = '2'; //교체
		case 'M' : g[0] = '3'; //타사
		case 'G' : g[0] = '4'; //PSD
		case 'J' : g[0] = '5'; //주차
		case 'F' : g[0] = '6'; //물류
		default  : g[0] = '9'; //기타
	}

	switch(pgb) {
		case 'J' :
		case 'M' :
		case 'N' :
		case 'G' :
		case 'F' : g[1] = '0';
		case 'E' : g[1] = '9';
		default  : g[1] = pgb;
	}

	return gno;
}

/********************************************************************************
* 기      능   : 저장 Callback  
********************************************************************************/
function fn_afterSave(errCode, errMsg) {

	if ( errCode != 0 ) {
		gfn_showAlert("CE00001");
	} else {
		// 기안문서 최초 저장 후 조회 처리 
		gubun = "QUERY";
		
		fn_query2(); //  기안문서 조회
		fn_query3(); // 결재정보 조회 
		fn_get_app_status();
		fn_query(); // 업체정보 조회 
		
	}
}
function fn_afterSave2(errCode, errMsg) {

	if ( errCode != 0 ) {
		gfn_showAlert("CE00001");
	} else {
		// 인수처리 후속 프로세스
		// 1. 직영 무상 자동발주
		// 2. sms 전송 
		// 3. 결재 처리 
		//TRACE("fn_musangBalju");
		fn_musangBalju();
		
	}
}

/********************************************************************************
* 기      능   : . 직영 무상 자동발주
********************************************************************************/
// 승강기 
// 인수일 다음 일자 무상 개시 
function fn_musangBalju()
{
	tit_callService(
        "CS0602001A_ACT"
        , "musangBalju"
        , "ds_list=ds_hnoList"
        , ""
        , ""
        , "fn_afterMusangBalju"
        , true);
}
function fn_afterMusangBalju(errCode, errMsg) {
	if(errCode != 0) {
		gfn_showMsg("CE00001");
	} else {
		gfn_showMsg("CI00003");
		//TRACE("fn_sms");
		fn_sms();
	}
}
/********************************************************************************
* 기      능   : 2. sms 전송 
********************************************************************************/
function fn_sms() {

	tit_clearActionInfo();
	tit_addMultiActionInfo("cs06:CS0602001A_I2");
	tit_callService(
        "PDA_ACT"
        , ""
        , "ds_list_m=ds_sms:A"
        , ""
        , ""
        , "fn_afterSms");
}

function fn_afterSms(errCode, errMsg) {

	fn_decideApproval(); // 결재 처리
}
/********************************************************************************
* 기      능   :SMS 메시지 생성 
********************************************************************************/
function ufn_getMsg(curRow) {
	var msg;

	msg = "[" + ds_hnoList.GetColumn(curRow, "PJT") + " " + substr(ds_hnoList.GetColumn(curRow, "ZSITE_NM"),0,10) + "..]" + " 현장이 인수되었습니다";

	return msg;
}

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}
/********************************************************************************
* 기      능   : 액셀  
********************************************************************************/
function fn_excel() {

}
/********************************************************************************
* 기      능   : 접수 5
********************************************************************************/
function fn_receipt() {

}
/********************************************************************************
* 기      능   : 승인 10
********************************************************************************/
function fn_approval() {

}
/********************************************************************************
* 기      능   : 전송 60
********************************************************************************/
function fn_trans() {

}

//=========================================================================================
// [ PART 4]
// Callback 함수 정의 : callback 함수명은 메인 함수의 fn_xxxx() 에서 xxxx 부분은 fn_afterXXXX()
// 형태가 되도록 작성 
//=========================================================================================
/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(errCode, errMsg) {
	
	if ( errCode!= 0 ) {
		gfn_showMsg("CE00001");
	} else {
//alert(	gubun );		
		if(gubun != "DRAFT")
		{
//alert("x");		
			ed_remark.Text = ds_hnoList.GetColumn(0, "REMARK" );
		}
		cb_bsu.Value   = ds_bsuInfo.GetColumn(0, "LIFNR" );
		fn_setButtonStatus();
	}
}

//=========================================================================================
// [ PART 6 ]
// component Event 정의 : 각 Component 별 이벤트 
//=========================================================================================
/********************************************************************************
* 기      능   : 결재자정보가져오기
********************************************************************************/
function fn_get_app_status() {

	ds_decide.ClearData();
	
	tit_clearActionInfo();
	tit_addSearchActionInfo("wb01:APP_STATUS");		//결재자조회
	tit_callService(
		""
		, ""
		, "ds_cond=ds_cond_b"
		, "ds_decide=ds_decide"
		, ""
		, ""
		, true
		, false
		, true);	
}
/********************************************************************************
 * 기      능   : 문서 상태에 따른 버튼 활성화 설정 
 ********************************************************************************/
function fn_setButtonStatus() {

	if(gubun == "DRAFT") {
		div_btn.btn_draft.Enable = true; 
		div_btn.btn_delete.Enable   = false;
		div_btn.btn_sendback.Enable = false;
		div_btn.btn_decide.Enable = false;
			
	} else {
		cal_isd.Enable = false;
		cb_bsu.Enable = false;
		cb_agb.Enable = false;
		cb_fyn.Enable = false;
		cb_abg.Enable = false;
		ed_remark.Enable = false;
		cb_juj.Enable = false;
		cb_buj.Enable = false;
				
	}
		
//trace(ds_apInfo.SaveXML());
//trace(ds_decide.SaveXML());
	// 기안 전 ( 기안부서 OR 수신부서 - 마케팅팀 ) 
	if (parseInt(ds_apInfo.GetColumn(0,"APSTAT")) < 1 || (ds_apInfo.GetColumn(0,"APSTAT") == "3" && gfn_getAuthGroup("ZCS07"))) 
	{	
//alert("1");	
		div_btn.btn_draft.Enable    = true; 
		div_btn.btn_delete.Enable   = false;
		div_btn.btn_sendback.Enable = false;
		div_btn.btn_decide.Enable   = false;
	} else if((ds_apInfo.GetColumn(0,"APSTAT") > "0" && ds_apInfo.GetColumn(0,"APSTAT") != "3" && ds_apInfo.GetColumn(0,"APSTAT") < "6") 
			   && G_USER_ID == substr(ds_decide.GetColumn(0, "APNUM"),1) ) 
	{
//alert("2");	
		div_btn.btn_draft.Enable    = false;	
		div_btn.btn_sendback.Enable = true;	
		div_btn.btn_decide.Enable   = true;
	} else {
//alert("3");	
		div_btn.btn_draft.Enable = false;
		div_btn.btn_decide.Enable = false;
		div_btn.btn_sendback.Enable = false;
	}	
	
	// 기안 대상 여부 확인 
	/*
	1. 계획과 불일치 건
	
	2. 에스컬레이터 업 tp3  확인 s w 
	
	3. tp1 고속엘리베이터 속도 240 초과 
	
	4. 인수업체 공통수급 미동의 시 ..(향후)
	*/
	
	
	if(ds_bsuPlanInfo.GetColumn(0, "BSU_GB") == null) {
		// 2018.10.11 이준석DL 요청
		// 인수업체 선택 시 인수계획업체의 정보를 조회한다.
		fn_PlanQuery();		
	}
		
	var t_tp1 = ds_bsuInfo.GetColumn(0, "TP1");
	var t_tp3 = ds_bsuInfo.GetColumn(0, "TP3");
	var t_tgb = ds_bsuInfo.GetColumn(0, "BSU_GB");
	var plan_tgb = ds_bsuPlanInfo.GetColumn(0, "BSU_GB"); // 2018.10.11 이준석DL 요청. 실제 인수계획업체의 직영 및 협력사정보를 담는다.
	var writeDocno = true;
	var planActual = true;
	var parking = false;

	for(var i=0; i<ds_hnoList.RowCount(); i++) {
		// 계획 불일치 건 수신부서 기안 
		if(ds_hnoList.GetColumn(i, "ZZBSU") <> ds_hnoList.GetColumn(i, "ZZBSU_B")) {
			FLAG_ADMIN_APPROVAL = false;
		}
		//주차여부확인 
		if(substr(ds_hnoList.GetColumn(i, "HNO"),0,1) == "J") {
			parking = true;
		}
		// 속도가 204 초과현장의 경우 
		// 에스컬레이터 인 경우 
		if(substr(ds_hnoList.GetColumn(i, "HNO"),0,1) <> "L") {
			if(!t_tp3) {
			
				//trace("유지관리업-에스컬레이터 업체만 인수 가능");
				ed_notice.Text = "유지관리업-에스컬레이터 업체만 인수 가능";
				div_btn.btn_draft.Enable = false;
				writeDocno = false;
			}
		} else {
		
			//trace(parseInt(ds_hnoList.GetColumn(i, "ZSPEC3")));
			if(parseInt(ds_hnoList.GetColumn(i, "ZSPEC3")) > 240) {
				if(!t_tp1) {
				
					//trace("유지관리업-고속엘리베이터 업체만 인수 가능");
					ed_notice.Text = "유지관리업-고속엘리베이터 업체만 인수 가능";
					div_btn.btn_draft.Enable = false;
					writeDocno = false;
				}
			} 
		}
		if(ds_hnoList.GetColumn(i, "ZZBSU") <> ds_hnoList.GetColumn(i, "ZZBSU_B") ) {
			planActual = false;
		}
	
	}
	
	var actulCount = parseInt(ds_hnoList.RowCount());
	var scope      = parseInt(med_scp.Value);
	var cnt_all    = parseInt(med_cnt_all.Value);

	if(actulCount + cnt_all >= scope) {
		ed_notice.Text = "유지관리범위 초과 ";
		div_btn.btn_draft.Enable = false;
		writeDocno = false;

	}
	// 직영 및 주차 의 경우 계획 불일치의 경우만 체크 
	if(t_tgb == 1 || parking) {
		ed_notice.Text = "";
		if(gubun == "DRAFT") {
			div_btn.btn_draft.Enable = true;
		}
		writeDocno = true;
	} else if(plan_tgb == 1 && t_tgb == 3) { // 2018.10.11 이준석 DL 요청. 인수계획업체가 직영이고 입수업체가 협력사일 경우
		writeDocno = true;
		planActual = false;
	}
	
	if(writeDocno) {
		if(planActual) {
			ed_notice.Text = "계획 일치 (지사장 전결)";
		} else { // 인수계획업체 유무에 따라서
			if(plan_tgb == 1 && t_tgb == 3) { // 인수계획업체가 직영이고 실제 인수업체가 협력사일 경우
				//ed_notice.Text = "계획 불일치 (부문장 전결) ";
				ed_notice.Text = "계획 불일치 (담당 전결) ";  // 이준석씨 요청으로 변경
			} else { // 인수계획업체가 직영이고 실제 인수업체가 다른 직영사일 경우
				ed_notice.Text = "계획 불일치 (팀장 전결) ";
			}
		}
	}
	if(ds_bsuInfo.RowCount() == 0){
		ed_notice.Text = "인수 대상 업체를 지정하십시오.";
	}
	if (parseInt(ds_apInfo.GetColumn(0,"APSTAT")) < 1 || (ds_apInfo.GetColumn(0,"APSTAT") == "3" && gfn_getAuthGroup("ZCS07"))) 
	{
		div_btn.btn_draft.Enable    = true; 
		div_btn.btn_delete.Enable   = false;
		div_btn.btn_sendback.Enable = false;
		div_btn.btn_decide.Enable   = false;
	}
}

/********************************************************************************
* 기      능   : 결재자 리스트 조회 
********************************************************************************/
function btn_wf_stat_OnClick(obj)
{
	if(length(ed_docno.Text) > 0 )  {
		var arg = "fa_docno=" + quote(ed_docno.Text);
		gfn_openPopup("CS0405001A", true, arg);	
	}
}
/********************************************************************************
* 기      능   : 결재 15
* FLAG_ADMIN_APPROVAL = TRUE >> "기안 결재 내 처리 "
* FLAG_ADMIN_APPROVAL = FALSE >> "수신부서 전송 건  "
********************************************************************************/
function fn_decide() {

	fa_docno = ed_docno.Text;
	if(!gfn_showConfirm("CI00014", "문서번호 : "+ quote(fa_docno)+ "결재")) return;

	 // trace(ds_apInfo.SaveXML());
	 // trace(ds_decide.SaveXML());

	// 기안 부서 완료 처리 문서의 경우 인수 및 수신결재 처리  ZWBAP01-ATSTAT = 6 
	if( (FLAG_ADMIN_APPROVAL && ds_decide.GetColumn(0, "APPGUBN") == "S" && ds_apInfo.GetColumn(0, "APNUM") == "H"+G_USER_ID )
	    || (ds_decide.GetColumn(0, "APPGUBN") == "R" && ds_apInfo.GetColumn(0, "APNUM") == "H"+G_USER_ID ))  {

		//TRACE("GO TAKE OVER ");
		// 인수 처리 
		fn_save();

	} else {
		fn_decideApproval(); // 결재 처리
	}
	
}
/********************************************************************************
* 기      능   : 결재 처리
********************************************************************************/
function fn_decideApproval() {

	//----------------------------------------------------------------------
	// 의견 입력 팝업 추가 
	// f팝업 전달 변수 fa_docno : 문서번호 ,fa_dockind : 문서종류 
	// return 값 : rtn_yn (Y:의견입력됨 N:의견입력안됨)

	if(gfn_showConfirm("CW10025","의견을 입력하시겠습니까?") )
	{ 
		var arg = "";
		arg = " fa_docno=" + quote(fa_docno) +" fa_dockind =23";
		var rtn_yn = gfn_openPopup2("CS0401001C", true , arg);
	}
	// 의견입력 팝업 종료
	//----------------------------------------------------------------------
	ds_decide.setColumn(ds_decide.FindRow("APNUM","H"+G_USER_ID),"SEQSTAT","3");

	tit_clearActionInfo();
 	//결재자 저장
 	tit_addSearchActionInfo("cs04:CS0401002A_U2");
 	tit_addSearchActionInfo("cs04:CS0401002A_U3");

	// 기안 부서 완료 처리 문서의 경우 인수 및 수신결재 처리  ZWBAP01-ATSTAT = 6 
	if( FLAG_ADMIN_APPROVAL && ds_decide.GetColumn(0, "APPGUBN") == "S" && ds_apInfo.GetColumn(0, "APNUM") == "H"+G_USER_ID ) {
		tit_addMultiActionInfo("cs04:CS0401002A_U4");      
	}

	tit_callService(
		""
		, ""
		, "ds_list_0=ds_decide:A"
		, ""
		, ""
		, "fn_afterDecideApproval"
		, true);

}
/********************************************************************************
* 기      능   : 반송 65
********************************************************************************/
function fn_sendback() {

	fa_docno = ed_docno.Text;	
	if(!gfn_showConfirm("CI00014", "문서번호 : "+ quote(fa_docno)+ "반송")) return;
	//----------------------------------------------------------------------
	// 의견 입력 팝업 추가 
	// f팝업 전달 변수 fa_docno : 문서번호 ,fa_dockind : 문서종류 
	// return 값 : rtn_yn (Y:의견입력됨 N:의견입력안됨)
	if(gfn_showConfirm("CW10025","의견을 입력하시겠습니까?") )
	{
		var arg = "";
		arg = " fa_docno=" + quote(fa_docno) +" fa_dockind =23";
		var rtn_yn = gfn_openPopup2("CS0401001C", true , arg);
	}
	// 의견입력 팝업 종료
	//----------------------------------------------------------------------
	ds_decide.setColumn(ds_decide.FindRow("APNUM","H"+G_USER_ID),"SEQSTAT","2");

	tit_clearActionInfo();
 	//결재자 저장
 	tit_addMultiActionInfo("cs04:CS0401002A_U2");
 	tit_addMultiActionInfo("cs04:CS0401002A_U3");

	tit_callService(
		""
		, ""
		, "ds_list_0=ds_decide:A"
		, ""
		, ""
		, "fn_afterDecideApproval"
		, true);
	

}
/********************************************************************************
* 기      능   : 결재  call back 
********************************************************************************/
function fn_afterDecideApproval() {

	fn_query2(); //  기안문서 조회
	fn_query3(); // 결재정보 조회 
	fn_get_app_status();
	fn_query(); // 업체정보 조회 
}


function cb_bsu_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
//ALERT(ds_bsu_cd.GetColumn(ds_bsu_cd.FindRow("CODE", cb_bsu.Value), "CODE2"));

//ALERT("A : " + 	ed_pjt_param.Text);		
//TRACE(ds_bsuInfo.SaveXML()	);	
	ed_bsu_param.Text = ds_bsu_cd.GetColumn(ds_bsu_cd.FindRow("CODE", cb_bsu.Value), "CODE2") ;
//ALERT("B : " + 	ed_pjt_param.Text);		
//TRACE(ds_bsuInfo.SaveXML()	);	
	for(var i=0; i<ds_hnoList.RowCount(); i++) {
		ds_hnoList.SetColumn(i, "ZZBSU", ed_bsu_param.Text) ; 
	}
	
	// 2018.10.11 이준석DL 요청
	// 인수업체 선택 시 인수계획업체의 정보를 조회한다.
	fn_PlanQuery();
	
	fn_query();
//TRACE(ds_bsuInfo.SaveXML()	);
//ALERT("C : " + 	ed_pjt_param.Text);		
	fn_juj();	
//TRACE(ds_bsuInfo.SaveXML()	);	
//ALERT("Z : " + 	ed_pjt_param.Text);	
//return;
}

/********************************************************************************
* 기      능   : 주점검자,부점검자 콤보 SELECT
********************************************************************************/
function fn_juj() {	
//ALERT("D : " + 	ed_pjt_param.Text);		
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs06:CS0602001C_S4");
	tit_callService(
		""
		, ""
		, "ds_bsuInfo=ds_bsuInfo"
		, "ds_juj_cd=ds_juj_cd"
		, ""
		, "fn_afterQueryCd"
		, true
		, true
		, true
		);

//trace(ds_juj_cd.SaveXML());
//alert("1");
//alert("E : " + ed_pjt_param.Text);	

}

/********************************************************************************
* 기      능   : 조회 Callback  :주점검자,부점검자 콤보
********************************************************************************/
function fn_afterQueryCd(errCode, errMsg) {
	ds_buj_cd.copy(ds_juj_cd);
//alert("2 : " + ed_bsu_param.Text);
	ds_juj_cd.Filter("BSU=="+quote(TRIM(ed_bsu_param.Text)));
	ds_buj_cd.Filter("BSU=="+quote(TRIM(ed_bsu_param.Text)));
	
}

/********************************************************************************
* 기      능   : 신규인수현장이 2대이하인 현장일때 알림 팝업창 표출
********************************************************************************/
function cb_abg_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	if(ds_list2.RowCount() < 3 && strCode == 'A') {
		if(!gfn_showConfirm("STO현장입니다. 아파트(주거용)이 맞습니까?")) {
			return;
		}	
	}
}

/********************************************************************************
* 기      능   : 인수계획업체의 정보를 가져오는 기능
* 업체 정보 조회 
********************************************************************************/
function fn_PlanQuery() {
	ds_cond_plan.ClearData();
	ds_cond_plan.AddRow();
	ds_cond_plan.SetColumn(0, "ZZBSU",ds_hnoList.GetColumn(0, "ZZBSU_B"));
	
	tit_clearActionInfo();
	tit_addSearchActionInfo("cs06:CS0602001C_S1");
	tit_callService(
        ""
        , ""
        , "ds_cond=ds_cond_plan"
        , "ds_bsuPlanInfo=ds_list"
        , ""
        , ""
        , true
        , ""
        , true);

}

/********************************************************************************
* 기      능   : 기안부서 완료의 경우 신규인수 처리 강제 승인(관리자용)
* 결재내용 확인 후, 반드시 운영서버에서 실행해야 됨.
********************************************************************************/
function btn_admin_seungin(obj)
{
	// 인수 처리 
	fn_save();
}
]]></Script>
</Window>