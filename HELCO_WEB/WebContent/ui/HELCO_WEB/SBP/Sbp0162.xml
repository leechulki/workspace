<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="265" Id="Sbp0162" Left="8" OnLoadCompleted="fn_OnLoadCompleted" OnUnloadCompleted="fn_OnUnloadCompleted" PidAttrib="7" Title="종결처리" Top="8" Ver="1.0" Width="400" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_input">
				<Contents>
					<colinfo id="GUBUN" size="256" type="STRING"/>
					<colinfo id="SONNR" size="256" type="STRING"/>
					<colinfo id="SORLT" size="256" type="STRING"/>
					<colinfo id="ZPYM" size="256" type="STRING"/>
					<colinfo id="AUART" size="256" type="STRING"/>
					<colinfo id="NEWZPYM" size="256" type="STRING"/>
					<colinfo id="PRESORLT" size="256" type="STRING"/>
					<colinfo id="DELDAT" size="256" type="STRING"/>
					<colinfo id="CHKFLG" size="1" type="STRING"/>
					<colinfo id="BDDAT" size="256" type="STRING"/>
					<colinfo id="ZSEC" size="256" type="STRING"/>
					<colinfo id="SBDAM" size="256" type="DECIMAL"/>
					<record>
						<AUART></AUART>
						<BDDAT></BDDAT>
						<CHKFLG></CHKFLG>
						<DELDAT></DELDAT>
						<GUBUN></GUBUN>
						<NEWZPYM></NEWZPYM>
						<PRESORLT></PRESORLT>
						<SBDAM/>
						<SONNR></SONNR>
						<SORLT></SORLT>
						<ZPYM></ZPYM>
						<ZSEC></ZSEC>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_input2" UseClientLayout="1">
				<Contents>
					<colinfo id="MANDT" size="3" type="STRING"/>
					<colinfo id="SONNR" size="10" type="STRING"/>
					<colinfo id="ZPYM" size="6" type="STRING"/>
					<colinfo id="SPART" size="2" type="STRING"/>
					<colinfo id="AUART" size="4" type="STRING"/>
					<colinfo id="MATNR" size="18" type="STRING"/>
					<colinfo id="VKBUR" size="4" type="STRING"/>
					<colinfo id="VKGRP" size="3" type="STRING"/>
					<colinfo id="ZKUNNR" size="10" type="STRING"/>
					<colinfo id="ZAGNT" size="10" type="STRING"/>
					<colinfo id="GTYPE" size="20" type="STRING"/>
					<colinfo id="TYPE1" size="5" type="STRING"/>
					<colinfo id="TYPE2" size="5" type="STRING"/>
					<colinfo id="TYPE3" size="5" type="STRING"/>
					<colinfo id="ZNUMBER" size="5" type="STRING"/>
					<colinfo id="KUNNR" size="10" type="STRING"/>
					<colinfo id="GSNAM" size="50" type="STRING"/>
					<colinfo id="LAND1" size="3" type="STRING"/>
					<colinfo id="REGION" size="2" type="STRING"/>
					<colinfo id="ZDELI" size="1" type="STRING"/>
					<colinfo id="ZLHGBN" size="1" type="STRING"/>
					<colinfo id="SHANGH" size="4" type="STRING"/>
					<colinfo id="ZINTER" size="1" type="STRING"/>
					<colinfo id="SOFOCA" size="15" type="STRING"/>
					<colinfo id="ZFORE" size="4" type="STRING"/>
					<colinfo id="ZCOST" size="15" type="STRING"/>
					<colinfo id="WAERK" size="5" type="STRING"/>
					<colinfo id="DELDAT" size="8" type="STRING"/>
					<colinfo id="ZRMK" size="100" type="STRING"/>
					<colinfo id="SOABLE" size="1" type="STRING"/>
					<colinfo id="SORLT" size="4" type="STRING"/>
					<colinfo id="PGUBN" size="4" type="STRING"/>
					<colinfo id="SOPRICE" size="15" type="STRING"/>
					<colinfo id="SHANG" size="4" type="STRING"/>
					<colinfo id="ZMPFLG" size="1" type="STRING"/>
					<colinfo id="VBELN" size="10" type="STRING"/>
					<colinfo id="ZBPNNR" size="10" type="STRING"/>
					<colinfo id="SONNRB" size="10" type="STRING"/>
					<colinfo id="CDATE" size="8" type="STRING"/>
					<colinfo id="CTIME" size="6" type="STRING"/>
					<colinfo id="CUSER" size="10" type="STRING"/>
					<colinfo id="UDATE" size="8" type="STRING"/>
					<colinfo id="UTIME" size="6" type="STRING"/>
					<colinfo id="UUSER" size="10" type="STRING"/>
					<colinfo id="DDATE" size="8" type="STRING"/>
					<colinfo id="DTIME" size="6" type="STRING"/>
					<colinfo id="DUSER" size="10" type="STRING"/>
					<colinfo id="SBDCM" size="256" type="STRING"/>
					<colinfo id="SBDAM" size="256" type="STRING"/>
					<colinfo id="PBDAM" size="256" type="STRING"/>
					<colinfo id="ZSEC" size="256" type="STRING"/>
					<colinfo id="ZSECAM" size="256" type="STRING"/>
					<colinfo id="ZFOREC" size="256" type="STRING"/>
					<colinfo id="ZPRGFLG" size="256" type="STRING"/>
					<colinfo id="SHANG55" size="4" type="STRING"/>
					<colinfo id="ZFOREC55" size="256" type="STRING"/>
					<colinfo id="ZCOST55" size="15" type="STRING"/>
					<colinfo id="ZKUNNR_NM" size="256" type="STRING"/>
					<colinfo id="ZAGNT_NM" size="256" type="STRING"/>
					<colinfo id="KUNNR_NM" size="256" type="STRING"/>
					<colinfo id="LAND1_NM" size="256" type="STRING"/>
					<colinfo id="ZAREA_NM" size="256" type="STRING"/>
					<colinfo id="STATUS" size="256" type="STRING"/>
					<colinfo id="CHK" size="256" type="STRING"/>
					<colinfo id="UFLAG" size="256" type="STRING"/>
					<colinfo id="RTYPE" size="256" type="STRING"/>
					<colinfo id="ZCLFLG" size="256" type="STRING"/>
					<colinfo id="SPEC" size="256" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_zsec">
				<Contents>
					<colinfo id="CODE" size="256" type="STRING"/>
					<colinfo id="CODE_NAME" size="256" type="STRING"/>
					<colinfo id="FILTER1" size="256" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Height="36" Id="div_btn" TabOrder="10" Text="Div0" Url="WB01::CommBtnForm.xml" Width="400">
			<Contents></Contents>
		</Div>
		<Shape BKColor="user0" Bottom="264" Height="224" Id="Shape1" Left="-1" LineColor="user1" Right="399" TabOrder="8" Top="40" Type="Rectangle" Width="400"></Shape>
		<Static Align="Right" Height="20" Id="Static0" Left="5" Style="sty_lb_search" TabOrder="8" Text="수주계획번호&#32;" Top="44" VAlign="Middle" Width="90"></Static>
		<Edit BindDataset="ds_input" Border="Flat" CheckLength="Byte" Column="SONNR" Enable="FALSE" Height="20" Id="ed_sonnr" ImeMode="none" Left="97" LeftMargin="4" MaxLength="10" RightMargin="4" Style="sty_ipt_search" TabOrder="7" Top="44" UpperOnly="TRUE" Width="100"></Edit>
		<Edit BindDataset="ds_input" Border="Flat" CheckLength="Byte" Column="ZPYM" Enable="FALSE" Height="20" Id="ed_zpym" ImeMode="none" Left="97" LeftMargin="4" MaxLength="105" RightMargin="4" Style="sty_ipt_search" TabOrder="8" Top="66" UpperOnly="TRUE" Width="90"></Edit>
		<Static Align="Right" Height="20" Id="Static1" Left="5" Style="sty_lb_search" TabOrder="9" Text="계획년월&#32;" Top="66" VAlign="Middle" Width="90"></Static>
		<Button Appearance="FLAT" ButtonStyle="TRUE" Color="user5" Cursor="HAND" DomainID="btn.copy" Height="22" Id="btn_copy" ImageID="btn_comm_copy_k" Left="284" LeftMargin="20" OnClick="fn_OnClick_btn" TabOrder="9" Text="실행" Top="6" Width="52"></Button>
		<Div BKColor="user0" Height="22" Id="div_yearMon" Left="200" OnLoadCompleted="fn_OnLoadCompleted" TabOrder="14" Text="Div0" Top="132" Url="COM::Coms012.xml" Width="184">
			<Contents></Contents>
		</Div>
		<Static Align="Right" Height="20" Id="Static2" Left="5" Style="sty_lb_search" TabOrder="15" Text="종결처리&#32;" Top="132" VAlign="Middle" Width="90"></Static>
		<Combo BindDataset="ds_input" Border="Flat" CodeColumn="CODE" Column="SORLT" DataColumn="CODE_NAME" Height="20" Id="cb_sorltP" Left="96" OnChanged="cb_sorltP_OnChanged" OnFocus="ufn_OnFocus" OnKillFocus="ufn_OnKillFocus" Style="sty_ipt_form" TabOrder="0" Top="131" Width="100"></Combo>
		<Static Align="Right" Height="20" Id="Static3" Left="5" Style="sty_lb_search" TabOrder="16" Text="고객명&#32;" Top="88" VAlign="Middle" Width="90"></Static>
		<Static Align="Right" Height="20" Id="Static4" Left="5" Style="sty_lb_search" TabOrder="17" Text="현장명&#32;" Top="110" VAlign="Middle" Width="90"></Static>
		<Static Height="19" Id="st_kunnrNm" Left="100" TabOrder="18" Text="&#32;" Top="90" VAlign="Middle" Width="200"></Static>
		<Static Height="19" Id="st_nm" Left="100" TabOrder="19" Text="&#32;" Top="111" VAlign="Middle" Width="200"></Static>
		<Calendar Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Column="PCAPID" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_deldat" Left="97" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form" SundayTextColor="user35" TabOrder="2" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="156" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="94"></Calendar>
		<Static Align="Right" Height="24" Id="st_deldat" Left="5" Style="sty_lb_search" TabOrder="20" Text="납품예정일" Top="154" VAlign="Middle" Width="90"></Static>
		<Static Align="Right" Height="24" Id="Static5" Left="5" Style="sty_lb_search" TabOrder="21" Text="낙찰사" Top="206" VAlign="Middle" Width="90"></Static>
		<Static Align="Right" Height="24" Id="Static6" Left="5" Style="sty_lb_search" TabOrder="22" Text="낙찰가" Top="232" VAlign="Middle" Width="90"></Static>
		<Combo Border="Flat" CodeColumn="CODE" DataColumn="CODE_NAME" Enable="FALSE" Height="20" Id="cb_zsec" InnerDataset="ds_zsec" Left="96" OnFocus="ufn_OnFocus" OnKillFocus="ufn_OnKillFocus" Style="sty_ipt_form" TabOrder="4" Top="207" Width="100"></Combo>
		<MaskEdit BindDataset="ds_list" Border="Flat" Enable="FALSE" Height="20" Id="ed_sbdam" Left="97" LeftMargin="4" Mask="###,###,###,##0" RightMargin="4" Style="sty_ipt_form" TabOrder="5" Top="233" Width="104"></MaskEdit>
		<Checkbox BKColor="user0" FalseValue="&#32;" Height="20" Id="chk_flg" Left="306" OnClick="chk_flg_OnClick" TabOrder="1" TabStop="FALSE" TextMargin="0" Top="132" TrueValue="Y" Value="FALSE" Width="16"></Checkbox>
		<Static Align="Right" Height="20" Id="Static7" Left="200" Style="sty_lb_search" TabOrder="23" Text="타사낙찰정보등록" Top="132" VAlign="Middle" Width="103"></Static>
		<Static Align="Right" Height="24" Id="Static8" Left="5" Style="sty_lb_search" TabOrder="24" Text="입찰예정일" Top="180" VAlign="Middle" Width="90"></Static>
		<Calendar Border="Flat" ClickedBkColor="user32" ClickedTextColor="user33" Dateformat="yyyy.MM.dd" DayFont="돋움,9" DaySelect="Auto" DaySpacingHeight="6" DrawWeekSeparator="FALSE" EditAlign="CENTER" Enable="FALSE" Font="돋움,9" HeaderBorder="NONE" HeaderFont="돋움,10,Bold" Height="20" Id="cal_bddat" Left="97" MonthPickerFormat="yyyy년&#32;MMMM" MonthPopupBorder="FLAT" SaturdayTextColor="user34" SelectedDayFont="돋움,9,Bold" Style="sty_ipt_form_ind" SundayTextColor="user35" TabOrder="3" TextColor="user36" TitleBKColor="user37" TitleTextColor="user38" TodayColor="user39" Top="183" WeekBKColor="user40" WeekColor="user41" WeeksFont="돋움,10" Width="104"></Calendar>
	</Form>
	<Script><![CDATA[/*
 ******************************************************************************************
 * 기      능   : 종결처리(sbp0162)
 * 작  성  자   : 
 * 작성  일자   : 2012.06
 * ----------------------------------------------------------------------------------------
 * HISTORY    : 
 ******************************************************************************************
*/

#include "LIB::tit_comm_0001.js";	// Server 연결 
#include "LIB::common.js";			// 공통 Script 
#include "LIB::common_sd.js";
#include "LIB::common_hdel.js";		// 공통 스크립트  /* GNY 추가 */
//=========================================================================================
// 전역변수를 선언
// FORM에서 사용되는 전역변수는 대문자로 작성하며, F_XXX 의 형태를 갖도록 한다. 
//=========================================================================================


//=========================================================================================
// Form Loading 
//=========================================================================================
function fn_OnLoadCompleted(obj) 
{
	
	// Button 정보 loading 시키기 
	// 화면제목 설정 및 버튼 활성화 (조회버튼)
	div_btn.fn_loadUseBtn('', "종결처리[sbp0162]", '', '');
	
	// Form 로드 이벤트 맨 첫줄에 기술 
	//gfn_initForm();

	//gfn_translation(obj, G_LANG);

	//ds_combo.ClearData();

	// parent정보를 copy하여 RFC 활용 2012.11.16
	ds_input2.ClearData();
	ds_input2.AddRow();
	ds_input2.CopyRow(0, parent.ds_output, parent.ds_output.row);	// 선택된 레코드 copy

	ed_sonnr.Text 	 = parent.ds_output.GetColumn(ds_output.row, 'SONNR'); 	// 수주계획번호
	ed_zpym.Text 	 = parent.ds_output.GetColumn(ds_output.row, 'ZPYM');	// 계획년월
	st_kunnrNm.Text	 = parent.ds_output.getcolumn(ds_output.row, "KUNNR_NM");// 고객명
	st_nm.Text		 = parent.ds_output.getcolumn(ds_output.row, "KUNNR_NM");// 현장명
	cal_deldat.Value = parent.ds_output.getcolumn(ds_output.row, "DELDAT");	//납기예정일

	var curYear = substr(gfn_getCurrDate(),0,4); 
	var curMonth = substr(gfn_getCurrDate(),4,2);
	var maxMonth = parseInt(curMonth)+1;

	div_yearMon.fn_makeYear(curYear,-5,5,0);
	div_yearMon.cb_monthf.index = parseInt(curMonth)-1;

	Static7.Visible = false;
	chk_flg.Visible = false;
		
	// 초기설정
	fn_init();
	
}

/********************************************************************************
* 초기설정
********************************************************************************/
function fn_init()
{
	http.Sync = true;
	
	// 종결처리
	destroy("ds_sorltP");
	Create("dataset", "ds_sorltP");
	object("ds_sorltP").AddColumn("CODE", "STRING", 256);
	object("ds_sorltP").AddColumn("CODE_NAME", "STRING", 256);
	object("ds_sorltP").AddColumn("FILTER1", "STRING", 256);
	
	// 언어, 코드구분
	var where = G_LANG+",SD111";
	callServiceN("code"
				 , "com0060/find"
				 , ""					// biz에서 받는 명, mip에서 보내는 명
				 , "ds_sorltP=ds_output"	// mip에서 받는 명, biz에서 보내는 명
				 , "where="+where+" popFlag="+quote("sorlt")
				 , "");
				 
	ds_sorltP.filter("pos(CODE,"+"'7')>=0");
	cb_sorltP.InnerDataset 	= "ds_sorltP";
	cb_sorltP.index 		= 0;
	cb_sorltP.Redraw 		= true;

	// 낙찰사 조회
	ds_zsec.DeleteAll();
	ds_zsec.AddRow();
	ds_zsec.SetColumn(0,"CODE","BS106");
	ds_zsec.SetColumn(0,"CODE_NAME","BS106");
	ds_zsec.SetColumn(0,"FILTER1","");

	// 서비스 호출
	callServiceN( "code"					// srvId
				, "combo/comboXml"		// url
				, "ds_zsec=ds_zsec"		// inDsList
				, "ds_zsec=ds_zsec"		// outDsList
				, ""					// strParam
				, "fn_afterQueryCode"	// CallBackFunc
				);


	http.Sync = false;

	cb_sorltP.SetFocus();
}


/********************************************************************************
* form UnloadCompleted 
********************************************************************************/
function fn_OnUnloadCompleted(obj) {
	
	// Tab에서 해당 화면 삭제
	return gfn_isFormUnload(obj);
}

/********************************************************************************
* 기      능   : 조회 Callback  
********************************************************************************/
function fn_afterQuery(strSvcID, nErrorCode, strErrorMag)
{
	if (strSvcID == "finish")
	{
		if (nErrorCode < 0)
		{
			gfn_showMsg("CE00001");
		}
		else
		{
			gfn_showAlert("CI00006", "종결");
			Parent.fn_query();	// 월 수주계획 재 조회
			fn_close();
		}
	}
}

/********************************************************************************
* 기      능   : 낙찰사 Callback  
********************************************************************************/
function fn_afterQueryCode(strSvcID, nErrorCode, strErrorMag)
{
	if (ds_zsec.GetRowCount() > 0)
	{
		var StrFilter1 = "10";		// default 10(승강기)
		if( IsExistVar("fa_filter1", true) )	{
			if (length(trim(fa_filter1)) > 0)	{
				StrFilter1 = fa_filter1;
			}
		}
		ds_zsec.Filter("FILTER1==" + quote(StrFilter1));
	}
}

/********************************************************************************
* 기      능   : 닫기  
********************************************************************************/
function fn_close() {
	close();
}

function fn_OnClick_btn(obj)
{
	var fncName = "fn_" + substr(obj.id, 4); 
	eval( fncName + "()");
}


/********************************************************************************
* 종결처리 변경시
********************************************************************************/
function cb_sorltP_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	// 입찰상태 ( 낙찰 = 30 )이면 이월 불가
	//if ( parent.ds_output.GetColumn(parent.ds_output.row, 'ZPRGFLG') == '30' )
	//{
		// [${}] 일 경우 이월처리가 안됩니다.
		//gfn_showAlert("CW10079", "입찰상태가 낙찰(30)");

		//cb_sorltP.Index = 1;
		//return;
	//}

	div_yearMon.Visible = false;
	cal_deldat.Enable   = false;
	Static7.Visible     = false;
	chk_flg.Visible     = false;
	chk_flg.Value       = "";
	chk_flg_OnClick(chk_flg, "");

	// 이월(70)일 경우 활성화
	if ( strCode == '70' )
	{
		cal_deldat.Enable   = true;
		div_yearMon.Visible = true;
	}
	else if (strCode == '73')	// 미참여
	{
		Static7.Visible     = true;
		chk_flg.Visible     = true;
	}
}

/********************************************************************************
* 복사
********************************************************************************/
function fn_copy()
{
	// valid 체크
	if ( fn_copyValid() == false ) return;

	// [종결처리]을 하시겠습니까?
	if ( !gfn_showConfirm("CI00024", "[종결처리]") )
	{
		return;
	}

	var url = "sbp0162_N/update";

	// 미참여 (73)
	if ( cb_sorltP.Value == '73')
	{
		ds_input.SetColumn(0, "CHKFLG", chk_flg.Value);
		ds_input.SetColumn(0, "BDDAT",  cal_bddat.Value);
		ds_input.SetColumn(0, "ZSEC",   cb_zsec.Value);
		ds_input.SetColumn(0, "SBDAM",  ed_sbdam.Value);
	}
	
	// 종결처리 (이월 = 70)
	if ( cb_sorltP.Value == '70') {
		ds_input.SetColumn(0,'AUART',	parent.ds_output.GetColumn(ds_output.row, 'AUART') );													// 판매문서유형
		ds_input.SetColumn(0,'NEWZPYM',	div_yearMon.cb_yearf.value + div_yearMon.cb_monthf.Value);	// 선택년월

		// 2012.12.13 종결처리 이전상태
		ds_input.SetColumn(0,'PRESORLT', parent.ds_output.GetColumn(ds_output.row, 'SORLT') );		// 종결처리전 상태
		ds_input.SetColumn(0,'DELDAT',	cal_deldat.Value );		// 납품예정일												// 판매문서유형

		url = "sbp0162_N/insert";
	} 
	
	// 서비스 호출
	callServiceN("finish"				// srvId
				, url					// url
				, "ds_input=ds_input ds_input2=ds_input2"	// inDsList
				, ""					// outDsList
				, ""					// strParam
				, ""					// CallBackFunc
				);

	//close('ok');
}

/********************************************************************************
* 복사 전 valid 체크
********************************************************************************/
function fn_copyValid()
{
	// 이월(70) 경우만 체크
	if ( cb_sorltP.value == '70' )
	{

		// 수주결과 (20 = 견적생성)
		//if ( parent.ds_output.GetColumn(parent.ds_output.row, 'SORLT') == '20') 
		//{
			// 단납기구분 ( 1 = 단납기, X )
			//if ( parent.ds_output.GetColumn(parent.ds_output.row, 'ZDELI') == '1' ||
			//	 parent.ds_output.GetColumn(parent.ds_output.row, 'ZDELI') == 'X') 
			//{
				// [${}] 일 경우 이월처리가 안됩니다.
				//gfn_showAlert("CW10079", "견적이면서 단납기");
				
				//cb_sorltP.Index = 1;
				//return false;
			//}
		//}

		var zpym1 = parseInt(ed_zpym.Text); 											// 계획년월
		var zpym2 = parseInt(substr(gfn_getCurrDate(),0,6));							// 현재년월
		var zpym3 = parseInt(div_yearMon.cb_yearf.Value + div_yearMon.cb_monthf.Value); // 콤보년월
	
		if (zpym3 > zpym2) {
			if (zpym3 == zpym1) {
				// [${}]과/와 같을 수 없습니다.
				gfn_showAlert("CW10081", "이월 처리시 계획년월");
				return false;
			}
		} else {
			// [${}] 이전은 선택할 수 없습니다.
			gfn_showAlert("CW10081", "이월 처리시 현재월" );
			//div_yearMon.cb_yearf.Value = substr(gfn_getCurrDate(),4,2);
			return false;
		}
		
		// 낙찰(30)
		// 낙찰된 계획은 이월불가
		//if ( parent.ds_output.getColumn(parent.ds_output.row, "ZPRGFLG") == '30' )
		//{
			// [${}] 일 경우 이월처리가 안됩니다.
			//gfn_showAlert("CW10079", "낙찰된 계획" );
			//return false;
		//}
		
		// 납기예정일 확인 2012.11.16
		var arr = ['납품예정일','계획년월'];
		
		// 판매문서유형 값이 ZR일경우(zr이 머지????)
		if ( substr(parent.ds_output.GetColumn(parent.ds_output.row,'AUART'),0,2) != 'ZR' ) 
		{
			// 계획년월이 납기예정일보다 이후일경우
			if (ParseInt(zpym3) > ParseInt(substr(cal_deldat.Value,0,6))) 
			{
				// 기종이 null이 아니라면
				if (parent.ds_output.GetColumn(parent.ds_output.row, 'GTYPE') != '') 
				{
					// CW10036=${}은 ${} 이후로 입력하세요.
					gfn_showAlert('CW10036',arr);
					gfn_SetFocus(cal_deldat, "Y");
					return false;
				}
			}
		}
		
		// 납기예정일이 워킹데이와 다를경우에 처리
		var datefrom = substr(zpym3,0,4) + '-' + substr(zpym3,4,2) + '-01';
		var days = '';
		
		// znumber = 대수, zdeli = 단납기구분
		if (ParseInt(parent.ds_output.GetColumn(parent.ds_output.row,'ZNUMBER')) <= 2
			|| parent.ds_output.GetColumn(parent.ds_output.row,'ZDELI') == 'X'	// 단납기구분
			|| parent.ds_output.GetColumn(parent.ds_output.row,'ZDELI') == '1') 
		{
			days = '45';
		} else if (ParseInt(parent.ds_output.GetColumn(parent.ds_output.row,'ZNUMBER')) <= 5) 
		{
			days = '65';
		} else if (ParseInt(parent.ds_output.GetColumn(parent.ds_output.row,'ZNUMBER')) <= 10) 
		{
			days = '80';
		} else if (ParseInt(parent.ds_output.GetColumn(parent.ds_output.row,'ZNUMBER')) <= 20) 
		{
			days = '100';
		} else 
		{
			days = '140';
		}
	
	
		http.Sync = true;
	
		destroy("ds_deldat");
		create("dataset", "ds_deldat");
		ds_deldat.addColumn("C_WORKINGDAY", "STRING", 256);
		
		var arg = "I_DATE_FROM="+quote(datefrom);
			arg += " I_DAYS="+quote(days);
			arg += " I_WERKS="+quote(1000);
			
		// 서비스 호출
		callServiceN("deldat"							// srvId
					, "sbp0160_N/deldat"				// url
					, ""								// inDsList
					, "ds_deldat=ds_deldat"				// outDsList
					, arg								// strParam
					, ""								// CallBackFunc
					);
	
		http.Sync = false;
	
		// 납기예정일 workingday
		if(ds_deldat.rowcount() > 0) 
		{
			// 워킹데이가 입력한 납기예정일보다 이후라면 
			// 변경처리하고 메시지처리
			if (ParseInt(ds_deldat.GetColumn(0,'C_WORKINGDAY')) > ParseInt(cal_deldat.Value) )
			{
				gfn_showAlert( "CE10005", ds_deldat.GetColumn(0,"C_WORKINGDAY") );
				
				cal_deldat.Value = ds_deldat.GetColumn(0,"C_WORKINGDAY");
				gfn_SetFocus(cal_deldat, "");
				return false;
			}
		} // end if
	
	}

	// 미입찰 && 낙찰사정보등록 시
	if (cb_sorltP.value == '73' && chk_flg.Value == "Y")
	{
		if (length(trim(cal_bddat.Value)) == 0)
		{
			// CW00208 : [${}](은)는 필수 입력 사양입니다.\n확인하여 주십시오.
			gfn_showAlert( "CW00208", "입찰예정일" );
			gfn_SetFocus(cal_bddat, "");
			return false;
		}

		if (length(trim(cb_zsec.Value)) == 0)
		{
			// CW00208 : [${}](은)는 필수 입력 사양입니다.\n확인하여 주십시오.
			gfn_showAlert( "CW00208", "낙찰사" );
			gfn_SetFocus(cb_zsec, "");
			return false;
		}

		if (length(trim(ed_sbdam.Text)) == 0 || ed_sbdam.Value == 0)
		{
			// CW00208 : [${}](은)는 필수 입력 사양입니다.\n확인하여 주십시오.
			gfn_showAlert( "CW00208", "낙찰가" );
			gfn_SetFocus(ed_sbdam, "");
			return false;
		}
	}

	return true;
}

/********************************************************************************
*  타사낙찰정보 체크 시
********************************************************************************/
function chk_flg_OnClick(obj,strValue)
{
	cb_zsec.Enable   = false;
	ed_sbdam.Enable  = false;
	cal_bddat.Enable = false;

	if (strValue == "Y")
	{
		cb_zsec.Enable   = true;
		ed_sbdam.Enable  = true;
		cal_bddat.Enable = true;
	}
}
]]></Script>
</Window>