<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hdel.sd.com.dao.DutyND">
	<resultMap id="DutyResult" type="hdel.sd.com.domain.Duty">
		<result property="MANDT" column="MANDT"/>
		<result property="BLOCKNO" column="BLOCKNO"/>
		<result property="BLOCKNM" column="BLOCKNM"/>
		<result property="GTYPE" column="GTYPE"/>
		<result property="BLOCKGBN" column="BLOCKGBN"/>
		<result property="ZPORDR" column="ZPORDR"/>
		<result property="ZPRDGBN" column="ZPRDGBN"/>
		<result property="SPEC1" column="SPEC1"/>
		<result property="SPECESS1" column="SPECESS1"/>
		<result property="SPECDEFV1" column="SPECDEFV1"/>
		<result property="SPEC2" column="SPEC2"/>
		<result property="SPECESS2" column="SPECESS2"/>
		<result property="SPECDEFV2" column="SPECDEFV2"/>
		<result property="SPEC3" column="SPEC3"/>
		<result property="SPECESS3" column="SPECESS3"/>
		<result property="SPECDEFV3" column="SPECDEFV3"/>
		<result property="SPEC4" column="SPEC4"/>
		<result property="SPECESS4" column="SPECESS4"/>
		<result property="SPECDEFV4" column="SPECDEFV4"/>
		<result property="SPEC5" column="SPEC5"/>
		<result property="SPECESS5" column="SPECESS5"/>
		<result property="SPECDEFV5" column="SPECDEFV5"/>
		<result property="SPEC6" column="SPEC6"/>
		<result property="SPECESS6" column="SPECESS6"/>
		<result property="SPECDEFV6" column="SPECDEFV6"/>
		<result property="SPEC7" column="SPEC7"/>
		<result property="SPECESS7" column="SPECESS7"/>
		<result property="SPECDEFV7" column="SPECDEFV7"/>
		<result property="SPEC8" column="SPEC8"/>
		<result property="SPECESS8" column="SPECESS8"/>
		<result property="SPECDEFV8" column="SPECDEFV8"/>
		<result property="SPEC9" column="SPEC9"/>
		<result property="SPECESS9" column="SPECESS9"/>
		<result property="SPECDEFV9" column="SPECDEFV9"/>
		<result property="SPEC10" column="SPEC10"/>
		<result property="SPECESS10" column="SPECESS10"/>
		<result property="SPECDEFV10" column="SPECDEFV10"/>
		<result property="SPEC11" column="SPEC11"/>
		<result property="SPECESS11" column="SPECESS11"/>
		<result property="SPECDEFV11" column="SPECDEFV11"/>
		<result property="SPEC12" column="SPEC12"/>
		<result property="SPECESS12" column="SPECESS12"/>
		<result property="SPECDEFV12" column="SPECDEFV12"/>
		<result property="SPEC13" column="SPEC13"/>
		<result property="SPECESS13" column="SPECESS13"/>
		<result property="SPECDEFV13" column="SPECDEFV13"/>
		<result property="SPEC14" column="SPEC14"/>
		<result property="SPECESS14" column="SPECESS14"/>
		<result property="SPECDEFV14" column="SPECDEFV14"/>
		<result property="SPEC15" column="SPEC15"/>
		<result property="SPECESS15" column="SPECESS15"/>
		<result property="SPECDEFV15" column="SPECDEFV15"/>
		<result property="SPEC16" column="SPEC16"/>
		<result property="SPECESS16" column="SPECESS16"/>
		<result property="SPECDEFV16" column="SPECDEFV16"/>
		<result property="SPEC17" column="SPEC17"/>
		<result property="SPECESS17" column="SPECESS17"/>
		<result property="SPECDEFV17" column="SPECDEFV17"/>
		<result property="SPEC18" column="SPEC18"/>
		<result property="SPECESS18" column="SPECESS18"/>
		<result property="SPECDEFV18" column="SPECDEFV18"/>
		<result property="SPEC19" column="SPEC19"/>
		<result property="SPECESS19" column="SPECESS19"/>
		<result property="SPECDEFV19" column="SPECDEFV19"/>
		<result property="SPEC20" column="SPEC20"/>
		<result property="SPECESS20" column="SPECESS20"/>
		<result property="SPECDEFV20" column="SPECDEFV20"/>
		<result property="OUT1" column="OUT1"/>
		<result property="OUT2" column="OUT2"/>
		<result property="OUT3" column="OUT3"/>
		<result property="OUT4" column="OUT4"/>
		<result property="OUT5" column="OUT5"/>
		<result property="OUT6" column="OUT6"/>
		<result property="OUT7" column="OUT7"/>
		<result property="OUT8" column="OUT8"/>
		<result property="OUT9" column="OUT9"/>
		<result property="OUT10" column="OUT10"/>
		<result property="ZRMK" column="ZRMK"/>
	</resultMap>
	<resultMap id="DutyDResult" type="hdel.sd.com.domain.DutyDet">
		<result property="MANDT" column="MANDT"/>
		<result property="BLOCKNO" column="BLOCKNO"/>
		<result property="ZSEQ" column="ZSEQ"/>
		<result property="SPEC1" column="SPEC1"/>
		<result property="SPEC2" column="SPEC2"/>
		<result property="SPEC3" column="SPEC3"/>
		<result property="SPEC4" column="SPEC4"/>
		<result property="SPEC5" column="SPEC5"/>
		<result property="SPEC6" column="SPEC6"/>
		<result property="SPEC7" column="SPEC7"/>
		<result property="SPEC8" column="SPEC8"/>
		<result property="SPEC9" column="SPEC9"/>
		<result property="SPEC10" column="SPEC10"/>
		<result property="SPEC11" column="SPEC11"/>
		<result property="SPEC12" column="SPEC12"/>
		<result property="SPEC13" column="SPEC13"/>
		<result property="SPEC14" column="SPEC14"/>
		<result property="SPEC15" column="SPEC15"/>
		<result property="SPEC16" column="SPEC16"/>
		<result property="SPEC17" column="SPEC17"/>
		<result property="SPEC18" column="SPEC18"/>
		<result property="SPEC19" column="SPEC19"/>
		<result property="SPEC20" column="SPEC20"/>
		<result property="OUT1" column="OUT1"/>
		<result property="OUT2" column="OUT2"/>
		<result property="OUT3" column="OUT3"/>
		<result property="OUT4" column="OUT4"/>
		<result property="OUT5" column="OUT5"/>
		<result property="OUT6" column="OUT6"/>
		<result property="OUT7" column="OUT7"/>
		<result property="OUT8" column="OUT8"/>
		<result property="OUT9" column="OUT9"/>
		<result property="OUT10" column="OUT10"/>
		<result property="ZRMK" column="ZRMK"/>
	</resultMap>
	<select id="selectDuty" parameterType="map" resultMap="DutyResult">
	<![CDATA[
		SELECT	A.MANDT
			 ,	A.BLOCKNO
			 ,	B.BLOCKNM
			 ,	A.GTYPE
			 ,	A.BLOCKGBN
			 ,	A.ZPRDGBN
			 ,	A.SPEC1
			 ,	A.SPECESS1
			 ,	A.SPECDEFV1
			 ,	A.SPEC2
			 ,	A.SPECESS2
			 ,	A.SPECDEFV2
			 ,	A.SPEC3
			 ,	A.SPECESS3
			 ,	A.SPECDEFV3
			 ,	A.SPEC4
			 ,	A.SPECESS4
			 ,	A.SPECDEFV4
			 ,	A.SPEC5
			 ,	A.SPECESS5
			 ,	A.SPECDEFV5
			 ,	A.SPEC6
			 ,	A.SPECESS6
			 ,	A.SPECDEFV6
			 ,	A.SPEC7
			 ,	A.SPECESS7
			 ,	A.SPECDEFV7
			 ,	A.SPEC8
			 ,	A.SPECESS8
			 ,	A.SPECDEFV8
			 ,	A.SPEC9
			 ,	A.SPECESS9
			 ,	A.SPECDEFV9
			 ,	A.SPEC10
			 ,	A.SPECESS10
			 ,	A.SPECDEFV10
			 ,	A.SPEC11
			 ,	A.SPECESS11
			 ,	A.SPECDEFV11
			 ,	A.SPEC12
			 ,	A.SPECESS12
			 ,	A.SPECDEFV12
			 ,	A.SPEC13
			 ,	A.SPECESS13
			 ,	A.SPECDEFV13
			 ,	A.SPEC14
			 ,	A.SPECESS14
			 ,	A.SPECDEFV14
			 ,	A.SPEC15
			 ,	A.SPECESS15
			 ,	A.SPECDEFV15
			 ,	A.SPEC16
			 ,	A.SPECESS16
			 ,	A.SPECDEFV16
			 ,	A.SPEC17
			 ,	A.SPECESS17
			 ,	A.SPECDEFV17
			 ,	A.SPEC18
			 ,	A.SPECESS18
			 ,	A.SPECDEFV18
			 ,	A.SPEC19
			 ,	A.SPECESS19
			 ,	A.SPECDEFV19
			 ,	A.SPEC20
			 ,	A.SPECESS20
			 ,	A.SPECDEFV20
			 ,	A.OUT1
			 ,	A.OUT2
			 ,	A.OUT3
			 ,	A.OUT4
			 ,	A.OUT5
			 ,	A.OUT6
			 ,	A.OUT7
			 ,	A.OUT8
			 ,	A.OUT9
			 ,	A.OUT10
			 ,	A.ZRMK
		  FROM	SAPHEE.ZSDTDUTY A
/*    INNER JOIN  SAPHEE.ZSDTDUTYT B  */
    LEFT JOIN  SAPHEE.ZSDTDUTYT B
		  ON 1=1
		  AND A.MANDT = B.MANDT
		  AND A.BLOCKNO = B.BLOCKNO
		 WHERE	A.MANDT		= #{mandt}
	]]>
		<if test="lang != null and lang != '' "> AND B.SPRAS = #{lang} </if>
		<if test="lang == null or  lang == '' "> AND B.SPRAS = '3'     </if>
		   <if test="anyType == true "> AND	(A.GTYPE = #{gtype} or A.GTYPE = '') </if>
		   <if test="anyType != true "> AND	A.GTYPE = #{gtype} </if>
 		   <if test='zflg == "0" or zflg == "1" or zflg == "2"'>
 		   		AND ZFLG IN (#{zflg},'Q','A') /*E-GIS,견적,공통 */
 		   </if>
 		   <if test='zflg == "Q"'>
		   		AND ZFLG IN ('Q','A')
		   </if>
 		   <if test='zflg == "P"'>
		   		AND ZFLG IN ('P','A')
		   </if>
 		   <if test="zflg == null || zflg == ''">
		   		AND ZFLG IN ('Q','A')
		   </if> 
		   AND	A.BLOCKGBN	LIKE '%' || #{blockgbn} || '%'
		   <if test="!lstExcpBlockNo.isEmpty()">
		   	AND A.BLOCKNO not in <foreach collection="lstExcpBlockNo" item="blockno" open="(" close=")" separator=",">#{blockno}</foreach>
		   </if>
		 ORDER
			BY	A.BLOCKGBN	ASC
			 ,	A.ZPORDR		ASC
			 ,	A.BLOCKNO		ASC
	</select>
	<select id="selectDutydList" parameterType="map" resultMap="DutyDResult">
		SELECT	MANDT
			 ,	BLOCKNO
			 ,	ZSEQ
			 ,	SPEC1
			 ,	SPEC2
			 ,	SPEC3
			 ,	SPEC4
			 ,	SPEC5
			 ,	SPEC6
			 ,	SPEC7
			 ,	SPEC8
			 ,	SPEC9
			 ,	SPEC10
			 ,	SPEC11
			 ,	SPEC12
			 ,	SPEC13
			 ,	SPEC14
			 ,	SPEC15
			 ,	SPEC16
			 ,	SPEC17
			 ,	SPEC18
			 ,	SPEC19
			 ,	SPEC20
			 ,	OUT1
			 ,	OUT2
			 ,	OUT3
			 ,	OUT4
			 ,	OUT5
			 ,	OUT6
			 ,	OUT7
			 ,	OUT8
			 ,	OUT9
			 ,	OUT10
			 ,	ZRMK
		  FROM	SAPHEE.ZSDTDUTYD
		 WHERE	MANDT	= #{mandt}
		   AND	BLOCKNO	IN (
		                   SELECT BLOCKNO
		                   FROM   SAPHEE.ZSDTDUTY
		                   WHERE  MANDT = #{mandt}
						   <if test="anyType == true "> AND	(GTYPE = #{gtype} or GTYPE = '') </if>
						   <if test="anyType != true "> AND	GTYPE = #{gtype} </if>
				 		   <if test='zflg == "0" or zflg == "1" or zflg == "2"'>
				 		   		AND ZFLG IN (#{zflg},'Q','A') /*E-GIS,견적,공통 */
				 		   </if>
				 		   <if test='zflg == "Q"'>
				 		   		AND ZFLG IN ('Q','A')   /*견적,공통 */
				 		   </if>
				 		   <if test='zflg == "P"'>
				 		   		AND ZFLG IN ('P','A')  /*수주,공통 */
				 		   </if>
		                     AND  BLOCKGBN LIKE '%' || #{blockgbn} || '%'
		                   )
		<if test="!lstExcpBlockNo.isEmpty()">
			AND BLOCKNO not in <foreach collection="lstExcpBlockNo" item="blockno" open="(" close=")" separator=",">#{blockno}</foreach>
		</if>
		 ORDER
			BY	BLOCKNO ASC
			 ,	ZSEQ ASC
		 WITH UR
	</select>
	<select id="selectError" parameterType="map" resultType="map">
		SELECT	D.CLASS
			 ,	CASE CLASS
				WHEN 'ELV_01'	THEN 'Elevator'
				WHEN 'ELV_02'	THEN 'Ship'
				WHEN 'AP_01'	THEN 'Parking'
				WHEN 'ESC_01'	THEN 'Escalator'
				WHEN 'MW_01'	THEN 'Moving Walk'
				WHEN 'PSD_01'	THEN 'PSD'
				WHEN 'SHN_01'	THEN 'Elevator (SHG)'
				WHEN 'SHN_02'	THEN 'Escalator (SHG)'
				WHEN 'SV_01'	THEN 'Monitoring'
				WHEN 'SP_01'	THEN 'Spare Part'
				WHEN 'DW_01'	THEN 'D/W'
				WHEN 'COST_EL'	THEN 'Cost'
				WHEN 'WL_01'	THEN 'W/L'
				ELSE 'Etc'
				END AS CLASSNM
			 ,	B.ATKLA
			 ,	B.ATNAM
			 ,	C.ATBEZ
		  FROM	SAPHEE.KSML AS A
				INNER JOIN			SAPHEE.CABN AS B	ON A.MANDT = B.MANDT	AND A.IMERK = B.ATINN
				LEFT OUTER JOIN		SAPHEE.CABNT AS C	ON B.MANDT = C.MANDT	AND B.ATINN = C.ATINN
					<if test="lang != null and lang != '' "> AND C.SPRAS = #{lang} </if>
					<if test="lang == null or  lang == '' "> AND C.SPRAS = '3'     </if>
				INNER JOIN			SAPHEE.KLAH AS D	ON A.MANDT = D.MANDT	AND A.CLINT = D.CLINT
		 WHERE	A.MANDT	= #{mandt}
		   AND	A.KLART	= '300'
		   AND	D.CLASS	= #{class}
		   AND	B.ATNAM	= #{atnam}
	</select>
	<select id="getIldat" parameterType="map" resultType="com.sap.domain.Datum">
		with vbap as (
			select mandt, hogi,
				case matnr 
					when 'L-1000' then 'C'	--출입구
					when 'S-1000' then 'A'	--TM/CP
					when 'W-1000' then 'A'	--TM/CP
					else ''
				end as block
			from saphee.vbap
			where mandt=#{mandt}
				and vbeln=#{vbeln}
				and posnr=#{posnr}
		)
		select zppt027.ildat	--, vbap.hogi, vbap.block 
		from vbap
			left join saphee.zppt027 as zppt027 on vbap.mandt=zppt027.mandt and vbap.hogi=zppt027.posid and zppt027.activ='05' and vbap.block=zppt027.block and zppt027.gubun='02'
		with ur
	</select>
</mapper>