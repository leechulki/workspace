<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hdel.sd.sso.dao.Sso0055ND">
  
  	<resultMap id="SearchProjectMap" type="hdel.sd.sso.domain.ZSDS0063"></resultMap>
    
	<!-- 수주헤더 조회 -->	
	<select id="SelectProject" parameterType="hdel.sd.sso.domain.ZSDS0063" resultMap="SearchProjectMap"> 
		SELECT  A.MANDT
			   ,A.VBELN
		       ,A.ZZPJT_ID AS PSPID
		       ,0 AS SEQ
		       ,A.AUART
		       ,A.SPART
		       ,A.VKBUR
		       ,D.BEZEI AS VKBURT
		       ,(SELECT KUNNR FROM SAPHEE.VBPA 
		                      WHERE MANDT = #{MANDT} 
		                      AND VBELN = A.VBELN 
		                      AND PARVW = 'Z2') AS ZKUNNR
		       ,'' AS ZKUNNRT
		       ,(SELECT KUNNR FROM SAPHEE.VBPA 
		                      WHERE MANDT = #{MANDT} 
		                      AND VBELN = A.VBELN 
		                      AND PARVW = 'RG') AS KUNRG
		       ,(SELECT NAME1 FROM SAPHEE.VBPA AS PA INNER JOIN SAPHEE.KNA1 AS A1 
		                                             ON  PA.MANDT = A1.MANDT 
		                                             AND PA.KUNNR = A1.KUNNR 
		                      WHERE PA.MANDT = #{MANDT} 
		                      AND PA.VBELN = A.VBELN 
		                      AND PA.PARVW = 'RG') AS KUNRG_NM   
		       ,C.KUNNR AS KUNWE
		       ,C.NAME1 AS KUNWE_NM
		       ,'' AS KUNZ1
		       ,'' AS KUNZ2
		       ,'' AS KUNZ3
		       ,'' AS TELF1
		       ,A.BSTNK
		       ,'' AS BRAN1
		       ,SUBSTR(A.BSTDK,1,4)||'-'||SUBSTR(A.BSTDK,5,2)||'-'||SUBSTR(A.BSTDK,7,2) AS BSTDK
		       ,A.ZQNTY
		       ,A.NETWR
		       ,0 AS WAVWR
		       ,0 AS COMMI
		       ,SUBSTR(A.VDATU,1,4)||'-'||SUBSTR(A.VDATU,5,2)||'-'||SUBSTR(A.VDATU,7,2) AS VDATU		    
		       ,A.WAERK
		       ,'' AS ZTERM
		       ,'' AS INCO1
		       ,'' AS INCO2
		       ,A.WWBLD
		       ,A.REPMO
		       ,A.GUAMO
		       ,SUBSTR(z1057.zapdat,1,4)||'-'||SUBSTR(z1057.zapdat,5,2)||'-'||SUBSTR(z1057.zapdat,7,2) AS ZAPDAT
		       ,SUBSTR(A.STADA,1,4)||'-'||SUBSTR(A.STADA,5,2)||'-'||SUBSTR(A.STADA,7,2) AS STADA
		       ,A.WORMO
		       ,A.REGION
		       ,A.HIGH_G
		       ,A.ADMITNO
		       ,A.CHEOR
		       ,SUBSTR(A.COMPL_DA,1,4)||'-'||SUBSTR(A.COMPL_DA,5,2)||'-'||SUBSTR(A.COMPL_DA,7,2) AS COMPL_DA
		       ,SUBSTR(A.FINAL_DA,1,4)||'-'||SUBSTR(A.FINAL_DA,5,2)||'-'||SUBSTR(A.FINAL_DA,7,2) AS FINAL_DA
		       ,A.ENFOR
		       ,A.TURNKEY
		       ,A.KISCON
		       ,A.HEL_REG
		       ,F.QTNUM AS LIFNR 
		       ,G.LANDX AS LIFNR2
		       ,A.LIFNR3
		       ,A.LIFNRCHK
		       ,A.REG_NO
		       ,A.REG_PE
		       ,A.EMAIL
		       ,A.SOCNO
		       ,A.CORNO
		       ,A.COMNO
		       ,A.SEP_MON		       
		       ,'0000-00-00' AS CDATE
		       ,E.STEXT AS WWBLDT	
		       ,SUBSTR(A.CONTR_DA,1,4)||'-'||SUBSTR(A.CONTR_DA,5,2)||'-'||SUBSTR(A.CONTR_DA,7,2) AS CONTR_DA
		  FROM	SAPHEE.VBAK	AS A 
		  		INNER JOIN SAPHEE.VBPA AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN AND B.PARVW = 'WE'
		  		INNER JOIN SAPHEE.KNA1 AS C ON B.MANDT = C.MANDT AND B.KUNNR = C.KUNNR 
		  		INNER JOIN SAPHEE.TVKBT AS D ON A.MANDT = D.MANDT AND A.VKBUR = D.VKBUR AND D.SPRAS = '3'
		  		LEFT OUTER JOIN SAPHEE.ZSDT0008 AS E ON A.MANDT = E.MANDT AND A.WWBLD = E.BUILDUSE		
		  		LEFT OUTER JOIN SAPHEE.ZSDT1046 F ON A.MANDT = F.MANDT AND A.ZZPJT_ID = F.VBELN AND F.ZPRGFLG = '90' AND F.ZSOFLG = 'X'	
		  		INNER JOIN SAPHEE.T005T AS G ON B.MANDT = G.MANDT AND B.LAND1 = G.LAND1 AND G.SPRAS = '3'
		  		left join saphee.zsdt1057 as z1057 on f.mandt=z1057.mandt and f.qtnum=z1057.qtnum and z1057.zapflg='30'
		 WHERE A.MANDT	  = #{MANDT}
		   AND A.ZZPJT_ID = #{PSPID}		 
		WITH UR
	</select>
	
	<!-- 수주헤더 조회 -->	
	<select id="SelectProjectInput" parameterType="hdel.sd.sso.domain.ZSDS0063" resultMap="SearchProjectMap"> 
		SELECT VBELN
               , PSPID
			   , SEQ
			   , SPART
			   , BSTNK
			   , BSTDK
			   , ZQNTY
			   , CONTR_DA
			   , WAERK
			   , VDATU
			   , VKBUR
			   , AUART
			   , ADMITNO
			   , KUNRG
		       , KUNRG_NM
			   , KUNWE
			   , KUNWE_NM
			   , SUBSTR(ZAPDAT,1,4)||'-'||SUBSTR(ZAPDAT,5,2)||'-'||SUBSTR(ZAPDAT,7,2) AS ZAPDAT
			   , SUBSTR(STADA,1,4)||'-'||SUBSTR(STADA,5,2)||'-'||SUBSTR(STADA,7,2) AS STADA
			   , '' AS ERDAT
			   , DECODE((SELECT COUNT(*) FROM SAPHEE.ZSDT0090 WHERE MANDT = #{MANDT} AND PSPID = #{PSPID} AND SEQ = (#{SEQ} - 1) AND FINL = 'X'), '0', 'INPUT', 'OK') AS KUNZ1 /* 차수가 생성된 자료라는 표시 */
			   , KUNNR AS ZKUNNR
		  FROM (SELECT A.VBELN
		               , A.ZZPJT_ID AS PSPID
					   , 0 AS SEQ
					   , A.SPART
					   , A.BSTNK
					   , SUBSTR(A.BSTDK,1,4)||'-'||SUBSTR(A.BSTDK,5,2)||'-'||SUBSTR(A.BSTDK,7,2) AS BSTDK
					   , A.ZQNTY
					   , SUBSTR(A.CONTR_DA,1,4)||'-'||SUBSTR(A.CONTR_DA,5,2)||'-'||SUBSTR(A.CONTR_DA,7,2) AS CONTR_DA
					   , A.WAERK
					   , SUBSTR(A.VDATU,1,4)||'-'||SUBSTR(A.VDATU,5,2)||'-'||SUBSTR(A.VDATU,7,2) AS VDATU
					   , A.VKBUR
					   , A.AUART
					   , A.RECAD_DA AS ADMITNO
					   ,(SELECT KUNNR FROM SAPHEE.VBPA 
				                      WHERE MANDT = #{MANDT} 
				                      AND VBELN = A.VBELN 
				                      AND PARVW = 'RG') AS KUNRG
				       ,(SELECT NAME1 FROM SAPHEE.VBPA AS PA INNER JOIN SAPHEE.KNA1 AS A1 
				                                             ON  PA.MANDT = A1.MANDT 
				                                             AND PA.KUNNR = A1.KUNNR 
				                      WHERE PA.MANDT = #{MANDT} 
				                      AND PA.VBELN = A.VBELN 
				                      AND PA.PARVW = 'RG') AS KUNRG_NM
					   , C.KUNNR AS KUNWE
					   , C.NAME1 AS KUNWE_NM
					   , (SELECT ZAPDAT 
					        FROM SAPHEE.ZSDT1057 AS Z57 INNER JOIN SAPHEE.VBAP AS AP ON Z57.MANDT = AP.MANDT AND Z57.QTNUM = AP.QTNUM
					       WHERE Z57.MANDT = #{MANDT}
					         AND Z57.ZRQFLG = '1'
					         AND Z57.ZAPFLG = '30'
					         AND AP.VBELN = A.VBELN 
					       FETCH FIRST 1 ROW ONLY) AS ZAPDAT
					   , (SELECT QTDAT FROM SAPHEE.ZSDT1046 WHERE MANDT = #{MANDT} AND VBELN = A.ZZPJT_ID ) AS STADA
					   , E.KUNNR
				  FROM SAPHEE.VBAK AS A INNER JOIN SAPHEE.VBPA AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN AND B.PARVW = 'WE'
					   INNER JOIN SAPHEE.KNA1 AS C ON B.MANDT = C.MANDT AND B.KUNNR = C.KUNNR
					   INNER JOIN SAPHEE.VBPA AS D ON A.MANDT = D.MANDT AND A.VBELN = D.VBELN AND D.PARVW = 'Z2'
			   		   INNER JOIN SAPHEE.KNA1 AS E ON D.MANDT = E.MANDT AND D.KUNNR = E.KUNNR
		 	 	 WHERE A.MANDT = #{MANDT}
				   AND A.ZZPJT_ID = #{PSPID})
		  WITH UR
	</select>
		
	<!-- 견적일 견적승인일 조회 -->	
	<select id="SelectQtdat" parameterType="hdel.sd.sso.domain.ZSDS0063" resultMap="SearchProjectMap"> 
		
		SELECT SUBSTR(B.QTDAT,1,4)||'-'||SUBSTR(B.QTDAT,5,2)||'-'||SUBSTR(B.QTDAT,7,2) AS STADA
		      ,SUBSTR(C.ZAPDAT,1,4)||'-'||SUBSTR(C.ZAPDAT,5,2)||'-'||SUBSTR(C.ZAPDAT,7,2) AS ZAPDAT
		FROM    SAPHEE.VBAK AS A INNER JOIN SAPHEE.ZSDT1046 AS B ON A.MANDT = B.MANDT AND A.ZZPJT_ID = B.VBELN
                                 LEFT OUTER JOIN SAPHEE.ZSDT1057 AS C ON B.MANDT = C.MANDT AND B.QTNUM = C.QTNUM AND C.ZRQFLG = '1' AND C.ZAPFLG = '30'
		WHERE A.MANDT	 = #{MANDT}
		AND   A.ZZPJT_ID = #{PSPID}
		WITH UR
	</select>
	
	<resultMap id="SearchHeaderMap" type="hdel.sd.sso.domain.ZSDT0090"></resultMap>  
  
	<!-- 계약변경 헤더 조회 -->	
	<select id="SelectHeader" parameterType="hdel.sd.sso.domain.ZSDT0090" resultMap="SearchHeaderMap"> 
		SELECT  A.MANDT
		    	 ,A.VBELN
				 ,A.PSPID
				 ,A.SEQ
				 ,A.ZQNTY
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY' THEN A.NETWR * 100 ELSE A.NETWR END AS NETWR
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.WAVWR * 100 ELSE A.WAVWR END AS WAVWR
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.COMMI * 100 ELSE  A.COMMI END AS COMMI
		         ,SUBSTR(A.VDATU,1,4)||'-'||SUBSTR(A.VDATU,5,2)||'-'||SUBSTR(A.VDATU,7,2) AS VDATU
		         ,A.WAERK
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.CHNETWR * 100 ELSE A.CHNETWR END AS CHNETWR
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.CHWAVWR * 100 ELSE A.CHWAVWR END AS CHWAVWR
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.CHCOMMI * 100 ELSE A.CHCOMMI END AS CHCOMMI
		         ,SUBSTR(A.CHVDATU,1,4)||'-'||SUBSTR(A.CHVDATU,5,2)||'-'||SUBSTR(A.CHVDATU,7,2) AS CHVDATU
		         ,A.CHWAERK
				 ,A.FINL
				 ,A.BIGO1
				 ,A.BIGO2
				 ,A.BIGO3
				 ,A.BIGO4
				 ,A.BIGO5
				 ,A.CHRES
				 ,A.REDEP
				 ,A.CHRES_A
				 ,A.REDEP_A
				 ,A.CHRES_B
				 ,A.REDEP_B
				 ,A.CHRES_C
				 ,A.REDEP_C
				 ,A.CHRES_D
				 ,A.REDEP_D
				 ,A.CHRES_E
				 ,A.REDEP_E
		         ,SUBSTR(A.ERDAT,1,4)||'-'||SUBSTR(A.ERDAT,5,2)||'-'||SUBSTR(A.ERDAT,7,2) AS ERDAT
		         ,SUBSTR(A.ERZET,1,2)||':'||SUBSTR(A.ERZET,3,2)||':'||SUBSTR(A.ERZET,5,2) AS ERZET
		         ,A.ERNAM		
		         ,SUBSTR(A.AEDAT,1,4)||'-'||SUBSTR(A.AEDAT,5,2)||'-'||SUBSTR(A.AEDAT,7,2) AS AEDAT
		         ,SUBSTR(A.AEZET,1,2)||':'||SUBSTR(A.AEZET,3,2)||':'||SUBSTR(A.AEZET,5,2) AS AEZET
		         ,A.AENAM		
		         ,A.SHCHK
		         ,A.CHSHCHK		
		         ,A.UCH_DUTY
		  FROM	SAPHEE.ZSDT0090	AS A		  						
		 WHERE  A.MANDT	  = #{MANDT}
		   AND  A.PSPID = #{PSPID}		 
		   AND  A.SEQ     = #{SEQ}
		WITH UR
	</select>
	
	<!-- 계약변경 헤더 생성 -->	
	<select id="SelectHeaderInput" parameterType="hdel.sd.sso.domain.ZSDT0090" resultMap="SearchHeaderMap"> 
		SELECT B.MANDT
		       , B.VBELN
		       , B.PSPID
		       , B.SEQ
		       , B.ZQNTY
		       , CASE WHEN B.WAERK = 'KRW' OR B.WAERK = 'JPY' THEN B.NETWR * 100 ELSE B.NETWR END AS NETWR
		       , CASE WHEN B.WAERK = 'KRW' OR B.WAERK = 'JPY' THEN B.WAVWR * 100 ELSE B.WAVWR END AS WAVWR
		       , CASE WHEN B.WAERK = 'KRW' OR B.WAERK = 'JPY' THEN B.COMMI * 100 ELSE B.COMMI END AS COMMI
               , B.VDATU
               , B.WAERK
               , CASE WHEN B.WAERK = 'KRW' OR B.WAERK = 'JPY' THEN B.NETWR * 100 ELSE B.NETWR END AS CHNETWR
		       , CASE WHEN B.WAERK = 'KRW' OR B.WAERK = 'JPY' THEN B.WAVWR * 100 ELSE B.WAVWR END AS CHWAVWR
		       , CASE WHEN B.WAERK = 'KRW' OR B.WAERK = 'JPY' THEN B.COMMI * 100 ELSE B.COMMI END AS CHCOMMI
		       , B.VDATU AS CHVDATU
		       , B.WAERK AS CHWAERK
		       , '' AS FINL
		       , '' AS BIGO1
		       , '' AS BIGO2
		       , '' AS BIGO3
		       , '' AS BIGO4
		       , '' AS BIGO5
		       , '' AS CHRES
		       , '' AS REDEP
		       , '' AS CHRES_A
		       , '' AS REDEP_A
		       , '' AS CHRES_B
		       , '' AS REDEP_B
		       , '' AS CHRES_C
		       , '' AS REDEP_C
		       , '' AS CHRES_D
		       , '' AS REDEP_D
		       , '' AS CHRES_E
		       , '' AS REDEP_E
		       , '' AS ERDAT
		       , '' AS ERNAM
		       , B.SHCHK
		       , B.SHCHK AS CHSHCHK
		       , C.UCH_DUTY AS UCH_DUTY		       
		  FROM (SELECT A.MANDT
				       , VBELN
		               , ZZPJT_ID AS PSPID
		               , CAST(#{SEQ} AS VARCHAR(3)) AS SEQ
		               , ZQNTY
		               , NETWR
		               , (SELECT SUM(WAVWR) FROM SAPHEE.VBAP WHERE MANDT = #{MANDT} AND VBELN = A.VBELN ) AS WAVWR
		               , (SELECT SUM(KZWI4) FROM SAPHEE.VBAP WHERE MANDT = #{MANDT} AND VBELN = A.VBELN ) AS COMMI
		               , SUBSTR(VDATU,1,4)||'-'||SUBSTR(VDATU,5,2)||'-'||SUBSTR(VDATU,7,2) AS VDATU
		               , WAERK
		               , SHCHK
		          FROM SAPHEE.VBAK AS A 
		         WHERE A.MANDT = #{MANDT}
		           AND A.ZZPJT_ID = #{PSPID}) AS B
			left join SAPHEE.ZSDT0090 AS C on B.MANDT = C.MANDT AND B.PSPID = C.PSPID AND C.SEQ = (B.SEQ-1)
         WITH UR
	</select>
		
	<resultMap id="SearchItemMap" type="hdel.sd.sso.domain.ZSDT0091"></resultMap>  
  
	<!-- 계약변경 아이템 조회 -->	
	<select id="SelectItem" parameterType="hdel.sd.sso.domain.ZSDT0091" resultMap="SearchItemMap"> 
		SELECT    A.MANDT
		    	 ,A.VBELN
				 ,A.PSPID    
				 ,A.SEQ      
				 ,A.POSNR    
				 ,A.HOGI     
				 ,A.AUART    
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.KZWI4 * 100 ELSE  A.KZWI4 END AS KZWI4    
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.NETWR * 100 ELSE A.NETWR END AS NETWR
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.WAVWR * 100 ELSE A.WAVWR END AS WAVWR
		         ,SUBSTR(A.EDATU,1,4)||'-'||SUBSTR(A.EDATU,5,2)||'-'||SUBSTR(A.EDATU,7,2) AS EDATU
				 ,A.REPMO    
				 ,A.GUAMO    
				 ,A.WORMO    
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.CHNETWR * 100 ELSE A.CHNETWR END AS CHNETWR  
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.CHWAVWR * 100 ELSE A.CHWAVWR END AS CHWAVWR
		         ,SUBSTR(A.CHEDATU,1,4)||'-'||SUBSTR(A.CHEDATU,5,2)||'-'||SUBSTR(A.CHEDATU,7,2) AS CHEDATU
		         ,A.CHREPMO  
				 ,A.CHGUAMO  
				 ,A.CHWORMO  
				 ,A.WAERK    
				 ,A.CHCK     
				 ,case A.HOGI_CANC when 'X' then 'C' else A.hogi_canc end as hogi_canc
				 ,A.SPEC_STAT
				 ,A.MATNR
				 ,A.CLASS
				 ,A.ARKTX
		         ,SUBSTR(A.ERDAT,1,4)||'-'||SUBSTR(A.ERDAT,5,2)||'-'||SUBSTR(A.ERDAT,7,2) AS ERDAT
		         ,A.ERNAM		
		         ,A.ABGRU
		         ,A.INCRTF_TP
                 ,TRIM(A.BRNDCD) AS BRNDCD
                 ,A.BRNDSEQ AS BRNDSEQ
                 ,NVL((SELECT SNDSYS FROM SAPHEE.ZSDT1140 WHERE MANDT = A.MANDT AND BRNDSEQ = A.BRNDSEQ AND ZPRDGBN = A.CLASS AND BRNDCD = A.BRNDCD), 'PDM') AS SNDSYS  
		  FROM	SAPHEE.ZSDT0091	AS A		  						
		 WHERE  A.MANDT	  = #{MANDT}
		   AND  A.PSPID = #{PSPID}		 
		   AND  A.SEQ     = #{SEQ}
		WITH UR
	</select>
	
	<!-- 계약변경 아이템 생성 -->	
	<select id="SelectItemInput" parameterType="hdel.sd.sso.domain.ZSDT0091" resultMap="SearchItemMap"> 
		SELECT   T.MANDT
		       , T.VBELN 
               , T.PSPID
               , T.SEQ
               , T.POSNR
               , T.HOGI
               , T.AUART
               , T.KZWI4
               , T.NETWR
               , T.WAVWR
               , T.EDATU
               , T.REPMO
               , T.GUAMO
               , T.WORMO
               , T.CHNETWR
               , T.CHWAVWR
               , T.CHEDATU
               , T.CHREPMO
               , T.CHGUAMO
               , T.CHWORMO
               , T.WAERK
               , T.CHCK
               , T.HOGI_CANC
               , T.MATNR
               , T.CLASS
               , T.ARKTX
               , T.ERDAT
		       , T.ERNAM
		       , T.ABGRU
               , T.BRNDCD
               , T.BRNDSEQ
			   , NVL((SELECT SNDSYS FROM SAPHEE.ZSDT1140 WHERE MANDT = T.MANDT AND BRNDSEQ = T.BRNDSEQ AND ZPRDGBN = T.CLASS AND BRNDCD = T.BRNDCD), 'PDM') AS SNDSYS  
        FROM    (
				SELECT   A.MANDT
					   , A.VBELN 
					   , A.ZZPJT_ID AS PSPID
					   , CAST(#{SEQ} AS VARCHAR(3)) AS SEQ
					   , B.POSNR
					   , B.HOGI
					   , A.AUART
					   , CASE WHEN B.WAERK = 'KRW' OR B.WAERK = 'JPY'  THEN B.KZWI4 * 100 ELSE  B.KZWI4 END AS KZWI4
					   , CASE WHEN B.WAERK = 'KRW' OR B.WAERK = 'JPY'  THEN B.NETWR * 100 ELSE  B.NETWR END AS NETWR
					   , CASE WHEN B.WAERK = 'KRW' OR B.WAERK = 'JPY'  THEN (B.KZWI5-B.KZWI4) * 100 ELSE  (B.KZWI5-B.KZWI4) END AS WAVWR
					   , SUBSTR(C.EDATU,1,4)||'-'||SUBSTR(C.EDATU,5,2)||'-'||SUBSTR(C.EDATU,7,2) AS EDATU
					   , B.REPMO
					   , B.GUAMO
					   , B.WORMO
					   , CASE WHEN B.WAERK = 'KRW' OR B.WAERK = 'JPY'  THEN B.NETWR * 100 ELSE  B.NETWR END AS CHNETWR
					   , CASE WHEN B.WAERK = 'KRW' OR B.WAERK = 'JPY'  THEN (B.KZWI5-B.KZWI4) * 100 ELSE  (B.KZWI5-B.KZWI4) END AS CHWAVWR
					   , SUBSTR(C.EDATU,1,4)||'-'||SUBSTR(C.EDATU,5,2)||'-'||SUBSTR(C.EDATU,7,2) AS CHEDATU
					   , B.REPMO AS CHREPMO
					   , B.GUAMO AS CHGUAMO
					   , B.WORMO AS CHWORMO
					   , A.WAERK
					   , '' AS CHCK
					   , CASE WHEN D.absta = 'A' THEN '' ELSE 'C' END AS HOGI_CANC
					   , B.MATNR
					   , CASE B.MATNR WHEN 'L-1000' THEN 'ELV_01'
									  WHEN 'L-1100' THEN 'WL_01'
									  WHEN 'L-1200' THEN 'DW_01'
									  WHEN 'L-2000' THEN 'ELV_02'
									  WHEN 'S-1000' THEN 'ESC_01'
									  WHEN 'W-1000' THEN 'MW_01'
									  WHEN 'J-1000' THEN 'AP_01'
									  WHEN 'T-1000' THEN 'SV_01'
									  WHEN 'Y-1000' THEN 'SP_01'
						 END AS CLASS
					   , B.ARKTX
					   , '' AS ERDAT
					   , '' AS ERNAM
					   , B.ABGRU
					   ,TRIM(B.BRNDCD) AS BRNDCD
					   ,B.BRNDSEQ AS BRNDSEQ
				  FROM SAPHEE.VBAK AS A INNER JOIN SAPHEE.VBAP AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN 
					   INNER JOIN SAPHEE.VBEP AS C ON B.MANDT= C.MANDT AND B.VBELN = C.VBELN AND B.POSNR = C.POSNR AND C.ETENR = '0001'
					   INNER JOIN SAPHEE.VBUP AS D ON B.MANDT = D.MANDT AND B.VBELN = D.VBELN AND B.POSNR = D.POSNR  
				 WHERE A.MANDT = #{MANDT}
				   AND A.ZZPJT_ID = #{PSPID}
                ) AS T
         ORDER BY T.HOGI
          WITH UR
	</select>
		
	<resultMap id="SearchBillOMap" type="hdel.sd.sso.domain.ZSDT0092"></resultMap>  
	<!-- 계약변경 현행청구계획 조회 -->	
	<select id="SelectBillO" parameterType="hdel.sd.sso.domain.ZSDT0092" resultMap="SearchBillOMap"> 
		SELECT  A.MANDT
		    	 ,A.VBELN
				 ,A.PSPID    
				 ,A.SEQ      
				 ,A.POSNR    
				 ,A.HOGI     
		         ,SUBSTR(A.FKDAT,1,4)||'-'||SUBSTR(A.FKDAT,5,2)||'-'||SUBSTR(A.FKDAT,7,2) AS FKDAT
		         ,A.MLBEZ
				 ,A.ZTERM
				 ,A.FKSAF
				 ,A.FPLTR
				 ,A.MSTXT
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.FAKWR * 100 ELSE A.FAKWR END AS FAKWR
				 ,A.WAERK    
		         ,SUBSTR(A.ERDAT,1,4)||'-'||SUBSTR(A.ERDAT,5,2)||'-'||SUBSTR(A.ERDAT,7,2) AS ERDAT
		         ,SUBSTR(A.ERZET,1,2)||':'||SUBSTR(A.ERZET,3,2)||':'||SUBSTR(A.ERDAT,5,2) AS ERZET
		         ,A.ERNAM
		         ,SUBSTR(A.AEDAT,1,4)||'-'||SUBSTR(A.AEDAT,5,2)||'-'||SUBSTR(A.AEDAT,7,2) AS AEDAT
		         ,SUBSTR(A.AEZET,1,2)||':'||SUBSTR(A.AEZET,3,2)||':'||SUBSTR(A.AEDAT,5,2) AS AEZET
		         ,A.AENAM				         		
		  FROM	SAPHEE.ZSDT0092	AS A		  						
		 WHERE  A.MANDT	  = #{MANDT}
		   AND  A.PSPID = #{PSPID}		 
		   AND  A.SEQ     = #{SEQ}
		   order by posnr, fkdat, mlbez
		WITH UR
	</select>
	
	<!-- 계약변경 현행청구계획 생성 -->	
	<select id="SelectBillOInput" parameterType="hdel.sd.sso.domain.ZSDT0092" resultMap="SearchBillOMap"> 
		SELECT A.MANDT
		       , A.VBELN 
               , A.ZZPJT_ID AS PSPID
               , CAST(#{SEQ} AS VARCHAR(3)) AS SEQ
               , B.POSNR
               , E.HOGI
               , SUBSTR(C.FKDAT,1,4)||'-'||SUBSTR(C.FKDAT,5,2)||'-'||SUBSTR(C.FKDAT,7,2) AS FKDAT
               , C.MLBEZ
               , C.ZTERM
               , CASE WHEN HOGI IS NULL THEN CASE WHEN COUNT(C.FKSAF) OVER(PARTITION BY C.FPLTR) -  
                                                       COUNT(C.FKSAF) OVER(PARTITION BY C.FPLTR, DECODE(LENGTH(TRIM(C.FKSAF)) , 0, 'A', C.FKSAF)) = 0 THEN 'A'
                                                  WHEN COUNT(C.FKSAF) OVER(PARTITION BY C.FPLTR) - 
                                                       COUNT(C.FKSAF) OVER(PARTITION BY C.FPLTR, DECODE(LENGTH(TRIM(C.FKSAF)) , 0, 'C', C.FKSAF)) = 0 THEN 'C'
                                             ELSE 'B'
                                             END
                 ELSE C.FKSAF
                 END FKSAF  
               , C.FPLTR
               , D.MSTXT
               , CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN C.FAKWR * 100 ELSE C.FAKWR END AS FAKWR
               , A.WAERK
               , '' AS ERDAT
               , '' AS ERZET
		       , '' AS ERNAM		
               , '' AS AEDAT
               , '' AS AEZET
		       , '' AS AENAM		       
		  FROM SAPHEE.VBAK AS A INNER JOIN SAPHEE.VBKD AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN 
		       INNER JOIN SAPHEE.FPLT AS C ON B.MANDT = C.MANDT AND B.FPLNR = C.FPLNR 
		       LEFT OUTER JOIN SAPHEE.T433T AS D ON C.MANDT = D.MANDT AND C.MLBEZ = D.MLSTN AND D.SPRAS = '3'
		       LEFT OUTER JOIN SAPHEE.VBAP AS E ON B.MANDT = E.MANDT AND B.VBELN = E.VBELN AND B.POSNR = E.POSNR
		 WHERE A.MANDT = #{MANDT}
		   AND A.ZZPJT_ID = #{PSPID}
		   order by posnr, fkdat, mlbez
		WITH UR
	</select>
	
	<resultMap id="SearchBillCMap" type="hdel.sd.sso.domain.ZSDT0093"></resultMap>  
	<!-- 계약변경 변경 청구계획 조회 -->	
	<select id="SelectBillC" parameterType="hdel.sd.sso.domain.ZSDT0093" resultMap="SearchBillCMap"> 
		SELECT  A.MANDT
		    	 ,A.VBELN
				 ,A.PSPID    
				 ,A.SEQ      
				 ,A.POSNR    
				 ,A.HOGI     
		         ,SUBSTR(A.CHFKDAT,1,4)||'-'||SUBSTR(A.CHFKDAT,5,2)||'-'||SUBSTR(A.CHFKDAT,7,2) AS CHFKDAT
		         ,A.CHMLBEZ
				 ,A.CHZTERM
				 ,A.CHFKSAF
				 ,A.FPLTR
				 ,A.CHMSTXT
				 ,CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN A.CHFAKWR * 100 ELSE A.CHFAKWR END AS CHFAKWR
				 ,A.WAERK    
		         ,SUBSTR(A.ERDAT,1,4)||'-'||SUBSTR(A.ERDAT,5,2)||'-'||SUBSTR(A.ERDAT,7,2) AS ERDAT
		         ,SUBSTR(A.ERZET,1,2)||':'||SUBSTR(A.ERZET,3,2)||':'||SUBSTR(A.ERZET,5,2) AS ERZET
		         ,A.ERNAM
		         ,SUBSTR(A.AEDAT,1,4)||'-'||SUBSTR(A.AEDAT,5,2)||'-'||SUBSTR(A.AEDAT,7,2) AS AEDAT
		         ,SUBSTR(A.AEZET,1,2)||':'||SUBSTR(A.AEZET,3,2)||':'||SUBSTR(A.AEZET,5,2) AS AEZET
		         ,A.AENAM				         		
		  FROM	SAPHEE.ZSDT0093	AS A		  						
		 WHERE  A.MANDT	  = #{MANDT}
		   AND  A.PSPID = #{PSPID}		 
		   AND  A.SEQ     = #{SEQ}
		   order by posnr, chfkdat,chmlbez
		WITH UR
	</select>

	<!-- 계약변경 변경 청구계획 생성 -->	
	<select id="SelectBillCInput" parameterType="hdel.sd.sso.domain.ZSDT0093" resultMap="SearchBillCMap"> 
		SELECT A.MANDT
		       , A.VBELN 
               , A.ZZPJT_ID AS PSPID
               , CAST(#{SEQ} AS VARCHAR(3)) AS SEQ
               , B.POSNR
               , E.HOGI
               , SUBSTR(C.FKDAT,1,4)||'-'||SUBSTR(C.FKDAT,5,2)||'-'||SUBSTR(C.FKDAT,7,2) AS CHFKDAT
               , C.MLBEZ AS CHMLBEZ
               , C.ZTERM AS CHZTERM
               , CASE WHEN HOGI IS NULL THEN CASE WHEN COUNT(C.FKSAF) OVER(PARTITION BY C.FPLTR) -  
                                                       COUNT(C.FKSAF) OVER(PARTITION BY C.FPLTR, DECODE(LENGTH(TRIM(C.FKSAF)) , 0, 'A', C.FKSAF)) = 0 THEN 'A'
                                                  WHEN COUNT(C.FKSAF) OVER(PARTITION BY C.FPLTR) - 
                                                       COUNT(C.FKSAF) OVER(PARTITION BY C.FPLTR, DECODE(LENGTH(TRIM(C.FKSAF)) , 0, 'C', C.FKSAF)) = 0 THEN 'C'
                                             ELSE 'B'
                                             END
                 ELSE C.FKSAF
                 END CHFKSAF   
               , C.FPLTR
               , D.MSTXT AS CHMSTXT
               , CASE WHEN A.WAERK = 'KRW' OR A.WAERK = 'JPY'  THEN C.FAKWR * 100 ELSE C.FAKWR END AS CHFAKWR
               , A.WAERK
               , '' AS ERDAT
               , '' AS ERZET
		       , '' AS ERNAM
               , '' AS AEDAT
               , '' AS AEZET
		       , '' AS AENAM		       
		  FROM SAPHEE.VBAK AS A INNER JOIN SAPHEE.VBKD AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN 
		       INNER JOIN SAPHEE.FPLT AS C ON B.MANDT = C.MANDT AND B.FPLNR = C.FPLNR 
		       LEFT OUTER JOIN SAPHEE.T433T AS D ON C.MANDT = D.MANDT AND C.MLBEZ = D.MLSTN AND D.SPRAS = '3'
		       LEFT OUTER JOIN SAPHEE.VBAP AS E ON B.MANDT = E.MANDT AND B.VBELN = E.VBELN AND B.POSNR = E.POSNR
		 WHERE A.MANDT = #{MANDT}
		   AND A.ZZPJT_ID = #{PSPID}
		   order by posnr, chfkdat, chmlbez
		WITH UR
	</select>
		
	<resultMap id="SearchSpecCMap" type="hdel.sd.sso.domain.ZSDT0094"></resultMap>  
	
	<!-- 계약변경 변경사양 조회 -->	
	<select id="SelectSpecC" parameterType="hdel.sd.sso.domain.ZSDT0094" resultMap="SearchSpecCMap"> 
SELECT  X.MANDT
       ,X.PSPID
       ,Y.SEQ
       ,X.POSNR
       ,X.HOGI
       ,X.MATNR
       ,X.PRH AS NAM_CHAR
       ,X.PRHNAME AS ATBEZ
       ,Y.CHAR_VALUE
       ,Y.CHAR_VALUEMD AS CHAR_VALUEMD
       ,Y.ATWTB AS ATWTB
       ,X.ATKLA AS ATKLA
       , (SELECT CASE COUNT(*) WHEN 0 THEN 0 ELSE 1 END
  		   FROM SAPHEE.CAWN
 		     WHERE MANDT = X.MANDT
   		    AND ATINN = X.ATINN  ) AS CNT
   	   ,X.ATFOR AS CNGBN	    
       ,Y.ERDAT
       ,Y.ERNAM
       ,CASE WHEN LOCATE('\', X.PRHNAME) > 0 THEN 'C'
           ELSE 'N' 
       END AS PCNCD
      ,X.DISPTP
      ,X.MODITP
      ,X.ZPRDGBN
      ,X.BRNDCD
      ,X.BRNDSEQ
      ,(SELECT SNDSYS FROM SAPHEE.ZSDT1140 WHERE MANDT = X.MANDT AND  BRNDSEQ = X.BRNDSEQ AND ZPRDGBN = X.ZPRDGBN AND BRNDCD = X.BRNDCD) AS SNDSYS
FROM  (
	    SELECT A.MANDT
              ,C.PSPID
              ,C.POSNR
              ,C.MATNR
              ,C.HOGI
	          ,A.PRH
	          ,(SELECT ATBEZ FROM SAPHEE.CABNT WHERE MANDT = B.MANDT AND ATINN = B.ATINN AND SPRAS = '3') AS PRHNAME
              ,B.ATINN
	          ,B.ATKLA
	          ,B.ATFOR
	          ,A.BRNDSEQ
	          ,A.ZPRDGBN
	          ,A.BRNDCD
	          ,A.DISPTP
	          ,A.MODITP
	     FROM  SAPHEE.ZSDT1141 AS A
	           INNER JOIN SAPHEE.CABN AS B ON A.MANDT = B.MANDT AND A.PRH = B.ATNAM
	           INNER JOIN TABLE (
                              SELECT X.MANDT
                                    ,X.PSPID
                                    ,X.POSNR
                                    ,X.MATNR
                                    ,X.HOGI
                                    ,X.BRNDSEQ
                                    ,X.ZPRDGBN
                                    ,X.BRNDCD
                                    ,X.MAX_QTNUM
                              FROM  (
                                    SELECT A.MANDT
                                          ,A.PSPID
                                          ,A.POSNR
                                          ,A.MATNR
                                          ,A.CLASS AS ZPRDGBN
                                          ,A.HOGI
                                          ,MAX(B.QTNUM) OVER(PARTITION BY A.MANDT, A.PSPID) AS MAX_QTNUM
                                          ,NVL(B.QTNUM, '') AS QTNUM
                                          ,B.QTSER
                                          ,B.QTSEQ
                                          ,CASE WHEN A.BRNDCD IS NULL THEN
                                                   'NOBRND'
                                                WHEN TRIM(A.BRNDCD) = '' THEN
                                                   'NOBRND'
                                           ELSE
                                               A.BRNDCD
                                           END AS BRNDCD
                                          ,A.BRNDSEQ AS BRNDSEQ
                                    FROM   SAPHEE.ZSDT0091 A
                                           LEFT OUTER JOIN SAPHEE.VBAP AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN AND A.POSNR = B.POSNR
                                    WHERE  A.MANDT = #{MANDT}
                                      AND  A.PSPID = #{PSPID}
                                      AND  A.SEQ = #{SEQ}
                              		  ) AS X  
                              		  LEFT OUTER JOIN (
                                                    SELECT MANDT
                                                          ,PSPID
                                                          ,SEQ
                                                          ,POSNR
                                                          ,HOGI
                                                          ,MATNR
                                                          ,CHAR_VALUE
                                                    FROM   SAPHEE.ZSDT0094
                                                    WHERE  MANDT = #{MANDT}
                                                      AND  PSPID = #{PSPID}        
                                                      AND  SEQ   = #{SEQ}
                                                      AND  NAM_CHAR = 'EL_ABRAND'
                              		  ) AS Y ON X.MANDT = Y.MANDT AND X.PSPID = Y.PSPID AND X.POSNR = Y.POSNR
		        ) AS C ON A.MANDT = C.MANDT AND A.BRNDSEQ = C.BRNDSEQ AND A.ZPRDGBN = C.ZPRDGBN AND A.BRNDCD = C.BRNDCD
		        LEFT OUTER JOIN SAPHEE.ZSDT1073 AS D ON D.MANDT = A.MANDT AND D.CLASS = A.ZPRDGBN  AND D.ATNAM = A.PRH
		 WHERE A.DIPSDAT > HEX(CURRENT DATE)
		   AND  D.ATNAM IS NULL
     )  AS X
     LEFT OUTER JOIN (
                     SELECT MANDT
                           ,PSPID
                           ,SEQ
                           ,POSNR
                           ,HOGI
                           ,MATNR
                           ,CHAR_VALUE
                           ,CHAR_VALUEMD
                           ,ATWTB
                           ,NAM_CHAR
                           ,SUBSTR(ERDAT,1,4)||'-'||SUBSTR(ERDAT,5,2)||'-'||SUBSTR(ERDAT,7,2) AS ERDAT
                           ,ERNAM
                     FROM   SAPHEE.ZSDT0094
                     WHERE  MANDT = #{MANDT}
                       AND  PSPID = #{PSPID}        
                       AND  SEQ   = #{SEQ}
     ) AS Y ON X.MANDT = X.MANDT AND X.PSPID = Y.PSPID AND X.POSNR = Y.POSNR AND X.HOGI = Y.HOGI AND X.MATNR = Y.MATNR AND X.PRH = Y.NAM_CHAR
ORDER BY X.HOGI     
WITH UR
	</select>
	
	<!-- 계약변경 변경사양 생성 -->	
	<select id="SelectSpecCInput" parameterType="hdel.sd.sso.domain.ZSDT0094" resultMap="SearchSpecCMap"> 
SELECT  X.MANDT
       ,X.PSPID
       ,CAST(#{SEQ} AS VARCHAR(3)) AS SEQ
       ,X.POSNR
       ,X.HOGI
       ,X.MATNR
       ,X.PRH AS NAM_CHAR
       ,X.PRHNAME AS ATBEZ
       , case X.ATFOR when 'NUM' then REPLACE(Y.CHAR_VALUE, ',', '') 
                      when 'CHAR' then (case Y.char_value when '0' then '' else Y.char_value end)
		 else Y.char_value end as char_value  --쿼리수정 20160414ksk
       , '' AS CHAR_VALUEMD
       ,Y.ATWTB AS ATWTB
       ,X.ATKLA AS ATKLA
       , (SELECT CASE COUNT(*) WHEN 0 THEN 0 ELSE 1 END
  		   FROM SAPHEE.CAWN
 		     WHERE MANDT = X.MANDT
   		    AND ATINN = X.ATINN  ) AS CNT
   	   ,X.ATFOR AS CNGBN	    
       , '' AS ERDAT
       , '' AS ERNAM
       ,CASE WHEN LOCATE('\', X.PRHNAME) > 0 THEN 'C'
           ELSE 'N' 
       END AS PCNCD
      ,X.DISPTP
      ,X.MODITP
      ,X.ZPRDGBN
      ,X.BRNDCD
      ,X.BRNDSEQ
      ,(SELECT SNDSYS FROM SAPHEE.ZSDT1140 WHERE MANDT = X.MANDT AND  BRNDSEQ = X.BRNDSEQ AND ZPRDGBN = X.ZPRDGBN AND BRNDCD = X.BRNDCD) AS SNDSYS
FROM  (
	    SELECT A.MANDT
              ,C.PSPID
              ,C.POSNR
              ,C.MATNR
              ,C.HOGI
	          ,A.PRH
	          ,(SELECT ATBEZ FROM SAPHEE.CABNT WHERE MANDT = B.MANDT AND ATINN = B.ATINN AND SPRAS = '3') AS PRHNAME
              ,B.ATINN
	          ,B.ATKLA
	          ,B.ATFOR
	          ,A.BRNDSEQ
	          ,A.ZPRDGBN
	          ,A.BRNDCD
	          ,A.DISPTP
	          ,A.MODITP
	     FROM   SAPHEE.ZSDT1141 AS A
	           INNER JOIN SAPHEE.CABN AS B ON A.MANDT = B.MANDT AND A.PRH = B.ATNAM
	           INNER JOIN TABLE (
                              SELECT X.MANDT
                                    ,X.PSPID
                                    ,X.POSNR
                                    ,X.MATNR
                                    ,X.HOGI
                                    ,X.BRNDSEQ
                                    ,X.ZPRDGBN
                                    ,X.BRNDCD
                                    ,X.MAX_QTNUM
                              FROM  (
                              		  SELECT A.MANDT
                              		        ,A.ZZPJT_ID AS PSPID
                              		        ,B.POSNR
                              		        ,B.MATNR
                              		        ,CASE B.MATNR WHEN 'L-1000' THEN 'ELV_01'
                              		                      WHEN 'L-1100' THEN 'WL_01'
                              		                      WHEN 'L-1200' THEN 'DW_01'
                              		                      WHEN 'L-2000' THEN 'ELV_02'
                              		                      WHEN 'S-1000' THEN 'ESC_01'
                              		                      WHEN 'W-1000' THEN 'MW_01'
                              		                      WHEN 'J-1000' THEN 'AP_01'
                              		                      WHEN 'T-1000' THEN 'SV_01'
                              		                      WHEN 'Y-1000' THEN 'SP_01'
                              		         END AS ZPRDGBN
                              		        ,B.HOGI AS HOGI
                              		        ,MAX(C.QTNUM) OVER(PARTITION BY A.MANDT, A.ZZPJT_ID) AS MAX_QTNUM
                              		        ,NVL(C.QTNUM, '') AS QTNUM
                              		        ,C.QTSER
                              		        ,C.QTSEQ
                                            ,CASE WHEN B.BRNDCD IS NULL THEN
                                                   'NOBRND'
                                                  WHEN TRIM(B.BRNDCD) = '' THEN
                                                   'NOBRND'
                                             ELSE
                                                 B.BRNDCD
                                             END AS BRNDCD
                              		        ,B.BRNDSEQ AS BRNDSEQ
                              		  FROM   SAPHEE.VBAK AS A
                              		         INNER JOIN SAPHEE.VBAP AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN
                              		         LEFT OUTER JOIN SAPHEE.ZSDT1047 AS C ON B.MANDT = B.MANDT AND B.QTNUM = C.QTNUM AND B.QTSER = C.QTSER AND B.QTSEQ = C.QTSEQ
                              		  WHERE  A.MANDT = #{MANDT}
                              		    AND  A.ZZPJT_ID = #{PSPID}
                              		  ) AS X  
		        ) AS C ON A.MANDT = C.MANDT AND A.BRNDSEQ = C.BRNDSEQ AND A.ZPRDGBN = C.ZPRDGBN AND A.BRNDCD = C.BRNDCD
		        LEFT OUTER JOIN SAPHEE.ZSDT1073 AS D ON D.MANDT = A.MANDT AND D.CLASS = A.ZPRDGBN  AND D.ATNAM = A.PRH
		 WHERE A.DIPSDAT > HEX(CURRENT DATE)
		   AND  D.ATNAM IS NULL
     )  AS X
     LEFT OUTER JOIN (SELECT A.MANDT
                             , A.ZZPJT_ID AS PSPID
                             , B.POSNR
                             , B.HOGI
                             , B.MATNR
                             , CASE F.ATWRT WHEN '' THEN TRIM(CHAR(BIGINT(VALUE(F.ATFLV,0)))) ELSE TRIM(F.ATWRT) END AS CHAR_VALUE
                             , '' AS CHAR_VALUEMD
                             , H.ATWTB
                             , F.ATINN
                        FROM SAPHEE.VBAK AS A
                             INNER JOIN SAPHEE.VBAP AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN  
                             INNER JOIN SAPHEE.IBINOWN AS C ON B.MANDT = C.MANDT AND B.CUOBJ = C.INSTANCE 
                             INNER JOIN SAPHEE.IBIN AS D ON C.MANDT = D.MANDT AND C.INSTANCE = D.INSTANCE
                             INNER JOIN SAPHEE.IBINVALUES AS E ON D.MANDT = E.MANDT AND D.IN_RECNO = E.IN_RECNO
                             INNER JOIN SAPHEE.IBSYMBOL AS F  ON E.MANDT = F.MANDT AND E.SYMBOL_ID = F.SYMBOL_ID
                             LEFT OUTER JOIN (SELECT T1.ATWTB, T2.ATINN, T2.ATWRT  
                                                      FROM SAPHEE.CAWNT AS T1 
                                                           INNER JOIN SAPHEE.CAWN AS T2 ON T1.MANDT = T2.MANDT AND T1.ATINN = T2.ATINN AND T1.ATZHL = T2.ATZHL AND T1.SPRAS = '3'
                                                     WHERE T1.MANDT = #{MANDT}
                                                       AND T1.SPRAS = '3') AS H ON F.ATINN = H.ATINN AND F.ATWRT = H.ATWRT
                       WHERE A.MANDT = #{MANDT}
                         AND A.ZZPJT_ID = #{PSPID}
     ) AS Y ON X.MANDT = X.MANDT AND X.PSPID = Y.PSPID AND X.POSNR = Y.POSNR AND X.HOGI = Y.HOGI AND X.MATNR = Y.MATNR AND X.ATINN = Y.ATINN
WITH UR
	</select>
	
	
	<resultMap id="SsoResultMap" type="hdel.sd.sso.domain.Sso0055VO"></resultMap>

	<!-- 사양리스트 조회 -->	
	<select id="SelectSayang" parameterType="hdel.sd.sso.domain.Sso0055VO" resultMap="SsoResultMap">
		<![CDATA[ 
SELECT     CAST (#{MANDT} AS VARCHAR(10)) AS MANDT 
         , CAST (#{PSPID} AS VARCHAR(10)) AS PSPID 
         , '0' 		AS SEQ 
         , CAST (#{POSNR} AS VARCHAR(10)) AS POSNR 
         , CAST (#{MATNR} AS VARCHAR(10)) AS MATNR 
         , CAST (#{HOGI} AS VARCHAR(72)) AS HOGI
         , T.ZPRDGBN AS CLASS
         , T.PRH AS NAM_CHAR
         , T.PRHNAME AS ATBEZ
         , '' AS CHAR_VALUE
         , '' AS ATWTB
         , T.CNT
         , T.ATFOR AS CNGBN -- char/num 구분
         , '' AS ERDAT
         , '' AS ERNAM
         , T.ATKLA AS ATKLA
         , '' AS CHAR_VALUEMD
         , CASE WHEN LOCATE('\', T.PRHNAME) > 0 THEN 'C' ELSE 'N' END AS PCNCD
         , T.DISPTP
         , T.MODITP
         , T.ZPRDGBN
         , T.BRNDCD
         , T.BRNDSEQ
         , (SELECT SNDSYS FROM SAPHEE.ZSDT1140 WHERE MANDT = T.MANDT AND BRNDSEQ = T.BRNDSEQ AND ZPRDGBN = T.ZPRDGBN AND BRNDCD = T.BRNDCD) AS SNDSYS
FROM     (
         SELECT A.MANDT
              , A.BRNDSEQ
              , A.ZPRDGBN
              , A.BRNDCD
              , A.PRH
              , B.ATKLA
              , B.ATFOR
              , (SELECT ATBEZ FROM SAPHEE.CABNT WHERE MANDT = B.MANDT AND ATINN = B.ATINN AND SPRAS = '3') AS PRHNAME
              , ( SELECT CASE COUNT(*) WHEN 0 THEN 0 ELSE 1 END
                  FROM SAPHEE.CAWN
                 WHERE MANDT = A.MANDT
                   AND ATINN = B.ATINN  ) AS CNT
              , A.DISPTP
              , A.MODITP
         FROM   SAPHEE.ZSDT1141 AS A
                INNER JOIN SAPHEE.CABN AS B ON A.MANDT = B.MANDT AND A.PRH = B.ATNAM
     	         LEFT OUTER JOIN SAPHEE.ZSDT1073 AS C ON C.MANDT = A.MANDT AND C.CLASS = A.ZPRDGBN  AND C.ATNAM = A.PRH
          WHERE  A.MANDT   = #{MANDT}
            AND  A.BRNDSEQ = #{BRNDSEQ}
            AND  A.ZPRDGBN = #{CLASS} 
            AND  A.BRNDCD  = #{BRNDCD}
            AND  A.DIPSDAT > HEX(CURRENT DATE)
            AND  C.ATNAM IS NULL
         ) T
ORDER BY CASE WHEN T.ATKLA = ' ' THEN '2' || T.ATKLA ELSE '1' || T.ATKLA END, T.PRHNAME
WITH UR
		]]>
	</select>
	
	<select id="SelectVbeln" parameterType="hdel.sd.sso.domain.Sso0055VO" resultMap="SsoResultMap">
		<![CDATA[ 
			SELECT z1046.VBELN , z1046.QTDAT, vbak.WWBLD, z1046.ZLZONE AS ALOCT, z1046.REGION AS ADTA
			FROM SAPHEE.ZSDT1046 as z1046
				left join saphee.vbak as vbak on z1046.mandt=vbak.mandt and z1046.vbeln=vbak.zzpjt_id
			WHERE z1046.MANDT = #{MANDT}
				AND LENGTH(z1046.VBELN) > 2
				AND z1046.VBELN = #{VBELN}
			WITH UR
		]]>
	</select>
	
	<select id="SelectVbeln2" parameterType="hdel.sd.sso.domain.Sso0055VO" resultMap="SsoResultMap">
		<![CDATA[ 
			SELECT VBELN
			 FROM SAPHEE.VBAK 
			WHERE MANDT = #{MANDT}
			  AND AUART IN ('ZJ01', 'ZJ02')
 			  AND BSTDK >= '20150201' 
			  AND PSPID = #{VBELN}
			WITH UR
		]]>
	</select>
	
    <!--  최종 차수 조회 -->
	<select id="SelectMaxSeq" parameterType="hdel.sd.sso.domain.Sso0055ParamVO" resultMap="SsoResultMap"> 
		SELECT  value(MAX(SEQ),0) as SEQ				
		  FROM	SAPHEE.ZSDT0090
		 WHERE  MANDT  = #{MANDT}
		   AND  PSPID  = #{PSPID}		 
		WITH UR
	</select>

    <!--  최종 호기 조회 -->
	<select id="SelectMaxHogi" parameterType="hdel.sd.sso.domain.Sso0055VO" resultMap="SsoResultMap"> 
		SELECT #{PSPID} || SUBSTR(#{MATNR}, 1, 1) || LPAD(COALESCE(SUBSTR(MAX(HOGI), 8, 2),'0') + 1, 2, '0') AS HOGI 
		  <if test="CHCK =='item'">
		  FROM SAPHEE.ZSDT0091 as z9x
		  </if>
		  <if test="CHCK =='spec'">
		  FROM SAPHEE.ZSDT0094 as z9x
		  </if>
		 WHERE MANDT = #{MANDT} 
		   AND PSPID = #{PSPID} 
		   AND SEQ = #{SEQ}
		   AND SUBSTR(HOGI, 1, 7) = #{PSPID} || SUBSTR(#{MATNR}, 1, 1)
		   AND HOGI not in (select z9x.PSPID||rshno from saphee.zsdt1033 where mandt=z9x.mandt)
		   AND SUBSTR(HOGI,7,2) != 'Y6'
		WITH UR
	</select>
	
    <!--  신규생성 호기 정보 -->
	<select id="SelectHogi" parameterType="map" resultType="java.lang.String"> 
		SELECT distinct hogi
		  FROM saphee.zsdt0091
		 WHERE mandt = #{mandt}
		   AND vbeln = #{vbeln} 
		   AND pspid = #{pspid} 
		   AND seq   = #{seq}
		   AND posnr = #{posnr}
		WITH UR
	</select>
		
	<select id="SelectSayangForPrint" parameterType="hdel.sd.sso.domain.Sso0055VO" resultMap="SsoResultMap">
		<![CDATA[
		SELECT
		          PSPID                        AS PSPID
		        , HOGI                        AS HOGI
		        , ANAM_CHAR                   AS NAM_CHAR
		        , ACHAR_VALUE          AS CHAR_VALUE
		        , cabnt.atbez       AS ATBEZ
		        , BCHAR_VALUE          AS CHAR_VALUEMD
		FROM (
		        select
		               VALUE(A.mandt,B.mandt) as     mandt
		               , VALUE(A.PSPID,B.PSPID)      PSPID
		               , VALUE(A.HOGI,B.HOGI)                HOGI
		               , VALUE(A.NAM_CHAR,'')                ANAM_CHAR
		               , VALUE(A.CHAR_VALUE,'')      ACHAR_VALUE
		               , VALUE(B.NAM_CHAR,'')                BNAM_CHAR
		               , VALUE(B.CHAR_VALUE,'')      BCHAR_VALUE
		--             , B.ATBEZ                                     BATBEZ
		        FROM (
					SELECT X.MANDT
						  ,X.PSPID
						  ,X.POSNR
						  ,X.HOGI
						  ,X.MATNR
						  ,Y.PRH AS NAM_CHAR
						  ,NVL(Z.CHAR_VALUE, '') AS CHAR_VALUE
					FROM   (      
					SELECT MANDT
						  ,PSPID
						  ,SEQ
						  ,POSNR
						  ,HOGI
						  ,MATNR
						  ,CLASS
						  ,BRNDSEQ
						  ,CASE WHEN BRNDCD = '' THEN
							   'NOBRND'
							   WHEN BRNDCD IS NULL THEN
							   'NOBRND'
						   ELSE
							   BRNDCD            
						   END AS BRNDCD
					FROM   SAPHEE.ZSDT0091
					WHERE  MANDT = #{MANDT}
					  AND  PSPID = #{PSPID}
					  AND  SEQ   = #{SEQPRE}
					) AS X  
					INNER JOIN SAPHEE.ZSDT1141 AS Y ON X.MANDT = Y.MANDT AND X.BRNDSEQ = Y.BRNDSEQ AND X.CLASS = Y.ZPRDGBN AND X.BRNDCD = Y.BRNDCD
					LEFT OUTER JOIN SAPHEE.ZSDT0094 AS Z ON X.MANDT = Z.MANDT AND X.PSPID = Z.PSPID AND X.SEQ = Z.SEQ AND X.POSNR = Z.POSNR AND Y.PRH = Z.NAM_CHAR
		        ) AS A 
				INNER JOIN (
					SELECT X.MANDT
						  ,X.PSPID
						  ,X.POSNR
						  ,X.HOGI
						  ,X.MATNR
						  ,Y.PRH AS NAM_CHAR
						  ,NVL(Z.CHAR_VALUE, '') AS CHAR_VALUE
					FROM   (      
					SELECT MANDT
						  ,PSPID
						  ,SEQ
						  ,POSNR
						  ,HOGI
						  ,MATNR
						  ,CLASS
						  ,BRNDSEQ
						  ,CASE WHEN BRNDCD = '' THEN
							   'NOBRND'
							   WHEN BRNDCD IS NULL THEN
							   'NOBRND'
						   ELSE
							   BRNDCD            
						   END AS BRNDCD
					FROM   SAPHEE.ZSDT0091
					WHERE  MANDT = #{MANDT}
					  AND  PSPID = #{PSPID}
					  AND  SEQ   = #{SEQ}
					) AS X
					INNER JOIN SAPHEE.ZSDT1141 AS Y ON X.MANDT = Y.MANDT AND X.BRNDSEQ = Y.BRNDSEQ AND X.CLASS = Y.ZPRDGBN AND X.BRNDCD = Y.BRNDCD
					LEFT OUTER JOIN SAPHEE.ZSDT0094 AS Z ON X.MANDT = Z.MANDT AND X.PSPID = Z.PSPID AND X.SEQ = Z.SEQ AND X.POSNR = Z.POSNR AND Y.PRH = Z.NAM_CHAR
		        ) AS B
		        ON A.MANDT = B.MANDT   
		        AND A.PSPID = B.PSPID
		        AND A.POSNR = B.POSNR
		        AND A.HOGI = B.HOGI
		        AND A.MATNR = B.MATNR
		        AND A.NAM_CHAR = B.NAM_CHAR
		) AS TEMP
		        INNER JOIN SAPHEE.CABN AS CABN ON TEMP.MANDT = CABN.MANDT AND TEMP.BNAM_CHAR = CABN.ATNAM
		        LEFT OUTER JOIN SAPHEE.CABNT AS CABNT ON CABN.MANDT = CABNT.MANDT AND CABN.ATINN = CABNT.ATINN AND CABN.ADZHL = CABNT.ADZHL AND CABNT.SPRAS='3'
		
		WHERE HOGI != ''
		        AND (ACHAR_VALUE != '' OR BCHAR_VALUE != '')
		        AND ACHAR_VALUE <> BCHAR_VALUE
		ORDER BY HOGI, ATBEZ
		WITH UR
		]]>
	</select>
	
	<!-- 영업오더 문서 상태 -->	
	<resultMap id="SearchGBSTKMap" type="hdel.sd.sso.domain.Sso0055VO">
		<result property="VBELN" column="VBELN"/>
		<result property="GBSTK" column="GBSTK"/>
	</resultMap>	
	<select id="SelectDocStatusGBSTK" parameterType="map" resultMap="SearchGBSTKMap">  
		SELECT VBAK.VBELN, VBUK.GBSTK
		  FROM saphee.vbak AS vbak INNER JOIN saphee.vbuk AS vbuk ON vbak.mandt = vbuk.mandt AND vbak.vbeln = vbuk.vbeln
		 WHERE vbak.mandt 	 = #{mandt}
		  AND  vbak.zzpjt_id = #{pspid}
		WITH UR
	</select>
	<update id="setCostState" parameterType="hdel.sd.sso.domain.Sso0055ParamVO">
		UPDATE SAPHEE.ZSDT0090
		SET
			FINL = #{FINL}
		WHERE   MANDT = #{MANDT}
			AND PSPID = #{PSPID}
			AND SEQ   = #{SEQ}
	</update>
	
	<select id="getRecad_da" parameterType="hdel.sd.sso.domain.Sso0055ParamVO" resultMap ="SsoResultMap">
		SELECT RECAD_DA, PSPID, ERDAT
		FROM   SAPHEE.VBAK
		WHERE  MANDT = #{MANDT}
		AND    ZZPJT_ID = #{VBELN}
		WITH UR
	</select>

	<resultMap id="ZCOBT304Map" type="hdel.sd.sso.domain.Sso0055VO"></resultMap>
	
	<select id="searchZcobt304" parameterType="hdel.sd.sso.domain.Sso0055ParamVO" resultMap="ZCOBT304Map">
		SELECT    Z304.MANDT
				, Z304.PSPID
				, POSID
				, TWAER
				, MEINH_MH
				, PRDM01, PRDM02, PRDM03, PRDM04, PRDM05
				, PRDA01
				, PRDL01, PRDL02, PRDL03, PRDL04, PRDL05
				, PRDE01, PRDE02, PRDE03, PRDE04, PRDE05, PRDE06, PRDE07, PRDE08, PRDE09, PRDE10, PRDE11, PRDE12, PRDE13, PRDE14, PRDE15
				, PRDI01, PRDI02, PRDI03, PRDI04
				, EQMM01, EQMM02, EQMM03, EQMM04, EQMM05
				, EQMA01, EQMA02
				, EQML01, EQML02, EQML03, EQML04, EQML05
				, EQME01, EQME02, EQME03, EQME04, EQME05, EQME06, EQME07, EQME08, EQME09, EQME10, EQME11, EQME12, EQME13, EQME14, EQME15
				, EQME51, EQME52, EQME53, EQME54, EQME55, EQME56, EQME57, EQME58, EQME59, EQME60
				, EQME61, EQME62, EQME63, EQME64, EQME65, EQME66, EQME67, EQME68, EQME69, EQME70
				, EQME71, EQME72, EQME73, EQME74, EQME75, EQME76, EQME77, EQME78, EQME79, EQME80
				, EQME81, EQME82, EQME83, EQME84, EQME85, EQME86, EQME87, EQME88, EQME89, EQME90
				, EQME91, EQME92, EQME93, EQME94, EQME95, EQME96, EQME97, EQME98, EQME99, EQME100
				, EQME101, EQME102, EQME103, EQME104, EQME105, EQME106, EQME107, EQME108, EQME109, EQME110
				, EQME111, EQME112, EQME113, EQME114, EQME115, EQME116, EQME117, EQME118, EQME119, EQME120
				, EQMI01, EQMI02, EQMI03
				, EQMO01, EQMO02, EQMO03, EQMO04, EQMO05, EQMO06, EQMO07, EQMO08, EQMO09, EQMO10
				, EQMO11, EQMO12, EQMO13, EQMO14, EQMO15, EQMO16, EQMO17, EQMO18, EQMO19, EQMO20
				, EQMO21, EQMO22, EQMO23, EQMO24, EQMO25, EQMO26, EQMO27, EQMO28, EQMO29, EQMO30
				, EQMO31, EQMO32, EQMO33, EQMO34, EQMO35, EQMO36, EQMO37, EQMO38, EQMO39, EQMO40
				, CTSM01, CTSM02, CTSM03, CTSM04, CTSM05, CTSM06, CTSM07, CTSM08, CTSM09, CTSM10,  CTSM11,  CTSM12,  CTSM13,  CTSM14
				, CTSA01
				, CTSL01, CTSL02, CTSL03, CTSL04, CTSL05
				, CTSE01, CTSE02, CTSE03, CTSE04, CTSE05
				, CTSI01, CTSI02, CTSI03
				, FDSP01, FDSP02, FDSP03, FDSP04, FDSP05, FDSP06, FDSP07, FDSP08, FDSP09, FDSP10, FDSP11
				, MODEL
				, FDS01, FDS02, FDS03, FDS04, FDS05, FDS06, FDS07, FDS08, FDS09, FDS10
				, ADDT01
				, Z1046.VKGRP		AS VKGRP
				, Z1046.VKGRP_NM	AS VKGRP_NM
				, Z1046.ZKUNNR_NM1 	AS ZKUNNR_NM
				, Z1046.GSNAM		AS GSNAM		-- 프로젝트명
				, Z1046.KUNNR_NM1 	AS BUYR_NM 		-- 판매처
				, Z1046.SPART 		AS SPART
				, Z1046.LAND1       AS LAND1
		FROM SAPHEE.ZCOBT304 Z304
		LEFT OUTER JOIN TABLE (
			SELECT    A.MANDT
					, A.VBELN
			 		, A.VKGRP
					, B.BEZEI AS VKGRP_NM
					, C.KUNNR AS ZKUNNR
					, C.NAME1 AS ZKUNNR_NM1
					, C.NAME2 AS ZKUNNR_NM2
					, A.GSNAM
					, D.KUNNR AS KUNNR
					, D.NAME1 AS KUNNR_NM1
					, D.NAME2 AS KUNNR_NM2
					, E.CODE1
					, E.CTEXT2 AS SPART
					, D.LAND1 AS LAND1
			FROM SAPHEE.ZSDT1046 A
			INNER JOIN SAPHEE.TVGRT  B ON B.MANDT = A.MANDT AND B.VKGRP  = A.VKGRP and b.spras = '3'
			INNER JOIN SAPHEE.KNA1   C ON C.MANDT = A.MANDT AND C.KUNNR  = A.ZKUNNR
			INNER JOIN SAPHEE.KNA1   D ON D.MANDT = A.MANDT AND D.KUNNR  = A.KUNNR
			INNER JOIN SAPHEE.ZLCODE E ON E.MANDT = A.MANDT AND E.CODE2  = A.SPART AND E.CODE1='SPART' AND E.LANG='ko' 
		) Z1046 ON Z304.MANDT = Z1046.MANDT AND Z304.PSPID = Z1046.VBELN
		WHERE   Z304.MANDT = #{MANDT}
			AND Z304.PSPID = #{PSPID}
			AND z304.POSID = #{POSID}
	WITH UR
	</select>
	
	<resultMap id="selectListBlockNameMap" type="hdel.sd.sso.domain.Sso0055VO">
	</resultMap>
	<select id="selectListBlockName" parameterType="hdel.sd.sso.domain.Sso0055ParamVO" resultMap="selectListBlockNameMap">
		SELECT A.MANDT
				, A.POSID
				, A.BLSEQ2                                        AS BLSEQ
				, SUM(A.BDMNG)                                AS BDMNG
				, MIN(A.SALES)                                   AS SALES
				, SUM(A.ZCTOTAL)  	                         AS ZCTOTAL
				, MAX(A.MESSG)                                 AS MESSG
				, MAX(A.BLOCKNAME)                          AS BLOCKNAME
				, MAX(A.DESCRIPTION) AS MAKTX
		 FROM TABLE
				 (  SELECT B.MANDT
							, B.POSID
							, B.BLSEQ2
--							, B.BDMNG
							, CASE WHEN BLSEQ3 = '00' THEN B.BDMNG
													 	ELSE NULL END 			AS BDMNG
							, B.ZCTOTAL
							, B.SALES
							, B.MESSG
							, B.BLOCKNAME
							, CASE WHEN B.MAKTX IS NULL OR B.MAKTX = '' THEN Z005.CD_KEY
									 ELSE  B.MAKTX	 END                                                     AS MAKTX
--							, VALUE(mara.spec,VALUE(z005.cd_name,'')) DESCRIPTION
							, CASE WHEN BLSEQ3 = '00' THEN VALUE(mara.spec,VALUE(z005.cd_name,''))
															 ELSE NULL END		AS DESCRIPTION
					 FROM TABLE
							 ( SELECT  Z204.*
										, M.MATNR
										, M.MAKTX
								  FROM TABLE
										  ( SELECT Z204.*
--													, Z005.BLOCKNAME
													, CASE WHEN BLSEQ3 = '00' THEN Z005.BLOCKNAME
															 ELSE NULL END	                                    AS BLOCKNAME
											 FROM TABLE
													 ( SELECT  MANDT
																, POSID
																, BLSEQ
																, SUBSTR(BLSEQ, 1, 4) AS BLSEQ2
																, SUBSTR(BLSEQ, 5, 2) AS BLSEQ3
																, BLNUM
																, MODEL
																, RQMAT
																, BDMNG
																, ZCTOTAL
																, SALES
																, MESSG
														 FROM SAPHEE.ZCOBT204
														WHERE MANDT = #{MANDT}
														   AND PSPID = #{PSPID}
														   AND POSID = #{POSID}
													 ) Z204 LEFT OUTER JOIN TABLE
													 ( SELECT  OPT_CD1
																, OPT_CD2
																, MODEL
																, CD_NAME AS BLOCKNAME
														 FROM SAPHEE.ZCOBT005
														WHERE MANDT  = #{MANDT}
														   AND CD_TYPE = 'AB0001'
														   AND DIV = '0'
														   <if test="PLM_YN != null and PLM_YN != ''">
															   AND PLM_YN = #{PLM_YN}
														   </if>
														   <if test="PLM_YN == null or PLM_YN == ''">
															   AND PLM_YN = ''
														   </if>
													 ) Z005
												 ON Z204.BLSEQ = Z005.OPT_CD1
											   AND Z204.MODEL = Z005.MODEL
											) Z204 LEFT OUTER JOIN TABLE
											( SELECT MANDT
													 , MATNR
													 , MAKTX
											   FROM SAPHEE.MAKT
											  WHERE MANDT = #{MANDT}
												 AND SPRAS    = '3'
											) M
									   ON Z204.RQMAT = M.MATNR
							 ) B LEFT OUTER JOIN TABLE
							 ( SELECT  MATNR, SPEC
								  FROM SAPHEE.MARA
								 WHERE MANDT  = #{MANDT}
							 ) MARA 
						ON B.RQMAT = mara.matnr
						LEFT OUTER JOIN TABLE
					       ( SELECT  CD_TYPE
										, MODEL
										, CD_KEY
										, CD_NAME
								  FROM SAPHEE.ZCOBT005
								 WHERE MANDT  = #{MANDT}
									AND CD_TYPE = 'AB0004'
									AND DIV = '0'
							 ) Z005
						ON B.MODEL = Z005.MODEL
					  AND B.RQMAT = Z005.CD_KEY
				 ) A
		GROUP BY A.MANDT
				, A.POSID
				, A.BLSEQ2
		ORDER BY A.MANDT
				, A.POSID
				, A.BLSEQ2
		WITH UR
	</select>
	
	<resultMap id="selectListExchangeMap" type="hdel.sd.sso.domain.Sso0055VO">
	</resultMap>
	<select id="selectListExchange" parameterType="hdel.sd.sso.domain.Sso0055ParamVO" resultMap="selectListExchangeMap">
		SELECT T.MANDT		AS MANDT
			, T.TCURRDATE	AS TCURRDATE
			, SUM(KRWUSD) 	AS KRWUSD
			, SUM(KRWJPY) 	AS KRWJPY
			, SUM(KRWEUR) 	AS KRWEUR
		FROM TABLE (
			SELECT A.MANDT
				, CAST((99999999-INT(GDATU)) AS CHAR(8)) 									  	  AS TCURRDATE
				, CASE WHEN FCURR='USD' THEN UKURS 									ELSE NULL END AS KRWUSD
				, CASE WHEN FCURR='JPY' THEN CAST(UKURS/100.00000 AS DECIMAL(10,5)) ELSE NULL END AS KRWJPY
				, CASE WHEN FCURR='EUR' THEN UKURS 									ELSE NULL END AS KRWEUR
			FROM SAPHEE.TCURR AS A
			WHERE   MANDT = #{MANDT}
				AND KURST = 'M'
				AND TCURR = 'KRW'
				AND CAST((99999999-INT(GDATU)) AS CHAR(8)) = #{TCURRDATE}
		) T
		GROUP BY MANDT, TCURRDATE
		WITH UR
	</select>
	
	<resultMap id="searchZcobt204DMap" type="hdel.sd.sso.domain.Sso0055VO">
	</resultMap>
	<select id="searchZcobt204D" parameterType="hdel.sd.sso.domain.Sso0055ParamVO" resultMap="searchZcobt204DMap">
		SELECT PSPID
		FROM   SAPHEE.ZCOBT204D 
		WHERE  MANDT = #{MANDT}
	    AND    PSPID = #{PSPID}
		<!-- AND    SEQ = #{SEQ} 널오류정정 jss -->
		AND    SEQ =  CAST(COALESCE(NULLIF( TRIM(#{SEQ}||''),''),'-1') AS INTEGER)
		AND    POSID = #{POSID}
     	WITH UR
	</select>
    <resultMap id="selectListBlockNameDMap" type="hdel.sd.sso.domain.Sso0055VO">
	</resultMap>
	<select id="selectListBlockNameD" parameterType="hdel.sd.sso.domain.Sso0055ParamVO" resultMap="selectListBlockNameDMap">
		SELECT A.MANDT
				, A.POSID
				, A.BLSEQ2                                        AS BLSEQ
				, A.SEQ										 AS SEQ
				, SUM(A.BDMNG)                                AS BDMNG
				, MIN(A.SALES)                                   AS SALES
				, SUM(A.ZCTOTAL)  	                         AS ZCTOTAL
				, MAX(A.MESSG)                                 AS MESSG
				, MAX(A.BLOCKNAME)                          AS BLOCKNAME
				, MAX(A.DESCRIPTION) AS MAKTX
		 FROM TABLE
				 (  SELECT B.MANDT
							, B.POSID
							, B.SEQ
							, B.BLSEQ2
--							, B.BDMNG
							, CASE WHEN BLSEQ3 = '00' THEN B.BDMNG
													 	ELSE NULL END 			AS BDMNG
							, B.ZCTOTAL
							, B.SALES
							, B.MESSG
							, B.BLOCKNAME
							, CASE WHEN B.MAKTX IS NULL OR B.MAKTX = '' THEN Z005.CD_KEY
									 ELSE  B.MAKTX	 END                                                     AS MAKTX
--							, VALUE(mara.spec,VALUE(z005.cd_name,'')) DESCRIPTION
							, CASE WHEN BLSEQ3 = '00' THEN VALUE(mara.spec,VALUE(z005.cd_name,''))
															 ELSE NULL END		AS DESCRIPTION
					 FROM TABLE
							 ( SELECT  Z204.*
										, M.MATNR
										, M.MAKTX
								  FROM TABLE
										  ( SELECT Z204.*
--													, Z005.BLOCKNAME
													, CASE WHEN BLSEQ3 = '00' THEN Z005.BLOCKNAME
															 ELSE NULL END	                                    AS BLOCKNAME
											 FROM TABLE
													 ( SELECT  MANDT
																, POSID
																, SEQ
																, BLSEQ
																, SUBSTR(BLSEQ, 1, 4) AS BLSEQ2
																, SUBSTR(BLSEQ, 5, 2) AS BLSEQ3
																, BLNUM
																, MODEL
																, RQMAT
																, BDMNG
																, ZCTOTAL
																, SALES
																, MESSG
														 FROM SAPHEE.ZCOBT204D
														WHERE MANDT = #{MANDT}
														   AND PSPID = #{PSPID}
														   AND POSID = #{POSID}
														   AND SEQ = #{SEQ}
													 ) Z204 LEFT OUTER JOIN TABLE
													 ( SELECT  OPT_CD1
																, OPT_CD2
																, MODEL
																, CD_NAME AS BLOCKNAME
														 FROM SAPHEE.ZCOBT005
														WHERE MANDT  = #{MANDT}
														   AND CD_TYPE = 'AB0001'
			   											   AND DIV = '0'
			   											   <if test="PLM_YN != null and PLM_YN != ''">
															   AND PLM_YN = #{PLM_YN}
														   </if>
														   <if test="PLM_YN == null or PLM_YN == ''">
															   AND PLM_YN = ''
														   </if>
													 ) Z005
												 ON Z204.BLSEQ = Z005.OPT_CD1
											   AND Z204.MODEL = Z005.MODEL
											) Z204 LEFT OUTER JOIN TABLE
											( SELECT MANDT
													 , MATNR
													 , MAKTX
											   FROM SAPHEE.MAKT
											  WHERE MANDT = #{MANDT}
												 AND SPRAS    = '3'
											) M
									   ON Z204.RQMAT = M.MATNR
							 ) B LEFT OUTER JOIN TABLE
							 ( SELECT  MATNR, SPEC
								  FROM SAPHEE.MARA
								 WHERE MANDT  = #{MANDT}
							 ) MARA 
						ON B.RQMAT = mara.matnr
						LEFT OUTER JOIN TABLE
					       ( SELECT  CD_TYPE
										, MODEL
										, CD_KEY
										, CD_NAME
								  FROM SAPHEE.ZCOBT005
								 WHERE MANDT  = #{MANDT}
									AND CD_TYPE = 'AB0004'
			   						AND DIV = '0'
							 ) Z005
						ON B.MODEL = Z005.MODEL
					  AND B.RQMAT = Z005.CD_KEY
				 ) A
		GROUP BY A.MANDT
				, A.POSID
				, A.BLSEQ2
				, A.SEQ
		ORDER BY A.MANDT
				, A.POSID
				, A.BLSEQ2
				, A.SEQ
		WITH UR
	</select>
	<resultMap id="ZCOBT304DMap" type="hdel.sd.sso.domain.Sso0055VO"></resultMap>
	
	<select id="searchZcobt304D" parameterType="hdel.sd.sso.domain.Sso0055ParamVO" resultMap="ZCOBT304DMap">
		SELECT    Z304.MANDT
				, Z304.PSPID
				, Z304.SEQ
				, POSID
				, TWAER
				, MEINH_MH
				, PRDM01, PRDM02, PRDM03, PRDM04, PRDM05
				, PRDA01
				, PRDL01, PRDL02, PRDL03, PRDL04, PRDL05
				, PRDE01, PRDE02, PRDE03, PRDE04, PRDE05, PRDE06, PRDE07, PRDE08, PRDE09, PRDE10, PRDE11, PRDE12, PRDE13, PRDE14, PRDE15
				, PRDI01, PRDI02, PRDI03, PRDI04
				, EQMM01, EQMM02, EQMM03, EQMM04, EQMM05
				, EQMA01, EQMA02
				, EQML01, EQML02, EQML03, EQML04, EQML05
				, EQME01, EQME02, EQME03, EQME04, EQME05, EQME06, EQME07, EQME08, EQME09, EQME10, EQME11, EQME12, EQME13, EQME14, EQME15
				, EQME51, EQME52, EQME53, EQME54, EQME55, EQME56, EQME57, EQME58, EQME59, EQME60
				, EQME61, EQME62, EQME63, EQME64, EQME65, EQME66, EQME67, EQME68, EQME69, EQME70
				, EQME71, EQME72, EQME73, EQME74, EQME75, EQME76, EQME77, EQME78, EQME79, EQME80
				, EQME81, EQME82, EQME83, EQME84, EQME85, EQME86, EQME87, EQME88, EQME89, EQME90
				, EQME91, EQME92, EQME93, EQME94, EQME95, EQME96, EQME97, EQME98, EQME99, EQME100
				, EQME101, EQME102, EQME103, EQME104, EQME105, EQME106, EQME107, EQME108, EQME109, EQME110
				, EQME111, EQME112, EQME113, EQME114, EQME115, EQME116, EQME117, EQME118, EQME119, EQME120
				, EQMI01, EQMI02, EQMI03
				, EQMO01, EQMO02, EQMO03, EQMO04, EQMO05, EQMO06, EQMO07, EQMO08, EQMO09, EQMO10
				, EQMO11, EQMO12, EQMO13, EQMO14, EQMO15, EQMO16, EQMO17, EQMO18, EQMO19, EQMO20
				, EQMO21, EQMO22, EQMO23, EQMO24, EQMO25, EQMO26, EQMO27, EQMO28, EQMO29, EQMO30
				, EQMO31, EQMO32, EQMO33, EQMO34, EQMO35, EQMO36, EQMO37, EQMO38, EQMO39, EQMO40
				, CTSM01, CTSM02, CTSM03, CTSM04, CTSM05, CTSM06, CTSM07, CTSM08, CTSM09, CTSM10, CTSM11,  CTSM12,  CTSM13,  CTSM14,  CTSM15, CTSM17, CTSM18
				, CTSA01
				, CTSL01, CTSL02, CTSL03, CTSL04, CTSL05
				, CTSE01, CTSE02, CTSE03, CTSE04, CTSE05
				, CTSI01, CTSI02, CTSI03
				, FDSP01, FDSP02, FDSP03, FDSP04, FDSP05, FDSP06, FDSP07, FDSP08, FDSP09, FDSP10, FDSP11
				, MODEL
				, FDS01, FDS02, FDS03, FDS04, FDS05, FDS06, FDS07, FDS08, FDS09, FDS10
				, ADDT01
				, Z1046.VKGRP		AS VKGRP
				, Z1046.VKGRP_NM	AS VKGRP_NM
				, Z1046.ZKUNNR_NM1 	AS ZKUNNR_NM
				, Z1046.GSNAM		AS GSNAM		-- 프로젝트명
				, Z1046.KUNNR_NM1 	AS BUYR_NM 		-- 판매처
				, Z1046.SPART 		AS SPART
				, Z1046.LAND1       AS LAND1
		FROM SAPHEE.ZCOBT304D Z304
		LEFT OUTER JOIN TABLE (
			SELECT    A.MANDT
					, A.VBELN
			 		, A.VKGRP
					, B.BEZEI AS VKGRP_NM
					, C.KUNNR AS ZKUNNR
					, C.NAME1 AS ZKUNNR_NM1
					, C.NAME2 AS ZKUNNR_NM2
					, A.GSNAM
					, D.KUNNR AS KUNNR
					, D.NAME1 AS KUNNR_NM1
					, D.NAME2 AS KUNNR_NM2
					, E.CODE1
					, E.CTEXT2 AS SPART
					, D.LAND1
			FROM SAPHEE.ZSDT1046 A
			INNER JOIN SAPHEE.TVGRT  B ON B.MANDT = A.MANDT AND B.VKGRP  = A.VKGRP and b.spras = '3'
			INNER JOIN SAPHEE.KNA1   C ON C.MANDT = A.MANDT AND C.KUNNR  = A.ZKUNNR
			INNER JOIN SAPHEE.KNA1   D ON D.MANDT = A.MANDT AND D.KUNNR  = A.KUNNR
			INNER JOIN SAPHEE.ZLCODE E ON E.MANDT = A.MANDT AND E.CODE2  = A.SPART AND E.CODE1='SPART' AND E.LANG='ko' 
		) Z1046 ON Z304.MANDT = Z1046.MANDT AND Z304.PSPID = Z1046.VBELN
		WHERE   Z304.MANDT = #{MANDT}
			AND Z304.PSPID = #{PSPID}
			AND z304.POSID = #{POSID}
			<!-- AND z304.SEQ   = #{SEQ} 널오류 정정 jss -->
			AND z304.SEQ   = CAST(COALESCE(NULLIF( TRIM(#{SEQ}||''),''),'-1') AS INTEGER)
	WITH UR
	</select>
	<select id="searchZcobt304DPrev" parameterType="hdel.sd.sso.domain.Sso0055ParamVO" resultMap="ZCOBT304DMap">
		SELECT    Z304.MANDT
				, Z304.PSPID
				, Z304.SEQ
				, POSID
				, TWAER
				, MEINH_MH
				, PRDM01, PRDM02, PRDM03, PRDM04, PRDM05
				, PRDA01
				, PRDL01, PRDL02, PRDL03, PRDL04, PRDL05
				, PRDE01, PRDE02, PRDE03, PRDE04, PRDE05, PRDE06, PRDE07, PRDE08, PRDE09, PRDE10, PRDE11, PRDE12, PRDE13, PRDE14, PRDE15
				, PRDI01, PRDI02, PRDI03, PRDI04
				, EQMM01, EQMM02, EQMM03, EQMM04, EQMM05
				, EQMA01, EQMA02
				, EQML01, EQML02, EQML03, EQML04, EQML05
				, EQME01, EQME02, EQME03, EQME04, EQME05, EQME06, EQME07, EQME08, EQME09, EQME10, EQME11, EQME12, EQME13, EQME14, EQME15
				, EQME51, EQME52, EQME53, EQME54, EQME55, EQME56, EQME57, EQME58, EQME59, EQME60
				, EQME61, EQME62, EQME63, EQME64, EQME65, EQME66, EQME67, EQME68, EQME69, EQME70
				, EQME71, EQME72, EQME73, EQME74, EQME75, EQME76, EQME77, EQME78, EQME79, EQME80
				, EQME81, EQME82, EQME83, EQME84, EQME85, EQME86, EQME87, EQME88, EQME89, EQME90
				, EQME91, EQME92, EQME93, EQME94, EQME95, EQME96, EQME97, EQME98, EQME99, EQME100
				, EQME101, EQME102, EQME103, EQME104, EQME105, EQME106, EQME107, EQME108, EQME109, EQME110
				, EQME111, EQME112, EQME113, EQME114, EQME115, EQME116, EQME117, EQME118, EQME119, EQME120
				, EQMI01, EQMI02, EQMI03
				, EQMO01, EQMO02, EQMO03, EQMO04, EQMO05, EQMO06, EQMO07, EQMO08, EQMO09, EQMO10
				, EQMO11, EQMO12, EQMO13, EQMO14, EQMO15, EQMO16, EQMO17, EQMO18, EQMO19, EQMO20
				, EQMO21, EQMO22, EQMO23, EQMO24, EQMO25, EQMO26, EQMO27, EQMO28, EQMO29, EQMO30
				, EQMO31, EQMO32, EQMO33, EQMO34, EQMO35, EQMO36, EQMO37, EQMO38, EQMO39, EQMO40
				, CTSM01, CTSM02, CTSM03, CTSM04, CTSM05, CTSM06, CTSM07, CTSM08, CTSM09, CTSM10, CTSM11,  CTSM12,  CTSM13,  CTSM14
				, CTSA01
				, CTSL01, CTSL02, CTSL03, CTSL04, CTSL05
				, CTSE01, CTSE02, CTSE03, CTSE04, CTSE05
				, CTSI01, CTSI02, CTSI03
				, FDSP01, FDSP02, FDSP03, FDSP04, FDSP05, FDSP06, FDSP07, FDSP08, FDSP09, FDSP10, FDSP11
				, MODEL
				, FDS01, FDS02, FDS03, FDS04, FDS05, FDS06, FDS07, FDS08, FDS09, FDS10
				, ADDT01
				, Z1046.VKGRP		AS VKGRP
				, Z1046.VKGRP_NM	AS VKGRP_NM
				, Z1046.ZKUNNR_NM1 	AS ZKUNNR_NM
				, Z1046.GSNAM		AS GSNAM		-- 프로젝트명
				, Z1046.KUNNR_NM1 	AS BUYR_NM 		-- 판매처
				, Z1046.SPART 		AS SPART
				, Z1046.LAND1       AS LAND1
		FROM SAPHEE.ZCOBT304D Z304
		LEFT OUTER JOIN TABLE (
			SELECT    A.MANDT
					, A.VBELN
			 		, A.VKGRP
					, B.BEZEI AS VKGRP_NM
					, C.KUNNR AS ZKUNNR
					, C.NAME1 AS ZKUNNR_NM1
					, C.NAME2 AS ZKUNNR_NM2
					, A.GSNAM
					, D.KUNNR AS KUNNR
					, D.NAME1 AS KUNNR_NM1
					, D.NAME2 AS KUNNR_NM2
					, E.CODE1
					, E.CTEXT2 AS SPART
					, D.LAND1
			FROM SAPHEE.ZSDT1046 A
			INNER JOIN SAPHEE.TVGRT  B ON B.MANDT = A.MANDT AND B.VKGRP  = A.VKGRP and b.spras = '3'
			INNER JOIN SAPHEE.KNA1   C ON C.MANDT = A.MANDT AND C.KUNNR  = A.ZKUNNR
			INNER JOIN SAPHEE.KNA1   D ON D.MANDT = A.MANDT AND D.KUNNR  = A.KUNNR
			INNER JOIN SAPHEE.ZLCODE E ON E.MANDT = A.MANDT AND E.CODE2  = A.SPART AND E.CODE1='SPART' AND E.LANG='ko' 
		) Z1046 ON Z304.MANDT = Z1046.MANDT AND Z304.PSPID = Z1046.VBELN
		WHERE   Z304.MANDT = #{MANDT}
			AND Z304.PSPID = #{PSPID}
			AND z304.POSID = #{POSID}
			<!-- AND z304.SEQ   = (select max(seq) from saphee.zcobt304d where mandt=z304.mandt and pspid=z304.pspid and posid=z304.posid and seq &lt; #{SEQ}) 널오류 정정 jss -->
			AND z304.SEQ   = (select max(seq) from saphee.zcobt304d where mandt=z304.mandt and pspid=z304.pspid and posid=z304.posid and seq &lt; CAST(COALESCE(NULLIF( TRIM(#{SEQ}||''),''),'-1') AS INTEGER))
	WITH UR
	</select>
	
	<delete id="deleteZsdt0090" parameterType="hdel.sd.sso.domain.ZSDT0090">
		 DELETE
		   FROM	SAPHEE.ZSDT0090	AS A		  						
		  WHERE A.MANDT	= #{MANDT}
		    AND A.PSPID = #{PSPID}		 
		    AND A.SEQ   = #{SEQ}
	</delete>
	
	<delete id="deleteZsdt0091" parameterType="hdel.sd.sso.domain.ZSDT0091">
		 DELETE
		   FROM	SAPHEE.ZSDT0091	AS A		  						
		  WHERE A.MANDT	= #{MANDT}
		    AND A.PSPID = #{PSPID}		 
		    AND A.SEQ   = #{SEQ}
	</delete>
	
	<delete id="deleteZsdt0092" parameterType="hdel.sd.sso.domain.ZSDT0092">
		 DELETE
		   FROM	SAPHEE.ZSDT0092	AS A		  						
		  WHERE A.MANDT	= #{MANDT}
		    AND A.PSPID = #{PSPID}		 
		    AND A.SEQ   = #{SEQ}
	</delete>
	
	<delete id="deleteZsdt0093" parameterType="hdel.sd.sso.domain.ZSDT0093">
		 DELETE
		   FROM	SAPHEE.ZSDT0093	AS A		  						
		  WHERE A.MANDT	= #{MANDT}
		    AND A.PSPID = #{PSPID}		 
		    AND A.SEQ   = #{SEQ}
	</delete>
	
	<delete id="deleteZsdt0094" parameterType="hdel.sd.sso.domain.ZSDT0094">
		 DELETE
		   FROM	SAPHEE.ZSDT0094	AS A		  						
		  WHERE A.MANDT	= #{MANDT}
		    AND A.PSPID = #{PSPID}		 
		    AND A.SEQ   = #{SEQ}
	</delete>
	<delete id="deletePosnrZsdt0094" parameterType="hdel.sd.sso.domain.ZSDT0094">
		 DELETE
		   FROM	SAPHEE.ZSDT0094	AS A		  						
		  WHERE A.MANDT	= #{MANDT}
		    AND A.PSPID = #{PSPID}		 
		    AND A.SEQ   = #{SEQ}
		    AND A.POSNR = #{POSNR}
	</delete>
	<insert id="insertPosnrZsdt0094" parameterType="hdel.sd.sso.domain.ZSDT0094">
		INSERT INTO SAPHEE.ZSDT0094 (
			  MANDT
			, PSPID
			, SEQ
			, POSNR
			, HOGI
			, MATNR
			, NAM_CHAR
			--, ATBEZ
			, CHAR_VALUE
			, CHAR_VALUEMD
			, ATWTB
			, ATKLA
			, CNT
			, CNGBN
			, ERDAT
			, ERZET
			, ERNAM
			, AEDAT
			, AEZET
			, AENAM            
		)
		SELECT     CAST (#{MANDT} AS VARCHAR(10)) AS MANDT 
		         , CAST (#{PSPID} AS VARCHAR(10)) AS PSPID 
		         , CAST(#{SEQ} AS SMALLINT) AS SEQ
		         , CAST (#{POSNR} AS VARCHAR(10)) AS POSNR 
		         , CAST (#{HOGI} AS VARCHAR(72)) AS HOGI
		         , CAST (#{MATNR} AS VARCHAR(10)) AS MATNR 
		         , T.PRH AS NAM_CHAR
		--         , T.PRHNAME AS ATBEZ
		         , '' AS CHAR_VALUE
		         , '' AS CHAR_VALUEMD
		         , '' AS ATWTB
		         , T.ATKLA AS ATKLA
		         , T.CNT
		         , T.ATFOR AS CNGBN
			     , REPLACE(CURRENT_DATE, '-', '') AS ERDAT
				 , REPLACE(CURRENT_TIME, '.', '') AS ERZET
				 , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM 
				 , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
				 , REPLACE(CURRENT_TIME, '.', '') AS AEZET
				 , CAST(#{AENAM} AS VARCHAR(36))  AS AENAM
		FROM     (
		         SELECT A.MANDT
		              , A.BRNDSEQ
		              , A.ZPRDGBN
		              , A.BRNDCD
		              , A.PRH
		              , B.ATKLA
		              , B.ATFOR
		              , (SELECT ATBEZ FROM SAPHEE.CABNT WHERE MANDT = B.MANDT AND ATINN = B.ATINN AND SPRAS = '3') AS PRHNAME
		              , ( SELECT CASE COUNT(*) WHEN 0 THEN 0 ELSE 1 END
		                  FROM SAPHEE.CAWN
		                 WHERE MANDT = A.MANDT
		                   AND ATINN = B.ATINN  ) AS CNT
		              , A.DISPTP
		              , A.MODITP
		         FROM   SAPHEE.ZSDT1141 AS A
		                INNER JOIN SAPHEE.CABN AS B ON A.MANDT = B.MANDT AND A.PRH = B.ATNAM
		     	         LEFT OUTER JOIN SAPHEE.ZSDT1073 AS C ON C.MANDT = A.MANDT AND C.CLASS = A.ZPRDGBN  AND C.ATNAM = A.PRH
		          WHERE  A.MANDT   = #{MANDT}
		            AND  A.BRNDSEQ = #{BRNDSEQ}
		            AND  A.ZPRDGBN = #{ZPRDGBN} 
		            AND  A.BRNDCD  = #{BRNDCD}
		            AND  A.DIPSDAT > HEX(CURRENT DATE)
		            AND  C.ATNAM IS NULL
		         ) T
		ORDER BY CASE WHEN T.ATKLA = ' ' THEN '2' || T.ATKLA ELSE '1' || T.ATKLA END, T.PRHNAME
	</insert>	
	<update id="mergeHeader" parameterType="hdel.sd.sso.domain.ZSDT0090">
		MERGE INTO SAPHEE.ZSDT0090 AS T1
		USING (SELECT CAST(#{MANDT} AS VARCHAR(9))  AS MANDT
                     , CAST(#{VBELN} AS VARCHAR(30)) AS VBELN
                     , CAST(#{PSPID} AS VARCHAR(72)) AS PSPID
                     , CAST(#{SEQ} AS SMALLINT) AS SEQ
                     , CAST(#{ZQNTY} AS VARCHAR(6)) AS ZQNTY
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{NETWR} AS DECIMAL(15,2)) / 100 
                       ELSE CAST(#{NETWR} AS DECIMAL(15,2)) END AS NETWR
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{WAVWR} AS DECIMAL(15,2)) / 100 
                       ELSE CAST(#{WAVWR} AS DECIMAL(15,2)) END AS WAVWR
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{COMMI} AS DECIMAL(13,2)) / 100 
                       ELSE CAST(#{COMMI} AS DECIMAL(13,2)) END AS COMMI  
                     , REPLACE(CAST(#{VDATU} AS VARCHAR(24)), '-', '') AS VDATU
                     , CAST(#{WAERK} AS VARCHAR(15)) AS WAERK
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{CHNETWR} AS DECIMAL(15,2)) / 100 
                       ELSE CAST(#{CHNETWR} AS DECIMAL(15,2)) END AS CHNETWR
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{CHWAVWR} AS DECIMAL(15,2)) / 100 
                       ELSE CAST(#{CHWAVWR} AS DECIMAL(15,2)) END AS CHWAVWR
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{CHCOMMI} AS DECIMAL(13,2)) / 100 
                       ELSE CAST(#{CHCOMMI} AS DECIMAL(13,2)) END AS CHCOMMI
                     , REPLACE(CAST(#{CHVDATU} AS VARCHAR(24)), '-', '') AS CHVDATU
                     , CAST(#{CHWAERK} AS VARCHAR(15)) AS CHWAERK
                     , CAST(#{FINL} AS VARCHAR(3)) AS FINL
					 , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
					 , REPLACE(CURRENT_TIME, '.', '') AS ERZET
                     , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM
					 , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
					 , REPLACE(CURRENT_TIME, '.', '') AS AEZET
                     , CAST(#{AENAM} AS VARCHAR(36))  AS AENAM                     
                     , CAST(#{BIGO1} AS VARCHAR(765)) AS BIGO1
                     , CAST(#{BIGO2} AS VARCHAR(765)) AS BIGO2
                     , CAST(#{BIGO3} AS VARCHAR(765)) AS BIGO3
                     , CAST(#{BIGO4} AS VARCHAR(765)) AS BIGO4
                     , CAST(#{BIGO5} AS VARCHAR(765)) AS BIGO5
                     , CAST(#{CHRES} AS VARCHAR(3)) AS CHRES
                     , CAST(#{REDEP} AS VARCHAR(3)) AS REDEP
                     , CAST(#{CHRES_A} AS VARCHAR(3)) AS CHRES_A
                     , CAST(#{REDEP_A} AS VARCHAR(3)) AS REDEP_A
                     , CAST(#{CHRES_B} AS VARCHAR(3)) AS CHRES_B
                     , CAST(#{REDEP_B} AS VARCHAR(3)) AS REDEP_B
                     , CAST(#{CHRES_C} AS VARCHAR(3)) AS CHRES_C
                     , CAST(#{REDEP_C} AS VARCHAR(3)) AS REDEP_C
                     , CAST(#{CHRES_D} AS VARCHAR(3)) AS CHRES_D
                     , CAST(#{REDEP_D} AS VARCHAR(3)) AS REDEP_D
                     , CAST(#{CHRES_E} AS VARCHAR(3)) AS CHRES_E
                     , CAST(#{REDEP_E} AS VARCHAR(3)) AS REDEP_E
                     , #{SHCHK} AS SHCHK
                     , #{CHSHCHK} AS CHSHCHK
                     , #{UCH_DUTY} AS UCH_DUTY
                FROM SYSIBM.SYSDUMMY1
				 ) AS T2 ON T1.MANDT = T2.MANDT
                        AND T1.VBELN = T2.VBELN
						AND T1.PSPID = T2.PSPID
						AND T1.SEQ = T2.SEQ
		WHEN MATCHED THEN
				UPDATE SET T1.ZQNTY = T2.ZQNTY
                           , T1.NETWR = T2.NETWR
                           , T1.WAVWR = T2.WAVWR
                           , T1.COMMI = T2.COMMI
                           , T1.VDATU = T2.VDATU
                           , T1.WAERK = T2.WAERK
                           , T1.CHNETWR = T2.CHNETWR
                           , T1.CHWAVWR = T2.CHWAVWR
                           , T1.CHCOMMI = T2.CHCOMMI
                           , T1.CHVDATU = T2.CHVDATU
                           , T1.CHWAERK = T2.CHWAERK
                           , T1.FINL = T2.FINL
                           , T1.AEDAT = T2.AEDAT
                           , T1.AEZET = T2.AEZET
                           , T1.AENAM = T2.AENAM                           
                           , T1.BIGO1 = T2.BIGO1
                           , T1.BIGO2 = T2.BIGO2
                           , T1.BIGO3 = T2.BIGO3
                           , T1.BIGO4 = T2.BIGO4
                           , T1.BIGO5 = T2.BIGO5
                           , T1.CHRES = T2.CHRES
                           , T1.REDEP = T2.REDEP
                           , T1.CHRES_A = T2.CHRES_A
                           , T1.REDEP_A = T2.REDEP_A
                           , T1.CHRES_B = T2.CHRES_B
                           , T1.REDEP_B = T2.REDEP_B
                           , T1.CHRES_C = T2.CHRES_C
                           , T1.REDEP_C = T2.REDEP_C
                           , T1.CHRES_D = T2.CHRES_D
                           , T1.REDEP_D = T2.REDEP_D
                           , T1.CHRES_E = T2.CHRES_E
                           , T1.REDEP_E = T2.REDEP_E
                           , T1.SHCHK = T2.SHCHK
                           , T1.CHSHCHK = T2.CHSHCHK
                           , T1.UCH_DUTY = T2.UCH_DUTY
		WHEN NOT MATCHED THEN
				INSERT ( 
                	MANDT
                	, VBELN
                	, PSPID
                	, SEQ
                	, ZQNTY
                    , NETWR
                    , WAVWR
                    , COMMI
                    , VDATU
                    , WAERK
                    , CHNETWR
                    , CHWAVWR
                    , CHCOMMI
                    , CHVDATU
                    , CHWAERK
                    , FINL
                    , ERDAT
                    , ERZET
                    , ERNAM
                    , AEDAT
                    , AEZET
                    , AENAM                    
                    , BIGO1
                    , BIGO2
                    , BIGO3
                    , BIGO4
                    , BIGO5
                    , CHRES
                    , REDEP
                    , CHRES_A
                    , REDEP_A
                    , CHRES_B
                    , REDEP_B
                    , CHRES_C
                    , REDEP_C
                    , CHRES_D
                    , REDEP_D
                    , CHRES_E
                    , REDEP_E
                    , SHCHK
                    , CHSHCHK
                    , UCH_DUTY
				) VALUES (
                	T2.MANDT
                	, T2.VBELN
                	, T2.PSPID
                	, T2.SEQ
                	, T2.ZQNTY
                    , T2.NETWR
                    , T2.WAVWR
                    , T2.COMMI
                    , T2.VDATU
                    , T2.WAERK
                    , T2.CHNETWR
                    , T2.CHWAVWR
                    , T2.CHCOMMI
                    , T2.CHVDATU
                    , T2.CHWAERK
                    , T2.FINL
                    , T2.ERDAT
                    , T2.ERZET
                    , T2.ERNAM
                    , T2.ERDAT
                    , T2.ERZET
                    , T2.ERNAM                    
                    , T2.BIGO1
                    , T2.BIGO2
                    , T2.BIGO3
                    , T2.BIGO4
                    , T2.BIGO5
                    , T2.CHRES
                    , T2.REDEP
                    , T2.CHRES_A
                    , T2.REDEP_A
                    , T2.CHRES_B
                    , T2.REDEP_B
                    , T2.CHRES_C
                    , T2.REDEP_C
                    , T2.CHRES_D
                    , T2.REDEP_D
                    , T2.CHRES_E
                    , T2.REDEP_E
                    , SHCHK
                    , CHSHCHK
                    , T2.UCH_DUTY
				)
	</update>
	
	<insert id="insertItem" parameterType="hdel.sd.sso.domain.ZSDT0091">
		INSERT INTO SAPHEE.ZSDT0091 (
			MANDT
            , VBELN
            , PSPID
            , SEQ
            , POSNR
            , HOGI
            , AUART
            , KZWI4
            , NETWR
            , WAVWR
            , EDATU
            , REPMO
            , GUAMO
            , WORMO
            , CHNETWR
            , CHWAVWR
            , CHEDATU
            , CHREPMO
            , CHGUAMO
            , CHWORMO
            , WAERK
            , CHCK
            , HOGI_CANC
            , MATNR
            , CLASS
            , ARKTX
            , ERDAT
            , ERZET
            , ERNAM
            , AEDAT
            , AEZET
            , AENAM            
            , SPEC_STAT
            , BRNDCD
            , BRNDSEQ
		)
		SELECT A.MANDT
		       , A.VBELN 
               , A.ZZPJT_ID AS PSPID
               , CAST(#{SEQ} AS VARCHAR(3)) AS SEQ
               , B.POSNR
               , B.HOGI
               , A.AUART
               , B.KZWI4
               , B.NETWR
               , B.WAVWR
               , C.EDATU
               , B.REPMO
               , B.GUAMO
               , B.WORMO
               , B.NETWR
               , B.WAVWR
               , C.EDATU AS CHEDATU
               , B.REPMO AS CHREPMO
               , B.GUAMO AS CHGUAMO
               , B.WORMO AS CHWORMO
               , A.WAERK
               , '' AS CHCK
               , D.ABSTA AS HOGI_CANC
               , CASE B.MATNR WHEN 'Y-400' THEN 'Y-1000' 
                 ELSE B.MATNR
                END MATNR
               , CASE B.MATNR WHEN 'L-1000' THEN 'ELV_01'
                              WHEN 'L-1100' THEN 'WL_01'
                              WHEN 'L-1200' THEN 'DW_01'
                              WHEN 'L-2000' THEN 'ELV_02'
                              WHEN 'S-1000' THEN 'ESC_01'
                              WHEN 'W-1000' THEN 'MW_01'
                              WHEN 'J-1000' THEN 'AP_01'
                              WHEN 'T-1000' THEN 'SV_01'
                              WHEN 'Y-1000' THEN 'SP_01'
                              ELSE '' 
                 END AS CLASS
               , B.ARKTX
               , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
               , REPLACE(CURRENT_TIME, '.', '') AS ERZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM
               , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
               , REPLACE(CURRENT_TIME, '.', '') AS AEZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS AENAM                
		       , '' AS SPEC_STAT
			   ,TRIM(B.BRNDCD) AS BRNDCD
			   ,B.BRNDSEQ AS BRNDSEQ
          FROM SAPHEE.VBAK AS A INNER JOIN SAPHEE.VBAP AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN 
               INNER JOIN SAPHEE.VBEP AS C ON B.MANDT= C.MANDT AND B.VBELN = C.VBELN AND B.POSNR = C.POSNR AND C.ETENR = '0001'
               INNER JOIN SAPHEE.VBUP AS D ON B.MANDT = D.MANDT AND B.VBELN = D.VBELN AND B.POSNR = D.POSNR  
         WHERE A.MANDT = #{MANDT}
           AND A.ZZPJT_ID = #{PSPID}
          WITH UR		
	</insert>
	
	<update id="mergeItem" parameterType="hdel.sd.sso.domain.ZSDT0091">
		MERGE INTO SAPHEE.ZSDT0091 AS T1
		USING (SELECT CAST(#{MANDT} AS VARCHAR(9))  AS MANDT
                     , CAST(#{VBELN} AS VARCHAR(30)) AS VBELN
                     , CAST(#{PSPID} AS VARCHAR(72)) AS PSPID
                     , CAST(#{SEQ} AS SMALLINT) AS SEQ
                     , CAST(#{POSNR} AS VARCHAR(18)) AS POSNR
                     , CAST(#{HOGI} AS VARCHAR(72)) AS HOGI
                     , CAST(#{AUART} AS VARCHAR(12)) AS AUART
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{KZWI4} AS DECIMAL(15,2)) / 100 
                       ELSE CAST(#{KZWI4} AS DECIMAL(15,2)) END AS KZWI4
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{NETWR} AS DECIMAL(15,2)) / 100 
                       ELSE CAST(#{NETWR} AS DECIMAL(15,2)) END AS NETWR
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{WAVWR} AS DECIMAL(15,2)) / 100 
                       ELSE CAST(#{WAVWR} AS DECIMAL(15,2)) END AS WAVWR
                     , REPLACE(CAST(#{EDATU} AS VARCHAR(24)), '-', '') AS EDATU
                     , CAST(#{REPMO} AS VARCHAR(6)) AS REPMO
                     , CAST(#{GUAMO} AS VARCHAR(6)) AS GUAMO
                     , CAST(#{WORMO} AS VARCHAR(6)) AS WORMO
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{CHNETWR} AS DECIMAL(15,2)) / 100 
                       ELSE CAST(#{CHNETWR} AS DECIMAL(15,2)) END AS CHNETWR
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{CHWAVWR} AS DECIMAL(15,2)) / 100 
                       ELSE CAST(#{CHWAVWR} AS DECIMAL(15,2)) END AS CHWAVWR
                     , REPLACE(CAST(#{CHEDATU} AS VARCHAR(24)), '-', '') AS CHEDATU
                     , CAST(#{CHREPMO} AS VARCHAR(6)) AS CHREPMO
                     , CAST(#{CHGUAMO} AS VARCHAR(6)) AS CHGUAMO
                     , CAST(#{CHWORMO} AS VARCHAR(6)) AS CHWORMO
                     , CAST(#{WAERK} AS VARCHAR(15)) AS WAERK
                     , CAST(#{CHCK} AS VARCHAR(3)) AS CHCK
                     , CAST(#{HOGI_CANC} AS VARCHAR(3)) AS HOGI_CANC
					 , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
					 , REPLACE(CURRENT_TIME, '.', '') AS ERZET
                     , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM
					 , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
					 , REPLACE(CURRENT_TIME, '.', '') AS AEZET
                     , CAST(#{AENAM} AS VARCHAR(36))  AS AENAM
                     , case substr(#{MATNR},1,1) when 'Y'  then cast('Y-1000' as varchar(54)) else CAST(#{MATNR} AS VARCHAR(54)) end AS MATNR
                     , CAST(#{CLASS} AS VARCHAR(54)) AS CLASS
                     , CAST(#{SPEC_STAT} AS VARCHAR(3)) AS SPEC_STAT
                     , CAST(#{ARKTX} AS VARCHAR(120)) AS ARKTX
                     , CAST(#{ABGRU} AS VARCHAR(2)) AS ABGRU
                     , VALUE((SELECT DISTINCT BEZEI FROM SAPHEE.TVAGT WHERE MANDT = #{MANDT} AND SPRAS = '3' AND ABGRU = #{ABGRU}), '') AS ABGRUTXT
                     , CAST(#{BRNDCD} AS VARCHAR(30)) AS BRNDCD
                     , CAST(#{BRNDSEQ} AS VARCHAR(3)) AS BRNDSEQ
                FROM SYSIBM.SYSDUMMY1
				 ) AS T2 ON T1.MANDT = T2.MANDT
                        AND T1.VBELN = T2.VBELN
						AND T1.PSPID = T2.PSPID
						AND T1.SEQ = T2.SEQ
                        AND T1.POSNR = T2.POSNR
                        AND T1.HOGI = T2.HOGI
		WHEN MATCHED THEN
				UPDATE SET T1.NETWR = T2.NETWR
                           , T1.WAVWR = T2.WAVWR
                           , T1.EDATU = T2.EDATU
                           , T1.REPMO = T2.REPMO
                           , T1.WORMO = T2.WORMO
                           , T1.CHNETWR = T2.CHNETWR
                           , T1.CHWAVWR = T2.CHWAVWR
                           , T1.CHEDATU = T2.CHEDATU
                           , T1.CHREPMO = T2.CHREPMO
                           , T1.CHWORMO = T2.CHWORMO
                           , T1.WAERK = T2.WAERK
                           , T1.AEDAT = T2.AEDAT
                           , T1.AEZET = T2.AEZET                           
                           , T1.AENAM = T2.AENAM
                           , T1.CHCK = T2.CHCK
                           , T1.AUART = T2.AUART
                           , T1.KZWI4 = T2.KZWI4
                           , T1.HOGI_CANC = T2.HOGI_CANC
                           , T1.GUAMO = T2.GUAMO
                           , T1.CHGUAMO = T2.CHGUAMO
                           , T1.MATNR = T2.MATNR
                           , T1.CLASS = T2.CLASS
                           , T1.SPEC_STAT = DECODE(T2.SPEC_STAT, 'I', 'S', DECODE(T2.CHCK, 'X', '', T2.SPEC_STAT))
                           , T1.ARKTX = T2.ARKTX
                           , T1.ABGRU = T2.ABGRU
                           , T1.ABGRUTXT = T2.ABGRUTXT
                           , T1.BRNDCD  = T2.BRNDCD
                           , T1.BRNDSEQ = T2.BRNDSEQ
		WHEN NOT MATCHED THEN
				INSERT ( 
                	MANDT
                    , VBELN
                    , PSPID
                    , SEQ
                    , POSNR
                    , HOGI
                    , NETWR
                    , WAVWR
                    , EDATU
                    , REPMO
                    , WORMO
                    , CHNETWR
                    , CHWAVWR
                    , CHEDATU
                    , CHREPMO
                    , CHWORMO
                    , WAERK
                    , ERDAT
                    , ERZET
                    , ERNAM
                    , AEDAT
                    , AEZET
                    , AENAM
                    , CHCK
                    , AUART
                    , KZWI4
                    , HOGI_CANC
                    , GUAMO
                    , CHGUAMO
                    , MATNR
                    , CLASS
                    , SPEC_STAT
                    , ARKTX
                    , ABGRU
                    , ABGRUTXT
                    , BRNDCD
                    , BRNDSEQ
				) VALUES (
                	T2.MANDT
                    , T2.VBELN
                    , T2.PSPID
                    , T2.SEQ
                    , T2.POSNR
                    , T2.HOGI
                    , T2.NETWR
                    , T2.WAVWR
                    , T2.EDATU
                    , T2.REPMO
                    , T2.WORMO
                    , T2.CHNETWR
                    , T2.CHWAVWR
                    , T2.CHEDATU
                    , T2.CHREPMO
                    , T2.CHWORMO
                    , T2.WAERK
                    , T2.ERDAT
                    , T2.ERZET
                    , T2.ERNAM                    
                    , T2.ERDAT
                    , T2.ERZET
                    , T2.ERNAM                    
                    , T2.CHCK
                    , T2.AUART
                    , T2.KZWI4
                    , T2.HOGI_CANC
                    , T2.GUAMO
                    , T2.CHGUAMO
                    , T2.MATNR
                    , T2.CLASS
                    , T2.SPEC_STAT
                    , T2.ARKTX
                    , T2.ABGRU
                    , T2.ABGRUTXT
                    , T2.BRNDCD
                    , T2.BRNDSEQ
				)
	</update>
	
	<update id="mergeBillO" parameterType="hdel.sd.sso.domain.ZSDT0092">
		MERGE INTO SAPHEE.ZSDT0092 AS T1
		USING (SELECT CAST(#{MANDT} AS VARCHAR(9))  AS MANDT
                     , CAST(#{VBELN} AS VARCHAR(30)) AS VBELN
                     , CAST(#{PSPID} AS VARCHAR(72)) AS PSPID
                     , CAST(#{SEQ} AS SMALLINT) AS SEQ
                     , CAST(#{POSNR} AS VARCHAR(18)) AS POSNR
                     , CAST(#{HOGI} AS VARCHAR(72)) AS HOGI
                     , REPLACE(CAST(#{FKDAT} AS VARCHAR(24)), '-', '') AS FKDAT
                     , CAST(#{MLBEZ} AS VARCHAR(15)) AS MLBEZ
                     , CAST(#{ZTERM} AS VARCHAR(12)) AS ZTERM
                     , CAST(#{FKSAF} AS VARCHAR(3)) AS FKSAF
                     , CAST(#{FPLTR} AS VARCHAR(18)) AS FPLTR
                     , CAST(#{MSTXT} AS VARCHAR(60)) AS MSTXT
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{FAKWR} AS DECIMAL(15,2)) / 100 
                       ELSE CAST(#{FAKWR} AS DECIMAL(15,2)) END AS FAKWR
                     , CAST(#{WAERK} AS VARCHAR(15)) AS WAERK
					 , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
					 , REPLACE(CURRENT_TIME, '.', '') AS ERZET
                     , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM
					 , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
					 , REPLACE(CURRENT_TIME, '.', '') AS AEZET
                     , CAST(#{AENAM} AS VARCHAR(36))  AS AENAM 
                FROM SYSIBM.SYSDUMMY1
				 ) AS T2 ON T1.MANDT = T2.MANDT
                        AND T1.VBELN = T2.VBELN
						AND T1.PSPID = T2.PSPID
						AND T1.SEQ = T2.SEQ
                        AND T1.POSNR = T2.POSNR
                        AND T1.HOGI = T2.HOGI
                        AND T1.FKDAT = T2.FKDAT
                        AND T1.MLBEZ = T2.MLBEZ
                        AND T1.ZTERM = T2.ZTERM
                        AND T1.FKSAF = T2.FKSAF
                        AND T1.FPLTR = T2.FPLTR
		WHEN MATCHED THEN
				UPDATE SET T1.FAKWR = T2.FAKWR
                           , T1.WAERK = T2.WAERK
                           , T1.AEDAT = T2.AEDAT
                           , T1.AEZET = T2.AEZET
                           , T1.AENAM = T2.AENAM                           
                           , T1.MSTXT = T2.MSTXT
		WHEN NOT MATCHED THEN
				INSERT ( 
                	MANDT
                    , VBELN
                    , PSPID
                    , SEQ
                    , POSNR
                    , HOGI
                    , FKDAT
                    , MLBEZ
                    , ZTERM
                    , FKSAF
                    , FPLTR
                    , FAKWR
                    , WAERK
                    , ERDAT
                    , ERZET
                    , ERNAM
                    , AEDAT
                    , AEZET
                    , AENAM                    
                    , MSTXT
				) VALUES (
                	T2.MANDT
                    , T2.VBELN
                    , T2.PSPID
                    , T2.SEQ
                    , T2.POSNR
                    , T2.HOGI
                    , T2.FKDAT
                    , T2.MLBEZ
                    , T2.ZTERM
                    , T2.FKSAF
                    , T2.FPLTR
                    , T2.FAKWR
                    , T2.WAERK
                    , T2.ERDAT
                    , T2.ERZET
                    , T2.ERNAM
                    , T2.ERDAT
                    , T2.ERZET
                    , T2.ERNAM                    
                    , T2.MSTXT
				)
	</update>
	
	<update id="mergeBillC" parameterType="hdel.sd.sso.domain.ZSDT0093">
		MERGE INTO SAPHEE.ZSDT0093 AS T1
		USING (SELECT CAST(#{MANDT} AS VARCHAR(9))  AS MANDT
                     , CAST(#{VBELN} AS VARCHAR(30)) AS VBELN
                     , CAST(#{PSPID} AS VARCHAR(72)) AS PSPID
                     , CAST(#{SEQ} AS SMALLINT) AS SEQ
                     , CAST(#{POSNR} AS VARCHAR(18)) AS POSNR
                     , CAST(#{HOGI} AS VARCHAR(72)) AS HOGI
                     , REPLACE(CAST(#{CHFKDAT} AS VARCHAR(24)), '-', '') AS CHFKDAT
                     , CAST(#{CHMLBEZ} AS VARCHAR(15)) AS CHMLBEZ
                     , CAST(#{CHZTERM} AS VARCHAR(12)) AS CHZTERM
                     , CAST(#{CHFKSAF} AS VARCHAR(3)) AS CHFKSAF
                     , CAST(#{FPLTR} AS VARCHAR(18)) AS FPLTR
                     , CAST(#{CHMSTXT} AS VARCHAR(60)) AS CHMSTXT
                     , CASE WHEN CAST(#{WAERK} AS VARCHAR(15)) = 'KRW' OR CAST(#{WAERK} AS VARCHAR(15)) = 'JPY' THEN CAST(#{CHFAKWR} AS DECIMAL(15,2)) / 100 
                       ELSE CAST(#{CHFAKWR} AS DECIMAL(15,2)) END AS CHFAKWR
                     , CAST(#{WAERK} AS VARCHAR(15)) AS WAERK
				     , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
			   	     , REPLACE(CURRENT_TIME, '.', '') AS ERZET
               	     , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM                     
					 , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
					 , REPLACE(CURRENT_TIME, '.', '') AS AEZET
                     , CAST(#{AENAM} AS VARCHAR(36))  AS AENAM 
                FROM SYSIBM.SYSDUMMY1
				 ) AS T2 ON T1.MANDT = T2.MANDT
                        AND T1.VBELN = T2.VBELN
						AND T1.PSPID = T2.PSPID
						AND T1.SEQ = T2.SEQ
                        AND T1.POSNR = T2.POSNR
                        AND T1.HOGI = T2.HOGI
                        AND T1.CHFKDAT = T2.CHFKDAT
                        AND T1.CHMLBEZ = T2.CHMLBEZ
                        AND T1.CHZTERM = T2.CHZTERM
                        AND T1.CHFKSAF = T2.CHFKSAF
                        AND T1.FPLTR = T2.FPLTR
		WHEN MATCHED THEN
				UPDATE SET T1.CHFAKWR = T2.CHFAKWR
                           , T1.WAERK = T2.WAERK
                           , T1.AEDAT = T2.AEDAT
                           , T1.AEZET = T2.AEZET
                           , T1.AENAM = T2.AENAM                           
                           , T1.CHMSTXT = T2.CHMSTXT
		WHEN NOT MATCHED THEN
				INSERT ( 
                	MANDT
                    , VBELN
                    , PSPID
                    , SEQ
                    , POSNR
                    , HOGI
                    , CHFKDAT
                    , CHMLBEZ
                    , CHZTERM
                    , CHFKSAF
                    , FPLTR
                    , CHFAKWR
                    , WAERK
                    , ERDAT
                    , ERZET
                    , ERNAM                    
                    , AEDAT
                    , AEZET
                    , AENAM                    
                    , CHMSTXT
				) VALUES (
                	T2.MANDT
                    , T2.VBELN
                    , T2.PSPID
                    , T2.SEQ
                    , T2.POSNR
                    , T2.HOGI
                    , T2.CHFKDAT
                    , T2.CHMLBEZ
                    , T2.CHZTERM
                    , T2.CHFKSAF
                    , T2.FPLTR
                    , T2.CHFAKWR
                    , T2.WAERK
					, T2.ERDAT                                         
			   		, T2.ERZET
               		, T2.ERNAM                    
					, T2.ERDAT                                         
			   		, T2.ERZET
               		, T2.ERNAM               		
                    , T2.CHMSTXT
				)
	</update>
	
	<insert id="insertSpecC" parameterType="hdel.sd.sso.domain.ZSDT0094">
		INSERT INTO SAPHEE.ZSDT0094 (
			MANDT
            , PSPID
            , SEQ
            , POSNR
            , HOGI
            , MATNR
            , NAM_CHAR
            --, ATBEZ
            , CHAR_VALUE
            , CHAR_VALUEMD
            , ATWTB
            , ATKLA
            , CNT
            , CNGBN
            , ERDAT
            , ERZET
            , ERNAM
            , AEDAT
            , AEZET
            , AENAM            
		)
		SELECT  X.MANDT
			   ,X.PSPID
			   ,CAST(#{SEQ} AS VARCHAR(3)) AS SEQ
			   ,X.POSNR
			   ,X.HOGI
			   ,X.MATNR
			   ,X.PRH AS NAM_CHAR
			   --,X.PRHNAME AS ATBEZ
			   ,NVL(DECODE(X.ATFOR, 'NUM', REPLACE(Y.CHAR_VALUE, ',', ''), Y.CHAR_VALUE), '') AS CHAR_VALUE
			   ,NVL(Y.CHAR_VALUEMD, '') AS CHAR_VALUEMD
			   , NVL(Y.ATWTB, '' ) AS ATWTB
			   ,X.ATKLA AS ATKLA
			   , (SELECT CASE COUNT(*) WHEN 0 THEN 0 ELSE 1 END
				   FROM SAPHEE.CAWN
					 WHERE MANDT = X.MANDT
					AND ATINN = X.ATINN  ) AS CNT
			   ,X.ATFOR AS CNGBN
			   , REPLACE(CURRENT_DATE, '-', '') AS ERDAT
			   , REPLACE(CURRENT_TIME, '.', '') AS ERZET
			   , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM 
			   , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
			   , REPLACE(CURRENT_TIME, '.', '') AS AEZET
			   , CAST(#{AENAM} AS VARCHAR(36))  AS AENAM
		FROM  (
				SELECT A.MANDT
					  ,C.PSPID
					  ,C.POSNR
					  ,C.MATNR
					  ,C.HOGI
					  ,A.PRH
					  ,(SELECT ATBEZ FROM SAPHEE.CABNT WHERE MANDT = B.MANDT AND ATINN = B.ATINN AND SPRAS = '3') AS PRHNAME
					  ,B.ATINN
					  ,B.ATKLA
					  ,B.ATFOR
					  ,A.BRNDSEQ
					  ,A.ZPRDGBN
					  ,A.BRNDCD
					  ,A.DISPTP
					  ,A.MODITP
				 FROM  SAPHEE.ZSDT1141 AS A
					   INNER JOIN SAPHEE.CABN AS B ON A.MANDT = B.MANDT AND A.PRH = B.ATNAM
					   INNER JOIN TABLE (
									  SELECT X.MANDT
											,X.PSPID
											,X.POSNR
											,X.MATNR
											,X.HOGI
											,X.BRNDSEQ
											,X.ZPRDGBN
											,X.BRNDCD
											,X.MAX_QTNUM
									  FROM  (
											  SELECT A.MANDT
													,A.ZZPJT_ID AS PSPID
													,B.POSNR
													,B.MATNR
													,CASE B.MATNR WHEN 'L-1000' THEN 'ELV_01'
																  WHEN 'L-1100' THEN 'WL_01'
																  WHEN 'L-1200' THEN 'DW_01'
																  WHEN 'L-2000' THEN 'ELV_02'
																  WHEN 'S-1000' THEN 'ESC_01'
																  WHEN 'W-1000' THEN 'MW_01'
																  WHEN 'J-1000' THEN 'AP_01'
																  WHEN 'T-1000' THEN 'SV_01'
																  WHEN 'Y-1000' THEN 'SP_01'
													 END AS ZPRDGBN
													,B.HOGI AS HOGI
													,MAX(C.QTNUM) OVER(PARTITION BY A.MANDT, A.ZZPJT_ID) AS MAX_QTNUM
													,NVL(C.QTNUM, '') AS QTNUM
													,C.QTSER
													,C.QTSEQ
                                                    ,CASE WHEN B.BRNDCD IS NULL THEN
                                                        'NOBRND'
                                                          WHEN B.BRNDCD = '' THEN
                                                        'NOBRND'
                                                     ELSE
                                                         B.BRNDCD
                                                     END AS BRNDCD
                                                    ,B.BRNDSEQ AS BRNDSEQ
											  FROM   SAPHEE.VBAK AS A
													 INNER JOIN SAPHEE.VBAP AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN
													 LEFT OUTER JOIN SAPHEE.ZSDT1047 AS C ON B.MANDT = B.MANDT AND B.QTNUM = C.QTNUM AND B.QTSER = C.QTSER AND B.QTSEQ = C.QTSEQ
											  WHERE  A.MANDT = #{MANDT}
												AND  A.ZZPJT_ID = #{PSPID}
											  ) AS X  
						) AS C ON A.MANDT = C.MANDT AND A.BRNDSEQ = C.BRNDSEQ AND A.ZPRDGBN = C.ZPRDGBN AND A.BRNDCD = C.BRNDCD
						LEFT OUTER JOIN SAPHEE.ZSDT1073 AS D ON D.MANDT = A.MANDT AND D.CLASS = A.ZPRDGBN  AND D.ATNAM = A.PRH
				 WHERE  D.ATNAM IS NULL
			 )  AS X
			 LEFT OUTER JOIN (SELECT A.MANDT
									 , A.ZZPJT_ID AS PSPID
									 , B.POSNR
									 , B.HOGI
									 , B.MATNR
		                             , CASE  F.ATWRT 
							                       WHEN '' THEN    CASE (SELECT ATFOR FROM SAPHEE.CABN WHERE MANDT = '183' AND ATINN = F.ATINN) 
                               					   		   		   		            WHEN 'NUM' THEN TRIM(CHAR(BIGINT(VALUE(F.ATFLV,0)))) ELSE TRIM(F.ATWRT) END  
                                                   ELSE  TRIM(F.ATWRT) END  AS CHAR_VALUE	
									 , '' AS CHAR_VALUEMD
									 , H.ATWTB
									 , F.ATINN
								FROM SAPHEE.VBAK AS A
									 INNER JOIN SAPHEE.VBAP AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN  
									 INNER JOIN SAPHEE.IBINOWN AS C ON B.MANDT = C.MANDT AND B.CUOBJ = C.INSTANCE 
									 INNER JOIN SAPHEE.IBIN AS D ON C.MANDT = D.MANDT AND C.INSTANCE = D.INSTANCE
									 INNER JOIN SAPHEE.IBINVALUES AS E ON D.MANDT = E.MANDT AND D.IN_RECNO = E.IN_RECNO
									 INNER JOIN SAPHEE.IBSYMBOL AS F  ON E.MANDT = F.MANDT AND E.SYMBOL_ID = F.SYMBOL_ID
									 LEFT OUTER JOIN (SELECT T1.ATWTB, T2.ATINN, T2.ATWRT  
															  FROM SAPHEE.CAWNT AS T1 
																   INNER JOIN SAPHEE.CAWN AS T2 ON T1.MANDT = T2.MANDT AND T1.ATINN = T2.ATINN AND T1.ATZHL = T2.ATZHL AND T1.SPRAS = '3'
															 WHERE T1.MANDT = #{MANDT}
															   AND T1.SPRAS = '3') AS H ON F.ATINN = H.ATINN AND F.ATWRT = H.ATWRT
							   WHERE A.MANDT = #{MANDT}
								 AND A.ZZPJT_ID = #{PSPID}
			 ) AS Y ON X.MANDT = X.MANDT AND X.PSPID = Y.PSPID AND X.POSNR = Y.POSNR AND X.HOGI = Y.HOGI AND X.MATNR = Y.MATNR AND X.ATINN = Y.ATINN
	</insert>

	<insert id="insertSpecCsub" parameterType="hdel.sd.sso.domain.ZSDT0094">
		INSERT INTO SAPHEE.ZSDT0094 (
			MANDT
            , PSPID
            , SEQ
            , POSNR
            , HOGI
            , MATNR
            , NAM_CHAR
            --, ATBEZ
            , CHAR_VALUE
            , CHAR_VALUEMD
            , ATWTB
            , ATKLA
            , CNT
            , CNGBN
            , ERDAT
            , ERZET
            , ERNAM
            , AEDAT
            , AEZET
            , AENAM            
		)
		SELECT CAST (#{MANDT} AS VARCHAR(10)) AS MANDT
               , CAST (#{PSPID} AS VARCHAR(10)) AS PSPID
               , CAST(#{SEQ} AS SMALLINT) 		AS SEQ
               , CAST (#{POSNR} AS VARCHAR(10)) AS POSNR
               , CAST(#{HOGI} AS VARCHAR(72)) AS HOGI
               , case substr(#{MATNR},1,1) when 'Y'  then cast('Y-1000' as varchar(10)) else CAST(#{MATNR} AS VARCHAR(10)) end AS MATNR
               , B.ATNAM 	AS NAM_CHAR
               --, C.ATBEZ
               , '' AS CHAR_VALUE
               , '' AS CHAR_VALUEMD
               , '' AS ATWTB
               , B.ATKLA
               , (SELECT CASE COUNT(*) WHEN 0 THEN 0 ELSE 1 END FROM SAPHEE.CAWN WHERE MANDT	= B.MANDT AND ATINN	= B.ATINN  ) AS CNT
               , B.ATFOR AS CNGBN 
               , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
               , REPLACE(CURRENT_TIME, '.', '') AS ERZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM 
               , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
               , REPLACE(CURRENT_TIME, '.', '') AS AEZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS AENAM
		  FROM	SAPHEE.KSML AS A
				INNER JOIN		    SAPHEE.CABN AS B	ON A.MANDT = B.MANDT	AND A.IMERK = B.ATINN
				LEFT OUTER JOIN		SAPHEE.CABNT AS C	ON B.MANDT = C.MANDT	AND B.ATINN = C.ATINN
				INNER JOIN			SAPHEE.KLAH AS D	ON A.MANDT = D.MANDT	AND A.CLINT = D.CLINT
		 WHERE A.MANDT = #{MANDT}
		   AND A.KLART = '300'
		   AND D.CLASS = (SELECT CLASS FROM SAPHEE.ZSDT0091 WHERE MANDT = #{MANDT} AND PSPID = #{PSPID} AND SEQ = #{SEQ} AND POSNR = #{POSNR})
		   AND C.SPRAS = '3'
           AND B.ATKLA != 'EL_ZCOST'
	</insert>
	
	<update id="mergeSpecC" parameterType="hdel.sd.sso.domain.ZSDT0094">
		MERGE INTO SAPHEE.ZSDT0094 AS T1
		USING (SELECT CAST(#{MANDT} AS VARCHAR(9))  AS MANDT
                     , CAST(#{PSPID} AS VARCHAR(72)) AS PSPID
                     , CAST(#{SEQ} AS SMALLINT) AS SEQ
                     , CAST(#{POSNR} AS VARCHAR(18)) AS POSNR
                     , CASE WHEN CAST(#{HOGI} AS VARCHAR(72)) = '' THEN (SELECT MAX(HOGI) FROM SAPHEE.ZSDT0094 WHERE MANDT = #{MANDT} AND PSPID = #{PSPID} AND SEQ = #{SEQ} AND POSNR = #{POSNR})
                       ELSE CAST(#{HOGI} AS VARCHAR(72)) END AS HOGI
                     , case substr(#{MATNR},1,1) when 'Y'  then cast('Y-1000' as varchar(54)) else CAST(#{MATNR} AS VARCHAR(54)) end AS MATNR
                     , CAST(#{NAM_CHAR} AS VARCHAR(90)) AS NAM_CHAR
                     , CAST(#{CHAR_VALUE} AS VARCHAR(180)) AS CHAR_VALUE
                     , CAST(#{CHAR_VALUEMD} AS VARCHAR(180)) AS CHAR_VALUEMD
                     , CAST(#{ATWTB} AS VARCHAR(90)) AS ATWTB
                     , CAST(#{ATKLA} AS VARCHAR(30)) AS ATKLA
                     , CAST(#{CNT} AS SMALLINT) AS CNT
                     , CAST(#{CNGBN} AS VARCHAR(12)) AS CNGBN
					 , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
					 , REPLACE(CURRENT_TIME, '.', '') AS ERZET
                     , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM                      
					 , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
					 , REPLACE(CURRENT_TIME, '.', '') AS AEZET
                     , CAST(#{AENAM} AS VARCHAR(36))  AS AENAM 
                FROM SYSIBM.SYSDUMMY1
				 ) AS T2 ON T1.MANDT = T2.MANDT
						AND T1.PSPID = T2.PSPID
						AND T1.SEQ = T2.SEQ
                        AND T1.POSNR = T2.POSNR
                        AND T1.HOGI = T2.HOGI
                        AND T1.MATNR = T2.MATNR
                        AND T1.NAM_CHAR = T2.NAM_CHAR
		WHEN MATCHED THEN
				UPDATE SET T1.CHAR_VALUE = T2.CHAR_VALUE
                           , T1.CHAR_VALUEMD = T2.CHAR_VALUEMD
                           , T1.ATWTB = T2.ATWTB
                           , T1.ATKLA = T2.ATKLA
                           , T1.CNT = T2.CNT
                           , T1.CNGBN = T2.CNGBN
                           , T1.AEDAT = T2.AEDAT
                           , T1.AEZET = T2.AEZET
                           , T1.AENAM = T2.AENAM                           
		WHEN NOT MATCHED THEN
				INSERT ( 
                	MANDT
                    , PSPID
                    , SEQ
                    , POSNR
                    , HOGI
                    , MATNR
                    , NAM_CHAR
                    , CHAR_VALUE
                    , CHAR_VALUEMD
                    , ATWTB
                    , ATKLA
                    , CNT
                    , CNGBN
                    , ERDAT
                    , ERZET
                    , ERNAM
                    , AEDAT
                    , AEZET
                    , AENAM                    
                    
				) VALUES (
                	T2.MANDT
                    , T2.PSPID
                    , T2.SEQ
                    , T2.POSNR
                    , T2.HOGI
                    , T2.MATNR
                    , T2.NAM_CHAR
                    , T2.CHAR_VALUE
                    , T2.CHAR_VALUEMD
                    , T2.ATWTB
                    , T2.ATKLA
                    , T2.CNT
                    , T2.CNGBN
                    , T2.ERDAT                                         
			   		, T2.ERZET
               		, T2.ERNAM
                    , T2.ERDAT                                         
			   		, T2.ERZET
               		, T2.ERNAM               		
				)
	</update>
	
	<select id="selectChkHeader" parameterType="hdel.sd.sso.domain.ZSDT0090" resultMap="SsoResultMap">
		SELECT REPLACE(HOGI, PSPID, '') AS HOGI
		       , SUM(DECODE(CHCK, 'X', '1', '0')) OVER(PARTITION BY PSPID) AS CHKCNT
		       , COUNT(*) OVER(PARTITION BY PSPID) - SUM(DECODE(HOGI_CANC, 'X', '1', '0')) OVER(PARTITION BY PSPID) AS HOGICNT
		       , CHCK
		  FROM SAPHEE.ZSDT0091 AS A		  						
		 WHERE A.MANDT = #{MANDT}
		   AND A.PSPID = #{PSPID}
		   AND A.SEQ = #{SEQ}
		 ORDER BY HOGI
		WITH UR
	</select>
	
	<update id="updateHeader" parameterType="hdel.sd.sso.domain.ZSDT0090">
		UPDATE SAPHEE.ZSDT0090 SET
			BIGO5 = #{BIGO5}
		 WHERE MANDT = #{MANDT}
	       AND PSPID = #{PSPID}
	       AND SEQ   = #{SEQ}
	</update>
	
	<insert id="insertZero0090" parameterType="hdel.sd.sso.domain.ZSDT0090">
		INSERT INTO SAPHEE.ZSDT0090 (
       		MANDT
       		, VBELN
       		, PSPID
       		, SEQ
       		, ZQNTY
            , NETWR
            , WAVWR
            , COMMI
            , VDATU
            , WAERK
            , CHNETWR
            , CHWAVWR
            , CHCOMMI
            , CHVDATU
            , CHWAERK
            , FINL
            , ERDAT
            , ERZET
            , ERNAM
            , AEDAT
            , AEZET
            , AENAM            
            , BIGO1
            , BIGO2
            , BIGO3
            , BIGO4
            , BIGO5
            , CHRES
            , REDEP
            , CHRES_A
            , REDEP_A
            , CHRES_B
            , REDEP_B
            , CHRES_C
            , REDEP_C
            , CHRES_D
            , REDEP_D
            , CHRES_E
            , REDEP_E
            , SHCHK
            , CHSHCHK
       	)
       	SELECT MANDT
          	   , VBELN
          	   , PSPID
          	   , 0 AS SEQ
          	   , ZQNTY
               , NETWR
               , WAVWR
               , COMMI
               , VDATU
               , WAERK
               , CHNETWR
               , CHWAVWR
               , CHCOMMI
               , CHVDATU
               , CHWAERK
               , FINL
			   , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
			   , REPLACE(CURRENT_TIME, '.', '') AS ERZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM 
			   , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
			   , REPLACE(CURRENT_TIME, '.', '') AS AEZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS AENAM               
               , BIGO1
               , BIGO2
               , BIGO3
               , BIGO4
               , BIGO5
               , CHRES
               , REDEP
               , CHRES_A
               , REDEP_A
               , CHRES_B
               , REDEP_B
               , CHRES_C
               , REDEP_C
               , CHRES_D
               , REDEP_D
               , CHRES_E
               , REDEP_E
               , SHCHK
               , CHSHCHK
    	  FROM SAPHEE.ZSDT0090	
    	 WHERE MANDT = #{MANDT}
    	   AND PSPID = #{PSPID}
    	   AND SEQ   = #{SEQ}
	</insert>
	
	<insert id="insertZero0091" parameterType="hdel.sd.sso.domain.ZSDT0091">
		INSERT INTO SAPHEE.ZSDT0091 (
			MANDT
            , VBELN
            , PSPID
            , SEQ
            , POSNR
            , HOGI
            , NETWR
            , WAVWR
            , EDATU
            , REPMO
            , WORMO
            , CHNETWR
            , CHWAVWR
            , CHEDATU
            , CHREPMO
            , CHWORMO
            , WAERK
            , ERDAT
            , ERZET
            , ERNAM
            , AEDAT
            , AEZET
            , AENAM            
            , CHCK
            , AUART
            , KZWI4
            , HOGI_CANC
            , GUAMO
            , CHGUAMO
            , MATNR
            , CLASS
            , SPEC_STAT
            , ARKTX
            , BRNDCD
            , BRNDSEQ
		)
		SELECT MANDT
		       , VBELN
		       , PSPID
		       , 0 AS SEQ
		       , POSNR
		       , HOGI
               , NETWR
               , WAVWR
               , EDATU
               , REPMO
               , WORMO
               , CHNETWR
               , CHWAVWR
               , CHEDATU
               , CHREPMO
               , CHWORMO
               , WAERK
               , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
			   , REPLACE(CURRENT_TIME, '.', '') AS ERZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM
               , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
			   , REPLACE(CURRENT_TIME, '.', '') AS AEZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS AENAM               
               , CHCK
               , AUART
               , KZWI4
               , HOGI_CANC
               , GUAMO
               , CHGUAMO
               , MATNR
               , CLASS
               , SPEC_STAT
               , ARKTX
               , BRNDCD
               , BRNDSEQ
          FROM SAPHEE.ZSDT0091
         WHERE MANDT = #{MANDT}
           AND PSPID = #{PSPID}
           AND SEQ   = #{SEQ}
	</insert>

	<insert id="insertZero0092" parameterType="hdel.sd.sso.domain.ZSDT0092">
		INSERT INTO SAPHEE.ZSDT0092 (
			MANDT
			, VBELN
            , PSPID
            , SEQ
            , POSNR
            , HOGI
            , FKDAT
            , MLBEZ
            , ZTERM
            , FKSAF
            , FPLTR
            , FAKWR
            , WAERK
            , ERDAT
            , ERZET
            , ERNAM
            , AEDAT
            , AEZET
            , AENAM
            , MSTXT
		)
		SELECT MANDT
               , VBELN
               , PSPID
               , 0 AS SEQ
               , POSNR
               , HOGI
               , FKDAT
               , MLBEZ
               , ZTERM
               , FKSAF
               , FPLTR
               , FAKWR
               , WAERK
               , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
			   , REPLACE(CURRENT_TIME, '.', '') AS ERZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM
               , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
			   , REPLACE(CURRENT_TIME, '.', '') AS AEZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS AENAM               
               , MSTXT
          FROM SAPHEE.ZSDT0092
         WHERE MANDT = #{MANDT}
           AND PSPID = #{PSPID}
           AND SEQ   = #{SEQ}
	</insert>
	
	<insert id="insertZero0093" parameterType="hdel.sd.sso.domain.ZSDT0093">
		INSERT INTO SAPHEE.ZSDT0093 (
			MANDT
	        , VBELN
	        , PSPID
	        , SEQ
	        , POSNR
	        , HOGI
	        , CHFKDAT
	        , CHMLBEZ
	        , CHZTERM
	        , CHFKSAF
	        , FPLTR
	        , CHFAKWR
	        , WAERK
	        , ERDAT
	        , ERZET
	        , ERNAM
	        , AEDAT
	        , AEZET
	        , AENAM	        
	        , CHMSTXT
		)
		SELECT MANDT
               , VBELN
               , PSPID
               , 0 AS SEQ
               , POSNR
               , HOGI
               , CHFKDAT
               , CHMLBEZ
               , CHZTERM
               , CHFKSAF
               , FPLTR
               , CHFAKWR
               , WAERK
               , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
			   , REPLACE(CURRENT_TIME, '.', '') AS ERZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM
               , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
			   , REPLACE(CURRENT_TIME, '.', '') AS AEZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS AENAM               
               , CHMSTXT
          FROM SAPHEE.ZSDT0093
         WHERE MANDT = #{MANDT}
           AND PSPID = #{PSPID}
           AND SEQ   = #{SEQ}
	</insert>
	
	<insert id="insertZero0094" parameterType="hdel.sd.sso.domain.ZSDT0094">
		INSERT INTO SAPHEE.ZSDT0094 ( 
			MANDT
            , PSPID
            , SEQ
            , POSNR
            , HOGI
            , MATNR
            , NAM_CHAR
            --, ATBEZ
            , CHAR_VALUE
            , CHAR_VALUEMD
            , ATWTB
            , ATKLA
            , CNT
            , CNGBN
            , ERDAT
            , ERZET
            , ERNAM
            , AEDAT
            , AEZET
            , AENAM
		)
		SELECT A.MANDT
		       , A.PSPID
		       , 0
		       , A.POSNR
		       , A.HOGI
		       , A.MATNR
		       , A.NAM_CHAR
		       --, A.ATBEZ
		       , NVL(DECODE(A.CNGBN, 'NUM', REPLACE(B.CHAR_VALUE, ',', ''), B.CHAR_VALUE), '') AS CHAR_VALUE
		       , NVL(B.CHAR_VALUEMD, '' ) AS CHAR_VALUEMD
		       , NVL(B.ATWTB, '' ) AS ATWTB
		       , A.ATKLA
               , ( SELECT CASE COUNT(*) WHEN 0 THEN 0 ELSE 1 END
		  		   FROM   SAPHEE.CAWN
  		 		   WHERE  MANDT	= A.MANDT
	   			   AND    ATINN	= A.ATINN  ) AS CNT
		       , A.CNGBN
		       , REPLACE(CURRENT_DATE, '-', '') AS ERDAT                                         
			   , REPLACE(CURRENT_TIME, '.', '') AS ERZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS ERNAM
		       , REPLACE(CURRENT_DATE, '-', '') AS AEDAT                                         
			   , REPLACE(CURRENT_TIME, '.', '') AS AEZET
               , CAST(#{ERNAM} AS VARCHAR(36))  AS AENAM               
		  FROM TABLE(SELECT A.MANDT
		                    , B.ATKLA
		                    , B.ATNAM AS NAM_CHAR
		                    --, C.ATBEZ
		                    , B.ATFOR AS CNGBN
		                    , D.CLASS
		                    , E.PSPID
		                    , E.SEQ
		                    , E.POSNR
		                    , E.HOGI
		                    , E.MATNR
		                    , B.ATINN
		               FROM (SELECT MANDT
		                           , CLINT
		                           , IMERK
		                      FROM SAPHEE.KSML
		                     WHERE 1 = 1
		                       AND MANDT = #{MANDT}
		                       AND KLART = '300') A
		                     INNER JOIN SAPHEE.CABN AS B       ON A.MANDT = B.MANDT AND A.IMERK = B.ATINN
		                     LEFT OUTER JOIN SAPHEE.CABNT AS C ON B.MANDT = C.MANDT AND B.ATINN = C.ATINN
		                     INNER JOIN SAPHEE.KLAH AS D       ON A.MANDT = D.MANDT AND A.CLINT = D.CLINT
		                     LEFT OUTER JOIN (SELECT A.MANDT
		                                             , A.ZZPJT_ID AS PSPID
		                                             , CAST(#{SEQ} AS VARCHAR(3)) AS SEQ
		                                             , B.POSNR
		                                             , B.HOGI
		                                             , B.MATNR
		                                             , CASE B.MATNR WHEN 'L-1000' THEN 'ELV_01'
		                                                            WHEN 'L-1100' THEN 'WL_01'
		                                                            WHEN 'L-1200' THEN 'DW_01'
		                                                            WHEN 'L-2000' THEN 'ELV_02'
		                                                            WHEN 'S-1000' THEN 'ESC_01'
		                                                            WHEN 'W-1000' THEN 'MW_01'
		                                                            WHEN 'J-1000' THEN 'AP_01'
		                                                            WHEN 'T-1000' THEN 'SV_01'
		                                                            WHEN 'Y-1000' THEN 'SP_01'
		                                               END AS CLASS
		                                        FROM SAPHEE.VBAK AS A
		                                             INNER JOIN SAPHEE.VBAP AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN
		                                       WHERE A.MANDT = #{MANDT}
		                                         AND A.ZZPJT_ID = #{PSPID}) AS E ON A.MANDT = E.MANDT
		              WHERE C.SPRAS = '3'
		                AND D.CLASS = E.CLASS) A
		       LEFT OUTER JOIN (SELECT A.MANDT
		                               , A.ZZPJT_ID AS PSPID
		                               , B.POSNR
		                               , B.HOGI
		                               , B.MATNR
		                               ,CASE  F.ATWRT 
							                       WHEN '' THEN    CASE (SELECT ATFOR FROM SAPHEE.CABN WHERE MANDT = '183' AND ATINN = F.ATINN) 
                               					   		   		   		            WHEN 'NUM' THEN TRIM(CHAR(BIGINT(VALUE(F.ATFLV,0)))) ELSE TRIM(F.ATWRT) END  
                                                   ELSE  TRIM(F.ATWRT) END  AS CHAR_VALUE	
		                               , '' AS CHAR_VALUEMD
		                               , H.ATWTB
		                               , F.ATINN
		                          FROM SAPHEE.VBAK AS A
		                               INNER JOIN SAPHEE.VBAP AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN  
		                               INNER JOIN SAPHEE.IBINOWN AS C ON B.MANDT = C.MANDT AND B.CUOBJ = C.INSTANCE 
		                               INNER JOIN SAPHEE.IBIN AS D ON C.MANDT = D.MANDT AND C.INSTANCE = D.INSTANCE
		                               INNER JOIN SAPHEE.IBINVALUES AS E ON D.MANDT = E.MANDT AND D.IN_RECNO = E.IN_RECNO
		                               INNER JOIN SAPHEE.IBSYMBOL AS F  ON E.MANDT = F.MANDT AND E.SYMBOL_ID = F.SYMBOL_ID
		                               LEFT OUTER JOIN (SELECT T1.ATWTB, T2.ATINN, T2.ATWRT  
                                                          FROM SAPHEE.CAWNT AS T1 
                                                               INNER JOIN SAPHEE.CAWN AS T2 ON T1.MANDT = T2.MANDT AND T1.ATINN = T2.ATINN AND T1.ATZHL = T2.ATZHL AND T1.SPRAS = '3'
                                                         WHERE T1.MANDT = '183'
                                                           AND T1.SPRAS = '3') AS H ON F.ATINN = H.ATINN AND F.ATWRT = H.ATWRT
		                         WHERE A.MANDT = #{MANDT}
		                           AND A.ZZPJT_ID = #{PSPID}) AS B ON A.MANDT = B.MANDT AND A.PSPID = B.PSPID AND A.POSNR = B.POSNR AND A.HOGI = B.HOGI AND A.MATNR = B.MATNR AND A.ATINN = B.ATINN
          WHERE A.NAM_CHAR NOT LIKE 'EL_Z%'
            AND A.NAM_CHAR NOT LIKE 'VARCOND%'
            AND A.NAM_CHAR NOT IN ( 'EL_DOPTA', 'EL_DITEM' )
	</insert>
	<select id="getPartnerZ3" parameterType="map" resultType="java.lang.String">
		select vbpa.kunnr
		from saphee.vbap as vbap
	  	inner join saphee.vbpa as vbpa on vbap.mandt=vbpa.mandt and vbap.vbeln=vbpa.vbeln
		where vbap.mandt = #{mandt}
		  and vbap.hogi = #{posid}
		  and vbpa.posnr = '000000'
		  and vbpa.parvw = 'Z3'
		with ur
	</select>
	<select id="getExceptionalVbeln" parameterType="map" resultType="hdel.lib.domain.ZSDT0129">
		select vbeln, kbetr
		from saphee.zsdt0129
		where mandt = #{mandt}
		  and vbeln = #{vbeln}
		with ur
	</select>

	<select id="getZsdt0220Kbetr" parameterType="map" resultType="java.lang.Double">
	 <![CDATA[
	    SELECT  ZSDT0220.KBETR AS KBETR
	    FROM SAPHEE.VBPA AS VBPA 
	    INNER JOIN SAPHEE.ZSDT0220 AS ZSDT0220
		  ON VBPA.MANDT = ZSDT0220.MANDT
		  AND VBPA.LZONE = ZSDT0220.ZONE1
	   WHERE VBPA.MANDT = #{mandt}
	     AND VBPA.VBELN = #{vbeln}
	     AND VBPA.PARVW = 'WE'
	     AND ZSDT0220.DATAB <= #{contrda}
	     AND ZSDT0220.DATBI >= #{contrda}
	   WITH UR
	 ]]>  
	</select>	

	<select id="getZsdt0223Area" parameterType="map" resultType="java.lang.String">
	    -- 운송지역 수수료 권역관리
	<![CDATA[ 
		SELECT zsdt0223.area
		  FROM saphee.vbpa AS vbpa INNER JOIN saphee.zsdt0223 AS zsdt0223
		  							  ON vbpa.mandt = zsdt0223.mandt
		  							 AND vbpa.lzone = zsdt0223.zone1
		 WHERE vbpa.mandt = #{mandt}
		   AND vbpa.vbeln = #{vbeln}
		   AND vbpa.posnr = '000000'
		   AND vbpa.parvw = 'WE'
		   AND zsdt0223.datab <= #{contrda}
		   AND zsdt0223.datbi >= #{contrda}
		with ur
	]]>	
	</select>

	<select id="getAdtZa90" parameterType="map" resultType="java.lang.Double">
		select kbetr
		from saphee.zsdt0208
		where mandt = #{mandt}
		  and vbeln = #{vbeln}
		with ur
	</select>

    <!--  대리점 수수료 기준일자  -->
	<select id="SelectDateCommi" parameterType="hdel.sd.sso.domain.Sso0055ParamVO" resultMap="SsoResultMap">
		SELECT 'QTDAT' AS DATE_TP, z1046.qtdat AS BSDATE
		  FROM saphee.zsdt1046 AS z1046 INNER JOIN saphee.vbak AS vbak 
		  	     						  ON z1046.mandt=vbak.mandt 
										 AND z1046.vbeln=vbak.zzpjt_id
		 WHERE z1046.mandt = #{MANDT}
		   AND z1046.vbeln = #{PSPID}
		WITH UR			
	</select>
	
	<!-- 영업사원 조회 -->
	<select id="SelectKunnr" parameterType="map" resultType="java.lang.String">
		SELECT kunnr
		  FROM saphee.vbpa
		 WHERE mandt = #{mandt}
		   AND vbeln = (SELECT vbeln
						  FROM saphee.vbak
						 WHERE mandt = #{mandt} 
						   AND zzpjt_id = #{vbeln})
		   AND posnr = '000000'
		   AND parvw = 'Z2'
		with ur
	</select>
	
	<!--  리모델링 대리점 판매수수료 지급 관련 현대협력사 여부 조회 -->
	<select id="SelectZsdt0214" parameterType="map" resultType="java.lang.Integer"> 
		SELECT count(*)
		  FROM saphee.zsdt0214
		 WHERE kunnr = #{kunnr}
		   AND delet = ''
		with ur
	</select>
	
	<!-- standard Table의 청구계획 조회(0원빌링조정) -->
	<select id="SelectFksaf" parameterType="map" resultType="java.lang.Integer">
		SELECT count(*)
		  FROM saphee.vbak vbak
		  JOIN saphee.vbkd vbkd
		    ON vbak.mandt = vbkd.mandt 
		   AND vbak.vbeln = vbkd.vbeln
		  JOIN saphee.fplt fplt
		    ON vbkd.mandt = fplt.mandt
		   AND vbkd.fplnr = fplt.fplnr
		 WHERE vbak.mandt = #{mandt} 
		   AND vbak.zzpjt_id = #{pspId}
		   AND vbkd.posnr != '000000'
		   AND fplt.fksaf != 'C'
		with ur
	</select>
	
	<!-- 입력 후 차수 변경하여 삭제하지 못하도록 검증 -->
	<select id="SelectFinl" parameterType="hdel.sd.sso.domain.ZSDT0090" resultType="java.lang.String">
		SELECT finl
		  FROM saphee.zsdt0090
		 WHERE mandt = #{MANDT}
    	   AND pspid = #{PSPID}
    	   AND seq   = #{SEQ}
		with ur
	</select>
	
	<select id="getMaxSeq" parameterType="map" resultType="java.lang.Integer">
		SELECT value(max(seq), 0)
		  FROM saphee.zsdt0090
		 WHERE mandt = #{mandt}
		   AND pspid = #{vbeln}
		with ur
	</select>
	
	<select id="SelectQtnum" parameterType="hdel.sd.sso.domain.ZSDT0090" resultType="java.lang.String">
		SELECT MAX(C.QTNUM) AS QTNUM
		FROM   SAPHEE.VBAK AS A                                                                                                       
		       INNER JOIN SAPHEE.VBAP AS B ON A.MANDT = B.MANDT AND A.VBELN = B.VBELN                                                 
		       INNER JOIN SAPHEE.ZSDT1047 AS C ON B.MANDT = B.MANDT AND B.QTNUM = C.QTNUM AND B.QTSER = C.QTSER AND B.QTSEQ = C.QTSEQ 
		WHERE  A.MANDT = #{MANDT}                                                                                                        
		  AND  A.ZZPJT_ID = #{PSPID}                                                                                                  
		WITH UR
	</select>
	
		
	<!-- JQPR 조회 -->
	<resultMap id="selectJqprMap" type="hdel.sd.sso.domain.ZSDT1108"></resultMap>  
	<select id="selectJqpr" parameterType="hdel.sd.sso.domain.ZSDT1108" resultMap="selectJqprMap">
		SELECT mandt, vbeln, hogi, jqprnum, jqprno, max(remarkhogi) AS remarkhogi, max(remarkrow) AS remarkrow, iwbtr,  MAX(SEQ) AS SEQ
		FROM TABLE 
		(SELECT zqm7.mandt, zqm7.pspid AS vbeln, zqm7.hogi, zqm7.jqprnum, zqm7.jqprno, '' AS remarkhogi, '' AS remarkrow,
		   SUM(NVL(CASE zqm7.impktl  WHEN SUBSTR(CAST(z1109.kostl AS CHAR(10)), 6) THEN DECIMAL(zqm7.iwbtr *(zqm7.IMPKTL_P  * 0.01),15,2) END,0)+  
		       NVL(CASE zqm7.impktl2 WHEN SUBSTR(CAST(z1109.kostl AS CHAR(10)), 6) THEN DECIMAL(zqm7.iwbtr *(zqm7.IMPKTL2_P * 0.01),15,2) END,0)+ 
		       NVL(CASE zqm7.impktl3 WHEN SUBSTR(CAST(z1109.kostl AS CHAR(10)), 6) THEN DECIMAL(zqm7.iwbtr *(zqm7.IMPKTL3_P * 0.01),15,2) END,0)
		       )OVER(PARTITION BY zqm7.jqprnum) AS iwbtr,
	       0 AS SEQ
		FROM saphee.zqmt007 AS zqm7
			INNER JOIN saphee.zsdt1109 AS z1109 
				ON zqm7.mandt = z1109.mandt 
					AND (zqm7.impktl = SUBSTR(CAST(kostl AS CHAR(10)), 6) OR zqm7.impktl2 = SUBSTR(CAST(kostl AS CHAR(10)), 6) OR zqm7.impktl3 = SUBSTR(CAST(kostl AS CHAR(10)), 6))
		WHERE zqm7.mandt = #{mandt}
			AND zqm7.pspid = #{vbeln}
			AND zqm7.causecod IN ('F21', 'G15', 'G11', 'G13')
			<![CDATA[ AND zqm7.status <> '9'  ]]>
		UNION all
		SELECT mandt, vbeln, hogi, jqprnum, jqprno, remarkhogi, remarkrow, iwbtr, SEQ
		FROM saphee.zsdt1108 A
		WHERE A.mandt = #{mandt}
			AND A.vbeln = #{vbeln}
			AND A.SEQ = (SELECT MAX(SEQ) FROM SAPHEE.ZSDT1108 WHERE MANDT = A.MANDT AND VBELN = A.VBELN  AND  JQPRNUM = A.jqprnum AND HOGI = A.HOGI)
		) T
		GROUP BY T.mandt, T.vbeln, T.hogi, T.jqprnum, T.jqprno, T.iwbtr
		ORDER BY remarkhogi, remarkrow DESC
		WITH ur
	</select>
	
	<!-- JQPR 삽입 -->
	<update id="mergeZsdt1108" parameterType="hdel.sd.sso.domain.ZSDT1108">
		MERGE INTO saphee.zsdt1108 as z1108
			USING (
				SELECT CAST(#{mandt} AS VARCHAR(9))  AS mandt,
					CAST(#{vbeln} AS VARCHAR(30))  AS vbeln,
					CAST(#{hogi} AS VARCHAR(72))  AS hogi,
					CAST(#{jqprnum} AS VARCHAR(30))  AS jqprnum,
					CAST(#{jqprno} AS VARCHAR(60))  AS jqprno,
					CAST(#{remarkseq} AS SMALLINT)  AS remarkseq,
					CAST(#{remarkhogi} AS VARCHAR(72))  AS remarkhogi,
					CAST(#{remarkrow} AS VARCHAR(6))  AS remarkrow,
					REPLACE(CURRENT_DATE, '-', '') AS erdat,
					REPLACE(CURRENT_TIME, '.', '') AS erzet,
				 	CAST(#{ernam} AS VARCHAR(36))  AS ernam,
				 	REPLACE(CURRENT_DATE, '-', '') AS aedat,                                        
				 	REPLACE(CURRENT_TIME, '.', '') AS aezet,
				 	CAST(#{aenam} AS VARCHAR(36))  AS aenam,
			 		CAST(#{waers} AS VARCHAR(15))  AS waers,
			 		CAST(#{iwbtrorg} AS VARCHAR(13))  AS iwbtr,
			 		CAST(#{seq} AS SMALLINT)  AS seq
				FROM SYSIBM.SYSDUMMY1
				) as z1108set ON z1108set.MANDT = z1108.MANDT
                        AND z1108set.VBELN = z1108.VBELN
						AND z1108set.HOGI = z1108.HOGI
						AND z1108set.JQPRNUM = z1108.JQPRNUM
                        AND z1108set.JQPRNO = z1108.JQPRNO
                        AND z1108set.SEQ = z1108.SEQ
			WHEN MATCHED THEN
				UPDATE SET
					remarkseq = z1108set.remarkseq,
					remarkhogi = z1108set.remarkhogi,
					remarkrow = z1108set.remarkrow,
					seq = z1108set.seq,
					iwbtr = z1108set.iwbtr,
					waers = z1108set.waers,
					aedat = z1108set.aedat,
					aezet = z1108set.aezet,
					aenam = z1108set.aenam
			WHEN NOT MATCHED THEN
				INSERT (mandt, vbeln, hogi, jqprnum, jqprno, remarkseq, remarkhogi, remarkrow, erdat, erzet, ernam, aedat, aezet, aenam, iwbtr, waers, seq )
				VALUES (z1108set.mandt, z1108set.vbeln, z1108set.hogi, z1108set.jqprnum, z1108set.jqprno, z1108set.remarkseq, z1108set.remarkhogi, z1108set.remarkrow, 
						z1108set.erdat, z1108set.erzet, z1108set.ernam, z1108set.aedat, z1108set.aezet, z1108set.aenam, z1108set.iwbtr, z1108set.waers, z1108set.seq )
	</update>
	
	<!-- JQPR 삭제 -->
	<delete id="deleteZsdt1108" parameterType="hdel.sd.sso.domain.ZSDT1108">
		DELETE
		   FROM	SAPHEE.ZSDT1108		  						
		  WHERE MANDT	= #{mandt}
		    AND VBELN = #{vbeln}		 
		    AND REMARKSEQ   = #{remarkseq}
	</delete>
	
	<update id="updateZqmt007" parameterType="hdel.sd.sso.domain.ZSDT1108">
		UPDATE SAPHEE.ZQMT007
		SET 	Y66 = 'X'
		WHERE   MANDT = #{mandt}
		AND   JQPRNUM = #{jqprnum}
	</update>

	<!-- 프로젝트 Count -->
	<select id="validation_pspid" parameterType="map" resultType="java.lang.Integer">
		SELECT count(*)
		  FROM saphee.vbak
		 WHERE mandt 	= #{mandt} 
		   AND zzpjt_id = #{pspId}
		with ur
	</select>
	
</mapper>