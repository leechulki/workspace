<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hdel.sd.sch.dao.Sch0060D">

	<resultMap id="ComboResultMap" type="hdel.sd.sch.domain.ComboVO">
	    <result property="CODE" column="CODE"/>
	    <result property="CODE_NAME" column="CODE_NAME"/>
	</resultMap>

	<resultMap id="Sch0060ResultMap" type="hdel.sd.sch.domain.Sch0060">
		<result property="VKBUR" column="VKBUR"/>
		<result property="VKGRP" column="VKGRP"/>
		<result property="KUNZ1T" column="KUNZ1T"/>
		<result property="ZMAN_NM" column="ZMAN_NM"/>
		<result property="NAMET" column="NAMET"/>
		<result property="CELLP" column="CELLP"/>
		<result property="LIFNT" column="LIFNT"/>
		<result property="CELLP2" column="CELLP2"/>
		<result property="PSPID" column="PSPID"/>
		<result property="KUNNR" column="KUNNR"/>
		<result property="KUNNR_NM" column="KUNNR_NM"/>
		<result property="JUDGE" column="JUDGE"/>
		<result property="JMISUYN" column="JMISUYN"/>
		<result property="ZSITE_NM" column="ZSITE_NM"/>
		<result property="BSTDK_YM" column="BSTDK_YM"/>
		<result property="RECAD_DA" column="RECAD_DA"/>
		<result property="BSTDK" column="BSTDK"/>
		<result property="ZQNTY" column="ZQNTY"/>
		<result property="POSID" column="POSID"/>
		<result property="ARKTX" column="ARKTX"/>
		<result property="GUBUNA" column="GUBUNA"/>
		<result property="GUBUNB" column="GUBUNB"/>
		<result property="GUBUNC" column="GUBUNC"/>
		<result property="WWBLD" column="WWBLD"/>
		<result property="ILSIC" column="ILSIC"/>
		<result property="VDATU" column="VDATU"/>
		<result property="TXT30" column="TXT30"/>
		<result property="SSDATE1" column="SSDATE1"/>
		<result property="SSDATE" column="SSDATE"/>
		<result property="CLDATE1" column="CLDATE1"/>
		<result property="CLDATE" column="CLDATE"/>
		<result property="ZZSHIP1" column="ZZSHIP1"/>
		<result property="ZZCOMP2" column="ZZCOMP2"/>
		<result property="ZBEPJEO" column="ZBEPJEO"/>
		<result property="ZBOSUOUT" column="ZBOSUOUT"/>
		<result property="PRO_R" column="PRO_R"/>
		<result property="LMDAT" column="LMDAT"/>
		<result property="WAERK" column="WAERK"/>
		<result property="SUJU" column="SUJU"/>
		<result property="WAERK_F" column="WAERK_F"/>
		<result property="SUJU_F" column="SUJU_F"/>
		<result property="WAVWR"  column="WAVWR"/>
		<result property="WAVWR_F"  column="WAVWR_F"/>
		<result property="MECHUL" column="MECHUL"/>
		<result property="GISUNG_R" column="GISUNG_R"/>
		<result property="MECHULIK" column="MECHULIK"/>
		<result property="F_MECHUL" column="F_MECHUL"/>
		<result property="F_MECHULIK" column="F_MECHULIK"/>
		<result property="CHEONG" column="CHEONG"/>
		<result property="MICH" column="MICH"/>
		<result property="NETWR_RQ" column="NETWR_RQ"/>
		<result property="CCHEONG" column="CCHEONG"/>
		<result property="SUKEUM" column="SUKEUM"/>
		<result property="MISU" column="MISU"/>
		<result property="COLBI" column="COLBI"/>
		<result property="ZTERM" column="ZTERM"/>
		<result property="JMISU" column="JMISU"/>
		<result property="BILL" column="BILL"/>
		<result property="BILLTYPE" column="BILLTYPE"/>
		<result property="MEKIND" column="MEKIND"/>
		<result property="INGTEXT" column="INGTEXT"/>
		<result property="KMECHUL" column="KMECHUL"/>
		<result property="HSUKEUM" column="HSUKEUM"/>
		<result property="AMT00" column="AMT00"/>
		<result property="AMT01" column="AMT01"/>
		<result property="AMT02" column="AMT02"/>
		<result property="AMT03" column="AMT03"/>
		<result property="AMT04" column="AMT04"/>
		<result property="AMT05" column="AMT05"/>
		<result property="AMT06" column="AMT06"/>
		<result property="AMT07" column="AMT07"/>
		<result property="AMT08" column="AMT08"/>
		<result property="AMT09" column="AMT09"/>
		<result property="AMT10" column="AMT10"/>
		<result property="AMT11" column="AMT11"/>
		<result property="AMT12" column="AMT12"/>
		<result property="VBELN" column="VBELN"/>
		<result property="SPART" column="SPART"/>
		<result property="AUART" column="AUART"/>
		<result property="ZRQYM" column="ZRQYM"/>
		<result property="BYSYM" column="BYSYM"/>
	</resultMap>

	<select id="selectZSPEC" parameterType="hdel.sd.sch.domain.ComboParamVO" resultMap="ComboResultMap">
		SELECT CW.ATWRT AS CODE, WT.ATWTB AS CODE_NAME
		FROM SAPHEE.CABN AS CB
		   LEFT OUTER JOIN SAPHEE.CAWN AS CW
		      ON CB.MANDT = CW.MANDT
		      AND CB.ATINN = CW.ATINN
		   LEFT OUTER  JOIN SAPHEE.CAWNT AS WT
		      ON CW.MANDT = WT.MANDT
		      AND CW.ATINN = WT.ATINN
		      AND CW.ATZHL = WT.ATZHL
		      AND CW.ADZHL = WT.ADZHL
		      AND WT.SPRAS = '3'
		WHERE CB.MANDT = #{MANDT}
		   AND CB.ATNAM = #{ATNAM}	-- ±ま, ¿뵵, N½, ¼ӵµ
		WITH UR
	</select>

	<select id="selectCDATE" parameterType="hdel.sd.sch.domain.ComboParamVO" resultMap="ComboResultMap">
		SELECT ZCLOSE AS CODE, ZCLOSE AS CODE_NAME
		FROM SAPHEE.ZEIST104
		WHERE MANDT = #{MANDT}
		   AND ZYEAR = #{CDATE_YY}
		   AND ZMONTH = #{CDATE_MM}
		   --AND ZGUBUN = 'OH'
		WITH UR
	</select>

	<select id="selectGUBUN" parameterType="hdel.sd.sch.domain.ComboParamVO" resultMap="ComboResultMap">
		SELECT CODE2 AS CODE, CTEXT2 AS CODE_NAME
		FROM SAPHEE.ZLCODE
		WHERE 
		   MANDT = #{MANDT}
		   AND LANG = #{LANG}
		   AND CODE1 = #{CODE1}
		<if test="CODE1 =='EIS001'"> ORDER BY DTEXT1 </if>
		WITH UR
	</select>

	<select id="selectJUDGE" parameterType="hdel.sd.sch.domain.ComboParamVO" resultMap="ComboResultMap">
		SELECT DOMVALUE_L AS CODE, DDTEXT AS CODE_NAME
		  FROM SAPHEE.DD07T
		 WHERE DOMNAME = 'ZSDDJUDGE'
		WITH UR
	</select>

	<select id="selectZZACTSS" parameterType="hdel.sd.sch.domain.ComboParamVO" resultMap="ComboResultMap">
		SELECT CODE2 CODE, CTEXT2 CODE_NAME
		FROM SAPHEE.ZLCODE MM028A
		WHERE MM028A.MANDT = #{MANDT}
		   AND MM028A.CODE1 = #{CODE1}
		   AND MM028A.LANG = #{LANG}
		FOR FETCH ONLY
		WITH UR
	</select>

	<select id="selectTEMNO" parameterType="hdel.sd.sch.domain.ComboParamVO" resultMap="ComboResultMap">
		<![CDATA[
			SELECT TEMNO CODE, NAMET CODE_NAME
			FROM SAPHEE.ZPST0011
			WHERE MANDT = #{MANDT}
			   AND RETIF = ''
			   AND TEMNO > ''
			ORDER BY NAMET
			FOR FETCH ONLY
			WITH UR
		]]>
	</select>

	<select id="selectGUBUNC" parameterType="hdel.sd.sch.domain.ComboParamVO" resultMap="ComboResultMap">
		SELECT DOMVALUE_L AS CODE, DDTEXT AS CODE_NAME
		FROM SAPHEE.DD07T
		WHERE DOMNAME = #{DOMNAME}
		WITH UR
	</select>

	<select id="selectWWBLD" parameterType="hdel.sd.sch.domain.ComboParamVO" resultMap="ComboResultMap">
		SELECT WWBLD AS CODE, STEXT AS CODE_NAME
		FROM SAPHEE.ZV_SDT0008
		WHERE MANDT = #{MANDT}
		WITH UR
	</select>

	<select id="selectKUNZ1" parameterType="hdel.sd.sch.domain.ComboParamVO" resultMap="ComboResultMap">
		SELECT LIFNR AS CODE, NAME1 AS CODE_NAME
		FROM SAPHEE.LFA1
		WHERE MANDT = #{MANDT}
		   AND SORTL = #{SORTL}
		<if test="LIFNR !=null and LIFNR !=''"> AND LIFNR = #{LIFNR} </if>
		<if test="NAME1 !=null and NAME1 !=''"> AND NAME1 LIKE '%' || #{NAME1} || '%' </if>
		WITH UR
	</select>

	<select id="selectHOKI" parameterType="hdel.sd.sch.domain.Sch0060ParamVO" resultMap="Sch0060ResultMap">
		SELECT 
		     (SELECT VKBUR FROM SAPHEE.TVKBT WHERE MANDT = #{MANDT} AND SPRAS = '3'  AND VKBUR = AK.VKBUR) AS VKBUR
		   , (SELECT BEZEI FROM SAPHEE.TVKBT WHERE MANDT = #{MANDT} AND SPRAS = '3'  AND VKBUR = AK.VKBUR) AS VKBURT
		   , (SELECT VKGRP FROM SAPHEE.TVGRT WHERE MANDT = #{MANDT} AND SPRAS = '3' AND VKGRP = AK.VKGRP) AS VKGRP
		   , (SELECT BEZEI FROM SAPHEE.TVGRT WHERE MANDT = #{MANDT} AND SPRAS = '3' AND VKGRP = AK.VKGRP) AS VKGRPT
		   , EI7.KUNZ1T, MS1.ZMAN_NM, EI7.NAMET, EI7.CELLP, EI7.LIFNT, EI7.CELLP2, EI7.PSPID, MS1.KUNNR, MS1.KUNNR_NM, EI6.JUDGE
		   , EI7.JMISUYN, MS1.ZSITE_NM, SUBSTR(AK.BSTDK, 1, 6) AS BSTDK_YM, AK.RECAD_DA, AK.BSTDK, EI7.ZQNTY, EI7.POSID
		   , MS2.ZSPEC1 || ' ' || MS2.ZSPEC2 AS ARKTX, EI7.GBN, EI7.GUBUNA, EI7.GUBUNB, EI7.GUBUNC, AK.WWBLD, EI7.ILSIC, MS2.VDATU
		   , EI7.TXT30, EI7.SSDATE1, EI7.SSDATE, EI7.CLDATE1, EI7.CLDATE, MS2.ZZSHIP1, MS2.ZZCOMP2, MS2.ZBEPJEO, MS2.ZBOSUOUT
		   , EI7.PRO_R, EI7.LMDAT
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI7.WAERK_K
		           WHEN #{WAERK} = 'USD' THEN EI7.WAERK_U
		           ELSE EI7.WAERK_F 
		       END )AS WAERK 
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI7.SUJU_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI7.SUJU_U
		           ELSE CASE WHEN EI7.WAERK_F = 'KRW' OR EI7.WAERK_F = 'JPY' THEN EI7.SUJU_F * 100
		                     ELSE EI7.SUJU_F END 
		       END ) AS SUJU
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI7.WAVWR_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI7.WAVWR_U
		           ELSE CASE WHEN EI7.WAERK_F = 'KRW' OR EI7.WAERK_F = 'JPY' THEN EI7.WAVWR_F * 100
		                     ELSE EI7.WAVWR_F END 
		       END ) AS WAVWR_F
		   , (CASE WHEN EI7.SUJU_F = 0 THEN 0 ELSE (EI7.WAVWR_F / EI7.SUJU_F * 100) END) AS SUJU_R
		   
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI7.MECHUL_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI7.MECHUL_U
		           ELSE CASE WHEN EI7.WAERK_F = 'KRW' OR EI7.WAERK_F = 'JPY' THEN EI7.MECHUL_F * 100
		                     ELSE EI7.MECHUL_F END 
		       END ) AS MECHUL
		    , EI7.GISUNG_R
		    , (CASE WHEN #{WAERK} = 'KRW' THEN EI7.MECHULIK_K * 100 
		            WHEN #{WAERK} = 'USD' THEN EI7.MECHULIK_U
		            ELSE CASE WHEN EI7.WAERK_F = 'KRW' OR EI7.WAERK_F = 'JPY' THEN EI7.MECHULIK_F * 100
		                     ELSE EI7.MECHULIK_F END 
		        END ) AS MECHULIK
		    , (CASE WHEN #{WAERK} = 'KRW' THEN EI7.F_MECHUL_K * 100 
		            WHEN #{WAERK} = 'USD' THEN EI7.F_MECHUL_U
		            ELSE CASE WHEN EI7.WAERK_F = 'KRW' OR EI7.WAERK_F = 'JPY' THEN EI7.F_MECHUL_F * 100
		                     ELSE EI7.F_MECHUL_F END 
		        END ) AS F_MECHUL
		    , (CASE WHEN #{WAERK} = 'KRW' THEN EI7.F_MECHULIK_K * 100 
		            WHEN #{WAERK} = 'USD' THEN EI7.F_MECHULIK_U
		            ELSE CASE WHEN EI7.WAERK_F = 'KRW' OR EI7.WAERK_F = 'JPY' THEN EI7.F_MECHULIK_F * 100
		                     ELSE EI7.F_MECHULIK_F END 
		        END ) AS F_MECHULIK
		FROM SAPHEE.ZEIST207 AS EI7
		   INNER JOIN SAPHEE.ZEIST206 AS EI6
		      ON EI7.MANDT = EI6.MANDT
		     AND EI7.YEARM = EI6.YEARM
		     AND EI7.PSPID = EI6.PSPID
		   INNER JOIN SAPHEE.VBAK AS AK
		      ON EI7.MANDT = AK.MANDT
		     AND EI7.PSPID = AK.ZZPJT_ID
		   INNER JOIN SAPHEE.ZMASTER01 AS MS1
		      ON EI7.MANDT = MS1.MANDT
		     AND EI7.PSPID = MS1.POSID
		   INNER JOIN SAPHEE.ZMASTER02 AS MS2
		      ON EI7.MANDT = MS2.MANDT
		     AND EI7.PSPID = MS2.POSID
		     AND EI7.POSID = MS2.POSID_1
		WHERE EI7.MANDT = #{MANDT}
		   AND EI7.YEARM = SUBSTR(#{CDATE}, 1, 6)
		   <if test="VKBUR !=null and VKBUR !=''"> AND AK.VKBUR = #{VKBUR} </if>
		   <if test="VKGRP !=null and VKGRP !=''"> AND AK.VKGRP = #{VKGRP} </if>
		   <if test="PSPID !=null and PSPID !=''"> AND EI7.PSPID = #{PSPID} </if>
		   <if test="BSTDK_FRYM !=null and BSTDK_FRYM !=''">
			   <if test="BSTDK_TOYM !=null and BSTDK_TOYM !=''"> AND AK.BSTDK BETWEEN #{BSTDK_FRYM} || '01' AND #{BSTDK_TOYM} || '31' </if>
			   <if test="BSTDK_TOYM ==null or BSTDK_TOYM ==''">
				   <![CDATA[ AND AK.BSTDK > #{BSTDK_FRYM} || '%' ]]>
			   </if>
		   </if>
		   <if test="ZMAN !=null and ZMAN !=''"> AND MS1.ZMAN = #{ZMAN} </if>
		   <if test="JUDGE !=null and JUDGE !=''"> AND EI7.JUDGE = #{JUDGE} </if>
		   <if test="AUART_FR !=null and AUART_FR !=''">
			   <if test="AUART_TO !=null and AUART_TO !=''"> AND AK.AUART BETWEEN #{AUART_FR} AND #{AUART_TO} </if>
			   <if test="AUART_TO ==null or AUART_TO ==''"> AND AK.AUART = #{AUART_FR} </if>
		   </if>
		   <if test="GUBUNC !=null and GUBUNC !=''"> AND EI7.GUBUNC = #{GUBUNC} </if>
		   <if test="KUNNR !=null and KUNNR !=''"> AND MS1.KUNNR = #{KUNNR} </if>
		   <if test="WWBLD !=null and WWBLD !=''"> AND AK.WWBLD = #{WWBLD} </if>
		   <if test="JMISU !=null and JMISU !=''"> AND EI6.JMISUYN = #{JMISU} </if>
		   <if test="ZSPEC1 !=null and ZSPEC1 !=''"> AND MS2.ZSPEC1 = #{ZSPEC1} </if>
		   <if test="ZSPEC4 !=null and ZSPEC4 !=''"> AND MS2.ZSPEC4 = #{ZSPEC4} </if>
		   <if test="ZSPEC3 !=null and ZSPEC3 !=''"> AND MS2.ZSPEC3 = #{ZSPEC3} </if>
		   <if test="ZSPEC5 !=null and ZSPEC5 !=''"> AND MS2.ZSPEC5 = #{ZSPEC5} </if>
		   <if test="ZSPEC8 !=null and ZSPEC8 !=''"> AND MS2.ZSPEC8 = #{ZSPEC8} </if>
		   <if test="GBN !=null and GBN !=''"> AND EI7.GBN = #{GBN} </if>
		   <if test="GUBUNA !=null and GUBUNA !=''"> AND EI7.GUBUNA = #{GUBUNA} </if>
		   <if test="GUBUNB !=null and GUBUNB !=''"> AND EI7.GUBUNB = #{GUBUNB} </if>
		   <if test="CLDATE1_FRYM !=null and CLDATE1_FRYM !=''">
			   <if test="CLDATE1_TOYM !=null and CLDATE1_TOYM !=''"> AND EI7.CLDATE1 BETWEEN #{CLDATE1_FRYM} || '01' AND #{CLDATE1_TOYM} || '31' </if>
			   <if test="CLDATE1_TOYM ==null or CLDATE1_TOYM ==''">
				   <![CDATA[ AND EI7.CLDATE1 > #{CLDATE1_FRYM} || '%' ]]>
			   </if>
		   </if>
		   <if test="ZZACTSS !=null and ZZACTSS !=''"> AND MS2.ZZACTSS = #{ZZACTSS} </if>
		   <if test="TEMNO !=null and TEMNO !=''"> AND EI7.TEMNO = #{TEMNO} </if>
		   <if test="ZZSHIP1_FRYM !=null and ZZSHIP1_FRYM !=''">
			   <if test="ZZSHIP1_TOYM !=null and ZZSHIP1_TOYM !=''"> AND MS2.ZZSHIP1 BETWEEN #{ZZSHIP1_FRYM} || '01' AND #{ZZSHIP1_TOYM} || '31' </if>
			   <if test="ZZSHIP1_TOYM ==null or ZZSHIP1_TOYM ==''">
				   <![CDATA[ AND MS2.ZZSHIP1 > #{ZZSHIP1_FRYM} || '%' ]]>
			   </if>
		   </if>
		   <if test="KUNZ1 !=null and KUNZ1 !=''"> AND EI7.KUNZ1 = #{KUNZ1} </if>
		   <if test="LIFNR !=null and LIFNR !=''"> AND EI7.LIFNR = #{LIFNR} </if>
		   <if test="AGING !=null and AGING !=''"> AND EI7.AGING = #{AGING} </if>
		WITH UR
	</select>

	<select id="selectPROJECT" parameterType="hdel.sd.sch.domain.Sch0060ParamVO" resultMap="Sch0060ResultMap">
		SELECT 
		     (SELECT VKBUR FROM SAPHEE.TVKBT WHERE MANDT = #{MANDT} AND SPRAS = '3'  AND VKBUR = AK.VKBUR) AS VKBUR
		   , (SELECT BEZEI FROM SAPHEE.TVKBT WHERE MANDT = #{MANDT} AND SPRAS = '3'  AND VKBUR = AK.VKBUR) AS VKBURT
		   , (SELECT VKGRP FROM SAPHEE.TVGRT WHERE MANDT = #{MANDT} AND SPRAS = '3' AND VKGRP = AK.VKGRP) AS VKGRP
		   , (SELECT BEZEI FROM SAPHEE.TVGRT WHERE MANDT = #{MANDT} AND SPRAS = '3' AND VKGRP = AK.VKGRP) AS VKGRPT
		   , EI6.KUNZ1T, MS1.ZMAN_NM, EI6.PSPID, MS1.KUNNR, MS1.KUNNR_NM, EI6.JUDGE, EI6.JMISUYN, MS1.ZSITE_NM
		   , SUBSTR(AK.BSTDK, 1, 6) AS BSTDK_YM, AK.RECAD_DA, AK.BSTDK, EI6.ZQNTY, MAX(MS2.VDATU) AS VDATU
		   , EI6.SSDATE1, EI6.SSDATE, EI6.CLDATE1, EI6.CLDATE, MIN(MS2.ZZSHIP1) AS ZZSHIP1, MAX(MS2.ZZCOMP2) AS ZZCOMP2
		   , MAX(MS2.ZBEPJEO) AS ZBEPJEO, MAX(MS2.ZBOSUOUT) AS ZBOSUOUT, EI6.PRO_R, EI6.LMDAT
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.WAERK_K
		           WHEN #{WAERK} = 'USD' THEN EI6.WAERK_U
		           ELSE EI6.WAERK_F 
		       END )AS WAERK 
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.SUJU_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.SUJU_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.SUJU_F * 100
		                     ELSE EI6.SUJU_F END 
		       END ) AS SUJU
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.WAVWR_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.WAVWR_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.WAVWR_F * 100
		                     ELSE EI6.WAVWR_F END 
		       END ) AS WAVWR_F
		   , (CASE WHEN EI6.SUJU_F = 0 THEN 0 ELSE (EI6.WAVWR_F / EI6.SUJU_F * 100) END) AS SUJU_R
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.MECHUL_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.MECHUL_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.MECHUL_F * 100
		                     ELSE EI6.MECHUL_F END 
		       END ) AS MECHUL
		   , EI6.GISUNG_R
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.MECHULIK_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.MECHULIK_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.MECHULIK_F * 100
		                     ELSE EI6.MECHULIK_F END 
		       END ) AS MECHULIK
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.F_MECHUL_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.F_MECHUL_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.F_MECHUL_F * 100
		                     ELSE EI6.F_MECHUL_F END 
		       END ) AS F_MECHUL
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.F_MECHULIK_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.F_MECHULIK_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.F_MECHULIK_F * 100
		                     ELSE EI6.F_MECHULIK_F END 
		       END ) AS F_MECHULIK
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.CHEONG_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.CHEONG_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.CHEONG_F * 100
		                     ELSE EI6.CHEONG_F END 
		       END ) AS CHEONG
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.MICH_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.MICH_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.MICH_F * 100
		                     ELSE EI6.MICH_F END 
		       END ) AS MICH
		   , (CASE WHEN #{WAERK} = SD1010.WAERK THEN SD1010.NETWR_RQ
		   		   ELSE CASE WHEN #{WAERK} = 'KRW' AND SD1010.WAERK = 'USD' THEN
		   		                ( select ukurs
									from saphee.ztcurr as ztcurr
									where mandt=#{MANDT} and kurst='BP' 
									and #{CDATE} between frdat and todat and fcurr='USD' and tcurr='KRW' ) * SD1010.NETWR_RQ
		   		             WHEN #{WAERK} = 'USD' AND SD1010.WAERK = 'KRW' THEN
		   		                ( select ukurs
									from saphee.ztcurr as ztcurr
									where mandt=#{MANDT} and kurst='BP' 
									and #{CDATE} between frdat and todat and fcurr='USD' and tcurr='KRW' ) * SD1010.NETWR_RQ
		   		    END
		   		END ) AS NETWR_RQ    		   		           
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.CCHEONG_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.CCHEONG_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.CCHEONG_F * 100
		                     ELSE EI6.CCHEONG_F END 
		       END ) AS CCHEONG
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.SUKEUM_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.SUKEUM_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.SUKEUM_F * 100
		                     ELSE EI6.SUKEUM_F END 
		       END ) AS SUKEUM
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.MISU_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.MISU_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.MISU_F * 100
		                     ELSE EI6.MISU_F END 
		       END ) AS MISU
		   , (CASE WHEN #{WAERK} = SD1010.WAERK THEN SD1011.COLBI
		   		   ELSE CASE WHEN #{WAERK} = 'KRW' AND SD1010.WAERK = 'USD' THEN
								( select ukurs
									from saphee.ztcurr as ztcurr
									where mandt=#{MANDT} and kurst='BP' 
									and #{CDATE} between frdat and todat and fcurr='USD' and tcurr='KRW' ) * SD1011.COLBI
		   		             WHEN #{WAERK} = 'USD' AND SD1010.WAERK = 'KRW' THEN
								( select ukurs
									from saphee.ztcurr as ztcurr
									where mandt=#{MANDT} and kurst='BP' 
									and #{CDATE} between frdat and todat and fcurr='USD' and tcurr='KRW' ) * SD1011.COLBI
		   		    END
		   		END ) AS COLBI  		
		   , EI6.ZTERM
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.JMISU_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.JMISU_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.JMISU_F * 100
		                     ELSE EI6.JMISU_F END 
		       END ) AS JMISU
		   , (CASE WHEN #{WAERK} = 'KRW' THEN EI6.BILL_K * 100 
		           WHEN #{WAERK} = 'USD' THEN EI6.BILL_U
		           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.BILL_F * 100
		                     ELSE EI6.BILL_F END 
		       END ) AS BILL
		   , EI6.BILLTYPE
		   , (CASE WHEN
			     (CASE WHEN #{WAERK} = 'KRW' THEN EI6.MICH_K * 100 
			           WHEN #{WAERK} = 'USD' THEN EI6.MICH_U
			           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.MICH_F * 100
			                     ELSE EI6.MICH_F END 
			       END ) 
			     - 
			     (CASE WHEN #{WAERK} = SD1010.WAERK THEN SD1010.NETWR_RQ
			   		   ELSE CASE WHEN #{WAERK} = 'KRW' AND SD1010.WAERK = 'USD' THEN
								( select ukurs
									from saphee.ztcurr as ztcurr
									where mandt=#{MANDT} and kurst='BP' 
									and #{CDATE} between frdat and todat and fcurr='USD' and tcurr='KRW' ) * SD1010.NETWR_RQ
			   		             WHEN #{WAERK} = 'USD' AND SD1010.WAERK = 'KRW' THEN
			   		            ( select ukurs
									from saphee.ztcurr as ztcurr
									where mandt=#{MANDT} and kurst='BP' 
									and #{CDATE} between frdat and todat and fcurr='USD' and tcurr='KRW' )  * SD1010.NETWR_RQ
			   		    END
			   		END )  = 0 THEN 'Y' ELSE 'N' END) AS CHEONG_IB
		   , (CASE WHEN 
			     (CASE WHEN #{WAERK} = 'KRW' THEN EI6.MISU_K * 100 
			           WHEN #{WAERK} = 'USD' THEN EI6.MISU_U
			           ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN EI6.MISU_F * 100
			                     ELSE EI6.MISU_F END 
			       END )
		   		 - 
			     (CASE WHEN #{WAERK} = SD1010.WAERK THEN SD1011.COLBI
			   		   ELSE CASE WHEN #{WAERK} = 'KRW' AND SD1010.WAERK = 'USD' THEN
			   		                ( select ukurs
									from saphee.ztcurr as ztcurr
									where mandt=#{MANDT} and kurst='BP' 
									and #{CDATE} between frdat and todat and fcurr='USD' and tcurr='KRW' ) * SD1011.COLBI
			   		             WHEN #{WAERK} = 'USD' AND SD1010.WAERK = 'KRW' THEN
			   		                ( select ukurs
									from saphee.ztcurr as ztcurr
									where mandt=#{MANDT} and kurst='BP' 
									and #{CDATE} between frdat and todat and fcurr='USD' and tcurr='KRW' )  * SD1011.COLBI
			   		    END
			   		END ) = 0 THEN 'Y' ELSE 'N' END) AS SUKEUM_IB
		   , (CASE WHEN EI6.MECHUL_F > EI6.CHEONG_F THEN 
					    (CASE WHEN #{WAERK} = 'KRW' THEN ( EI6.MECHUL_K - EI6.CHEONG_K ) * 100 
					          WHEN #{WAERK} = 'USD' THEN ( EI6.MECHUL_U - EI6.CHEONG_U )
					          ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN ( EI6.MECHUL_F - EI6.CHEONG_F ) * 100
					                    ELSE ( EI6.MECHUL_F - EI6.CHEONG_F ) END 
					      END ) 
		   		   ELSE 0 END) AS KMECHUL
		   , (CASE WHEN EI6.SUKEUM_F > EI6.CHEONG_F THEN 
					    (CASE WHEN #{WAERK} = 'KRW' THEN ( EI6.SUKEUM_K - EI6.CHEONG_K ) * 100 
					          WHEN #{WAERK} = 'USD' THEN ( EI6.SUKEUM_U - EI6.CHEONG_U )
					          ELSE CASE WHEN EI6.WAERK_F = 'KRW' OR EI6.WAERK_F = 'JPY' THEN ( EI6.SUKEUM_F - EI6.CHEONG_F ) * 100
					                    ELSE ( EI6.SUKEUM_F - EI6.CHEONG_F ) END 
					      END )  
		   		   ELSE 0 END) AS HSUKEUM
		   , (SELECT MEKIND FROM SAPHEE.ZSDT0045 WHERE MANDT = #{MANDT} AND PSPID = EI6.PSPID ORDER BY MEDAT DESC FETCH FIRST 1 ROWS ONLY) AS MEKIND
		   , (SELECT INGTEXT FROM SAPHEE.ZFIT1015 WHERE MANDT = #{MANDT} AND DISGBN = 'X' AND KIDNO = EI6.PSPID ORDER BY SERNO DESC FETCH FIRST 1 ROWS ONLY) AS INGTEXT
		FROM SAPHEE.ZEIST207 AS EI7
		   INNER JOIN SAPHEE.ZEIST206 AS EI6
		      ON EI7.MANDT = EI6.MANDT
		     AND EI7.YEARM = EI6.YEARM 
		     AND EI7.PSPID = EI6.PSPID
		   INNER JOIN SAPHEE.VBAK AS AK
		      ON EI7.MANDT = AK.MANDT
		     AND EI7.PSPID = AK.ZZPJT_ID
		   INNER JOIN SAPHEE.ZMASTER01 AS MS1
		      ON EI7.MANDT = MS1.MANDT
		     AND EI7.PSPID = MS1.POSID
		   INNER JOIN SAPHEE.ZMASTER02 AS MS2
		      ON EI7.MANDT = MS2.MANDT
		     AND EI7.PSPID = MS2.POSID
		     AND EI7.POSID = MS2.POSID_1
		   LEFT OUTER JOIN SAPHEE.ZSDT1010 AS SD1010
		      ON EI6.MANDT = SD1010.MANDT
		     AND EI6.PSPID = SD1010.PSPID
		   LEFT OUTER JOIN SAPHEE.ZSDT1011 AS SD1011
		      ON EI6.MANDT = SD1011.MANDT
		     AND EI6.PSPID = SD1011.PSPID
		WHERE EI7.MANDT = #{MANDT}
		   AND EI7.YEARM = SUBSTR(#{CDATE}, 1, 6)
		   <if test="VKBUR !=null and VKBUR !=''"> AND AK.VKBUR = #{VKBUR} </if>
		   <if test="VKGRP !=null and VKGRP !=''"> AND AK.VKGRP = #{VKGRP} </if>
		   <if test="PSPID !=null and PSPID !=''"> AND EI7.PSPID = #{PSPID} </if>
		   <if test="BSTDK_FRYM !=null and BSTDK_FRYM !=''">
			   <if test="BSTDK_TOYM !=null and BSTDK_TOYM !=''"> AND AK.BSTDK BETWEEN #{BSTDK_FRYM} || '01' AND #{BSTDK_TOYM} || '31' </if>
			   <if test="BSTDK_TOYM ==null or BSTDK_TOYM ==''">
				   <![CDATA[ AND AK.BSTDK > #{BSTDK_FRYM} || '%' ]]>
			   </if>
		   </if>
		   <if test="ZMAN !=null and ZMAN !=''"> AND MS1.ZMAN = #{ZMAN} </if>
		   <if test="JUDGE !=null and JUDGE !=''"> AND EI7.JUDGE = #{JUDGE} </if>
		   <if test="AUART_FR !=null and AUART_FR !=''">
			   <if test="AUART_TO !=null and AUART_TO !=''"> AND AK.AUART BETWEEN #{AUART_FR} AND #{AUART_TO} </if>
			   <if test="AUART_TO ==null or AUART_TO ==''"> AND AK.AUART = #{AUART_FR} </if>
		   </if>
		   <if test="GUBUNC !=null and GUBUNC !=''"> AND EI7.GUBUNC = #{GUBUNC} </if>
		   <if test="KUNZ1 !=null and KUNZ1 !=''"> AND EI7.KUNZ1 = #{KUNZ1} </if>
		   <if test="KUNNR !=null and KUNNR !=''"> AND MS1.KUNNR = #{KUNNR} </if>
		   <if test="WWBLD !=null and WWBLD !=''"> AND AK.WWBLD = #{WWBLD} </if>
		   <if test="JMISU !=null and JMISU !=''"> AND EI6.JMISUYN = #{JMISU} </if>
		GROUP BY  AK.VKBUR, AK.VKGRP, EI6.KUNZ1T, MS1.ZMAN_NM, EI6.PSPID, MS1.KUNNR, MS1.KUNNR_NM, EI6.JUDGE, EI6.JMISUYN, MS1.ZSITE_NM
				, AK.BSTDK, AK.RECAD_DA, AK.BSTDK, EI6.ZQNTY, EI6.SSDATE1, EI6.SSDATE, EI6.CLDATE1, EI6.CLDATE, EI6.PRO_R, EI6.LMDAT
				, EI6.WAERK_K, EI6.WAERK_U, EI6.WAERK_F, EI6.SUJU_K, EI6.SUJU_U, EI6.SUJU_F, EI6.WAVWR_K, EI6.WAVWR_U, EI6.WAVWR_F
				, EI6.MECHUL_K, EI6.MECHUL_U, EI6.MECHUL_F, EI6.GISUNG_R, EI6.MECHULIK_F, EI6.MECHULIK_U, EI6.MECHULIK_F
				, EI6.F_MECHUL_K, EI6.F_MECHUL_U, EI6.F_MECHUL_F, EI6.MECHULIK_K, EI6.MECHULIK_U, EI6.MECHULIK_F, EI6.F_MECHULIK_K, EI6.F_MECHULIK_U, EI6.F_MECHULIK_F
				, EI6.CHEONG_K, EI6.CHEONG_U, EI6.CHEONG_F, EI6.MICH_K, EI6.MICH_U, EI6.MICH_F, SD1010.NETWR_RQ
				, EI6.CCHEONG_K, EI6.CCHEONG_U, EI6.CCHEONG_F, EI6.SUKEUM_K, EI6.SUKEUM_U, EI6.SUKEUM_F, EI6.MISU_K, EI6.MISU_U, EI6.MISU_F
				, SD1011.COLBI, EI6.ZTERM, EI6.JMISU_K, EI6.JMISU_U, EI6.JMISU_F, EI6.BILL_K, EI6.BILL_U, EI6.BILL_F, EI6.BILLTYPE, SD1010.WAERK, SD1011.WAERK		   
		WITH UR
	</select>

	<select id="selectCHEONG" parameterType="hdel.sd.sch.domain.Sch0060ParamVO" resultMap="Sch0060ResultMap">
		SELECT 
		     (SELECT VKBUR FROM SAPHEE.TVKBT WHERE MANDT = #{MANDT} AND SPRAS = '3'  AND VKBUR = AK.VKBUR) AS VKBUR
		   , (SELECT BEZEI FROM SAPHEE.TVKBT WHERE MANDT = #{MANDT} AND SPRAS = '3'  AND VKBUR = AK.VKBUR) AS VKBURT
		   , (SELECT VKGRP FROM SAPHEE.TVGRT WHERE MANDT = #{MANDT} AND SPRAS = '3' AND VKGRP = AK.VKGRP) AS VKGRP
		   , (SELECT BEZEI FROM SAPHEE.TVGRT WHERE MANDT = #{MANDT} AND SPRAS = '3' AND VKGRP = AK.VKGRP) AS VKGRPT
		   , EI6.KUNZ1T, MS1.ZMAN_NM, EI6.PSPID, MS1.KUNNR, MS1.KUNNR_NM, MS1.ZSITE_NM, MAX(MS2.VDATU) AS VDATU
		   , EI6.WAERK_F 	AS WAERK 
		   , EI6.SUJU_F  	AS SUJU 
		   , EI6.SUKEUM_F 	AS SUKEUM
		   , EI6.CHEONG_F 	AS CHEONG
		   , EI6.CCHEONG_F 	AS CCHEONG
		   , EI6.MICH_F 	AS MICH
		   , AK.VBELN, AK.SPART, AK.AUART
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT00} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT00} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT00
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT01} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT01} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT01
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT02} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT02} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT02
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT03} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT03} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT03
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT04} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT04} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT04
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT05} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT05} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT05
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT06} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT06} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT06
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT07} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT07} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT07
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT08} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT08} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT08
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT09} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT09} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT09
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT10} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT10} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT10
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT11} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT11} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT11
		   , (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT12} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT12} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END) AS AMT12
		   , (EI6.MICH_F
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT00} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT00} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT01} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT01} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT02} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT02} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT03} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT03} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT04} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT04} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT05} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT05} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT06} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT06} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT07} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT07} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT08} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT08} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT09} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT09} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT10} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT10} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT11} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT11} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
			   - (CASE WHEN (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT12} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) IS NULL THEN 0 ELSE (SELECT SUM(NETWR_RQ) FROM SAPHEE.ZSDT1010 WHERE MANDT = #{MANDT} AND ZRQYM = #{AMT12} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, NETWR_RQ) END)
		   ) AS MIJUNG
		FROM SAPHEE.ZEIST206 AS EI6
		   INNER JOIN SAPHEE.VBAK AS AK
		      ON EI6.MANDT = AK.MANDT
		     AND EI6.PSPID = AK.ZZPJT_ID
		   INNER JOIN SAPHEE.ZMASTER01 AS MS1
		      ON EI6.MANDT = MS1.MANDT
		     AND EI6.PSPID = MS1.POSID
		   INNER JOIN SAPHEE.ZMASTER02 AS MS2
		      ON EI6.MANDT = MS2.MANDT
		     AND EI6.PSPID = MS2.POSID
		   LEFT OUTER JOIN SAPHEE.ZSDT1010 AS SD1010
		      ON EI6.MANDT = SD1010.MANDT
		     AND EI6.PSPID = SD1010.PSPID
		WHERE EI6.MANDT = #{MANDT}
		   AND EI6.YEARM = SUBSTR(#{CDATE}, 1, 6)
		   <if test="VKBUR !=null and VKBUR !=''"> AND AK.VKBUR = #{VKBUR} </if>
		   <if test="VKGRP !=null and VKGRP !=''"> AND AK.VKGRP = #{VKGRP} </if>
		   <if test="PSPID !=null and PSPID !=''"> AND EI6.PSPID = #{PSPID} </if>
		   <if test="BSTDK_FRYM !=null and BSTDK_FRYM !=''">
			   <if test="BSTDK_TOYM !=null and BSTDK_TOYM !=''"> AND AK.BSTDK BETWEEN #{BSTDK_FRYM} || '01' AND #{BSTDK_TOYM} || '31' </if>
			   <if test="BSTDK_TOYM ==null or BSTDK_TOYM ==''">
				   <![CDATA[ AND AK.BSTDK > #{BSTDK_FRYM} || '%' ]]>
			   </if>
		   </if>
		   <if test="ZMAN !=null and ZMAN !=''"> AND MS1.ZMAN = #{ZMAN} </if>
		   <if test="JUDGE !=null and JUDGE !=''"> AND EI6.JUDGE = #{JUDGE} </if>
		   <if test="GUBUNC !=null and GUBUNC !=''"> AND EI6.GUBUNC = #{GUBUNC} </if>		   
		   <if test="AUART_FR !=null and AUART_FR !=''">
			   <if test="AUART_TO !=null and AUART_TO !=''"> AND AK.AUART BETWEEN #{AUART_FR} AND #{AUART_TO} </if>
			   <if test="AUART_TO ==null or AUART_TO ==''"> AND AK.AUART = #{AUART_FR} </if>
		   </if>
		   <if test="KUNZ1 !=null and KUNZ1 !=''"> AND EI6.KUNZ1 = #{KUNZ1} </if>
		   <if test="KUNNR !=null and KUNNR !=''"> AND MS1.KUNNR = #{KUNNR} </if>
		   <if test="WWBLD !=null and WWBLD !=''"> AND AK.WWBLD = #{WWBLD} </if>
		   <if test="JMISU !=null and JMISU !=''"> AND EI6.JMISUYN = #{JMISU} </if>
		GROUP BY AK.VKBUR, AK.VKGRP, EI6.KUNZ1T, MS1.ZMAN_NM, EI6.PSPID, MS1.KUNNR, MS1.KUNNR_NM, MS1.ZSITE_NM
		, EI6.WAERK_F, EI6.SUJU_F, EI6.SUKEUM_F, EI6.CHEONG_F, EI6.CCHEONG_F, EI6.MICH_F, AK.VBELN, AK.SPART, AK.AUART
		WITH UR
	</select>

	<select id="selectSUKEUM" parameterType="hdel.sd.sch.domain.Sch0060ParamVO" resultMap="Sch0060ResultMap">
		SELECT 
		     (SELECT VKBUR FROM SAPHEE.TVKBT WHERE MANDT = #{MANDT} AND SPRAS = '3'  AND VKBUR = AK.VKBUR) AS VKBUR
		   , (SELECT BEZEI FROM SAPHEE.TVKBT WHERE MANDT = #{MANDT} AND SPRAS = '3'  AND VKBUR = AK.VKBUR) AS VKBURT
		   , (SELECT VKGRP FROM SAPHEE.TVGRT WHERE MANDT = #{MANDT} AND SPRAS = '3' AND VKGRP = AK.VKGRP) AS VKGRP
		   , (SELECT BEZEI FROM SAPHEE.TVGRT WHERE MANDT = #{MANDT} AND SPRAS = '3' AND VKGRP = AK.VKGRP) AS VKGRPT
		   , EI6.KUNZ1T, MS1.ZMAN_NM, EI6.PSPID, MS1.KUNNR, MS1.KUNNR_NM, MS1.ZSITE_NM, MAX(MS2.VDATU) AS VDATU
		   , EI6.WAERK_F	AS WAERK 
		   , EI6.SUJU_F 	AS SUJU
		   , EI6.CHEONG_F 	AS CHEONG
		   , EI6.MICH_F 	AS MICH
		   , EI6.SUKEUM_F 	AS SUKEUM
		   , EI6.JMISU_F 	AS JMISU
		   , EI6.BILLTYPE
		   , (SELECT MEKIND FROM SAPHEE.ZSDT0045 WHERE MANDT = #{MANDT} AND PSPID = EI6.PSPID ORDER BY MEDAT DESC FETCH FIRST 1 ROWS ONLY) AS MEKIND
		   , (SELECT INGTEXT FROM SAPHEE.ZFIT1015 WHERE MANDT = #{MANDT} AND DISGBN = 'X' AND KIDNO = EI6.PSPID ORDER BY SERNO DESC FETCH FIRST 1 ROWS ONLY) AS INGTEXT
		   , EI6.MISU_F AS MISU
		   , AK.VBELN, AK.SPART, AK.AUART
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT00} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT00} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT00
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT01} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT01} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT01
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT02} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT02} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT02
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT03} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT03} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT03
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT04} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT04} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT04
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT05} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT05} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT05
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT06} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT06} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT06
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT07} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT07} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT07
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT08} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT08} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT08
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT09} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT09} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT09
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT10} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT10} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT10
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT11} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT11} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT11
		   , (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT12} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT12} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END) AS AMT12
		   , (EI6.MISU_F
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT00} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT00} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT01} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT01} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT02} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT02} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT03} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT03} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT04} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT04} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT05} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT05} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT06} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT06} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT07} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT07} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT08} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT08} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT09} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT09} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT10} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT10} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT11} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT11} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
			   - (CASE WHEN (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT12} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) IS NULL THEN 0 ELSE (SELECT SUM(COLBI) FROM SAPHEE.ZSDT1011 WHERE MANDT = #{MANDT} AND BYSYM = #{AMT12} AND PSPID = EI6.PSPID GROUP BY MANDT, VBELN, PSPID, COLBI) END)
		   ) AS MIJUNG
		FROM SAPHEE.ZEIST206 AS EI6
		   INNER JOIN SAPHEE.VBAK AS AK
		      ON EI6.MANDT = AK.MANDT
		     AND EI6.PSPID = AK.ZZPJT_ID
		   INNER JOIN SAPHEE.ZMASTER01 AS MS1
		      ON EI6.MANDT = MS1.MANDT
		     AND EI6.PSPID = MS1.POSID
		   INNER JOIN SAPHEE.ZMASTER02 AS MS2
		      ON EI6.MANDT = MS2.MANDT
		     AND EI6.PSPID = MS2.POSID
		   LEFT OUTER JOIN SAPHEE.ZSDT1011 AS SD1011
		      ON EI6.MANDT = SD1011.MANDT
		     AND EI6.PSPID = SD1011.PSPID
		WHERE EI6.MANDT = #{MANDT}
		   AND EI6.YEARM = SUBSTR(#{CDATE}, 1, 6)
		   <if test="VKBUR !=null and VKBUR !=''"> AND AK.VKBUR = #{VKBUR} </if>
		   <if test="VKGRP !=null and VKGRP !=''"> AND AK.VKGRP = #{VKGRP} </if>
		   <if test="PSPID !=null and PSPID !=''"> AND EI6.PSPID = #{PSPID} </if>
		   <if test="BSTDK_FRYM !=null and BSTDK_FRYM !=''">
			   <if test="BSTDK_TOYM !=null and BSTDK_TOYM !=''"> AND AK.BSTDK BETWEEN #{BSTDK_FRYM} || '01' AND #{BSTDK_TOYM} || '31' </if>
			   <if test="BSTDK_TOYM ==null or BSTDK_TOYM ==''">
				   <![CDATA[ AND AK.BSTDK > #{BSTDK_FRYM} || '%' ]]>
			   </if>
		   </if>
		   <if test="ZMAN !=null and ZMAN !=''"> AND MS1.ZMAN = #{ZMAN} </if>
		   <if test="JUDGE !=null and JUDGE !=''"> AND EI6.JUDGE = #{JUDGE} </if>
		   <if test="GUBUNC !=null and GUBUNC !=''"> AND EI6.GUBUNC = #{GUBUNC} </if>
		   <if test="AUART_FR !=null and AUART_FR !=''">
			   <if test="AUART_TO !=null and AUART_TO !=''"> AND AK.AUART BETWEEN #{AUART_FR} AND #{AUART_TO} </if>
			   <if test="AUART_TO ==null or AUART_TO ==''"> AND AK.AUART = #{AUART_FR} </if>
		   </if>
		   <if test="KUNZ1 !=null and KUNZ1 !=''"> AND EI6.KUNZ1 = #{KUNZ1} </if>
		   <if test="KUNNR !=null and KUNNR !=''"> AND MS1.KUNNR = #{KUNNR} </if>
		   <if test="WWBLD !=null and WWBLD !=''"> AND AK.WWBLD = #{WWBLD} </if>
		   <if test="JMISU !=null and JMISU !=''"> AND EI6.JMISUYN = #{JMISU} </if>
		GROUP BY AK.VKBUR, AK.VKGRP, EI6.KUNZ1T, MS1.ZMAN_NM, EI6.PSPID, MS1.KUNNR, MS1.KUNNR_NM, MS1.ZSITE_NM, EI6.WAERK_F
		, EI6.SUJU_F, EI6.CHEONG_F, EI6.MICH_F, EI6.SUKEUM_F, EI6.JMISU_F, EI6.BILLTYPE, EI6.MISU_F, AK.VBELN, AK.SPART, AK.AUART
		WITH UR
	</select>
	
	<insert id="mergeZSDT1010" parameterType="hdel.sd.sch.domain.Sch0060">
		MERGE INTO SAPHEE.ZSDT1010 AS T1
		USING (
			SELECT 
			   CAST(#{PSPID} AS VARCHAR(24)) AS PSPID, CAST(#{ZRQYM} AS VARCHAR(10)) AS ZRQYM
			FROM 
			   SYSIBM.SYSDUMMY1
		) AS T2 ON T1.PSPID = T2.PSPID AND T1.ZRQYM = T2.ZRQYM

		WHEN MATCHED THEN
			UPDATE SET 
			   T1.MANDT = #{MANDT}, 
			   T1.PSPID = #{PSPID}, 
			   T1.ZRQYM = #{ZRQYM}, 
			   T1.NETWR_RQ = #{NETWR_RQ}, 
			   T1.UDATE = #{DATE}, 
			   T1.UTIME = #{TIME}, 
			   T1.UUSER = #{USER}

		WHEN NOT MATCHED THEN
			INSERT (
			   MANDT, 
			   VBELN, 
			   PSPID, 
			   ZRQNNR, 
			   ZRQYM, 
			   NETWR_RQ, 
			   SPART, 
			   AUART, 
			   VKBUR, 
			   VKGRP, 
			   ZRMK, 
			   CDATE, 
			   CTIME, 
			   CUSER, 
			   UDATE, 
			   UTIME, 
			   UUSER, 
			   WAERK
			   ) VALUES (
			   #{MANDT}, 
			   #{VBELN}, 
			   #{PSPID}, 
			   (SELECT RIGHT(REPLACE(LTRIM(RTRIM(CHAR(CAST(VALUE(MAX(ZRQNNR),'0') AS DECIMAL) + 1))),'.', ''), 10) AS ZRQNNR FROM SAPHEE.ZSDT1010 WHERE PSPID = #{PSPID}), 
			   #{ZRQYM}, 
			   #{NETWR_RQ}, 
			   #{SPART}, 
			   #{AUART}, 
			   #{VKBUR}, 
			   #{VKGRP}, 
			   ' ', 
			   #{DATE}, 
			   #{TIME}, 
			   #{USER}, 
			   #{DATE}, 
			   #{TIME}, 
			   #{USER}, 
			   #{WAERK}
			   )
	</insert>
	
	<insert id="mergeZSDT1011" parameterType="hdel.sd.sch.domain.Sch0060">
		MERGE INTO SAPHEE.ZSDT1011 AS T1
		USING (
			SELECT 
			   CAST(#{PSPID} AS VARCHAR(24)) AS PSPID, CAST(#{BYSYM} AS VARCHAR(10)) AS BYSYM
			FROM 
			   SYSIBM.SYSDUMMY1
		) AS T2 ON T1.PSPID = T2.PSPID AND T1.BYSYM = T2.BYSYM

		WHEN MATCHED THEN
			UPDATE SET 
			   T1.MANDT = #{MANDT}, 
			   T1.PSPID = #{PSPID}, 
			   T1.BYSYM = #{BYSYM}, 
			   T1.COLBI = #{COLBI}, 
			   T1.UDATE = #{DATE}, 
			   T1.UTIME = #{TIME}, 
			   T1.UUSER = #{USER}

		WHEN NOT MATCHED THEN
			INSERT (
			   MANDT, 
			   VBELN, 
			   PSPID, 
			   ZICNNR, 
			   BYSYM, 
			   COLBI, 
			   SPART, 
			   AUART, 
			   VKBUR, 
			   VKGRP, 
			   ZRMK, 
			   CDATE, 
			   CTIME, 
			   CUSER, 
			   UDATE, 
			   UTIME, 
			   UUSER, 
			   WAERK
			   ) VALUES (
			   #{MANDT}, 
			   #{VBELN}, 
			   #{PSPID}, 
			   (SELECT RIGHT(REPLACE(LTRIM(RTRIM(CHAR(CAST(VALUE(MAX(ZICNNR),'0') AS DECIMAL) + 1))),'.', ''), 10) AS ZICNNR FROM SAPHEE.ZSDT1011 WHERE PSPID = #{PSPID}), 
			   #{BYSYM}, 
			   #{COLBI}, 
			   #{SPART}, 
			   #{AUART}, 
			   #{VKBUR}, 
			   #{VKGRP}, 
			   ' ', 
			   #{DATE}, 
			   #{TIME}, 
			   #{USER}, 
			   #{DATE}, 
			   #{TIME}, 
			   #{USER}, 
			   #{WAERK}
			   )
	</insert>
	
</mapper>
