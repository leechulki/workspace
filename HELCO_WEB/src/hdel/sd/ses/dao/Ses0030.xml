<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="hdel.sd.ses.dao.Ses0030D"> 
  
	<resultMap id="selectListHeaderMap" type="hdel.sd.ses.domain.Ses0030"> 
	    <result property="mandt" column="MANDT"/>
	    <result property="qtnum" column="QTNUM"/>
	    <result property="qtser" column="QTSER"/>
	    <result property="qtdat" column="QTDAT"/>
	    <result property="spart" column="SPART"/>
	    <result property="qtgbn" column="QTGBN"/>
	    <result property="zbdtyp" column="ZBDTYP"/>
	    <result property="zprgflg" column="ZPRGFLG"/>
	    <result property="vkbur" column="VKBUR"/>
	    <result property="vkgrp" column="VKGRP"/>
	    <result property="zkunnr" column="ZKUNNR"/>
	    <result property="zagnt" column="ZAGNT"/>
	    <result property="kunnr" column="KUNNR"/>
	    <result property="zcst" column="ZCST"/>
	    <result property="zgnm" column="ZGNM"/>
	    <result property="zdev" column="ZDEV"/>
	    <result property="gsnam" column="GSNAM"/>
	    <result property="zregn" column="ZREGN"/>
	    <result property="zpid" column="ZPID"/>
	    <result property="ztel" column="ZTEL"/>
	    <result property="zaddr_zpost" column="ZADDR_ZPOST"/>
	    <result property="zaddr_adr1" column="ZADDR_ADR1"/>
	    <result property="zaddr_adr2" column="ZADDR_ADR2"/>
	    <result property="soable" column="SOABLE"/>
	    <result property="zestdat" column="ZESTDAT"/>
	    <result property="deldat" column="DELDAT"/>
	    <result property="zdvmts" column="ZDVMTS"/>
	    <result property="zsum_znumber" column="ZSUM_ZNUMBER"/>
	    <result property="zsum_zcost" column="ZSUM_ZCOST"/>
	    <result property="zsum_zeam" column="ZSUM_ZEAM"/>
	    <result property="zsum_shang" column="ZSUM_SHANG"/>
	    <result property="inco" column="INCO"/>
	    <result property="zicif_pprt" column="ZICIF_PPRT"/>
	    <result property="zicif_ppct" column="ZICIF_PPCT"/>
	    <result property="zicif_ppcd" column="ZICIF_PPCD"/>
	    <result property="zicif_1strt" column="ZICIF_1STRT"/>
	    <result property="zicif_1stct" column="ZICIF_1STCT"/>
	    <result property="zicif_1stcd" column="ZICIF_1STCD"/>
	    <result property="zicif_2strt" column="ZICIF_2STRT"/>
	    <result property="zicif_2stct" column="ZICIF_2STCT"/>
	    <result property="zicif_2stcd" column="ZICIF_2STCD"/>
	    <result property="zicif_rmrt" column="ZICIF_RMRT"/>
	    <result property="zicif_rmct" column="ZICIF_RMCT"/>
	    <result property="zicif_rmcd" column="ZICIF_RMCD"/>
	    <result property="sprmk1" column="SPRMK1"/>
	    <result property="sprmk2" column="SPRMK2"/>
	    <result property="sprmk3" column="SPRMK3"/>
	    <result property="sprmk4" column="SPRMK4"/>
	    <result property="sprmk5" column="SPRMK5"/>
	    <result property="sprmk6" column="SPRMK6"/>
	    <result property="sprmk7" column="SPRMK7"/>
	    <result property="sprmk8" column="SPRMK8"/>
	    <result property="sprmk9" column="SPRMK9"/>
	    <result property="sprmk10" column="SPRMK10"/>
	    <result property="zsoflg" column="ZSOFLG"/>
	    <result property="sonnr" column="SONNR"/>
	    <result property="vbeln" column="VBELN"/>
	    <result property="waerk" column="WAERK"/>
	    <result property="auart" column="AUART"/>
	    <result property="co_ddvrtq" column="CO_DDVRTQ"/>
	    <result property="co_dephtq" column="CO_DEPHTQ"/>
	    <result property="co_dssq" column="CO_DSSQ"/>
	    <result property="co_bclcdtq" column="CO_BCLCDTQ"/>
	    <result property="co_chpitq" column="CO_CHPITQ"/>
	    <result property="co_aspc" column="CO_ASPC"/>
	    <result property="co_dsv1" column="CO_DSV1"/>
	    <result property="co_dsv1tq" column="CO_DSV1TQ"/>
	    <result property="co_dsv2" column="CO_DSV2"/>
	    <result property="co_dsv2tq" column="CO_DSV2TQ"/>
	    <result property="cdate" column="CDATE"/>
	    <result property="ctime" column="CTIME"/>
	    <result property="uuser" column="CUSER"/>
	    <result property="udate" column="UDATE"/>
	    <result property="utime" column="UTIME"/>
	    <result property="uuser" column="UUSER"/>
	    <result property="ddate" column="DDATE"/>
	    <result property="dtime" column="DTIME"/>
	    <result property="duser" column="DUSER"/>
	    <result property="zlzone" column="ZLZONE"/>
	    <result property="region" column="REGION"/>
	    <result property="zkunnr_nm" column="ZKUNNR_NM"/>
	    <result property="buyr_nm" column="BUYR_NM"/>
	    <result property="zagnt_nm" column="ZAGNT_NM"/>
	    <result property="zeam" column="ZEAM"/>
	    <result property="zattpath" column="ZATTPATH"/>
	    <result property="zattfn" column="ZATTFN"/>
	    <result property="zattfn_or" column="ZATTFN_OR"/>
	    <result property="part_cnt" column="PART_CNT"/>
	    <result property="fa_byrgbn" column="FA_BYRGBN"/>
	    <result property="zdeli" column="ZDELI"/>
	    <result property="tel" column="TEL"/>
	    <result property="fax" column="FAX"/>
	    <result property="mail" column="MAIL"/>
	    <result property="land1" column="LAND1"/>
	    <result property="landx" column="LANDX"/>
	    <result property="jgbn" column="JGBN"/>
	    <result property="aqtnum" column="AQTNUM"/>
	    <result property="oppid" column="OPPID"/>
	    <result property="uch_duty" column="UCH_DUTY"/>
	    <result property="frcmfcdat" column="FRCMFCDAT"/>
	    <result property="lifnrchk" column="LIFNRCHK"/>
	    <result property="sid" column="SID"/>
	    <result property="achdt" column="ACHDT"/>
	    <result property="qtvadt" column="QTVADT"/>
	    <result property="fa_chk1" column="FA_CHK1"/>
	    <result property="fa_chk2" column="FA_CHK2"/>
	</resultMap>
	
	<select id="selectListHeader" parameterType="hdel.sd.ses.domain.Ses0030ParamVO" resultMap="selectListHeaderMap">
		SELECT A.MANDT          -- 클라이언트
		        , A.QTNUM          -- 견적번호
		        , A.QTSER            -- 견적차수
		        , A.QTDAT           -- 견적일
		        , A.SPART            -- 제품군
		        , A.QTGBN           -- 견적구분
		        --, A.ZBDTYP        -- 건물용도
		        ,DECODE(H.DMSTAT,'QT',A.ZBDTYP,'SO', A.ZBDTYP, NULL, A.ZBDTYP, DECODE(A.AUART, 'ZN01', H.WWBLD, 'ZN02', H.WWBLD,  A.ZBDTYP )) AS  ZBDTYP        
		        , A.ZPRGFLG          -- 진행상태
		        , A.VKBUR             -- 사업장
		        , A.VKGRP             -- 영업그룹
		        , A.ZKUNNR          -- 영업사원
		        , A.ZAGNT            -- 대리점
		        , A.KUNNR            -- 고객번호
		        , A.ZCST               -- 기거래선
		        , A.ZGNM              -- 발주처
		        , A.ZDEV               -- 시행사
		        , A.GSNAM            -- 공사명
		        --, A.ZREGN             -- 지역
				,DECODE(H.DMSTAT,'QT',A.ZREGN,'SO', A.ZREGN, NULL, A.ZREGN, DECODE(A.AUART, 'ZN01', H.ZREGN, 'ZN02', H.ZREGN,  A.ZREGN )) AS  ZREGN		        
		        , A.LIFNRCHK			-- 계약형태
		        , A.ZPID                -- 현장담당자
		        , A.ZTEL                -- 현장연락처
		        --, A.ZADDR_ZPOST      -- 현장주소-우편번호
 				,DECODE(H.DMSTAT,'QT',A.ZADDR_ZPOST,'SO', A.ZADDR_ZPOST, NULL, A.ZADDR_ZPOST, DECODE(A.AUART, 'ZN01', H.PSTLZ1||H.PSTLZ2, 'ZN02', H.PSTLZ1||H.PSTLZ2,  A.ZADDR_ZPOST )) AS  ZADDR_ZPOST
		        --, A.ZADDR_ADR1     -- 현장주소-주소1
				,DECODE(H.DMSTAT,'QT',A.ZADDR_ADR1,'SO', A.ZADDR_ADR1, NULL, A.ZADDR_ADR1, DECODE(A.AUART, 'ZN01', H.ORT01_E, 'ZN02', H.ORT01_E,  A.ZADDR_ADR1 )) AS  ZADDR_ADR1 -- 현장주소-주소1
		        --, A.ZADDR_ADR2     -- 현장주소-주소2
				,DECODE(H.DMSTAT,'QT',A.ZADDR_ADR2,'SO', A.ZADDR_ADR2, NULL, A.ZADDR_ADR2, DECODE(A.AUART, 'ZN01', H.STRAS, 'ZN02', H.STRAS,  A.ZADDR_ADR2 )) AS  ZADDR_ADR2 -- 현장주소-주소2
		        , A.SOABLE            -- 수주가능성
		        , A.ZESTDAT           -- 입찰예정일
		        , A.DELDAT            -- 납기예정일
		        , A.ZDVMTS            -- 납기개월수
--		        , A.ZSUM_ZNUMBER 	  -- 합계정보-대수
		        , (SELECT sum(zt47.znumber) FROM saphee.zsdt1047 zt47 INNER JOIN saphee.mara AS mara ON zt47.mandt = mara.mandt 
		        												   AND zt47.matnr = mara.matnr 
		        												   AND mara.meins = 'ZA' 
		        												 WHERE zt47.mandt = #{mandt} AND zt47.qtnum = a.qtnum AND zt47.qtser = a.qtser ) AS ZSUM_ZNUMBER -- 합계정보-대수		        
       			, A.ZSUM_ZCOST    -- 합계정보 원가 
		        , A.ZSUM_ZEAM      -- 합계정보-견적가
		        , A.ZSUM_SHANG    -- 합계정보-시행율
		        , A.INCO               -- 인도조건
		        , A.ZICIF_PPRT        -- 수금정보-선수금(%)
		        , A.ZICIF_PPCT        -- 수금정보-선수금(내용)
		        , A.ZICIF_PPCD       -- 수금정보-선수금(조건)
		        , A.ZICIF_1STRT      -- 수금정보-1차중도금(%)
		        , A.ZICIF_1STCT      -- 수금정보-1차중도금(내용)
		        , A.ZICIF_1STCD      -- 수금정보-1차중도금(조건)
		        , A.ZICIF_2STRT      -- 수금정보-2차중도금(%)
		        , A.ZICIF_2STCT      -- 수금정보-2차중도금(내용)
		        , A.ZICIF_2STCD      -- 수금정보-2차중도금(조건)
		        , A.ZICIF_RMRT      -- 수금정보-잔금(%)
		        , A.ZICIF_RMCT      -- 수금정보-잔금(내용)
		        , A.ZICIF_RMCD      -- 수금정보-잔금(조건)
		        , A.SPRMK1           -- 특기사항1
		        , A.SPRMK2           -- 특기사항2
		        , A.SPRMK3           -- 특기사항3
		        , A.SPRMK4           -- 특기사항4
		        , A.SPRMK5           -- 특기사항5
		        , A.SPRMK6           -- 특기사항6
		        , A.SPRMK7           -- 특기사항7
		        , A.SPRMK8           -- 특기사항8
		        , A.SPRMK9           -- 특기사항9
		        , A.SPRMK10          -- 특기사항10
		        , A.ZSOFLG            -- 수주여부
		        , A.SONNR            -- 수주계획번호
		        , A.VBELN             -- 프로젝트번호
		        , A.WAERK            -- 통화
		        , A.AUART            -- 판매문서유형
				, A.CO_DDVRTQ
				, A.CO_DEPHTQ
				, A.CO_DSSQ
				, A.CO_BCLCDTQ
				, A.CO_CHPITQ
				, A.CO_ASPC
				, A.CO_DSV1
				, A.CO_DSV1TQ
				, A.CO_DSV2
				, A.CO_DSV2TQ
				, A.CDATE             -- 입력일
				, A.CTIME              -- 입력시각
				, A.CUSER              -- 입력자
				, A.UDATE             -- 변경일
				, A.UTIME             -- 변경시각
				, A.UUSER             -- 변경자
				, A.DDATE             -- 삭제일
				, A.DTIME             -- 삭제시각
				, A.DUSER             -- 삭제자
				, A.ZLZONE
				, A.REGION
				, A.ZKUNNR_NM    -- 담당자명
				, B.BUYR_NM         -- 거래선명
				, A.ZAGNT_NM      -- 대리점명
				, A.ZAGNTFLG          -- 대리점여부
				, A.INCO2               -- 인도조건2
				, C.ZATTPATH        -- 첨부경로
				, C.ZATTFN           -- 실파일명
				, C.ZATTFN_OR       -- 원 파일명
				, D.PART_CNT        -- 부분원가갯수
				, A.FA_BYRGBN       -- 물류업종구분
				, A.ZDELI              -- 단납기구분
				, A.AUTOLP          -- 자동도면 FLAG
				, E.ZRTRSN          -- 불가사유
				, CASE WHEN A.ZEAM1 = '0' THEN ''
						 WHEN A.ZEAM1 = '1'  THEN '일천'
						 WHEN A.ZEAM1 = '2'  THEN '이천'
						 WHEN A.ZEAM1 = '3'  THEN '삼천'
						 WHEN A.ZEAM1 = '4'  THEN '사천'
						 WHEN A.ZEAM1 = '5'  THEN '오천'
						 WHEN A.ZEAM1 = '6'  THEN '육천'
						 WHEN A.ZEAM1 = '7'  THEN '칠천'
						 WHEN A.ZEAM1 = '8'  THEN '팔천'
						 WHEN A.ZEAM1 = '9'  THEN '구천' END

				|| CASE WHEN A.ZEAM2 = '0' THEN ''
						 WHEN A.ZEAM2 = '1'  THEN '일백'
						 WHEN A.ZEAM2 = '2'  THEN '이백'
						 WHEN A.ZEAM2 = '3'  THEN '삼백'
						 WHEN A.ZEAM2 = '4'  THEN '사백'
						 WHEN A.ZEAM2 = '5'  THEN '오백'
						 WHEN A.ZEAM2 = '6'  THEN '육백'
						 WHEN A.ZEAM2 = '7'  THEN '칠백'
						 WHEN A.ZEAM2 = '8'  THEN '팔백'
						 WHEN A.ZEAM2 = '9'  THEN '구백' END

				|| CASE WHEN A.ZEAM3 = '0' THEN ''
						 WHEN A.ZEAM3 = '1'  THEN '일십'
						 WHEN A.ZEAM3 = '2'  THEN '이십'
						 WHEN A.ZEAM3 = '3'  THEN '삼십'
						 WHEN A.ZEAM3 = '4'  THEN '사십'
						 WHEN A.ZEAM3 = '5'  THEN '오십'
						 WHEN A.ZEAM3 = '6'  THEN '육십'
						 WHEN A.ZEAM3 = '7'  THEN '칠십'
						 WHEN A.ZEAM3 = '8'  THEN '팔십'
						 WHEN A.ZEAM3 = '9'  THEN '구십' END

				|| CASE WHEN A.ZEAM4 = '0' THEN ''
						 WHEN A.ZEAM4 = '1'  THEN '일'
						 WHEN A.ZEAM4 = '2'  THEN '이'
						 WHEN A.ZEAM4 = '3'  THEN '삼'
						 WHEN A.ZEAM4 = '4'  THEN '사'
						 WHEN A.ZEAM4 = '5'  THEN '오'
						 WHEN A.ZEAM4 = '6'  THEN '육'
						 WHEN A.ZEAM4 = '7'  THEN '칠'
						 WHEN A.ZEAM4 = '8'  THEN '팔'
						 WHEN A.ZEAM4 = '9'  THEN '구' END

				|| CASE WHEN A.ZEAM1 = '0' AND A.ZEAM2 = '0' AND A.ZEAM3 = '0' AND A.ZEAM4 = '0' THEN '' ELSE '조' END

				|| CASE WHEN A.ZEAM5 = '0' THEN ''
						 WHEN A.ZEAM5 = '1'  THEN '일천'
						 WHEN A.ZEAM5 = '2'  THEN '이천'
						 WHEN A.ZEAM5 = '3'  THEN '삼천'
						 WHEN A.ZEAM5 = '4'  THEN '사천'
						 WHEN A.ZEAM5 = '5'  THEN '오천'
						 WHEN A.ZEAM5 = '6'  THEN '육천'
						 WHEN A.ZEAM5 = '7'  THEN '칠천'
						 WHEN A.ZEAM5 = '8'  THEN '팔천'
						 WHEN A.ZEAM5 = '9'  THEN '구천' END

				|| CASE WHEN A.ZEAM6 = '0' THEN ''
						 WHEN A.ZEAM6 = '1'  THEN '일백'
						 WHEN A.ZEAM6 = '2'  THEN '이백'
						 WHEN A.ZEAM6 = '3'  THEN '삼백'
						 WHEN A.ZEAM6 = '4'  THEN '사백'
						 WHEN A.ZEAM6 = '5'  THEN '오백'
						 WHEN A.ZEAM6 = '6'  THEN '육백'
						 WHEN A.ZEAM6 = '7'  THEN '칠백'
						 WHEN A.ZEAM6 = '8'  THEN '팔백'
						 WHEN A.ZEAM6 = '9'  THEN '구백' END

				|| CASE WHEN A.ZEAM7 = '0' THEN ''
						 WHEN A.ZEAM7 = '1'  THEN '일십'
						 WHEN A.ZEAM7 = '2'  THEN '이십'
						 WHEN A.ZEAM7 = '3'  THEN '삼십'
						 WHEN A.ZEAM7 = '4'  THEN '사십'
						 WHEN A.ZEAM7 = '5'  THEN '오십'
						 WHEN A.ZEAM7 = '6'  THEN '육십'
						 WHEN A.ZEAM7 = '7'  THEN '칠십'
						 WHEN A.ZEAM7 = '8'  THEN '팔십'
						 WHEN A.ZEAM7 = '9'  THEN '구십' END

				|| CASE WHEN A.ZEAM8 = '0' THEN ''
						 WHEN A.ZEAM8 = '1'  THEN '일'
						 WHEN A.ZEAM8 = '2'  THEN '이'
						 WHEN A.ZEAM8 = '3'  THEN '삼'
						 WHEN A.ZEAM8 = '4'  THEN '사'
						 WHEN A.ZEAM8 = '5'  THEN '오'
						 WHEN A.ZEAM8 = '6'  THEN '육'
						 WHEN A.ZEAM8 = '7'  THEN '칠'
						 WHEN A.ZEAM8 = '8'  THEN '팔'
						 WHEN A.ZEAM8 = '9'  THEN '구' END

				|| CASE WHEN A.ZEAM5 = '0' AND A.ZEAM6 = '0' AND A.ZEAM7 = '0' AND A.ZEAM8 = '0' THEN '' ELSE '억' END

				|| CASE WHEN A.ZEAM9 = '0' THEN ''
						 WHEN A.ZEAM9 = '1'  THEN '일천'
						 WHEN A.ZEAM9 = '2'  THEN '이천'
						 WHEN A.ZEAM9 = '3'  THEN '삼천'
						 WHEN A.ZEAM9 = '4'  THEN '사천'
						 WHEN A.ZEAM9 = '5'  THEN '오천'
						 WHEN A.ZEAM9 = '6'  THEN '육천'
						 WHEN A.ZEAM9 = '7'  THEN '칠천'
						 WHEN A.ZEAM9 = '8'  THEN '팔천'
						 WHEN A.ZEAM9 = '9'  THEN '구천' END

				|| CASE WHEN A.ZEAM10 = '0' THEN ''
						 WHEN A.ZEAM10 = '1'  THEN '일백'
						 WHEN A.ZEAM10 = '2'  THEN '이백'
						 WHEN A.ZEAM10 = '3'  THEN '삼백'
						 WHEN A.ZEAM10 = '4'  THEN '사백'
						 WHEN A.ZEAM10 = '5'  THEN '오백'
						 WHEN A.ZEAM10 = '6'  THEN '육백'
						 WHEN A.ZEAM10 = '7'  THEN '칠백'
						 WHEN A.ZEAM10 = '8'  THEN '팔백'
						 WHEN A.ZEAM10 = '9'  THEN '구백' END

				|| CASE WHEN A.ZEAM11 = '0' THEN ''
						 WHEN A.ZEAM11 = '1'  THEN '일십'
						 WHEN A.ZEAM11 = '2'  THEN '이십'
						 WHEN A.ZEAM11 = '3'  THEN '삼십'
						 WHEN A.ZEAM11 = '4'  THEN '사십'
						 WHEN A.ZEAM11 = '5'  THEN '오십'
						 WHEN A.ZEAM11 = '6'  THEN '육십'
						 WHEN A.ZEAM11 = '7'  THEN '칠십'
						 WHEN A.ZEAM11 = '8'  THEN '팔십'
						 WHEN A.ZEAM11 = '9'  THEN '구십' END

				|| CASE WHEN A.ZEAM12 = '0' THEN ''
						 WHEN A.ZEAM12 = '1'  THEN '일'
						 WHEN A.ZEAM12 = '2'  THEN '이'
						 WHEN A.ZEAM12 = '3'  THEN '삼'
						 WHEN A.ZEAM12 = '4'  THEN '사'
						 WHEN A.ZEAM12 = '5'  THEN '오'
						 WHEN A.ZEAM12 = '6'  THEN '육'
						 WHEN A.ZEAM12 = '7'  THEN '칠'
						 WHEN A.ZEAM12 = '8'  THEN '팔'
						 WHEN A.ZEAM12 = '9'  THEN '구' END

				|| CASE WHEN A.ZEAM9 = '0' AND A.ZEAM10 = '0' AND A.ZEAM11 = '0' AND A.ZEAM12 = '0' THEN '' ELSE '만' END

				|| CASE WHEN A.ZEAM13 = '0' THEN ''
						 WHEN A.ZEAM13 = '1'  THEN '일천'
						 WHEN A.ZEAM13 = '2'  THEN '이천'
						 WHEN A.ZEAM13 = '3'  THEN '삼천'
						 WHEN A.ZEAM13 = '4'  THEN '사천'
						 WHEN A.ZEAM13 = '5'  THEN '오천'
						 WHEN A.ZEAM13 = '6'  THEN '육천'
						 WHEN A.ZEAM13 = '7'  THEN '칠천'
						 WHEN A.ZEAM13 = '8'  THEN '팔천'
						 WHEN A.ZEAM13 = '9'  THEN '구천' END

				|| CASE WHEN A.ZEAM14 = '0' THEN ''
						 WHEN A.ZEAM14 = '1'  THEN '일백'
						 WHEN A.ZEAM14 = '2'  THEN '이백'
						 WHEN A.ZEAM14 = '3'  THEN '삼백'
						 WHEN A.ZEAM14 = '4'  THEN '사백'
						 WHEN A.ZEAM14 = '5'  THEN '오백'
						 WHEN A.ZEAM14 = '6'  THEN '육백'
						 WHEN A.ZEAM14 = '7'  THEN '칠백'
						 WHEN A.ZEAM14 = '8'  THEN '팔백'
						 WHEN A.ZEAM14 = '9'  THEN '구백' END

				|| CASE WHEN A.ZEAM15 = '0' THEN ''
						 WHEN A.ZEAM15 = '1'  THEN '일십'
						 WHEN A.ZEAM15 = '2'  THEN '이십'
						 WHEN A.ZEAM15 = '3'  THEN '삼십'
						 WHEN A.ZEAM15 = '4'  THEN '사십'
						 WHEN A.ZEAM15 = '5'  THEN '오십'
						 WHEN A.ZEAM15 = '6'  THEN '육십'
						 WHEN A.ZEAM15 = '7'  THEN '칠십'
						 WHEN A.ZEAM15 = '8'  THEN '팔십'
						 WHEN A.ZEAM15 = '9'  THEN '구십' END

				|| CASE WHEN A.ZEAM16 = '0' THEN ''
						 WHEN A.ZEAM16 = '1'  THEN '일'
						 WHEN A.ZEAM16 = '2'  THEN '이'
						 WHEN A.ZEAM16 = '3'  THEN '삼'
						 WHEN A.ZEAM16 = '4'  THEN '사'
						 WHEN A.ZEAM16 = '5'  THEN '오'
						 WHEN A.ZEAM16 = '6'  THEN '육'
						 WHEN A.ZEAM16 = '7'  THEN '칠'
						 WHEN A.ZEAM16 = '8'  THEN '팔'
						 WHEN A.ZEAM16 = '9'  THEN '구' END AS ZEAM
						 ,Z.USERTELE 	AS TEL   -- 2012.12.14. 전화번호 추가
						 ,Z.USERFAXN   AS FAX   -- 2012.12.17. 팩스번호 추가
						 ,Z.USERMBPN  AS CEL    -- 2012.12.17. 휴대폰번호 추가
						 ,Z.USERMAIL  AS MAIL   -- 이메일주소 
						 ,B.LAND1
						 ,(SELECT LANDX FROM SAPHEE.T005T WHERE MANDT = A.MANDT AND SPRAS = '3' AND LAND1 = B.LAND1) AS LANDX
						 ,A.JGBN
						 ,A.AQTNUM
						 ,A.OPPID
						 ,A.UCH_DUTY
						 ,A.FRCMFCDAT
						 ,A.CONQTY20
						 ,A.CONQTY40
						 ,A.EGIS_FLAG
						 ,A.EGIS_EST_NO
						 ,A.EGIS_EST_SEQ
 						 ,A.PSPID_CO
						 ,A.OPENDT
				         ,Y.PORTNAME DESTNAME
				         ,A.DESTPORT
                         ,A.DEPTPORT
                         ,H.SID
                         ,A.ACHDT
                         ,A.QTVADT
                         ,(SELECT DECODE(COUNT(*),0,0,1) FROM SAPHEE.ZSDT1157 ZSDT1157 WHERE ZSDT1157.MANDT = A.MANDT AND ZSDT1157.QTNUM=A.QTNUM AND ZSDT1157.QTSER = A.QTSER AND ZSDT1157.FILEGBN = 'A' ) AS FA_CHK1
                         ,(SELECT DECODE(COUNT(*),0,0,1) FROM SAPHEE.ZSDT1157 ZSDT1157 WHERE ZSDT1157.MANDT = A.MANDT AND ZSDT1157.QTNUM=A.QTNUM AND ZSDT1157.QTSER = A.QTSER AND ZSDT1157.FILEGBN = 'B' ) AS FA_CHK2
			 FROM ( SELECT C.*
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM,  1, 1) AS ZEAM1
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM,  2, 1) AS ZEAM2
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM,  3, 1) AS ZEAM3
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM,  4, 1) AS ZEAM4
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM,  5, 1) AS ZEAM5
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM,  6, 1) AS ZEAM6
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM,  7, 1) AS ZEAM7
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM,  8, 1) AS ZEAM8
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM,  9, 1) AS ZEAM9
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM, 10, 1) AS ZEAM10
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM, 11, 1) AS ZEAM11
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM, 12, 1) AS ZEAM12
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM, 13, 1) AS ZEAM13
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM, 14, 1) AS ZEAM14
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM, 15, 1) AS ZEAM15
						   , SUBSTR(REPEAT('0', 16 - LENGTH(TRIM(ZEAM))) || ZEAM, 16, 1) AS ZEAM16
						   , CASE <if test="lang !=null and lang !=''">  CAST(#{lang} AS VARCHAR(2)) </if>
						   		  <if test="lang ==null or lang ==''">  CAST('ko' AS VARCHAR(2)) </if>
						      WHEN 'ko' THEN D.NAME1
						      ELSE      	 D.NAME2
						     END AS ZKUNNR_NM
					FROM ( SELECT E.*
									  , F.NAME1 AS ZAGNT_NM
								FROM ( SELECT z1046.MANDT
												 , z1046.QTNUM
												 , z1046.QTSER
												 , z1046.LIFNRCHK
												 , QTDAT
												 , SPART
												 , QTGBN
												 , ZBDTYP
												 , ZPRGFLG
												 , VKBUR
												 , VKGRP
												 , ZKUNNR
												 , ZAGNT
												 , KUNNR
												 , ZCST
												 , ZGNM
												 , ZDEV
												 , GSNAM
												 , ZREGN
												 , ZPID
												 , ZTEL
												 , ZADDR_ZPOST
												 , ZADDR_ADR1
												 , ZADDR_ADR2
												 , SOABLE
												 , ZESTDAT
												 , DELDAT
												 , ZDVMTS
												 , ZSUM_ZNUMBER
												 , ZSUM_ZCOST
												 , ZSUM_ZEAM
												 , ZSUM_SHANG
												 , INCO
												 , ZICIF_PPRT
												 , ZICIF_PPCT
												 , ZICIF_PPCD
												 , ZICIF_1STRT
												 , ZICIF_1STCT
												 , ZICIF_1STCD
												 , ZICIF_2STRT
												 , ZICIF_2STCT
												 , ZICIF_2STCD
												 , ZICIF_RMRT
												 , ZICIF_RMCT
												 , ZICIF_RMCD
												 , SPRMK1
												 , SPRMK2
												 , SPRMK3
												 , SPRMK4
												 , SPRMK5
												 , SPRMK6
												 , SPRMK7
												 , SPRMK8
												 , SPRMK9
												 , SPRMK10
												 , ZSOFLG
												 , SONNR
												 , VBELN
												 , WAERK
												 , AUART
												 , CO_DDVRTQ
												 , CO_DEPHTQ
												 , CO_DSSQ
												 , CO_BCLCDTQ
												 , CO_CHPITQ
												 , CO_ASPC
												 , CO_DSV1
												 , CO_DSV1TQ
												 , CO_DSV2
												 , CO_DSV2TQ
												 , CDATE
												 , CTIME
												 , CUSER
												 , UDATE
												 , UTIME
												 , UUSER
												 , DDATE
												 , DTIME
												 , DUSER
												 , ZLZONE
												 , REGION
												 , CHAR(CAST(ZSUM_ZEAM AS BIGINT)) AS ZEAM
												 , ZAGNTFLG
												 , INCO2
												 , FA_BYRGBN
												 , ZDELI
												 , JGBN
												 , AQTNUM
												 , OPPID
												 , AUTOLP
--												 , REPEAT('0', 16 - LENGTH(TRIM(CHAR(CAST(ZSUM_ZEAM AS BIGINT))))) || CHAR(CAST(ZSUM_ZEAM AS BIGINT)) AS ZEAM
												 , UCH_DUTY
												 , z1046.frcmfcdat                                                  
												 , NVL(z1091.conqty20,0) conqty20
												 , nvl(z1091.conqty40,0) conqty40
 												 , z1091.EGIS_FLAG
												 , z1091.EGIS_EST_NO
												 , z1091.EGIS_EST_SEQ
												 , z1091.PSPID_CO												                                                   
											     ,NVL((SELECT (CASE WHEN TIMESTAMPDIFF(16, TO_DATE(z1046.QTDAT, 'YYYYMMDD') - TO_DATE(D.OPENDT, 'YYYYMMDD')) > -1
											                  THEN 'Y'
											                  ELSE  'N'
											              END)  
											        FROM SAPHEE.ZSDT1127 D
											       WHERE  1=1
											         AND D.MANDT= z1046.MANDT
											         AND D.KUNNR  = z1046.KUNNR   
											       ),'N')  AS OPENDT
											     ,NVL(z1091.DESTPORT,'')  DESTPORT
											     ,NVL(z1091.DEPTPORT,'')  DEPTPORT
											     ,z1046.ACHDT
											     ,DECODE( z1046.QTVADT, 
															'00000000',
															CASE WHEN z1046.QTDAT > '19000000'  
															THEN VARCHAR_FORMAT(TO_DATE(z1046.QTDAT, 'YYYY-MM-DD') + 3 MONTH, 'YYYYMMDD')
															ELSE '' END,
															z1046.QTVADT
														) AS QTVADT
		 								   FROM SAPHEE.ZSDT1046 as z1046 -- 견적 Header
		 								   		inner join saphee.zsdt0167 as z0167 on z1046.mandt=z0167.mandt and z1046.qtnum=z0167.qtnum and z0167.tquot=#{tquot}
         								   		inner join saphee.zsdt1091 as z1091 on z1046.mandt=z1091.mandt and z1046.qtnum=z1091.qtnum and z1046.qtser=z1091.qtser
										  WHERE z1046.MANDT	= #{mandt}
                                          AND z1046.qtser = substr(trim(z1046.qtser),1)   /* key index를 적용시키기위함(견적순번을 적용)*/
		<if test="qtnum !=null and qtnum !=''">  AND z1046.QTNUM = #{qtnum} </if>
		<if test="qtser !=null and qtser !=''">  AND z1046.QTSER = #{qtser} </if>
	    <if test="frqtdat !=null and frqtdat !=''"> AND z1046.QTDAT BETWEEN #{frqtdat} AND #{toqtdat} </if>
	    <if test="frzestdat !=null and frzestdat !=''"> AND z1046.ZESTDAT BETWEEN #{frzestdat} AND #{tozestdat} </if>
		<if test="vkbur !=null and vkbur !=''"> AND z1046.VKBUR = #{vkbur} </if>
		<if test="vkgrp !=null and vkgrp !=''">  AND z1046.VKGRP = #{vkgrp} </if>
		<if test="zkunnr !=null and zkunnr !=''">  AND z1046.ZKUNNR = #{zkunnr} </if>
		<if test="zprgflg !=null and zprgflg !=''">  AND z1046.ZPRGFLG = #{zprgflg} </if>
		<if test="kunnr !=null and kunnr !=''">  AND z1046.KUNNR = #{kunnr} </if>
		<if test="auart !=null and auart !=''">  AND z1046.AUART = #{auart} </if>
		
		<if test="qtgbn !=null and qtgbn !=''">  AND z1046.QTGBN = #{qtgbn} </if> /* 견적구분 조회조건 추가 2021.04.16. */
		
		<if test="zregn !=null and zregn !=''">  AND z1046.ZREGN = #{zregn} </if>
		<if test="gno !=null and gno !=''">  AND z1046.ZAGNT = #{gno} </if>
		<if test="darijumzkunnr !=null and darijumzkunnr !=''">  AND z1046.ZKUNNR like '%'|| #{darijumzkunnr} </if>	
		<if test='"X".equals(tquot) and "N".equals(smlysno) '> AND z1046.QTNUM NOT LIKE 'E%' /* 모의견적서 제외 2021.06.08 */</if>
		<if test="max_qtser != null and max_qtser != '' and max_qtser != 0 ">
		--  2016.12.09 최종 차수 조회 여부 추가 by mj.Shin Start ------
		  AND (z1046.MANDT, z1046.QTNUM, z1046.QTSER) IN 
              (SELECT MANDT, QTNUM, MAX(QTSER)
                 FROM SAPHEE.ZSDT1046
                WHERE MANDT = #{mandt}
				<if test="qtnum !=null and qtnum !=''">  	
						AND QTNUM = #{qtnum} </if>
				<if test="qtser !=null and qtser !=''">  	
						AND QTSER = #{qtser} </if>
			    <if test="frqtdat !=null and frqtdat !=''"> 	
			    		AND QTDAT BETWEEN #{frqtdat} AND #{toqtdat} </if>
			    <if test="frzestdat !=null and frzestdat !=''"> 	
			    		AND ZESTDAT BETWEEN #{frzestdat} AND #{tozestdat} </if>
				<if test="vkbur !=null and vkbur !=''"> 	
						AND VKBUR = #{vkbur} </if>
				<if test="vkgrp !=null and vkgrp !=''">  	
						AND VKGRP = #{vkgrp} </if>
				<if test="zkunnr !=null and zkunnr !=''">  	
						AND ZKUNNR = #{zkunnr} </if>
				<if test="zprgflg !=null and zprgflg !=''">  	
						AND ZPRGFLG = #{zprgflg} </if>
				<if test="kunnr !=null and kunnr !=''">  	
						AND KUNNR = #{kunnr} </if>
				<if test="auart !=null and auart !=''">  	
						AND AUART = #{auart} </if>
				<if test="qtgbn !=null and qtgbn !=''">  
				       AND QTGBN = #{qtgbn} </if> /* 견적구분 조회조건 추가 2021.04.16. */		
				<if test="zregn !=null and zregn !=''">  	
						AND ZREGN = #{zregn} </if>
				<if test="gno !=null and gno !=''">  	
						AND ZAGNT = #{gno} </if>
				<if test="darijumzkunnr !=null and darijumzkunnr !=''">  	
						AND ZKUNNR like '%'|| #{darijumzkunnr} </if>
				<if test='"X".equals(tquot) and "N".equals(smlysno) '> 
						AND QTNUM NOT LIKE 'E%' </if> /* 모의견적서 제외 2021.06.08 */
		                GROUP BY MANDT, QTNUM )
				--  2016.12.09 최종 차수 조회 여부 추가 by mj.Shin End ------
		</if>
							
									    ) E LEFT OUTER JOIN TABLE
										( SELECT LIFNR AS KUNNR, NAME1
										   FROM SAPHEE.LFA1
										  WHERE MANDT = #{mandt}
										    AND LIFNR = E.ZAGNT
										  UNION
										   SELECT KUNNR, NAME1
											FROM SAPHEE.KNA1
										   WHERE MANDT = #{mandt}
											  AND KTOKD = 'Z004'
											  AND KUNNR = E.ZAGNT
										) F
								  ON E.ZAGNT = F.KUNNR
							) C LEFT OUTER JOIN TABLE
	  	 					( SELECT KUNNR, NAME1, NAME2
							   FROM SAPHEE.KNA1
							  WHERE MANDT = #{mandt}
							    AND KUNNR = C.ZKUNNR
	  	 					) D
					   ON C.ZKUNNR = D.KUNNR
				 ) A
				 LEFT OUTER JOIN TABLE
				 ( SELECT KUNNR, NAME1 	AS BUYR_NM, LAND1 -- 거래선명
					  FROM SAPHEE.KNA1
					 WHERE MANDT = A.MANDT
					   AND KUNNR = A.KUNNR
					   AND KTOKD IN ( 'Z001', 'Z002', 'Z004' )
				 ) B ON A.KUNNR = B.KUNNR
				 LEFT OUTER JOIN TABLE
				 (SELECT DOCREQNO, ZSEQ, ZATTPATH, ZATTFN, ZATTFN_OR
				    FROM SAPHEE.ZSDT1065
				   WHERE MANDT    = A.MANDT
				     AND DOCREQNO = A.QTNUM
				     AND ZSEQ     = A.QTSER
				     AND ZWGBN    = 'Q' -- 해외팀에서 첨부된 계약서
				 ) C ON C.DOCREQNO = A.QTNUM AND C.ZSEQ = A.QTSER
				LEFT OUTER JOIN TABLE
				( SELECT QTNUM
						  , QTSER
						  , COUNT(*) AS PART_CNT
				   FROM SAPHEE.ZCOBT309
				  WHERE MANDT = #{mandt}
				    AND QTNUM = A.QTNUM
					AND QTSER = A.QTSER
		<if test="qtnum !=null and qtnum !=''">  AND QTNUM = #{qtnum} </if>
		<if test="qtser !=null and qtser !=''">  AND QTSER = #{qtser} </if>
			  GROUP BY QTNUM, QTSER
				) D ON A.QTNUM = D.QTNUM AND A.QTSER = D.QTSER
				LEFT OUTER JOIN TABLE
				( SELECT QTNUM, QTSER, ZRTRSN
				  FROM   SAPHEE.ZSDT1057 AS TT
				  WHERE  MANDT =#{mandt}
				  AND 	 QTNUM = A.QTNUM
				  AND 	 QTSER = A.QTSER
		  		  AND    ZRQFLG = '1'
		  		  AND    ZRQSEQ = (  SELECT MAX(ZRQSEQ) FROM SAPHEE.ZSDT1057 WHERE MANDT = '183' AND QTNUM = TT.QTNUM AND QTSER = TT.QTSER)
				) E ON A.QTNUM = E.QTNUM AND A.QTSER = E.QTSER
				LEFT    JOIN TABLE
				(		 	 
							 SELECT  USERNUMB AS USER_ID, USERNAME AS USER_NAME, USERTELE , USERFAXN, USERMBPN, USERMAIL
							 	FROM SAPHEE.ZUSERF  U  
						WHERE U.MANDT    = #{mandt}
						AND USERNUMB = SUBSTR(A.ZKUNNR, 2,7)
				) Z ON SUBSTR(A.ZKUNNR, 2,7) = Z.USER_ID					
 				LEFT JOIN SAPHEE.ZSDT1130 Y
				ON Y.MANDT = A.MANDT
				AND Y.DESTPORT = A.DESTPORT
				AND Y.LAND1 = B.LAND1
				LEFT OUTER JOIN TABLE
			   (SELECT ZSDT1154.MANDT, ZSDT1001.SONNR, ZSDT1001.SID,
			     ZSDT1154.WWPER,
			     ZSDT1154.WWSPD,
			     ZSDT1154.ZREGN,
			     ZSDT1154.WWBLD,
			     ZSDT1154.WWCAP,
			     ZSDT1154.WWUSE,
			     ZSDT1154.WWFQ,
			     ZSDT1154.PSTLZ1,
			     ZSDT1154.PSTLZ2,
			     ZSDT1154.ORT01_E,
			     ZSDT1154.STRAS,
			     ZSDT1154.MFLIFNRT,
			     ZSDT1154.DMSTAT
		        FROM  SAPHEE.ZSDT1154  ZSDT1154, SAPHEE.ZSDT1001 ZSDT1001
		        WHERE ZSDT1154.MANDT = A.MANDT
		        AND ZSDT1001.MANDT = A.MANDT
		        AND ZSDT1001.SONNR = (SELECT MAX(SONNR) FROM SAPHEE.ZSDT1046 WHERE MANDT = A.MANDT AND QTNUM = A.QTNUM )
		        AND ZSDT1001.SID = ZSDT1154.SID
		        ) H ON H.MANDT = A.MANDT
		ORDER BY A.QTNUM, A.QTSER
		WITH UR
	</select>

	<select id="selectMaxQtnumInfo" parameterType="map" resultMap="selectListHeaderMap">
		SELECT MANDT
			 , QTNUM
			 , QTSER
			 , QTDAT
			 , SPART
			 , QTGBN
			 , ZBDTYP
			 , ZPRGFLG
			 , VKBUR
			 , VKGRP
			 , ZKUNNR
			 , ZAGNT
			 , KUNNR
			 , ZCST
			 , ZGNM
			 , ZDEV
			 , GSNAM
			 , ZREGN
			 , ZPID
			 , ZTEL
			 , ZADDR_ZPOST
			 , ZADDR_ADR1
			 , ZADDR_ADR2
			 , SOABLE
			 , ZESTDAT
			 , DELDAT
			 , ZDVMTS
			 , ZSUM_ZNUMBER
			 , ZSUM_ZCOST
			 , ZSUM_ZEAM
			 , ZSUM_SHANG
			 , INCO
			 , ZICIF_PPRT
			 , ZICIF_PPCT
			 , ZICIF_PPCD
			 , ZICIF_1STRT
			 , ZICIF_1STCT
			 , ZICIF_1STCD
			 , ZICIF_2STRT
			 , ZICIF_2STCT
			 , ZICIF_2STCD
			 , ZICIF_RMRT
			 , ZICIF_RMCT
			 , ZICIF_RMCD
			 , SPRMK1
			 , SPRMK2
			 , SPRMK3
			 , SPRMK4
			 , SPRMK5
			 , SPRMK6
			 , SPRMK7
			 , SPRMK8
			 , SPRMK9
			 , SPRMK10
			 , ZSOFLG
			 , VBELN
			 , WAERK
			 , AUART
			 , CO_DDVRTQ
			 , CO_DEPHTQ
			 , CO_DSSQ
			 , CO_BCLCDTQ
			 , CO_CHPITQ
			 , CO_ASPC
			 , CO_DSV1
			 , CO_DSV1TQ
			 , CO_DSV2
			 , CO_DSV2TQ
			 , CDATE
			 , CTIME
			 , CUSER
			 , UDATE
			 , UTIME
			 , UUSER
			 , DDATE
			 , DTIME
			 , DUSER
			 , ZLZONE
			 , REGION
			 , CHAR(CAST(ZSUM_ZEAM AS BIGINT)) AS ZEAM
			 , ZAGNTFLG
			 , INCO2
			 , FA_BYRGBN
			 , ZDELI
		 FROM SAPHEE.ZSDT1046 -- 견적 Header
		WHERE (MANDT, QTNUM, QTSER)	IN (SELECT MANDT, QTNUM, MAX(QTSER) 
									     FROM SAPHEE.ZSDT1046
									    WHERE MANDT = #{mandt}
	<if test="qtnum !=null and qtnum !=''">  AND QTNUM = #{qtnum} </if>
										GROUP BY MANDT, QTNUM
									  )
		FETCH FIRST 1 ROWS ONLY
		WITH UR
	</select>

	<resultMap id="selectListDetailMap" type="hdel.sd.ses.domain.Ses0030"> 
	    <result property="mandt" column="MANDT"/>
	    <result property="qtnum" column="QTNUM"/>
	    <result property="qtser" column="QTSER"/>
	    <result property="qtseq" column="QTSEQ"/>
	    <result property="shangh" column="SHANGH"/>
	    <result property="zsarea" column="ZSAREA"/>
	    <result property="matnr" column="MATNR"/>
	    <result property="zprdgbn" column="ZPRDGBN"/>
	    <result property="spec" column="SPEC"/>
	    <result property="gtype" column="GTYPE"/>
	    <result property="type1" column="TYPE1"/>
	    <result property="type2" column="TYPE2"/>
	    <result property="type3" column="TYPE3"/>
	    <result property="znumber" column="ZNUMBER"/>
	    <result property="zacapa" column="ZACAPA"/>
	    <result property="zuse" column="ZUSE"/>
	    <result property="zopn" column="ZOPN"/>
	    <result property="zlen" column="ZLEN"/>
	    <result property="zoutc" column="ZOUTC"/>
	    <result property="zuam" column="ZUAM"/>
	    <result property="zcost" column="ZCOST"/>
	    <result property="zcostm" column="ZCOSTM"/>
	    <result property="zeam" column="ZEAM"/>
	    <result property="zeam_org" column="ZEAM_ORG"/>
	    <result property="shang" column="SHANG"/>
	    <result property="zrmk" column="ZRMK"/>
	    <result property="sonnr" column="SONNR"/>
	    <result property="cdate" column="CDATE"/>
	    <result property="ctime" column="CTIME"/>
	    <result property="uuser" column="CUSER"/>
	    <result property="udate" column="UDATE"/>
	    <result property="utime" column="UTIME"/>
	    <result property="uuser" column="UUSER"/>
	    <result property="zuse_nm" column="ZUSE_NM"/>
	    <result property="zuams" column="ZUAMS"/>	    
	    <result property="zurate" column="ZURATE"/>
  	    <result property="conqty20" column="CONQTY20"/>	    
	    <result property="conqty40" column="CONQTY40"/>
	    <result property="egis_est_no" column="EGIS_EST_NO"/>
	    <result property="egis_est_seq" column="EGIS_EST_SEQ"/>
	    <result property="egis_est_serno" column="EGIS_EST_SERNO"/>
	    <result property="egis_spec_type" column="EGIS_SPEC_TYPE"/>
	    <result property="incrtf_tp" column="INCRTF_TP"/>
	    <result property="brndcd" column="BRNDCD"/>
	    <result property="brndnm" column="BRNDNM"/>
	    <result property="brndseq" column="BRNDSEQ"/>
	    <result property="sndSys" column="SNDSYS"/>
	    <result property="sid" column="SID"/>
	    <result property="mflifnrt" column="MFLIFNRT"/>
	    <result property="dmstat" column="DMSTAT"/>
	    <result property="cslifnrt" column="CSLIFNRT"/>
	    <result property="margin" column="MARGIN"/>
	    <result property="zuamp" column="ZUAMP"/>
	    <result property="zcostp" column="ZCOSTP"/>
	    <result property="delvno" column="DELVNO"/>
	</resultMap>
	
	<select id="selectListDetail" parameterType="hdel.sd.ses.domain.Ses0030ParamVO" resultMap="selectListDetailMap">
		SELECT A.MANDT           -- 클라이언트
	         , A.QTNUM           -- 견적번호
	         , A.QTSER             -- 견적차수
	         , A.QTSEQ            -- 견적일련번호
	         , A.SHANGH          -- 국내/상해구분
	         , A.ZSAREA           -- 판매지역
	         , A.MATNR            -- 자재번호
	         , A.ZPRDGBN         -- 
	         , A.SPEC               -- 스펙
	         , A.GTYPE              -- 기종
	        -- , A.TYPE1              -- 타입1
			,DECODE(H.DMSTAT,'QT',A.TYPE1,'SO', A.TYPE1, NULL, A.TYPE1, DECODE(B.AUART, 'ZN01', H.WWPER, 'ZN02', H.WWPER,  A.TYPE1 )) AS  TYPE1 -- 타입1
	        -- , A.TYPE2              -- 타입2
	        ,DECODE(H.DMSTAT,'QT',A.TYPE2,'SO', A.TYPE2, NULL, A.TYPE2, DECODE(B.AUART, 'ZN01', H.WWSPD, 'ZN02', H.WWSPD,  A.TYPE2 )) AS  TYPE2 -- 타입2
	         --, A.TYPE3              -- 타입3
			,DECODE(H.DMSTAT,'QT', CAST(COALESCE(NULLIF( TRIM(A.TYPE3||''),''),'0') AS INTEGER) ,'SO', CAST(COALESCE(NULLIF( TRIM(A.TYPE3||''),''),'0') AS INTEGER) , NULL, CAST(COALESCE(NULLIF( TRIM(A.TYPE3||''),''),'0') AS INTEGER), DECODE(B.AUART, 'ZN01', H.WWFQ, 'ZN02', H.WWFQ,  CAST(COALESCE(NULLIF( TRIM(A.TYPE3||''),''),'0') AS INTEGER))) AS  TYPE3 -- 타입3
	        , A.ZNUMBER         -- 대수
	         --, A.ZACAPA           -- 용량
             ,DECODE(H.DMSTAT,'QT',A.ZACAPA,'SO', A.ZACAPA, NULL, A.ZACAPA, DECODE(B.AUART, 'ZN01', H.WWCAP, 'ZN02', H.WWCAP,  A.ZACAPA )) AS  ZACAPA -- 용량
	         --, A.ZUSE               -- 용도/각도
             ,DECODE(H.DMSTAT,'QT',A.ZUSE,'SO', A.ZUSE, NULL, A.ZUSE, DECODE(B.AUART, 'ZN01', H.WWUSE, 'ZN02', H.WWUSE,  A.ZUSE )) AS  ZUSE -- 용도/각도
	         , (
	 			SELECT ATWTB
	 			FROM                SAPHEE.KSML AS A
	 			INNER JOIN          SAPHEE.CABN AS B	ON A.MANDT = B.MANDT	AND A.IMERK = B.ATINN
	 			LEFT OUTER JOIN	    SAPHEE.CABNT AS C	ON B.MANDT = C.MANDT	AND B.ATINN = C.ATINN	AND C.SPRAS = '3'
	 			INNER JOIN          SAPHEE.KLAH AS D	ON A.MANDT = D.MANDT	AND A.CLINT = D.CLINT
	 			LEFT OUTER JOIN     SAPHEE.CAWN AS E	ON B.MANDT = E.MANDT	AND B.ATINN = E.ATINN
	 			LEFT OUTER JOIN     SAPHEE.CAWNT AS F	ON A.MANDT = F.MANDT AND E.ATINN = F.ATINN AND E.ATZHL = F.ATZHL AND F.SPRAS = '3'
	 			WHERE   A.MANDT = #{mandt}
	 				AND A.KLART = '300'
	 				AND D.CLASS = ZPRDGBN
	 				AND B.ATNAM = 'EL_AUSE'
	 				AND E.ATWRT = ZUSE
	         ) ZUSE_NM           -- 용도명 (출력용)
	         , A.ZOPN              -- 열림
	         --, A.ZLEN            -- 정지층수/층고
             ,DECODE(H.DMSTAT,'QT', CAST(COALESCE(NULLIF( TRIM(A.ZLEN||''),''),'0') AS INTEGER), 'SO', CAST(COALESCE(NULLIF( TRIM(A.ZLEN||''),''),'0') AS INTEGER), NULL, CAST(COALESCE(NULLIF( TRIM(A.ZLEN||''),''),'0') AS INTEGER), DECODE(B.AUART, 'ZN01', H.WWFQ, 'ZN02', H.WWFQ,  CAST(COALESCE(NULLIF( TRIM(A.ZLEN||''),''),'0') AS INTEGER))) AS  ZLEN -- 정지층수/층고  
	         , A.ZOUTC             --
	      	 , A.ZUAM     -- 단가			 
	      	 , A.ZUAMS    --상해원가 추가 : 2014.05.21 신미정수정, 정동명CJ 요청
	      	 , A.ZURATE
	      	,  A.ZCOST    -- 원가
	        , A.ZCOSTM           -- 
     	    , A.ZEAM              -- 견적가
        	, A.ZEAM AS ZEAM_ORG  -- 견적가_org
	        , A.SHANG            -- 시행율
	        , A.ZRMK              -- 비고
	        , A.SONNR            -- 수주계획번호
			, A.CDATE             -- 입력일
			, A.CTIME              -- 입력시각
			, A.CUSER              -- 입력자
			, A.UDATE             -- 변경일
			, A.UTIME             -- 변경시각
			, A.UUSER             -- 변경자
			, A.ZPRGFLG           -- 디테일 상태
     		, DECODE(QTY20.PRD,NULL,'0','','0',QTY20.PRD)  CONQTY20
     		, DECODE(QTY40.PRD,NULL,'0','','0',QTY40.PRD)  CONQTY40
			, C.EGIS_EST_NO    
			, C.EGIS_EST_SEQ   
			, C.EGIS_EST_SERNO 
			, C.EGIS_SPEC_TYPE 
			, A.INCRTF_TP
			, TRIM(A.BRNDCD) AS BRNDCD
	        , NVL((
	 			SELECT ATWTB
	 			FROM                SAPHEE.KSML AS A
	 			INNER JOIN          SAPHEE.CABN AS B	ON A.MANDT = B.MANDT	AND A.IMERK = B.ATINN
	 			LEFT OUTER JOIN	    SAPHEE.CABNT AS C	ON B.MANDT = C.MANDT	AND B.ATINN = C.ATINN	AND C.SPRAS = '3'
	 			INNER JOIN          SAPHEE.KLAH AS D	ON A.MANDT = D.MANDT	AND A.CLINT = D.CLINT
	 			LEFT OUTER JOIN     SAPHEE.CAWN AS E	ON B.MANDT = E.MANDT	AND B.ATINN = E.ATINN
	 			LEFT OUTER JOIN     SAPHEE.CAWNT AS F	ON A.MANDT = F.MANDT AND E.ATINN = F.ATINN AND E.ATZHL = F.ATZHL AND F.SPRAS = '3'
	 			WHERE   A.MANDT = #{mandt}
	 				AND A.KLART = '300'
	 				AND D.CLASS = ZPRDGBN
	 				AND B.ATNAM = 'EL_ABRAND'
	 				AND E.ATWRT = BRNDCD
	          ), A.BRNDCD) BRNDNM           -- 브랜드명
			, A.BRNDSEQ AS BRNDSEQ
			,NVL((SELECT SNDSYS FROM SAPHEE.ZSDT1140 WHERE MANDT = A.MANDT AND BRNDSEQ = A.BRNDSEQ AND ZPRDGBN = A.ZPRDGBN AND BRNDCD = A.BRNDCD), 'PDM') AS SNDSYS
			,H.SID
			,H.MFLIFNRT
			,H.DMSTAT
			,H.CSLIFNRT
	        ,ROUND(CASE WHEN A.ZEAM = 0 OR A.ZCOSTP = 0 THEN
	             0
	         ELSE
	            ((A.ZEAM - A.ZCOSTP)/A.ZEAM) * 100 
	         END, 2) AS MARGIN -- 마진율
	        ,A.ZUAMP   -- 표준단가
			,A.ZCOSTP  -- 표준원가
			,(SELECT PRD FROM SAPHEE.ZSDT1048 WHERE MANDT = A.MANDT AND QTNUM = A.QTNUM AND QTSER = A.QTSER AND QTSEQ = A.QTSEQ AND PRH = 'EL_DELVNO') AS DELVNO
 		FROM SAPHEE.ZSDT1047 AS A 
			 INNER JOIN SAPHEE.ZSDT1046 AS B 
			 ON A.MANDT = B.MANDT 
			 AND A.QTNUM = B.QTNUM 
			 AND A.QTSER = B.QTSER  -- 견적 Detail
			 LEFT JOIN SAPHEE.ZSDT1093 AS C 
			 ON A.MANDT = C.MANDT 
			 AND A.QTNUM = C.QTNUM 
			 AND A.QTSER = C.QTSER  -- 사양Detail
			 AND A.QTSEQ = C.QTSEQ
			 LEFT JOIN SAPHEE.ZSDT1048 QTY20
			 ON 1=1
			 AND A.MANDT = QTY20.MANDT
			 AND A.QTNUM = QTY20.QTNUM
		     AND A.QTSER = QTY20.QTSER
		     AND A.QTSEQ = QTY20.QTSEQ 
		     AND QTY20.PRH = 'EL_YCON20'
			 LEFT JOIN SAPHEE.ZSDT1048 QTY40
			 ON 1=1
			 AND A.MANDT = QTY40.MANDT
			 AND A.QTNUM = QTY40.QTNUM
		     AND A.QTSER = QTY40.QTSER
		     AND A.QTSEQ = QTY40.QTSEQ 
		     AND QTY40.PRH = 'EL_YCON40'
		     LEFT OUTER JOIN TABLE
			 (SELECT ZSDT1154.MANDT, ZSDT1001.SONNR, ZSDT1001.SID,
			     ZSDT1154.WWPER,
			     ZSDT1154.WWSPD,
			     ZSDT1154.ZREGN,
			     ZSDT1154.WWBLD,
			     ZSDT1154.WWCAP,
			     ZSDT1154.WWUSE,
			     ZSDT1154.WWFQ,
			     ZSDT1154.PSTLZ1,
			     ZSDT1154.PSTLZ2,
			     ZSDT1154.ORT01_E,
			     ZSDT1154.STRAS,
			     ZSDT1154.MFLIFNRT,
			     ZSDT1154.DMSTAT,
			     ZSDT1154.CSLIFNRT
		        FROM  SAPHEE.ZSDT1154  ZSDT1154, SAPHEE.ZSDT1001 ZSDT1001
		        WHERE ZSDT1154.MANDT = A.MANDT
		        AND ZSDT1001.MANDT = A.MANDT
		        AND ZSDT1001.SONNR = A.SONNR
		        AND ZSDT1001.SID = ZSDT1154.SID
		     ) H ON H.MANDT = A.MANDT AND H.SONNR = A.SONNR
	   	WHERE A.MANDT = #{mandt}
		  AND A.QTNUM = #{qtnum}
	      AND A.QTSER   = #{qtser}
	    ORDER BY A.QTSEQ
	    WITH UR  
	</select>

	<select id="isAutolpOnMaxSeq" parameterType="map" resultType="java.lang.String">
		select z1046.autolp
		from saphee.zsdt1046 as z1046
		where z1046.mandt=#{mandt}
		  and z1046.qtnum=#{qtnum}
		  and z1046.qtser=(select max(qtser) from saphee.zsdt1046 where mandt=z1046.mandt and qtnum=z1046.qtnum)
		with ur
	</select>
	
	<resultMap id="selectSameVbelnMap" type="hdel.sd.ses.domain.Ses0030">
	 	<result property="qtnum" column="QTNUM"/>
	    <result property="qtser" column="QTSER"/>
	    <result property="qtdat" column="QTDAT"/>
	    <result property="gsnam" column="GSNAM"/>
	    <result property="vbeln" column="VBELN"/>
	    <result property="zkunnr" column="ZKUNNR"/>
	    <result property="zkunnr_nm" column="ZKUNNR_NM"/>
	</resultMap>
	
	<select id="selectSameVbeln" parameterType="hdel.sd.ses.domain.Ses0030ParamVO" resultMap="selectSameVbelnMap">
		SELECT A.QTNUM, A.QTSER, A.QTDAT, A.GSNAM, A.VBELN, A.ZKUNNR, B.NAME1 AS ZKUNNR_NM -- 프로젝트 번호 중복 확인 2021.05.06.
		FROM SAPHEE.ZSDT1046 AS A, SAPHEE.KNA1 AS B
		WHERE A.MANDT = #{mandt} AND A.VBELN = #{vbeln} AND B.KUNNR = A.ZKUNNR
		ORDER BY A.QTNUM
		WITH UR
	</select>
	
</mapper>  
