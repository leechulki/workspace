<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
    <type>select</type>
    <description><![CDATA[예산그룹관리 조회 - HEAD]]></description>
    <reload>true</reload>
    <monitoring>true</monitoring>
    <result-count>0</result-count>
    <statement>
<isNotNull col="ESCS_NUMB">
WITH TREE_DATA(LEVEL, MANDT, BDGR_NAME, BGCL, BDGT, BDGT_GRUP, ESCS_CODE, BGCL_DTIL, BGIT_CODE, BDGT_NUMB, BDGT_UPNB, BDGR_CDSQ, USE_YN) AS
    (
    SELECT 1 AS LEVEL, MANDT, BDGR_NAME, BGCL, BDGT, BDGT_GRUP, ESCS_CODE, BGCL_DTIL, BGIT_CODE, BDGT_NUMB, BDGT_UPNB, BDGR_CDSQ, USE_YN
    FROM   SAPHEE.ZFST0101
    WHERE  MANDT = #G_MANDT#
      AND  BDGT_UPNB = ''
    UNION ALL
    SELECT TREE_DATA.LEVEL + 1 LEVEL, A.MANDT, A.BDGR_NAME, A.BGCL, A.BDGT, A.BDGT_GRUP, A.ESCS_CODE, A.BGCL_DTIL, A.BGIT_CODE, A.BDGT_NUMB, A.BDGT_UPNB, A.BDGR_CDSQ, A.USE_YN
    FROM   SAPHEE.ZFST0101 AS A, TREE_DATA
    WHERE  TREE_DATA.BDGT_NUMB = A.BDGT_UPNB
      AND  A.USE_YN = 'Y'
    )
SELECT
       '1' AS FLAG
      ,'M' AS DIV
      ,CASE WHEN B.EXTN_ESCS IS NULL THEN
         ''
       ELSE
         '0'
       END AS CHK
      ,A.LEVEL
      ,A.MANDT
      ,A.BDGR_NAME
      ,A.BGCL
      ,A.BDGT
      ,A.BDGT_GRUP
      ,A.ESCS_CODE
      ,A.BGCL_DTIL
      ,A.BGIT_CODE
      ,A.BDGT_NUMB
      ,A.BDGT_UPNB
      ,A.BDGR_CDSQ
      ,A.USE_YN
      ,COALESCE(B.EXTN_ESCS, '') AS EXTN_ESCS
FROM  TREE_DATA AS A
       LEFT OUTER JOIN SAPHEE.ZFST0201 AS B 
       ON  A.MANDT = B.MANDT 
       AND B.ESCS_NUMB = CAST(#ESCS_NUMB# AS VARCHAR(20))
       AND B.ESCS_NTIM = CAST(#ESCS_NTIM# AS INTEGER)
       AND A.BGIT_CODE = B.EXTN_ESCS
       AND B.ITEM_DIYN = 'M'
ORDER BY A.BDGR_CDSQ
FOR FETCH ONLY
WITH UR
</isNotNull>
<isNull col="ESCS_NUMB">
WITH TREE_DATA(LEVEL, MANDT, BDGR_NAME, BGCL, BDGT, BDGT_GRUP, ESCS_CODE, BGCL_DTIL, BGIT_CODE, BDGT_NUMB, BDGT_UPNB, BDGR_CDSQ, USE_YN) AS
    (
    SELECT 1 AS LEVEL, MANDT, BDGR_NAME, BGCL, BDGT, BDGT_GRUP, ESCS_CODE, BGCL_DTIL, BGIT_CODE, BDGT_NUMB, BDGT_UPNB, BDGR_CDSQ, USE_YN
    FROM   SAPHEE.ZFST0101
    WHERE  MANDT = #G_MANDT#
      AND  BDGT_UPNB = ''
    UNION ALL
    SELECT TREE_DATA.LEVEL + 1 LEVEL, A.MANDT, A.BDGR_NAME, A.BGCL, A.BDGT, A.BDGT_GRUP, A.ESCS_CODE, A.BGCL_DTIL, A.BGIT_CODE, A.BDGT_NUMB, A.BDGT_UPNB, A.BDGR_CDSQ, A.USE_YN
    FROM   SAPHEE.ZFST0101 AS A, TREE_DATA
    WHERE  TREE_DATA.BDGT_NUMB = A.BDGT_UPNB
      AND  A.USE_YN = 'Y'
    )
SELECT
       '1' AS FLAG
      ,'M' AS DIV
      ,'1' AS CHK
      ,A.LEVEL
      ,A.MANDT
      ,A.BDGR_NAME
      ,A.BGCL
      ,A.BDGT
      ,A.BDGT_GRUP
      ,A.ESCS_CODE
      ,A.BGCL_DTIL
      ,A.BGIT_CODE
      ,A.BDGT_NUMB
      ,A.BDGT_UPNB
      ,A.BDGR_CDSQ
      ,A.USE_YN
      ,'' AS EXTN_ESCS
FROM  TREE_DATA AS A
ORDER BY A.BDGR_CDSQ
FOR FETCH ONLY
WITH UR
</isNull>
    </statement>
    <input default-name="ds_cond">
    </input>
    <output default-name="ds_zfst0101">
    </output>
</query>
