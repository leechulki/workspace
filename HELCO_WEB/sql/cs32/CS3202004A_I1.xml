<?xml version="1.0" encoding="euc-kr"?>
<query>
	<type>insert</type>
	<description><![CDATA[<!-- 대상집계 -->]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>0</result-count>
	<statement>
<![CDATA[
INSERT INTO SAPHEE.ZCST622 (MANDT, CS622_PJT, CS622_DAT, CS622_HNO, CS622_PRO, CS622_SPC, CS622_PL, CS622_DAN, CS622_SPC2, CS622_UPN, CS622_TYN
  , CS622_SPT, CS622_ADDR, CS622_NAM, CS622_BLD, CS622_ARA, CS622_TEM, CS622_BSU, CS622_BPM, CS622_JUJ, CS622_BUJ, CS622_WDT
  , CS622_IGD, CS622_ISD, CS622_MGM, CS622_MIM, CS622_BHDA, CS622_BHDB, CS622_UIC, CS622_UID, CS622_AMT, CS622_GBN2
  , CS622_PMON, CS622_HST, CS622_YON, CS622_GBN, CS622_GBN3, CS622_HEP, CS622_CLO, CS622_HB, CS622_HFROM, CS622_HTO, CS622_YEA)  
SELECT CAST(#G_MANDT# AS CHAR(3)), X.PJT, CAST(#DAT# AS CHAR(8)), X.HNO, X.PRO, X.ZSPEC12, X.ZSPEC9, X.ZSPEC7, X.ZSPEC1, X.UPN
  , CASE WHEN X.ZSPEC2 LIKE 'AETL%' 
           OR X.ZSPEC2 LIKE 'AEBL%' 
           OR X.ZSPEC2 LIKE 'AETM%' 
           OR X.ZSPEC2 LIKE 'AEBM%' 
           OR X.ZSPEC2 LIKE 'AETU%' 
           OR X.ZSPEC2 LIKE 'AEBU%' THEN 'AET' --승강기식
         WHEN X.ZSPEC2 LIKE 'ACT%'  THEN 'ACT' --평면왕복식
         ELSE 'AAN' --다층순환식
    END AS TYN
  , X.SPT, X.ADDR, X.NAM, VALUE(X.BLD_NM,''), X.ARA, X.TEM, X.BSU, X.BPM, X.JUJ, X.BUJ, X.WDT
  , X.IGD, X.ISD, X.MGM, X.MIM, VALUE(X.BHD_A,''), VALUE(X.BHD_B,'')
  , VALUE(X.UHJ_C,'')
  , X.UHJ_D
  , X.AMT
  , X.GBN2
  , X.PMON
  , CASE
       WHEN X.PMON > 3 AND X.HST_NM2 = '무상일반만료' THEN '전환펜딩실패'
       WHEN X.PMON > 3 AND X.HST_NM2 = '유상일반만료' THEN '갱신펜딩실패'
       ELSE HST_NM2
  	END AS HST_NM2
  , X.YON
  , CASE 
      WHEN X.FDT > '' THEN '실패예정'
          WHEN X.YBN = '1' AND X.HYN = '1' THEN 'FRTS'
          WHEN (X.YBN = '' OR X.YBN = '0') AND X.HYN = '1' THEN 'PRTS'
          WHEN X.YBN = '1' AND (X.HYN = '' OR X.HYN = '0') THEN 'FM'
          WHEN (X.YBN = '' OR X.YBN = '0') AND (X.HYN = '' OR X.HYN = '0') THEN 'POG'
          ELSE 'POG'
    END GBN
  , CASE 
      WHEN X.PRO = '3' THEN 'Renewal'
       		ELSE 'Conversion'
    END GBN3
  , VALUE(X.HEP,'')
  , 'N'
  , VALUE(F.GUAMO,0)
  , VALUE(F.HB_FROM,'')
  , VALUE(F.HB_TO,'')
  , X.FMS -- 년차 필드추가 CS622_YEA
  FROM
       (
       	SELECT
		       X.NO, X.PRO, X.PJT, X.HNO, X.UPN, X.SPT, X.NAM, X.BLD_NM,  X.AMT,
		       X.ARA, X.ARA_NM, X.TEM, X.TEM_NM, X.BPM, X.BPM_NM, X.BSU, X.BSU_NM, X.JUJ, X.JUJ_NM, X.BUJ, X.BUJ_NM, X.HEP, X.WDT,
		       X.IGD, X.ISD, X.MGM, X.BHD_A, X.MIM, X.BHD_B,
		       X.UHJ_C, X.UHJ_D, X.HST_NM2, 12 AS YON,
		       '' AS FDT,
               '' AS YBN,
               '' AS HYN,
              CASE WHEN X.HST_NM2 = '무상공사만료' THEN SAPHEE.MONTH_BETWEEN(X.BHD_A,CAST(#DAT# AS CHAR(8)),'1')
                    WHEN X.HST_NM2 = '무상일반만료' THEN SAPHEE.MONTH_BETWEEN(X.BHD_B,CAST(#DAT# AS CHAR(8)),'1')
                    WHEN X.HST_NM2 = '유상공사만료' THEN SAPHEE.MONTH_BETWEEN(X.UHJ_C,CAST(#DAT# AS CHAR(8)),'1')
                    WHEN X.HST_NM2 = '유상일반만료' THEN SAPHEE.MONTH_BETWEEN(X.UHJ_D,CAST(#DAT# AS CHAR(8)),'1')
                    ELSE (CASE WHEN X.IGD = '00000000' THEN 0 ELSE SAPHEE.MONTH_BETWEEN(X.IGD,CAST(#DAT# AS CHAR(8)),'1')
               END) END PMON,
               Y.ADDR1 || ' ' || Y.ADDR2 ADDR,
               X.GBN2,
               Z.ZSPEC1,
               Z.ZSPEC2,
               Z.ZSPEC9,
               Z.ZSPEC7,
               Z.ZSPEC12,
               X.FMS
          FROM
               (
                SELECT
                       ROW_NUMBER() OVER (ORDER BY A.HST_NM2, A.PJT, A.HNO) NO, A.PRO , A.PJT, A.HNO, A.SPT, A.NAM, A.UPN, A.ARA, A.ARA_NM, A.TEM, A.TEM_NM,
                       A.BPM, A.BPM_NM, A.BSU, A.BSU_NM, A.JUJ, A.JUJ_NM, A.BUJ, A.BUJ_NM, A.IGD, A.ISD, A.MGM, A.BGT_A, A.BHD_A, A.MIM, A.BGT_B, A.BHD_B,
                       A.USD_C, A.UHJ_C, A.USD_D, A.UHJ_D, A.HST_NM2, A.AMT, A.MON, A.PFM, A.PHRTS,
                       A.BLD,
                       C.CTEXT2 BLD_NM,
                       A.IGD AS BDT,
                       CASE
                            WHEN A.HST_NM2 = '미발주' THEN 0
                            WHEN A.HST_NM2 = '무상공사만료' THEN 0
                            WHEN A.HST_NM2 = '무상일반만료' THEN 0
                            WHEN A.HST_NM2 = '유상공사만료' THEN 0
                            WHEN A.HST_NM2 = '유상일반만료' THEN A.HMT
                       END HMT2,
                       CASE
                            WHEN A.HST_NM2 = '미발주' THEN 0
                            WHEN A.HST_NM2 = '무상공사만료' THEN 0
                            WHEN A.HST_NM2 = '무상일반만료' THEN 0
                            WHEN A.HST_NM2 = '유상공사만료' THEN 0
                            WHEN A.HST_NM2 = '유상일반만료' THEN A.DMT
                       END DMT2,
                       A.GBN2,
                       A.HEP,
                       A.WDT,
                       A.FMS
                  FROM
                       (
                        SELECT '1' AS PRO
                        	  ,A.PJT PJT
                              ,A.HNO HNO
                              ,G.ZSITE_NM SPT
                              ,G.KUNNR_NM NAM
                              ,'' UPN
                              ,A.ARA ARA
                              ,VALUE(SAPHEE.CODE_CONV(F.MANDT,'CS115',F.ARA),'') ARA_NM
                              ,WB.VKGRP AS TEM
                              ,VALUE(SAPHEE.CODE_CONV(F.MANDT,'VKGRP',WB.VKGRP),'') TEM_NM
                              ,F.BPM BPM
                              ,VALUE(SAPHEE.GET_BOSU_INWON(F.MANDT,F.BPM),'') BPM_NM
                              ,F.BSU BSU
                              ,VALUE(SAPHEE.GET_VENDER_N_NAME(F.MANDT,F.BSU),'') BSU_NM
                              ,F.JUJ JUJ
                              ,VALUE(SAPHEE.GET_BOSU_INWON(F.MANDT,F.JUJ),'') JUJ_NM
                              ,F.BUJ BUJ
                              ,VALUE(SAPHEE.GET_BOSU_INWON(F.MANDT,F.BUJ),'') BUJ_NM
                              ,CASE WHEN A.IGD > '00000000' THEN A.IGD ELSE '00000000' END IGD
                              ,CASE WHEN A.ISD > '00000000' THEN A.ISD ELSE ' ' END ISD
                              ,H.ZMUSAOCNT  MGM
                              ,A.BGT_A      BGT_A
                              ,A.BMT_A      BHD_A
                              ,H.ZMUSAOCNT2 MIM
                              ,''           BGT_B
                              ,''           BHD_B
                              ,A.USD_C      USD_C
                              ,A.UHJ_C      UHJ_C
                              ,''           USD_D
                              ,''           UHJ_D
                              ,''           PFM
                              ,''           PHRTS
                              ,A.AMT        AMT
                              ,A.HMT        HMT
                              ,A.DMT        DMT
                              ,A.MON        MON
                              ,CASE
                                    WHEN A.BMT_A = '' AND A.USD_C = '' THEN '미발주'
                                    WHEN A.BMT_A > '' AND A.USD_C = '' AND A.BMT_A < #DAT# THEN '무상공사만료'
                                    WHEN A.BMT_A = '' AND A.USD_C > '' AND A.USD_C < #DAT# THEN '유상공사만료'
                                    WHEN A.BMT_A > '' AND A.USD_C > '' AND A.BMT_A > A.USD_C AND A.BMT_A < #DAT# THEN '무상공사만료'
                                    WHEN A.BMT_A > '' AND A.USD_C > '' AND A.BMT_A < A.USD_C AND A.USD_C < #DAT# THEN '유상공사만료'
                                    ELSE '미발주'
                               END HST_NM2
                              ,F.BLD
                              ,'' GBN2
                              ,A.HEP
                              ,A.WDT
                              ,''           FMS
                          FROM (
                                SELECT A.PJT, A.HNO, A.ARA, A.BSU, A.BGT, A.USD, A.PJTM, A.PJTU, A.IGD, A.ISD,
                                       A.BGT_A, A.BMT_A, A.GNO_A, A.USD_C, A.UHJ_C, A.GNO_C, A.AMT, A.HMT, A.DMT, A.MON, A.HEP, A.WDT
                                  FROM (
                                        SELECT B.CS101_PJT PJT,
                                               B.CS101_HNO HNO,
                                               MAX(B.CS101_ARA) ARA,
                                               MAX(B.CS101_BSU) BSU,
                                               MIN(B.CS101_IGD) IGD,
                                               MIN(B.CS101_ISD) ISD,
                                               MIN(VALUE(A.CS116_BGT,'')) BGT,
                                               MIN(VALUE(C.CS126_USD,'')) USD,
                                               MIN(VALUE(D.CS116_PJT,'')) PJTM,
                                               MIN(VALUE(E.CS126_PJT,'')) PJTU,
                                               MIN(VALUE(F.CS116_BGT,'')) BGT_A,
                                               MAX(VALUE(F.CS116_BMT,'')) BMT_A,
                                               MAX(VALUE(F.CS116_GNO,'')) GNO_A,
                                               MIN(VALUE(G.CS126_USD,'')) USD_C,
                                               MAX(VALUE(G.CS126_UHJ,'')) UHJ_C,
                                               MAX(VALUE(G.CS126_GNO,'')) GNO_C,
                                               SUM(VALUE(G.CS126_AMT,0)) AMT,
                                               SUM(VALUE(G.CS126_HMT,0)) HMT,
                                               SUM(VALUE(G.CS126_DMT,0)) DMT,
                                               SUM(VALUE(G.CS126_UMS,0)) MON,
                                               MAX(VALUE(G.CS126_HEP,'')) HEP,
                                               MAX(VALUE(B.CS101_WDT,'')) WDT
                                          FROM SAPHEE.ZCST101 B
                                               LEFT OUTER JOIN SAPHEE.ZCST116 A ON A.MANDT = B.MANDT
                                                                               AND A.CS116_PJT = B.CS101_PJT
                                                                               AND A.CS116_HNO = B.CS101_HNO
                                                                               AND A.CS116_PST = 'A6'
                                                                               AND A.CS116_GND = 'B'
                                                                               AND A.CS116_BST <= #DAT#
                                               LEFT OUTER JOIN SAPHEE.ZCST126 C ON C.MANDT = B.MANDT
                                                                               AND C.CS126_PJT = B.CS101_PJT
                                                                               AND C.CS126_HNO = B.CS101_HNO
                                                                               AND C.CS126_PST = 'A6'
                                                                               AND C.CS126_DDT = ''
                                                                               AND C.CS126_GND = 'D'
                                                                               AND C.CS126_ADT <= #DAT#
                                               LEFT OUTER JOIN SAPHEE.ZCST116 D ON  D.MANDT = B.MANDT
                                                                               AND D.CS116_PJT = B.CS101_PJT
                                                                               AND D.CS116_HNO = B.CS101_HNO
                                                                               AND D.CS116_PST = 'A6'
                                                                               AND D.CS116_GND = 'A'
                                                                               AND D.CS116_BST <= #DAT#
                                                                               AND D.CS116_BGT <= #DAT#
                                                                               AND D.CS116_BMT >= SUBSTR(#DAT#,1,6)||'01'
                                               LEFT OUTER JOIN SAPHEE.ZCST126 E ON E.MANDT = B.MANDT
                                                                               AND E.CS126_PJT = B.CS101_PJT
                                                                               AND E.CS126_HNO = B.CS101_HNO
                                                                               AND E.CS126_PST = 'A6'
                                                                               AND E.CS126_DDT = ''
                                                                               AND E.CS126_GND = 'C'
                                                                               AND E.CS126_ADT <= #DAT#
                                                                               AND E.CS126_USD <= #DAT#
                                                                               AND E.CS126_UHJ >= SUBSTR(#DAT#,1,6)||'01'
                                               LEFT OUTER JOIN SAPHEE.ZCST116 F ON F.MANDT = B.MANDT
                                                                               AND F.CS116_PJT = B.CS101_PJT
                                                                               AND F.CS116_HNO = B.CS101_HNO
                                                                               AND F.CS116_PST = 'A6'
                                                                               AND F.CS116_GND = 'A'
                                                                               AND F.CS116_BST <= #DAT#
                                               LEFT OUTER JOIN SAPHEE.ZCST126 G ON G.MANDT = B.MANDT
                                                                               AND G.CS126_PJT = B.CS101_PJT
                                                                               AND G.CS126_HNO = B.CS101_HNO
                                                                               AND G.CS126_PST = 'A6'
                                                                               AND G.CS126_DDT = ''
                                                                               AND G.CS126_GND = 'C'
                                                                               AND G.CS126_ADT <= #DAT#
                                         WHERE B.MANDT = #G_MANDT#
                                           AND B.CS101_IGD BETWEEN '00000001' AND #DAT#
                                           AND SUBSTR(B.CS101_HNO,1,1) = 'J'
                                           AND B.CS101_PST = 'A6'
                                           AND B.CS101_ARA > ''
                                           AND B.CS101_BSU > ''
                                           AND B.CS101_PJT NOT LIKE 'M%'
                                           AND B.CS101_FDT <= #DAT#
                                        GROUP BY B.CS101_PJT, B.CS101_HNO
                                       ) A
                               ) A
                               LEFT OUTER JOIN (
                                                SELECT CS144_PJT PJT,
                                                       CS144_HNO HNO,
                                                       MAX(CS143_JHD) JHD
                                                  FROM SAPHEE.ZCST144 A,
                                                       SAPHEE.ZCST143 B
                                                 WHERE A.MANDT = B.MANDT
                                                   AND A.CS144_SEQ = B.CS143_SEQ
                                                   AND A.MANDT = #G_MANDT#
                                                   AND A.CS144_PST = 'A6'
                                                   AND B.CS143_JHD <= #DAT#
                                                   AND B.CS143_FSD <= #DAT#
                                                GROUP BY CS144_PJT, CS144_HNO
                                               ) B ON A.PJT = B.PJT
                                                  AND A.HNO = B.HNO
                               LEFT OUTER JOIN (
                                                SELECT CS172_PJO PJO,
                                                       CS172_HNO HNO,
                                                       MAX(CS172_MDT) MDT
                                                  FROM SAPHEE.ZCST172
                                                 WHERE MANDT = #G_MANDT#
                                                GROUP BY CS172_PJO, CS172_HNO
                                               ) D ON A.PJT = D.PJO
                                                  AND A.HNO = D.HNO,
                               SAPHEE.ZCST111 F INNER JOIN SAPHEE.ZMASTER01 G
                                                        ON F.MANDT = G.MANDT
                                                       AND F.PJT = G.POSID
                                                INNER JOIN SAPHEE.ZMASTER02 H
                                                        ON F.MANDT = H.MANDT
                                                       AND F.PJT = H.POSID
                                                       AND F.PJT||F.HNO = H.POSID_1,
                               SAPHEE.ZWBT010 WB
                         WHERE A.PJT = F.PJT
                           AND A.HNO = F.HNO
                           AND F.MANDT = #G_MANDT#
                           AND F.MANDT = WB.MANDT
                           AND F.BSU = WB.LGORT
                           AND WB.LGORT > ''
                           AND (F.HST <> 'D' OR (F.HST = 'D' AND VALUE(D.PJO,'') > ''))
                           AND (SUBSTR(VALUE(A.BGT,''),1,6) > SUBSTR(#DAT#,1,6) OR VALUE(A.BGT,'') = '')
                           AND (VALUE(A.USD,'') > #DAT# OR VALUE(A.USD,'') = '')
                           AND (VALUE(B.JHD,'') > #DAT# OR VALUE(B.JHD,'') = '')
                           AND (VALUE(D.MDT,'') > #DAT# OR VALUE(D.MDT,'') = '')
                           AND A.PJTM = ''
                           AND A.PJTU = ''
                           AND F.EXC = ''
                           AND A.ARA > ''
        
                        UNION ALL
        
                        SELECT '1' AS PRO
                        	  ,F.CS101_PJT PJT
                              ,F.CS101_HNO HNO
                              ,G.ZSITE_NM SPT
                              ,G.KUNNR_NM NAM
                              ,'' UPN
                              ,F.CS101_ARA ARA
                              ,VALUE(SAPHEE.CODE_CONV(F.MANDT,'CS115',F.CS101_ARA),'') ARA_NM
                              ,WB.VKGRP AS TEM
                              ,VALUE(SAPHEE.CODE_CONV(F.MANDT,'VKGRP',WB.VKGRP),'') TEM_NM
                              ,F.CS101_BPM BPM
                              ,VALUE(SAPHEE.GET_BOSU_INWON(F.MANDT,F.CS101_BPM),'') BPM_NM
                              ,F.CS101_BSU BSU
                              ,VALUE(SAPHEE.GET_VENDER_N_NAME(F.MANDT,F.CS101_BSU),'') BSU_NM
                              ,'' JUJ
                              ,'' JUJ_NM
                              ,'' BUJ
                              ,'' BUJ_NM
                              ,CASE WHEN F.CS101_IGD > '00000000' THEN F.CS101_IGD ELSE '00000000' END IGD
                              ,CASE WHEN F.CS101_ISD > '00000000' THEN F.CS101_ISD ELSE ' ' END ISD
                              ,H.ZMUSAOCNT  MGM
                              ,''           BGT_A
                              ,''           BHD_A
                              ,H.ZMUSAOCNT2 MIM
                              ,''           BGT_B
                              ,''           BHD_B
                              ,''           USD_C
                              ,''           UHJ_C
                              ,''           USD_D
                              ,''           UHJ_D
                              ,''           PFM
                              ,''           PHRTS
                              ,0            AMT
                              ,0            HMT
                              ,0						DMT
                              ,0            MON
                              ,'미발주'     HST_NM2
                              ,I.WWBLD      BLD
                              ,''           GBN2
                              ,''			HEP
                              ,VALUE(F.CS101_WDT,'') AS WDT
                              ,''           FMS
                          FROM SAPHEE.ZCST101 F INNER JOIN SAPHEE.ZMASTER01 G
                                                        ON F.MANDT = G.MANDT
                                                       AND F.CS101_PJT = G.POSID
                                                INNER JOIN SAPHEE.ZMASTER02 H
                                                        ON F.MANDT = H.MANDT
                                                       AND F.CS101_PJT = H.POSID
                                                       AND F.CS101_PJT||F.CS101_HNO = H.POSID_1
                                                INNER JOIN SAPHEE.VBAK I
                                                        ON F.MANDT = I.MANDT
                                                       AND F.CS101_PJT = I.ZZPJT_ID,
                               SAPHEE.ZWBT010 WB
                         WHERE F.MANDT = #G_MANDT#
                           AND F.MANDT = WB.MANDT
                           AND F.CS101_BSU = WB.LGORT
                           AND WB.LGORT > ''
                           AND SUBSTR(F.CS101_HNO,1,1) = 'J'
                           AND F.CS101_PST = 'A1'
                           AND F.CS101_ARA > ''
                           AND F.CS101_IGD BETWEEN '00000001' AND #DAT#
                           AND F.CS101_PJT NOT LIKE 'M%'
                           AND F.MDATE <= #DAT#
        
                        UNION ALL
        
                        SELECT '2' AS PRO
                        	  ,A.PJT PJT
                              ,A.HNO HNO
                              ,A.ZSITE_NM SPT
                              ,A.KUNNR_NM NAM
                              ,'' UPN
                              ,A.ARA ARA
                              ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'CS115',A.ARA),'') ARA_NM
                              ,WB.VKGRP AS TEM
                              ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'VKGRP',WB.VKGRP),'') TEM_NM
                              ,A.BPM BPM
                              ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BPM),'') BPM_NM
                              ,A.BSU BSU
                              ,VALUE(SAPHEE.GET_VENDER_N_NAME(A.MANDT,A.BSU),'') BSU_NM
                              ,A.JUJ JUJ
                              ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.JUJ),'') JUJ_NM
                              ,A.BUJ BUJ
                              ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BUJ),'') BUJ_NM
                              ,CASE WHEN A.IGD > '00000000' THEN A.IGD ELSE '00000000' END IGD
                              ,CASE WHEN A.ISD > '00000000' THEN A.ISD ELSE ' ' END ISD
                              ,A.ZMUSAOCNT  MGM
                              ,A.BGT_A      BGT_A
                              ,A.BMT_A      BHD_A
                              ,A.ZMUSAOCNT2 MIM
                              ,A.BGT_B      BGT_B
                              ,A.BMT_B      BHD_B
                              ,''           USD_C
                              ,''           UHJ_C
                              ,''           USD_D
                              ,''           UHJ_D
                              ,''           PFM
                              ,''           PHRTS
                              ,0            AMT
                              ,0            HMT
                              ,0						DMT
                              ,0            MON
                              ,'무상일반만료' HST_NM2
                              ,A.BLD
                              ,''           GBN2
                              ,A.HEP		HEP
                              ,A.WDT		WDT
                              ,''           FMS
                          FROM (
                                SELECT A.MANDT, A.PJT, A.HNO, A.ARA, A.BSU, A.IGD, A.ISD,
                                       A.BGT_B, A.BMT_B, A.BGT_A, A.BMT_A, A.GNO_B, A.GNO_A, A.HEP,
                                       G.ZSITE_NM, G.KUNNR_NM, F.BPM, F.JUJ, F.BUJ, H.ZMUSAOCNT, H.ZMUSAOCNT2, F.BLD, A.WDT
                                  FROM (
                                        SELECT A.MANDT, A.PJT, A.HNO, A.ARA, A.BSU, A.IGD, A.ISD,
                        					             A.BGT_B, A.BMT_B, A.BGT_A, A.BMT_A, A.GNO_B, A.GNO_A, C.USD, C.HEP, A.WDT
                                          FROM (
                                                SELECT A.MANDT, A.PJT, A.HNO, A.ARA, A.BSU, A.IGD, A.ISD,
                        						                   A.BGT_B, A.BMT_B, A.BGT_A, A.BMT_A, A.GNO_B, A.GNO_A, A.WDT
                                                  FROM (
                                                        SELECT MAX(A.MANDT) MANDT,
                                                               A.CS116_PJT PJT,
                                                               A.CS116_HNO HNO,
                                                               MAX(A.CS116_ARA) ARA,
                                                               MAX(A.CS116_BSU) BSU,
                                                               MIN(C.CS101_IGD) IGD,
                                                               MIN(C.CS101_ISD) ISD,
                                                               MIN(VALUE(A.CS116_BGT,'')) BGT_B,
                                                               MAX(VALUE(A.CS116_BMT,'')) BMT_B,
                                                               MIN(VALUE(D.CS116_BGT,'')) BGT_A,
                                                               MAX(VALUE(D.CS116_BMT,'')) BMT_A,
                                                               MAX(VALUE(A.CS116_GNO,'')) GNO_B,
                                                               MAX(VALUE(D.CS116_GNO,'')) GNO_A,
                                                               MAX(VALUE(C.CS101_WDT,'')) WDT
                                                          FROM SAPHEE.ZCST116 A, SAPHEE.ZCST111 B INNER JOIN SAPHEE.ZCST101 C
                                                                                                          ON B.MANDT = C.MANDT
                                                                                                         AND B.PJT = C.CS101_PJT
                                                                                                         AND B.HNO = C.CS101_HNO
                                                                                                  LEFT OUTER JOIN SAPHEE.ZCST116 D
                                                                                                          ON B.MANDT = D.MANDT
                                                                                                         AND B.PJT = D.CS116_PJT
                                                                                                         AND B.HNO = D.CS116_HNO
                                                                                                         AND D.CS116_PST = 'A6'
                                                                                                         AND D.CS116_GND = 'A'
                                                                                                         AND D.CS116_BGT <= #DAT#
                                                                                                         AND D.CS116_BST <= #DAT#
                                                         WHERE A.MANDT = #G_MANDT#
                                                           AND A.CS116_PST = 'A6'
                                                           AND A.CS116_GND = 'B'
                                                           AND A.MANDT = B.MANDT
                                                           AND A.CS116_PJT = B.PJT
                                                           AND A.CS116_HNO = B.HNO
                                                           AND SUBSTR(B.HNO,1,1) = 'J'
                                                           AND A.CS116_BST <= #DAT#
                                                         GROUP BY A.CS116_PJT, A.CS116_HNO
                                                       ) A
                                                 WHERE A.BGT_B <= #DAT#
                                               ) A LEFT OUTER JOIN
                                                                   (
                                                                    SELECT MAX(A.CS126_ARA) ARA, MAX(A.CS126_BSU) BSU, A.CS126_PJT PJT, A.CS126_HNO HNO,
                                                                           MIN(A.CS126_USD) USD, MIN(A.CS126_UMR) UMR, MAX(A.CS126_HEP) HEP
                                                                      FROM SAPHEE.ZCST126 A, SAPHEE.ZCST111 B
                                                                     WHERE A.MANDT = #G_MANDT#
                                                                       AND A.CS126_DDT = ''
                                                                       AND A.CS126_PST = 'A6'
                                                                       AND A.CS126_GND = 'D'
                                                                       AND A.CS126_USD <= #DAT#
                                                                       AND A.MANDT = B.MANDT
                                                                       AND A.CS126_PJT = B.PJT
                                                                       AND A.CS126_HNO = B.HNO
                                                                       AND SUBSTR(B.HNO,1,1) = 'J'
                                                                       AND A.CS126_ADT <= #DAT#
                                                                    GROUP BY A.CS126_PJT, A.CS126_HNO
                                                                   ) C ON A.PJT = C.PJT
                                                                      AND A.HNO = C.HNO
                                         WHERE A.BMT_B <= #DAT1#
                                       ) A LEFT OUTER JOIN
                                                           (
                                                            SELECT CS144_PJT PJT, CS144_HNO HNO, MAX(CS143_JHD) JHD
                                                              FROM SAPHEE.ZCST144 A, SAPHEE.ZCST143 B
                                                             WHERE A.MANDT = B.MANDT
                                                               AND A.CS144_SEQ = B.CS143_SEQ
                                                               AND A.MANDT = #G_MANDT#
                                                               AND A.CS144_PST = 'A6'
                                                               AND B.CS143_FSD <= #DAT#
                                                             GROUP BY CS144_PJT, CS144_HNO
                                                           ) B ON A.PJT = B.PJT
                                                              AND A.HNO = B.HNO
                                           LEFT OUTER JOIN (
                                                            SELECT CS172_PJO PJO, CS172_HNO HNO, MAX(CS172_MDT) MDT
                                                              FROM SAPHEE.ZCST172
                                                             WHERE MANDT = #G_MANDT#
                                                            GROUP BY CS172_PJO, CS172_HNO
                                                           ) D ON A.PJT = D.PJO
                                                              AND A.HNO = D.HNO,
                                       SAPHEE.ZCST111 F INNER JOIN SAPHEE.ZMASTER01 G
                                                                ON F.MANDT = G.MANDT
                                                               AND F.PJT = G.POSID
                                                        INNER JOIN SAPHEE.ZMASTER02 H
                                                                ON F.MANDT = H.MANDT
                                                               AND F.PJT = H.POSID
                                                               AND F.PJT||F.HNO = H.POSID_1
                                 WHERE A.PJT = F.PJT
                                   AND A.HNO = F.HNO
                                   AND F.MANDT = #G_MANDT#
                                   AND (F.HST <> 'D' OR (F.HST = 'D' AND VALUE(D.PJO,'') > ''))
                                   AND (VALUE(A.USD,'') > #DAT# OR VALUE(A.USD,'') = '')
                                   AND (VALUE(B.JHD,'') > #DAT# OR VALUE(B.JHD,'') = '' OR A.BGT_B > VALUE(B.JHD,''))
                                   AND (VALUE(D.MDT,'') > #DAT# OR VALUE(D.MDT,'') = '')
                               ) A,
                               SAPHEE.ZWBT010 WB
                         WHERE
                               WB.MANDT = #G_MANDT#
                           AND A.BSU = WB.LGORT
                           AND WB.LGORT > ''
        
                        UNION ALL
        
                        SELECT '3' AS PRO
                        	  ,A.PJT PJT
                              ,A.HNO HNO
                              ,A.CS121_SPT SPT
                              ,A.CS121_NAM NAM
                              ,A.UPN UPN
                              ,A.ARA ARA
                              ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'CS115',A.ARA),'') ARA_NM
                              ,WB.VKGRP AS TEM
                              ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'VKGRP',WB.VKGRP),'') TEM_NM
                              ,A.BPM BPM
                              ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BPM),'') BPM_NM
                              ,A.BSU BSU
                              ,VALUE(SAPHEE.GET_VENDER_N_NAME(A.MANDT,A.BSU),'') BSU_NM
                              ,A.JUJ JUJ
                              ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.JUJ),'') JUJ_NM
                              ,A.BUJ BUJ
                              ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BUJ),'') BUJ_NM
                              ,CASE WHEN A.IGD > '00000000' THEN A.IGD ELSE '00000000' END IGD
                              ,CASE WHEN A.ISD > '00000000' THEN A.ISD ELSE ' ' END ISD
                              ,A.ZMUSAOCNT  MGM
                              ,A.BGT_A      BGT_A
                              ,A.BMT_A      BHD_A
                              ,A.ZMUSAOCNT2 MIM
                              ,A.BGT_B      BGT_B
                              ,A.BMT_B      BHD_B
                              ,A.USD_C      USD_C
                              ,A.UHJ_C      UHJ_C
                              ,A.USD_D      USD_D
                              ,A.UHJ_D      UHJ_D
                              ,CASE WHEN A.PFM > '' THEN 'Y' ELSE '' END PFM
                              ,A.PHRTS
                              ,A.AMT        AMT
                              ,A.HMT        HMT
                              ,A.DMT				DMT
                              ,A.MON        MON
                              ,'유상일반만료' HST_NM2
                              ,A.BLD
                              ,A.GBN2
                              ,A.HEP
                              ,A.WDT
                              ,A.FMS
                          FROM (
                                SELECT A.MANDT, A.PJT, A.HNO, F.ARA, F.BSU, A.USD, A.UHJ, C.IGD, C.ISD, E.BGT_B, E.BMT_B, E.GNO_B, A.HEP,
                                       E1.BGT_A, E1.BMT_A, E1.GNO_A, E2.USD_C, E2.UHJ_C, E2.GNO_C,
                                       G.ZSITE_NM, G.KUNNR_NM, H.ZMUSAOCNT, H.ZMUSAOCNT2, F.BPM, F.JUJ, F.BUJ,
                                       E3.CS126_UPN UPN, E3.CS126_CST CST, E3.CS126_GNO GNO_D, E3.CS126_USD USD_D, E3.CS126_UHJ UHJ_D, E3.CS126_AMT AMT, E3.CS126_HMT HMT,E3.CS126_DMT DMT,
                                       E3.CS126_UMS MON, F.BLD, E3.CS126_KND PFM, E3.CS126_HYN PHRTS,
                                       E4.CS121_SPT , E4.CS121_NAM,
                                       CASE 
                                            WHEN E3.CS126_SLA = 'Y' THEN '기술용역'
                                            WHEN E3.CS126_KND > '' AND E3.CS126_HYN = 'Y' THEN 'FRTS'
                                            WHEN E3.CS126_KND = '' AND E3.CS126_HYN = 'Y' THEN 'PRTS'
                                            WHEN E3.CS126_KND > '' AND E3.CS126_HYN = 'N' THEN 'FM'
                                            WHEN E3.CS126_KND = '' AND E3.CS126_HYN = 'N' THEN 'POG'
                                            ELSE 'POG'
                                       END GBN2,
                                       C.WDT, A.FMS
                                  FROM
                                      (
                                       SELECT A.MANDT, A.PJT, A.HNO, A.USD, A.UHJ, A.ARA, A.BSU, A.USDM, A.HEP, A.FMS
                                         FROM (
                                               SELECT MAX(B.MANDT) MANDT, B.PJT, B.HNO, MAX(B.ARA) ARA, MAX(B.BSU) BSU,
                                                      MIN(B.USD) USD, MAX(B.UHJ) UHJ, MAX(B.USDM) USDM, MAX(B.HEP) HEP, MAX(FMS) FMS
                                                 FROM (
                                                       SELECT MAX(A.MANDT) MANDT, A.CS126_GRP, MAX(A.CS126_ARA) ARA, MAX(A.CS126_BSU) BSU, MAX(A.CS126_FMS) FMS,
                                                              A.CS126_PJT PJT, A.CS126_HNO HNO, MIN(A.CS126_USD) USD, MAX(A.CS126_UHJ) UHJ, MAX(A.CS126_USD) USDM, MAX(A.CS126_HEP) HEP
                                                         FROM SAPHEE.ZCST126 A, SAPHEE.ZCST111 B
                                                        WHERE A.MANDT = #G_MANDT#
                                                          AND A.CS126_DDT = ''
                                                          AND A.CS126_PST = 'A6'
                                                          AND A.CS126_GND = 'D'
                                                          AND A.CS126_USD <= #DAT#
                                                          AND A.MANDT = B.MANDT
                                                          AND A.CS126_PJT = B.PJT
                                                          AND A.CS126_HNO = B.HNO
                                                          AND SUBSTR(B.HNO,1,1) = 'J'
                                                          AND A.CS126_ADT <= #DAT#
                                                       GROUP BY A.CS126_GRP, A.CS126_PJT, A.CS126_HNO
                                                      ) B
                                                WHERE B.USD <= #DAT#
                                               GROUP BY B.PJT, B.HNO
                                              ) A
                                        WHERE A.UHJ <= #DAT1#
                                      ) A LEFT OUTER JOIN (
                                                           SELECT CS101_PJT PJT, CS101_HNO HNO,
                                                                  MIN(CS101_WDT) WDT,
                                                                  MIN(CS101_WNO) WNO,
                                                                  MIN(CS101_SCT) SCT,
                                                                  MIN(CS101_RCD) RCD,
                                                                  MIN(CS101_IGD) IGD,
                                                                  MIN(CS101_ISD) ISD,
                                                                  MIN(CS101_IJY) IJY
                                                             FROM SAPHEE.ZCST101
                                                            WHERE MANDT = #G_MANDT#
                                                              AND MDATE <= #DAT#
                                                           GROUP BY CS101_PJT, CS101_HNO
                                                          ) C ON A.PJT = C.PJT
                                                             AND A.HNO = C.HNO
                              	          LEFT OUTER JOIN (
                                                           SELECT CS116_PJT PJT, CS116_HNO HNO, MAX(CS116_BGT) BGT_B, MAX(CS116_BMT) BMT_B, MAX(CS116_GNO) GNO_B
                                                             FROM SAPHEE.ZCST116
                                                            WHERE MANDT = #G_MANDT#
                                                              AND CS116_PST = 'A6'
                                                              AND CS116_GND = 'B'
                                                              AND CS116_BST <= #DAT#
                                                           GROUP BY CS116_PJT, CS116_HNO
                                                          ) E ON A.PJT = E.PJT
                                                             AND A.HNO = E.HNO
                                          LEFT OUTER JOIN (
                                                           SELECT CS116_PJT PJT, CS116_HNO HNO, MAX(CS116_BGT) BGT_A, MAX(CS116_BMT) BMT_A, MAX(CS116_GNO) GNO_A
                                                             FROM SAPHEE.ZCST116
                                                            WHERE MANDT = #G_MANDT#
                                                              AND CS116_PST = 'A6'
                                                              AND CS116_GND = 'A'
                                                              AND CS116_BST <= #DAT#
                                                           GROUP BY CS116_PJT, CS116_HNO
                                                          ) E1 ON A.PJT = E1.PJT
                                                              AND A.HNO = E1.HNO
                                          LEFT OUTER JOIN (
                                                           SELECT CS126_PJT PJT, CS126_HNO HNO,
                                                                  MIN(CS126_USD) USD_C, MAX(CS126_UHJ) UHJ_C, MAX(CS126_GNO) GNO_C
                                                             FROM SAPHEE.ZCST126
                                                            WHERE MANDT = #G_MANDT#
                                                              AND CS126_PST = 'A6'
                                                              AND CS126_GND = 'C'
                                                              AND CS126_DDT = ''
                                                              AND CS126_ADT <= #DAT#
                                                           GROUP BY CS126_PJT, CS126_HNO
                                                          ) E2 ON A.PJT = E2.PJT
                                                              AND A.HNO = E2.HNO
                               	          LEFT OUTER JOIN (
                                                           SELECT CS144_PJT PJT, CS144_HNO HNO, MAX(CS143_JHD) JHD
                                                             FROM SAPHEE.ZCST144 A, SAPHEE.ZCST143 B
                                                            WHERE A.MANDT = B.MANDT
                                                              AND A.CS144_SEQ = B.CS143_SEQ
                                                              AND A.MANDT = #G_MANDT#
                                                              AND A.CS144_PST = 'A6'
                                                              AND B.CS143_FSD <= #DAT#
                                                           GROUP BY A.CS144_PJT, A.CS144_HNO
                                                          ) B ON A.PJT = B.PJT
                                                             AND A.HNO = B.HNO
                                          LEFT OUTER JOIN (
                                                           SELECT CS172_PJO PJO, CS172_HNO HNO, MAX(CS172_MDT) MDT
                                                             FROM SAPHEE.ZCST172
                                                            WHERE MANDT = #G_MANDT#
                                                           GROUP BY CS172_PJO, CS172_HNO
                                                          ) D ON A.PJT = D.PJO
                                                             AND A.HNO = D.HNO
                                          LEFT OUTER JOIN SAPHEE.ZCST126 E3
                                                  ON E3.MANDT = #G_MANDT#
                                                 AND A.PJT = E3.CS126_PJT
                                                 AND A.HNO = E3.CS126_HNO
                                                 AND E3.CS126_PST = 'A6'
                                                 AND E3.CS126_GND = 'D'
                                                 AND E3.CS126_DDT = ''
                                                 AND E3.CS126_USD = A.USDM
                                                 AND E3.CS126_ADT <= #DAT#
                                          INNER JOIN SAPHEE.ZCST121 E4
                                                  ON E4.MANDT = #G_MANDT#
                                                 AND E3.CS126_UPN = E4.CS121_UPN
                                                 AND E3.CS126_CST = E4.CS121_CST,
                                          SAPHEE.ZCST111 F INNER JOIN SAPHEE.ZMASTER01 G
                                                                   ON F.MANDT = G.MANDT
                                                                  AND F.PJT = G.POSID
                                                           INNER JOIN SAPHEE.ZMASTER02 H
                                                                   ON F.MANDT = H.MANDT
                                                                  AND F.PJT = H.POSID
                                                                  AND F.PJT||F.HNO = H.POSID_1
                                 WHERE A.PJT = F.PJT
                                   AND A.HNO = F.HNO
                                   AND F.MANDT = #G_MANDT#
                                   AND (F.HST <> 'D' OR (F.HST = 'D' AND VALUE(D.PJO,'') > ''))
                                   AND (VALUE(B.JHD,'') > #DAT# OR VALUE(B.JHD,'') = '' OR A.UHJ > VALUE(B.JHD,''))
                                   AND (VALUE(D.MDT,'') > #DAT# OR VALUE(D.MDT,'') = '')
                                   AND (VALUE(E.BMT_B,'') <= A.UHJ)
                               ) A,
                               SAPHEE.ZWBT010 WB
                         WHERE
                               WB.MANDT = #G_MANDT#
                           AND A.BSU = WB.LGORT
                           AND WB.LGORT > ''
                        ) A 
                       	LEFT OUTER JOIN SAPHEE.ZLCODE AS C ON C.MANDT = #G_MANDT#
                                                         AND C.CODE2 = A.BLD
                                                         AND C.CODE1 = 'CS123'
                                                         AND C.LANG = #G_LANG#
               ) X,
               SAPHEE.ZMASTER01 Y,
               SAPHEE.ZMASTER02 Z
         WHERE
               Y.MANDT = #G_MANDT#
           AND Y.MANDT = Z.MANDT
           AND Y.POSID = Z.POSID
           AND Z.POSID = X.PJT
           AND Z.POSID_1 = X.PJT || X.HNO 
        )X 
		LEFT OUTER JOIN SAPHEE.VBAK F
					ON F.MANDT = #G_MANDT#
                   AND X.PJT = F.ZZPJT_ID					    	                         
ORDER BY X.PRO, X.PJT, X.HNO
WITH UR	
]]>
</statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="_none">
	</output>
</query>
