<?xml version="1.0" encoding="euc-kr"?>
<query>
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>0</result-count>
	<statement>
<![CDATA[
SELECT
 PP004.WOKNUM AS HOGIN
,PP004.MATNR  AS MATNR
,PP004.IDNRK  AS IDNRK
,MS001.ZSITE_NM AS SITE_NM
,MS001.KUNNR_NM
,MS002.ZSPEC1 AS SPEC1
,MS002.ZSPEC2 AS SPEC2
--,MM011.MAKTX  AS MAKTX
,CASE WHEN MM011.MATNR_NM='' THEN MM011.MAKTX ELSE  MM011.MATNR_NM END AS MATNR_NM
,CASE WHEN PP004.MATKL = 'E331A' AND SUBSTR(PP004.DZEINR,14,3) = 'L21' THEN 'NONVISION='||'331C052G03'
           WHEN PP004.MATKL = 'E331A' AND SUBSTR(PP004.DZEINR,14,3) = 'L22' THEN 'NONVISION='||'331C052G01'
		   WHEN PP004.MATKL = 'E331A' AND SUBSTR(PP004.DZEINR,14,3) = 'L23' THEN 'NONVISION='||'331C052G02'
		   ELSE MM011.SPEC   
 END  AS SPEC
,MM011.ZSIZE  AS SIZE
,MM011.EXTWG  AS EXTWG
,PP004.MENGE  AS MENGE
--,PP004.MEINS  AS MEINS
,MA.MEINS AS MEINS
,PP004.DZEINR AS DZEINR
,PP004.MATKL  AS MATKL
,PP004.VERSION AS VERSION
,PP004.BOM_LEVEL AS BOM_LEVEL
,PP004.CRUSER AS CRUSER
,PP004.CRDAT  AS CRDAT
,PP004.CRTIM  AS CRTIM
,PP004.PART   AS PART
,CASE WHEN PP004.PART=11 THEN '기계-구조물'
      WHEN PP004.PART=12 THEN '기계-의장'
      WHEN PP004.PART=21 THEN '전기-CP'
      WHEN PP004.PART=22 THEN '전기-의장'
      WHEN PP004.PART=23 THEN '전기-CABLE'
      WHEN PP004.PART=50 THEN '주차'
      WHEN PP004.PART=60 THEN 'E/S,M/W'
      WHEN PP004.PART=70 THEN '물류' ELSE '' END AS PART_NM
,VALUE(PP008.TEXT,'') AS TEXT
,'0' AS NUM
,PP004.ITEM_SEQ  AS ITEM_SEQ
,CASE PP004.PRCTYP WHEN 'C' THEN '변경' WHEN 'D' THEN '삭제' WHEN 'N' THEN '추가' ELSE '' END AS PRCTYP
,CASE PP004.PRCTYP WHEN 'C' THEN PRCTYP||' '||SUBSTR(PP004.CRDAT,5,2)||'.'||SUBSTR(PP004.CRDAT,7,2) WHEN 'N' THEN PRCTYP||' '||SUBSTR(PP004.CRDAT,5,2)||'.'||SUBSTR(PP004.CRDAT,7,2) ELSE '' END AS PRCTYPS
,REPLACE(CHAR(CURRENT DATE),'-','.')||' '||REPLACE(SUBSTR(CHAR(CURRENT TIME),1,5),'.',':') AS CURR_DATE
,MS002.POSID_OLD AS POSID_OLD
,VALUE((
		
		SELECT
		PP008.TEXT
		FROM SAPHEE.ZPPT008 AS PP008 
		WHERE PP008.MANDT   = PP004.MANDT
		  AND PP008.WOKNUM  = PP004.WOKNUM
		  AND PP008.IDNRK   = '1211G0001'
		  AND PP008.SPEC_TYP <> '3'
		  AND PP008.SERIAL  = '0001'
		FETCH FIRST 1 ROWS ONLY
				
 ),'') AS XV
,VALUE((
		
		SELECT 
		PP008.TEXT
		FROM SAPHEE.ZPPT008 AS PP008 
		WHERE PP008.MANDT   = PP004.MANDT
		  AND PP008.WOKNUM  = PP004.WOKNUM
		  AND PP008.MATKL   = 'E321A'
		  AND PP008.SPEC_TYP <> '3'
		  AND PP008.TEXT LIKE '%CD%'
		  ORDER BY PP008.CRDAT DESC 
		FETCH FIRST 1 ROWS ONLY
				
 ),'') AS TYPE
,CASE WHEN SUBSTR(PP004.POSID_1,7,1) = 'N' THEN 
   VALUE ((SELECT
   LNAME
   FROM SAPHEE.ZMMT013 AS MM013
   WHERE MM013.MANDT = PP004.MANDT
     AND MM013.POSID = PP004.WOKNUM
     AND MM013.MATNR = PP004.IDNRK
     AND MM013.STATE = '2'
     FETCH FIRST 1 ROWS ONLY),'') 
   ELSE VALUE((

    SELECT
    LNAME
    FROM SAPHEE.ZMMT013 AS MM013
    WHERE MM013.MANDT   = PP004.MANDT
      AND MM013.POSID   = PP004.POSID_1 || '-P'
      AND MM013.MATNR   = PP004.IDNRK 
      AND MM013.STATE   = '2'
    FETCH FIRST 1 ROWS ONLY
      
 ),'') END AS LNAME
,(SELECT 
		CASE WHEN VALUE(MAX(PP008.TEXT),'N') = 'N' THEN '' ELSE 'STEEL LOUVER 출하' END REMARK 
		FROM SAPHEE.ZPPT008 AS PP008 
		WHERE PP008.MANDT   = PP004.MANDT
		  AND PP008.WOKNUM  = PP004.WOKNUM
		  AND PP008.MATKL   = 'E321A'
		  AND PP008.SPEC_TYP <> '3'
		  AND PP008.TEXT LIKE '%CD%'
		  AND (PP008.TEXT LIKE '%CD249A%' OR PP008.TEXT LIKE '%CD249B%' OR PP008.TEXT LIKE '%CD249C%' OR PP008.TEXT LIKE '%CD247A%' OR PP008.TEXT LIKE '%CD247B%' OR PP008.TEXT LIKE '%CD299B%')
) REMARK
FROM (

      SELECT
       MANDT
      ,CRDAT
      ,SEQNO
      ,WOKNUM
      ,MATNR
      ,IDNRK
      ,ITEM_SEQ
      ,MENGE
      ,MEINS
      ,MATKL
      ,DZEINR
      ,PRCTYP
      ,VERSION
      ,BOM_LEVEL
      ,CRUSER
      ,CRTIM
      ,ROW_NUMBER() OVER(PARTITION BY MANDT,WOKNUM,MATNR,IDNRK,ITEM_SEQ,MATKL ORDER BY MANDT,WOKNUM,MATNR,IDNRK,ITEM_SEQ,CRDAT DESC,SEQNO DESC) AS ROWNO
      ,CASE WHEN SUBSTR(WOKNUM,1,2)='QM' THEN SUBSTR(WOKNUM,3,6)
            WHEN SUBSTR(WOKNUM,1,1)='Q'  THEN SUBSTR(WOKNUM,2,6) ELSE SUBSTR(WOKNUM,1,6) END AS POSID
      ,CASE WHEN SUBSTR(WOKNUM,1,2)='QM' THEN SUBSTR(WOKNUM,3,9)
            WHEN SUBSTR(WOKNUM,1,1)='Q'  THEN SUBSTR(WOKNUM,2,9) ELSE SUBSTR(WOKNUM,1,9) END AS POSID_1
      ,CASE WHEN ZPART='M'             THEN 11
            WHEN ZPART='C'             THEN 12
            WHEN ZPART='1'             THEN 21
            WHEN ZPART='2'             THEN 22
            WHEN ZPART='3'             THEN 23
            WHEN SUBSTR(MATKL,2,1)='5' THEN 50
            WHEN SUBSTR(MATKL,2,1)='6' THEN 60
            WHEN SUBSTR(MATKL,2,1)='7' THEN 70
            WHEN SUBSTR(MATKL,2,1)='1' THEN 11
            WHEN SUBSTR(MATKL,2,1)='2' THEN 21
            WHEN SUBSTR(MATKL,2,1)='3' THEN 12 ELSE 90 END AS PART
      FROM SAPHEE.ZPPT004
      WHERE MANDT = #G_MANDT#
        AND WOKNUM LIKE #HOGIN#||'%' 
        AND BOM_LEVEL = '01'
        AND  MATKL  NOT IN ('E262A01','E280A01','E280B01','E281A01','E286A06','E291A01','E291B01',
							'C295A01','E322C','A604A','ALAB','AR92','C263A01','C263A04','C263A07',
							'C263A10','C263A12','C263A13','C263A14','C263A15','C263A16','C263B01',
							'C263B04','C263B07','C263B10','C263B16','C263B17','C263B18','C263B19',
							'C264B01','D582A'  ,'D591A'  ,'D592A'  ,'E280A05','E280B02',
							'E281A04','E282A05','E322A11','E322A09','E322A12')

    ) AS PP004
    LEFT OUTER JOIN SAPHEE.ZMASTER02 AS MS002 ON  MS002.MANDT   = PP004.MANDT 
                                              AND MS002.POSID   = PP004.POSID 
                                              AND MS002.POSID_1 = PP004.POSID_1
    LEFT OUTER JOIN SAPHEE.ZMMT011   AS MM011 ON  MM011.MANDT   = PP004.MANDT 
                                              AND MM011.MATNR   = PP004.IDNRK
    LEFT OUTER JOIN SAPHEE.ZPPT008   AS PP008 ON  PP008.MANDT   = PP004.MANDT
                                              AND PP008.CRDAT   = PP004.CRDAT 
                                              AND PP008.SEQNO   = PP004.SEQNO 
                                              AND PP008.WOKNUM  = PP004.WOKNUM
                                              AND PP008.MATNR   = PP004.MATNR 
                                              AND PP008.IDNRK   = PP004.IDNRK
                                              AND PP008.ITEM_SEQ= PP004.ITEM_SEQ
                                              AND PP008.MATKL   = PP004.MATKL                                             
                                              AND PP008.SPEC_TYP <> '3'
    LEFT OUTER JOIN SAPHEE.ZMASTER01 AS MS001 ON  MS001.MANDT   = PP004.MANDT 
                                              AND MS001.POSID   = PP004.POSID 
    LEFT OUTER JOIN SAPHEE.MARA AS MA ON MA.MANDT = PP004.MANDT
                                                                AND MA.MATNR = PP004.IDNRK
WHERE ROWNO = 1
  AND PRCTYP <> 'D'    -- 최종상태가 삭제(D)는 제외
  AND (
	  			 MM011.EXTWG2 LIKE 'BOX18' || '%' 
	  		OR  PP004.MATKL IN ('B120B01','E331C05','E141A','B120B02','E322A01','E322B03','E322B04','E332A02','E324B01')
        OR ( 
        			SUBSTR(PP004.POSID_1,1,1) IN ('E','C') AND 
        			PP004.MATKL IN ('E321A','E321A17','E321A08','E321A03') 
           )
	  	)
  AND PP004.MATKL  <> 'E321A03'
  AND MM011.MATNR NOT IN ( '125007011','204100174','205003149','205003152','205099057','206090059','241090040','242002040','259001126','259001127','259001249','259001542','259001723','259099107','259099108','259099116','259099117','259099118','259099119','259099120','259099121','259099122','259099139','259099140','259099141','260090004','262099108','262100015','262100026','262100032','262100033','263004004','263090075','263090125','263090162','263090163','263090193','263099020','263099040','263099175','263099234','263100303','263100307','264090058','264090132','264090170','264099057','264099164','264099165','264099166','264099167','264099168','264099169','264099170','264099171','264099172','264099173','264100005','269001027','269002003','270001030','280090001','280090011','280090012','280090054','280090061','280090062','280090063','280090064','280090065','280090066','280090067','280090071','280090074','280090076','280090078','280090080','280090086','280090102','280090103','280090104','280090106','280090107','280090112','280090116','280090122','280090136','280090141','280090145','280090146','280090149','280090150','280090152','280090158','280090159','280090161','280090162','280090164','280090166','280090167','280090170','280090172','280090173','280090174','280090177','280090178','280090179','280090180','280090182','280090183','280090184','280090186','280090187','280090189','280090190','280099001','280099007','280099011','280099021','280099025','280099056','280099058','280099073','280099077','280099087','280099113','280099120','280099122','280099124','280099126','280099138','280099144','280099158','280099169','280099171','280099175','280099176','280099186','280099190','280099193','280099200','280099202','280099212','280099219','280099229','280099230','280099231','280099232','280099233','280100305','280100314','280100316','280100319','280100321','280100326','280100327','280100328','280100329','280100330','280100331','280100332','280100333','280100335','280100336','280100476','280100477','280100479','280100480','2801T0008','281090009','281090010','281100060','281100071','281100118','281100119','281100161','282100001','282100002','282100003','282100004','286090010','286090048','290090036','291002001','291002002','291002003','291002004','291002005','291002006','291002007','291002008','291002009','291100040','291100057','291100061','291100062','291100075','291100076','291100077','291100079','2911T0002','2911T0002','322001192','322104844','R91001316','R91001607','R91002012','R91002013','R91002014','R91002015','R91002016','R91002022','R91002024','R91002040','R91002043','R91002055','R91002094','R91002150','R91002172','R91002176','R91002184','R91002186','R91002193','R91002214','R91002218','R91002219','R91002221','R91002226','R91002230','R91002233','R91002234','R91002235','R91002240','R91002241','R91002242','R91002253','R91002254','R91002255','R91002256','R91002257','R91002258','R91002260','R91002261','R91002262','R91002263','R91002264','R92007045','R92009107','R92009418')  --WALL BOX에 표기되지 말아야할 자재(장지원SW요청)
ORDER BY PP004.WOKNUM
        ,PP004.PART
        ,SUBSTR(PP004.MATKL,2)
        ,PP004.BOM_LEVEL
        ,PP004.IDNRK
        ,PP004.ITEM_SEQ
        ,PP004.MATKL
        ,PP008.SPEC_TYP
        ,PP008.SERIAL
FOR FETCH ONLY
WITH UR	]]></statement>
	<input default-name="ds_cond">
		<col name="G_MANDT" size="255" type="VARCHAR" description="" /> 
		<col name="HOGIIN" size="255" type="VARCHAR" description="" /> 
	</input>
	<output default-name="ds_list">
		<col name="HOGIN" size="72" type="VARCHAR" description="" /> 
		<col name="MATNR" size="54" type="VARCHAR" description="" /> 
		<col name="IDNRK" size="54" type="VARCHAR" description="" /> 
		<col name="SITE_NM" size="105" type="VARCHAR" description="" /> 
		<col name="KUNNR_NM" size="105" type="VARCHAR" description="" /> 
		<col name="SPEC1" size="15" type="VARCHAR" description="" /> 
		<col name="SPEC2" size="75" type="VARCHAR" description="" /> 
		<col name="MATNR_NM" size="120" type="VARCHAR" description="" /> 
		<col name="SPEC" size="180" type="VARCHAR" description="" /> 
		<col name="SIZE" size="180" type="VARCHAR" description="" /> 
		<col name="EXTWG" size="54" type="VARCHAR" description="" /> 
		<col name="MENGE" size="15" type="DECIMAL" description="" /> 
		<col name="MEINS" size="9" type="VARCHAR" description="" /> 
		<col name="DZEINR" size="120" type="VARCHAR" description="" /> 
		<col name="MATKL" size="27" type="VARCHAR" description="" /> 
		<col name="VERSION" size="6" type="VARCHAR" description="" /> 
		<col name="BOM_LEVEL" size="6" type="VARCHAR" description="" /> 
		<col name="CRUSER" size="60" type="VARCHAR" description="" /> 
		<col name="CRDAT" size="24" type="VARCHAR" description="" /> 
		<col name="CRTIM" size="18" type="VARCHAR" description="" /> 
		<col name="PART" size="11" type="INTEGER" description="" /> 
		<col name="PART_NM" size="16" type="VARCHAR" description="" /> 
		<col name="TEXT" size="300" type="VARCHAR" description="" /> 
		<col name="NUM" size="1" type="VARCHAR" description="" /> 
		<col name="ITEM_SEQ" size="12" type="VARCHAR" description="" /> 
		<col name="PRCTYP" size="6" type="VARCHAR" description="" /> 
		<col name="POSID_OLD" size="72" type="VARCHAR" description="" /> 
		<col name="XV" size="300" type="VARCHAR" description="" /> 
		<col name="TYPE" size="300" type="VARCHAR" description="" /> 
	</output>
</query>
