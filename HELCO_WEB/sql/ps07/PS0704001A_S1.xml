<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>
SELECT  ''AS CHECK , T.PSPID, T.POSID, T.ZSITE_NM, T.ZSPEC1 , T.ZSPEC2, T.LIFNR ,T.NAME1 , T.PERNO, T.NAMET2                      ,'' AS REQ_DATE  ,'' AS CHK_KIND  , '' AS CHASU , T.CHASUA, T.CHASUC, T.ZZACTSS, T.ZZJUNGO, T.ZZHOGIT
         , T.STATE, T.STATE2, T.CODE2, T.KINDA_YN  ,T.REQ_CELL , T.AUSE   
         ,CASE WHEN VALUE((SELECT T2.VALUE FROM SAPHEE.ZSDT0005 AS T2 WHERE T.MANDT =  T2.MANDT  AND T.POSID = T2.HOGI  AND T.DREUSE = T2.CHARACTERISTIC  AND T2.SEQ = ( SELECT MAX(Z.SEQ) FROM SAPHEE.ZSDT0005 AS Z WHERE T2.MANDT = Z.MANDT AND T2.HOGI= Z.HOGI AND T2.CHARACTERISTIC = Z.CHARACTERISTIC AND T2.SEQ = Z.SEQ)),'N') = 'Y' OR
                    VALUE((SELECT T2.VALUE FROM SAPHEE.ZSDT0005 AS T2 WHERE T.MANDT =  T2.MANDT  AND T.POSID = T2.HOGI  AND T.DKEY = T2.CHARACTERISTIC  AND T2.SEQ = ( SELECT MAX(Z.SEQ) FROM SAPHEE.ZSDT0005 AS Z WHERE T2.MANDT = Z.MANDT AND T2.HOGI= Z.HOGI AND T2.CHARACTERISTIC = Z.CHARACTERISTIC)),'N') = 'Y' THEN 'Y'  
	   	       WHEN SUBSTR(T.PSPID,1,1) = 'N' THEN 'Y' ELSE 'N' END  AS DREUSE 
FROM
(SELECT    M1.MANDT
       ,M1.POSID AS PSPID
       ,M2.POSID_1 AS POSID
       ,M1.ZSITE_NM
       ,M2.ZSPEC1
       ,M2.ZSPEC2
       ,M2.LIFNR
       ,M12.NAME1
       ,M2.TEMNO2 AS PERNO
       ,M2.NAMET2
       ,VALUE((SELECT MAX(CHASU) FROM SAPHEE.ZPST0036 P WHERE P.MANDT = M2.MANDT AND P.PSPID = M2.POSID AND P.POSID = M2.POSID_1 AND P.CHK_KIND = 'A'),'') AS CHASUA
       ,VALUE((SELECT MAX(CHASU) FROM SAPHEE.ZPST0036 P WHERE P.MANDT = M2.MANDT AND P.PSPID = M2.POSID AND P.POSID = M2.POSID_1 AND P.CHK_KIND = 'C'),'') AS CHASUC
       ,M2.ZZACTSS
       ,M2.ZZJUNGO
       ,M2.POSID_OLD ZZHOGIT
       ,M2.ZZCOMP2
      ,(SELECT CASE WHEN TRIM(B.STATE) = '3' THEN 'Y'
                    ELSE 'N'
       	 END
         FROM SAPHEE.ZPST0023 B
         WHERE B.MANDT = M2.MANDT
         AND B.PSPID = M2.POSID
         AND B.POSID = M2.POSID_1
         AND B.ZTYPE = '2'
        ) STATE   
      ,(SELECT CASE WHEN TRIM(B.STATE) = '3' THEN 'Y'
                    ELSE 'N'
       	 END
         FROM SAPHEE.ZPST0023 B
         WHERE B.MANDT = M2.MANDT
         AND B.PSPID = M2.POSID
         AND B.POSID = M2.POSID_1
         AND B.ZTYPE = '1'
        ) STATE2   
--    ,'' AS CODE2
-- 	     ,(SELECT CASE CAST(#RD_CHK# AS VARCHAR(10)) WHEN 'A' THEN B.LIFNR1 WHEN 'B' THEN B.LIFNR2 END 
--            FROM SAPHEE.ZMASTER01 A INNER JOIN SAPHEE.ZPST0007 B ON A.MANDT = B.MANDT AND A.ZCITY = B.ZCITY
--           WHERE A.MANDT = M1.MANDT
--           AND   A.POSID = M1.POSID) AS CODE2
        ,(SELECT B.LIFNR3 
             FROM SAPHEE.ZMASTER01 A INNER JOIN SAPHEE.ZPST0007 B ON A.MANDT = B.MANDT AND A.ZCITY = B.ZCITY
           WHERE A.MANDT = M1.MANDT
               AND A.POSID = M1.POSID) AS CODE2
       ,(SELECT CASE WHEN COUNT(*)=0 THEN 'Y' ELSE 'N' END FROM SAPHEE.ZPST0024 P WHERE P.MANDT = M2.MANDT AND P.PSPID = M2.POSID AND P.POSID = M2.POSID_1) AS KINDA_YN
         
    ,(SELECT  A.CELLP FROM SAPHEE.ZPST0001 A WHERE A.MANDT = M2.MANDT AND POSIT = 'X' AND A.RETIF = '' AND A.LIFNR = M2.LIFNR AND A.TEMNO = M2.TEMNO2 FETCH FIRST 1 ROWS ONLY) AS REQ_CELL   
	,LEFT(ZSPEC2,2) AS AUSE
	,M2.ZZCHAKG
	,CASE WHEN  M2.ZZGUBUN = '10' THEN 'EL_DREUSE' 
	           WHEN M2.ZZGUBUN = '11' THEN 'ES_DREUSE'
	           WHEN M2.ZZGUBUN = '12' THEN 'EW_DREUSE'  ELSE '' END DREUSE
     ,CASE WHEN  M2.ZZGUBUN = '10' THEN 'EL_DKEY' 
	           WHEN M2.ZZGUBUN = '11' THEN 'ES_DKEY'
	           WHEN M2.ZZGUBUN = '12' THEN 'EW_DKEY'  ELSE '' END DKEY
FROM SAPHEE.ZMASTER01 M1, SAPHEE.ZMASTER02 M2 LEFT OUTER JOIN SAPHEE.ZMMT012 M12 ON M2.MANDT = M12.MANDT AND M2.LIFNR = M12.LIFNR 
WHERE M1.MANDT = #G_MANDT#
AND M1.POSID = #PSPID#
<isEqual col="GUBUN" value="10">
AND M2.LIFNR = #G_VEND_CODE_E#
</isEqual>
<isEqual col="GUBUN" value="30">
AND M2.ZZACTSS = #G_AREA_CODE_E#
</isEqual>
AND M1.MANDT = M2.MANDT
AND M1.POSID = M2.POSID
AND (M2.POSID_1 LIKE '______L%' OR M2.POSID_1 LIKE '______S%' OR M2.POSID_1 LIKE '______J%' OR M2.POSID_1 LIKE '______W%')
AND M2.TXT30 &lt;&gt; 'Ãë¼Ò'

) AS T

WHERE T.MANDT = #G_MANDT#
  -- AND ( T.ZZCHAKG = 'X' OR T.STATE = 'Y' OR T.STATE2 = 'Y' )  " ±è¿¬½Ä gj Á¤¼ºÀÎ cjÇùÀÇ
FOR FETCH ONLY WITH UR	</statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_list">
	</output>
</query>
