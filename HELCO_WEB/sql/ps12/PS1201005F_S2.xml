<?xml version="1.0" encoding="euc-kr"?>
<query>
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>
<![CDATA[
SELECT A.LIFNR , A.PSPID, A.IPQTY AS IQNTY, A.CDATE , B.ZSITE_NM, C.NAME1, 
	          (SELECT COUNT(*) FROM SAPHEE.ZMASTER02 AS X  WHERE X.MANDT = A.MANDT AND X.POSID = A.PSPID AND X.ZZGUBUN IN ('11','12')) AS ZQNTY ,
	          (SELECT X.NAMET FROM SAPHEE.ZMASTER02 AS X  WHERE X.MANDT = A.MANDT AND X.POSID = A.PSPID AND X.ZZGUBUN IN ('11','12')      FETCH FIRST 1 ROWS ONLY) AS NAMET ,
		      (SELECT X.NAMET2 FROM SAPHEE.ZMASTER02 AS X  WHERE X.MANDT = A.MANDT AND X.POSID = A.PSPID AND X.ZZGUBUN IN ('11','12')      FETCH FIRST 1 ROWS ONLY) AS NAMET2 ,
 	          (SELECT X.USERNAME FROM SAPHEE.ZUSERF AS X  WHERE X.MANDT = A.MANDT AND X.USERNUMB = A.CNAME) AS CNAME  ,
			  (SELECT X.DEPT_N FROM SAPHEE.ZHRT001 AS X  WHERE X.MANDT = A.MANDT AND X.PSNO=  'H'|| A.CNAME) AS DPT1  ,
			  (SELECT X.DEPT_N FROM SAPHEE.ZHRT001 AS X  WHERE X.MANDT = A.MANDT AND X.PSNO=  'H'|| A.CNAME) AS DPT  ,
		      (SELECT X.RANK_N FROM SAPHEE.ZHRT001 AS X  WHERE X.MANDT = A.MANDT AND X.PSNO=  'H'|| A.CNAME) AS RANK  ,
  	          (SELECT X.RDATE FROM SAPHEE.ZPSTW0113D AS X  WHERE X.MANDT = A.MANDT AND X.LIFNR = A.LIFNR AND X.CDATE = A.CDATE AND X.PSPID = A.PSPID    FETCH FIRST 1 ROWS ONLY) AS RDATE, 
	         CASE WHEN SUBSTR(B.POSID,1,1) = 'E' OR SUBSTR(B.POSID,1,1) = 'T' OR SUBSTR(B.POSID,1,1) = 'C' 
	              THEN (SELECT (SELECT Y.LANDX 
                                 FROM SAPHEE.T005T AS Y 
			                     WHERE Y.MANDT = Z.MANDT AND Y.SPRAS = '3' AND Y.LAND1 = Z.LAND1) 
                          FROM SAPHEE.VBPA AS Z
		                 WHERE Z.MANDT = B.MANDT
			               AND Z.VBELN = B.POSID
                           AND Z.POSNR = '000000'
			               AND Z.PARVW = 'WE' )
	              ELSE B.ADDR1 || ' ' || B.ADDR2  END AS ADDR,
	       (SELECT X.CELLP FROM SAPHEE.ZPST0001 AS X  WHERE X.MANDT = A.MANDT AND X.LIFNR = A.LIFNR 
			      AND X.TEMNO = (SELECT X.TEMNO2 FROM SAPHEE.ZMASTER02 AS X  WHERE X.MANDT = A.MANDT AND X.POSID = A.PSPID AND X.ZZGUBUN IN ('11','12')  FETCH FIRST 1 ROWS ONLY) 
				  AND X.POSIT = 'X') AS CELLP
			 
  FROM SAPHEE.ZPSTW0113 AS A
 INNER JOIN SAPHEE.ZMASTER01 AS B 
   ON  A.MANDT  = B.MANDT 
	AND A.PSPID  = B.POSID
	
 LEFT OUTER JOIN SAPHEE.LFA1 AS C
   ON A.MANDT = C.MANDT
   AND A.LIFNR = C.LIFNR 
WHERE A.MANDT  = #G_MANDT#
  AND A.LIFNR =#LIFNR#
  AND A.PSPID = #PSPID#
  AND A.CDATE = #CDATE#
  


ORDER BY A.PSPID
FOR FETCH ONLY
WITH UR	]]></statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_print">
	</output>
</query>
