<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>0</result-count>
	<statement>
SELECT T2.ACTSS, T2.GBN, T2.GBN2, 
       T2.MON1, T2.MON2 ,T2.MON3, T2.MON4, T2.MON5, T2.MON6, T2.MON7, T2.MON8 , T2.MON9 , T2.MON10, T2.MON11, T2.MON12 , T2.MONT
FROM
(
SELECT A.ACTSS , 'A'  AS GBN ,  'A'  AS GBN2 , 
             VALUE(SUM(T.MON1),0) AS MON1 , VALUE(SUM(T.MON2),0) AS MON2 ,     VALUE(SUM(T.MON3),0) AS MON3 ,     VALUE(SUM(T.MON4),0) AS MON4,
 		     VALUE(SUM(T.MON5),0) AS MON5 , VALUE(SUM(T.MON6),0) AS MON6 ,     VALUE(SUM(T.MON7),0) AS MON7 ,     VALUE(SUM(T.MON8),0) AS MON8,
			 VALUE(SUM(T.MON9),0) AS MON9 , VALUE(SUM(T.MON10),0) AS MON10 ,   VALUE(SUM(T.MON11),0) AS MON11 ,   VALUE(SUM(T.MON12),0) AS MON12,
			 VALUE(( SUM(T.MON1) + SUM(T.MON2) + SUM(T.MON3) + SUM(T.MON4) + SUM(T.MON5) + SUM(T.MON6) + SUM(T.MON7) + SUM(T.MON8) + SUM(T.MON9) + SUM(T.MON10) +
			  SUM(T.MON11) + SUM(T.MON12)),0) AS MONT
			 
FROM SAPHEE.ZPST0000 AS A
LEFT OUTER JOIN 
(SELECT A.MANDT,  B.ZZACTSS, 
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '01' THEN 1 ELSE 0 END )AS MON1 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '02' THEN 1 ELSE 0 END )AS MON2 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '03' THEN 1 ELSE 0 END )AS MON3 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '04' THEN 1 ELSE 0 END )AS MON4 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '05' THEN 1 ELSE 0 END )AS MON5,              
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '06' THEN 1 ELSE 0 END )AS MON6 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '07' THEN 1 ELSE 0 END )AS MON7 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '08' THEN 1 ELSE 0 END )AS MON8 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '09' THEN 1 ELSE 0 END )AS MON9 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '10' THEN 1 ELSE 0 END )AS MON10 ,            
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '11' THEN 1 ELSE 0 END )AS MON11,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '12' THEN 1 ELSE 0 END )AS MON12                     


       
      FROM SAPHEE.ZPSTW1307 AS A
	    INNER JOIN SAPHEE.ZMASTER01 AS B
	     ON A.MANDT = B.MANDT
		  AND A.PSPID = B.POSID
		  
     WHERE A.MANDT =   #G_MANDT#
       AND SUBSTR(A.RDATE,1,4) =  SUBSTR(#SUPR_DTF#, 1 , 4)
       AND A.SUPR_DT= (SELECT MAX(X.SUPR_DT)  FROM SAPHEE.ZPSTW1307 AS X 
                        WHERE  A.MANDT = X.MANDT AND A.PSPID = X.PSPID AND X.SEQNO = (SELECT MAX(D.SEQNO)  FROM SAPHEE.ZPSTW1307 AS D WHERE X.MANDT = D.MANDT AND X.PSPID = D.PSPID AND X.SUPR_DT = D.SUPR_DT))     	
       AND A.GBN  &lt;&gt;  'B'
       
GROUP BY    A.MANDT,  B.ZZACTSS, A.RDATE, A.STATE

)	   AS T

ON A.MANDT =  T.MANDT
AND A.ACTSS = T.ZZACTSS

WHERE A.MANDT =  #G_MANDT# 

GROUP BY A.ACTSS

UNION ALL

SELECT A.ACTSS , 'A'  AS GBN ,  'B'  AS GBN2 , 
             VALUE(SUM(T.MON1),0) AS MON1 , VALUE(SUM(T.MON2),0) AS MON2 ,     VALUE(SUM(T.MON3),0) AS MON3 ,     VALUE(SUM(T.MON4),0) AS MON4,
 		     VALUE(SUM(T.MON5),0) AS MON5 , VALUE(SUM(T.MON6),0) AS MON6 ,     VALUE(SUM(T.MON7),0) AS MON7 ,     VALUE(SUM(T.MON8),0) AS MON8,
			 VALUE(SUM(T.MON9),0) AS MON9 , VALUE(SUM(T.MON10),0) AS MON10 ,   VALUE(SUM(T.MON11),0) AS MON11 ,   VALUE(SUM(T.MON12),0) AS MON12,
		     VALUE(( SUM(T.MON1) + SUM(T.MON2) + SUM(T.MON3) + SUM(T.MON4) + SUM(T.MON5) + SUM(T.MON6) + SUM(T.MON7) + SUM(T.MON8) + SUM(T.MON9) + SUM(T.MON10) +
			  SUM(T.MON11) + SUM(T.MON12)),0) AS MONT
			 
FROM SAPHEE.ZPST0000 AS A
LEFT OUTER JOIN 
(SELECT A.MANDT,  B.ZZACTSS, 
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '01' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON1 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '02' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON2 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '03' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON3 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '04' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON4 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '05' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON5,                   
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '06' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON6 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '07' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON7 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '08' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON8 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '09' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON9 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '10' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON10 ,                 
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '11' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON11,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '12' AND A.STATE = 'F' THEN 1 ELSE 0 END ) AS MON12                   
  

       
      FROM SAPHEE.ZPSTW1307 AS A
	    INNER JOIN SAPHEE.ZMASTER01 AS B
	     ON A.MANDT = B.MANDT
		  AND A.PSPID = B.POSID
		  
     WHERE A.MANDT =   #G_MANDT#
       AND SUBSTR(A.RDATE,1,4) =  SUBSTR(#SUPR_DTF#, 1 , 4)
       AND A.GBN  &lt;&gt;  'B'
       AND A.SUPR_DT= (SELECT MAX(X.SUPR_DT)  FROM SAPHEE.ZPSTW1307 AS X 
                        WHERE  A.MANDT = X.MANDT AND A.PSPID = X.PSPID AND X.SEQNO = (SELECT MAX(D.SEQNO)  FROM SAPHEE.ZPSTW1307 AS D WHERE X.MANDT = D.MANDT AND X.PSPID = D.PSPID AND X.SUPR_DT = D.SUPR_DT))     	
	--   AND B.ZZACTSS = '21'
GROUP BY    A.MANDT,  B.ZZACTSS, A.RDATE, A.STATE

)	   AS T

ON A.MANDT =  T.MANDT
AND A.ACTSS = T.ZZACTSS

WHERE A.MANDT =  #G_MANDT# 

GROUP BY A.ACTSS


 UNION ALL
SELECT A.ACTSS , 'A'  AS GBN ,  'C'  AS GBN2 , 
             VALUE(SUM(T.MON1),0) AS MON1 , VALUE(SUM(T.MON2),0) AS MON2 ,     VALUE(SUM(T.MON3),0) AS MON3 ,     VALUE(SUM(T.MON4),0) AS MON4,
 		     VALUE(SUM(T.MON5),0) AS MON5 , VALUE(SUM(T.MON6),0) AS MON6 ,     VALUE(SUM(T.MON7),0) AS MON7 ,     VALUE(SUM(T.MON8),0) AS MON8,
			 VALUE(SUM(T.MON9),0) AS MON9 , VALUE(SUM(T.MON10),0) AS MON10 ,   VALUE(SUM(T.MON11),0) AS MON11 ,   VALUE(SUM(T.MON12),0) AS MON12,
			 VALUE(( SUM(T.MON1) + SUM(T.MON2) + SUM(T.MON3) + SUM(T.MON4) + SUM(T.MON5) + SUM(T.MON6) + SUM(T.MON7) + SUM(T.MON8) + SUM(T.MON9) + SUM(T.MON10) +
			  SUM(T.MON11) + SUM(T.MON12)),0) AS MONT
			 
FROM SAPHEE.ZPST0000 AS A
LEFT OUTER JOIN 
(SELECT A.MANDT,  B.ZZACTSS, 
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '01' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON1 ,      
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '02' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON2 ,      
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '03' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON3 ,      
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '04' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON4 ,      
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '05' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON5,       
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '06' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON6 ,      
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '07' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON7 ,      
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '08' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON8 ,      
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '09' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON9 ,      
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '10' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON10 ,     
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '11' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON11,      
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '12' AND A.STATE = 'B' THEN 1 ELSE 0 END) AS MON12       
  

       
      FROM SAPHEE.ZPSTW1307 AS A
	    INNER JOIN SAPHEE.ZMASTER01 AS B
	     ON A.MANDT = B.MANDT
		  AND A.PSPID = B.POSID
		  
     WHERE A.MANDT =   #G_MANDT#
       AND SUBSTR(A.RDATE,1,4) =  SUBSTR(#SUPR_DTF#, 1 , 4)
       AND A.SUPR_DT= (SELECT MAX(X.SUPR_DT)  FROM SAPHEE.ZPSTW1307 AS X 
                        WHERE  A.MANDT = X.MANDT AND A.PSPID = X.PSPID AND X.SEQNO = (SELECT MAX(D.SEQNO)  FROM SAPHEE.ZPSTW1307 AS D WHERE X.MANDT = D.MANDT AND X.PSPID = D.PSPID AND X.SUPR_DT = D.SUPR_DT))     	
       AND A.GBN  &lt;&gt;  'B'
	--   AND B.ZZACTSS = '21'
GROUP BY    A.MANDT,  B.ZZACTSS, A.RDATE, A.STATE

)	   AS T

ON A.MANDT =  T.MANDT
AND A.ACTSS = T.ZZACTSS

WHERE A.MANDT =  #G_MANDT# 

GROUP BY A.ACTSS

 UNION ALL
SELECT A.ACTSS , 'A'  AS GBN ,  'D'  AS GBN2 , 
             VALUE(SUM(T.MON1),0) AS MON1 , VALUE(SUM(T.MON2),0) AS MON2 ,     VALUE(SUM(T.MON3),0) AS MON3 ,     VALUE(SUM(T.MON4),0) AS MON4,
 		     VALUE(SUM(T.MON5),0) AS MON5 , VALUE(SUM(T.MON6),0) AS MON6 ,     VALUE(SUM(T.MON7),0) AS MON7 ,     VALUE(SUM(T.MON8),0) AS MON8,
			 VALUE(SUM(T.MON9),0) AS MON9 , VALUE(SUM(T.MON10),0) AS MON10 ,   VALUE(SUM(T.MON11),0) AS MON11 ,   VALUE(SUM(T.MON12),0) AS MON12,
			 VALUE(( SUM(T.MON1) + SUM(T.MON2) + SUM(T.MON3) + SUM(T.MON4) + SUM(T.MON5) + SUM(T.MON6) + SUM(T.MON7) + SUM(T.MON8) + SUM(T.MON9) + SUM(T.MON10) +
			  SUM(T.MON11) + SUM(T.MON12)),0) AS MONT
			 
FROM SAPHEE.ZPST0000 AS A
LEFT OUTER JOIN 
(SELECT A.MANDT,  B.ZZACTSS, 
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '01' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON1 ,         
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '02' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON2 ,         
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '03' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON3 ,         
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '04' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON4 ,         
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '05' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON5,          
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '06' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON6 ,         
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '07' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON7 ,         
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '08' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON8 ,         
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '09' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON9 ,         
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '10' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON10 ,        
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '11' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON11,         
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '12' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS MON12           

       
      FROM SAPHEE.ZPSTW1307 AS A
	    INNER JOIN SAPHEE.ZMASTER01 AS B
	     ON A.MANDT = B.MANDT
		  AND A.PSPID = B.POSID
		  
     WHERE A.MANDT =   #G_MANDT#
       AND SUBSTR(A.RDATE,1,4) =  SUBSTR(#SUPR_DTF#, 1 , 4)
       AND A.SUPR_DT= (SELECT MAX(X.SUPR_DT)  FROM SAPHEE.ZPSTW1307 AS X 
                         WHERE  A.MANDT = X.MANDT AND A.PSPID = X.PSPID AND X.SEQNO = (SELECT MAX(D.SEQNO)  FROM SAPHEE.ZPSTW1307 AS D WHERE X.MANDT = D.MANDT AND X.PSPID = D.PSPID AND X.SUPR_DT = D.SUPR_DT))     	
       AND A.GBN  &lt;&gt;  'B'
	--   AND B.ZZACTSS = '21'
GROUP BY    A.MANDT,  B.ZZACTSS, A.RDATE, A.STATE

)	   AS T

ON A.MANDT =  T.MANDT
AND A.ACTSS = T.ZZACTSS

WHERE A.MANDT =  #G_MANDT# 

GROUP BY A.ACTSS

 UNION ALL
 
SELECT A.ACTSS , 'A'  AS GBN ,  'E'  AS GBN2 , 
         VALUE(CASE WHEN  SUM(T.P1) = 0  THEN 0 ELSE DEC((FLOAT(SUM(T.C1) ) /  FLOAT(SUM(T.P1) )) * 100 ,3)  END , 0)  AS MON1 ,                       
         VALUE(CASE WHEN  SUM(T.P2) = 0  THEN 0 ELSE DEC((FLOAT(SUM(T.C2) ) /  FLOAT(SUM(T.P2) )) * 100 ,3)  END , 0)  AS MON2 ,                       
         VALUE(CASE WHEN  SUM(T.P3) = 0  THEN 0 ELSE DEC((FLOAT(SUM(T.C3) ) /  FLOAT(SUM(T.P3) )) * 100 ,3)  END , 0)  AS MON3 ,                       
         VALUE(CASE WHEN  SUM(T.P4) = 0  THEN 0 ELSE DEC((FLOAT(SUM(T.C4) ) /  FLOAT(SUM(T.P4) )) * 100 ,3)  END , 0)  AS MON4 ,                       
         VALUE(CASE WHEN  SUM(T.P5) = 0  THEN 0 ELSE DEC((FLOAT(SUM(T.C5) ) /  FLOAT(SUM(T.P5) )) * 100 ,3)  END , 0)  AS MON5 ,                       
         VALUE(CASE WHEN  SUM(T.P6) = 0  THEN 0 ELSE DEC((FLOAT(SUM(T.C6) ) /  FLOAT(SUM(T.P6) )) * 100 ,3)  END , 0)  AS MON6 ,                       
         VALUE(CASE WHEN  SUM(T.P7) = 0  THEN 0 ELSE DEC((FLOAT(SUM(T.C7) ) /  FLOAT(SUM(T.P7) )) * 100 ,3)  END , 0)  AS MON7 ,                       
         VALUE(CASE WHEN  SUM(T.P8) = 0  THEN 0 ELSE DEC((FLOAT(SUM(T.C8) ) /  FLOAT(SUM(T.P8) )) * 100 ,3)  END , 0)  AS MON8 ,                       
         VALUE(CASE WHEN  SUM(T.P9) = 0  THEN 0 ELSE DEC((FLOAT(SUM(T.C9) ) /  FLOAT(SUM(T.P9) )) * 100 ,3)  END , 0)  AS MON9 ,                       
         VALUE(CASE WHEN  SUM(T.P10) = 0 THEN 0 ELSE DEC((FLOAT(SUM(T.C10)) /  FLOAT(SUM(T.P10))) * 100 ,3)  END , 0)  AS MON10 ,                      
         VALUE(CASE WHEN  SUM(T.P11) = 0 THEN 0 ELSE DEC((FLOAT(SUM(T.C11)) /  FLOAT(SUM(T.P11))) * 100 ,3)  END , 0)  AS MON11 ,                      
         VALUE(CASE WHEN  SUM(T.P12) = 0 THEN 0 ELSE DEC((FLOAT(SUM(T.C12)) /  FLOAT(SUM(T.P12))) * 100 ,3)  END , 0)  AS MON12 ,                      
                      
         VALUE(DEC((FLOAT(SUM(T.C1) + SUM(T.C2) + SUM(T.C3) + SUM(T.C4)+ SUM(T.C5)+ SUM(T.C6)+ SUM(T.C7)+ SUM(T.C8)+ SUM(T.C9)+ SUM(T.C10)+ SUM(T.C11)+ SUM(T.C12)) / 
                FLOAT(SUM(T.P1) + SUM(T.P2) + SUM(T.P3) + SUM(T.P4)+ SUM(T.P5)+ SUM(T.P6)+ SUM(T.P7)+ SUM(T.P8)+ SUM(T.P9)+ SUM(T.P10)+ SUM(T.P11)+ SUM(T.P12))) * 100 ,3) , 0)  AS MONT
        

FROM SAPHEE.ZPST0000 AS A
LEFT OUTER JOIN 
(SELECT A.MANDT,  B.ZZACTSS, 
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '01'  THEN 1 ELSE 0 END) AS P1 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '02'  THEN 1 ELSE 0 END) AS P2 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '03'  THEN 1 ELSE 0 END) AS P3 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '04'  THEN 1 ELSE 0 END) AS P4 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '05'  THEN 1 ELSE 0 END) AS P5,              
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '06'  THEN 1 ELSE 0 END) AS P6 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '07'  THEN 1 ELSE 0 END) AS P7 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '08'  THEN 1 ELSE 0 END) AS P8 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '09'  THEN 1 ELSE 0 END) AS P9 ,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '10'  THEN 1 ELSE 0 END) AS P10 ,            
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '11'  THEN 1 ELSE 0 END) AS P11,             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '12'  THEN 1 ELSE 0 END) AS P12,
  			 SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '01' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C1 ,              
			 SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '02' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C2 ,                             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '03' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C3 ,                             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '04' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C4 ,                             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '05' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C5,                              
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '06' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C6 ,                             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '07' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C7 ,                             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '08' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C8 ,                             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '09' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C9 ,                             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '10' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C10 ,                            
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '11' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C11,                             
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '12' AND A.STATE = 'C' THEN 1 ELSE 0 END) AS C12                              
           
      

       
      FROM SAPHEE.ZPSTW1307 AS A
	    INNER JOIN SAPHEE.ZMASTER01 AS B
	     ON A.MANDT = B.MANDT
		  AND A.PSPID = B.POSID
		  
     WHERE A.MANDT =   #G_MANDT#
       AND SUBSTR(A.RDATE,1,4) =  SUBSTR(#SUPR_DTF#, 1 , 4)
       AND A.SUPR_DT= (SELECT MAX(X.SUPR_DT)  FROM SAPHEE.ZPSTW1307 AS X 
                         WHERE  A.MANDT = X.MANDT AND A.PSPID = X.PSPID AND X.SEQNO = (SELECT MAX(D.SEQNO)  FROM SAPHEE.ZPSTW1307 AS D WHERE X.MANDT = D.MANDT AND X.PSPID = D.PSPID AND X.SUPR_DT = D.SUPR_DT))     	
       AND A.GBN  &lt;&gt;  'B'
GROUP BY    A.MANDT,  B.ZZACTSS, A.RDATE, A.STATE

)	   AS T

ON A.MANDT =  T.MANDT
AND A.ACTSS = T.ZZACTSS

WHERE A.MANDT =  #G_MANDT# 

GROUP BY A.ACTSS

 UNION ALL
 
SELECT A.ACTSS , 'A'  AS GBN ,  'F'  AS GBN2 , 
       CASE WHEN F.P1 = 0   OR VALUE(SUM(T.MON1) ,0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON1),0))  / FLOAT(VALUE(F.P1,0))  ) * 100 ,3) END AS MON1 ,                
       CASE WHEN F.P2 = 0   OR VALUE(SUM(T.MON2) ,0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON2),0))  / FLOAT(VALUE(F.P2,0))  ) * 100 ,3) END AS MON2 ,                
       CASE WHEN F.P3 = 0   OR VALUE(SUM(T.MON3) ,0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON3),0))  / FLOAT(VALUE(F.P3,0))  ) * 100 ,3) END AS MON3 ,                
       CASE WHEN F.P4 = 0   OR VALUE(SUM(T.MON4) ,0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON4),0))  / FLOAT(VALUE(F.P4,0))  ) * 100 ,3) END AS MON4 ,                
       CASE WHEN F.P5 = 0   OR VALUE(SUM(T.MON5) ,0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON5),0))  / FLOAT(VALUE(F.P5,0))  ) * 100 ,3) END AS MON5 ,                
       CASE WHEN F.P6 = 0   OR VALUE(SUM(T.MON6) ,0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON6),0))  / FLOAT(VALUE(F.P6,0))  ) * 100 ,3) END AS MON6 ,                
       CASE WHEN F.P7 = 0   OR VALUE(SUM(T.MON7) ,0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON7),0))  / FLOAT(VALUE(F.P7,0))  ) * 100 ,3) END AS MON7 ,                
       CASE WHEN F.P8 = 0   OR VALUE(SUM(T.MON8) ,0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON8),0))  / FLOAT(VALUE(F.P8,0))  ) * 100 ,3) END AS MON8 ,                
       CASE WHEN F.P9 = 0   OR VALUE(SUM(T.MON9) ,0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON9),0))  / FLOAT(VALUE(F.P9,0))  ) * 100 ,3) END AS MON9 ,                
       CASE WHEN F.P10 = 0  OR VALUE(SUM(T.MON10),0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON10),0)) / FLOAT(VALUE(F.P10,0)) ) * 100 ,3) END AS MON10 ,               
       CASE WHEN F.P11 = 0  OR VALUE(SUM(T.MON11),0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON11),0)) / FLOAT(VALUE(F.P11,0)) ) * 100 ,3) END AS MON11 ,               
       CASE WHEN F.P12 = 0  OR VALUE(SUM(T.MON12),0)  = 0 THEN 0 ELSE DEC((FLOAT(VALUE(SUM(T.MON12),0)) / FLOAT(VALUE(F.P12,0)) ) * 100 ,3) END AS MON12 ,               
                


               

       --0 AS MONT
	 --  DEC(((FLOAT(VALUE(( SUM(T.MON1) + SUM(T.MON2) + SUM(T.MON3) + SUM(T.MON4) + SUM(T.MON5) + SUM(T.MON6) + SUM(T.MON7) + SUM(T.MON8) + SUM(T.MON9) + SUM(T.MON10) +
		--  SUM(T.MON11) + SUM(T.MON12)),0)) /  FLOAT(VALUE(( SUM(F.P1) + SUM(F.P2) + SUM(F.P3) + SUM(F.P4) + SUM(F.P5) + SUM(F.P6) + SUM(F.P7) + SUM(F.P8) + SUM(F.P9) + SUM(F.P10) +
			--  SUM(F.P11) + SUM(F.P12)),0)) ) * 100 ),3)  AS MONT
	   DEC(((FLOAT(VALUE(( SUM(T.MON1) + SUM(T.MON2) + SUM(T.MON3) + SUM(T.MON4) + SUM(T.MON5) + SUM(T.MON6) + SUM(T.MON7) + SUM(T.MON8) + SUM(T.MON9) + SUM(T.MON10) +
		  SUM(T.MON11) + SUM(T.MON12)),0)) /  FLOAT(VALUE( F.P1 + F.P2 + F.P3 + F.P4 + F.P5 + F.P6 + F.P7 + F.P8 + F.P9 + F.P10  + F.P11 + F.P12,0)) ) * 100 ),3)  AS MONT
		  		 
FROM SAPHEE.ZPST0000 AS A
LEFT OUTER JOIN 
(SELECT A.MANDT,  B.ZZACTSS, 
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '01'  THEN 1 ELSE 0 END) AS MON1 ,                    
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '02'  THEN 1 ELSE 0 END) AS MON2 ,                    
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '03'  THEN 1 ELSE 0 END) AS MON3 ,                    
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '04'  THEN 1 ELSE 0 END) AS MON4 ,                    
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '05'  THEN 1 ELSE 0 END) AS MON5,                     
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '06'  THEN 1 ELSE 0 END) AS MON6 ,                    
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '07'  THEN 1 ELSE 0 END) AS MON7 ,                    
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '08'  THEN 1 ELSE 0 END) AS MON8 ,                    
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '09'  THEN 1 ELSE 0 END) AS MON9 ,                    
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '10'  THEN 1 ELSE 0 END) AS MON10 ,                   
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '11'  THEN 1 ELSE 0 END) AS MON11,                    
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '12'  THEN 1 ELSE 0 END) AS MON12                     
                                                                                                       


       
      FROM SAPHEE.ZPSTW1307 AS A
	    INNER JOIN SAPHEE.ZMASTER01 AS B
	     ON A.MANDT = B.MANDT
		  AND A.PSPID = B.POSID
		  
     WHERE A.MANDT =   #G_MANDT#
       AND SUBSTR(A.RDATE,1,4) =  SUBSTR(#SUPR_DTF#, 1 , 4)
       AND A.SUPR_DT= (SELECT MAX(X.SUPR_DT)  FROM SAPHEE.ZPSTW1307 AS X 
                        WHERE  A.MANDT = X.MANDT AND A.PSPID = X.PSPID AND X.SEQNO = (SELECT MAX(D.SEQNO)  FROM SAPHEE.ZPSTW1307 AS D WHERE X.MANDT = D.MANDT AND X.PSPID = D.PSPID AND X.SUPR_DT = D.SUPR_DT))     	
       AND A.GBN  &lt;&gt;  'B'

GROUP BY    A.MANDT,  B.ZZACTSS, A.RDATE, A.STATE

)	AS T

ON A.MANDT =  T.MANDT
AND A.ACTSS = T.ZZACTSS

LEFT OUTER JOIN (	
       SELECT A.MANDT, 
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '01'  THEN 1 ELSE 0 END) AS P1 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '02'  THEN 1 ELSE 0 END) AS P2 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '03'  THEN 1 ELSE 0 END) AS P3 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '04'  THEN 1 ELSE 0 END) AS P4 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '05'  THEN 1 ELSE 0 END) AS P5,                   
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '06'  THEN 1 ELSE 0 END) AS P6 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '07'  THEN 1 ELSE 0 END) AS P7 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '08'  THEN 1 ELSE 0 END) AS P8 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '09'  THEN 1 ELSE 0 END) AS P9 ,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '10'  THEN 1 ELSE 0 END) AS P10 ,                 
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '11'  THEN 1 ELSE 0 END) AS P11,                  
             SUM(CASE WHEN SUBSTR(A.RDATE,5,2) = '12'  THEN 1 ELSE 0 END) AS P12                   
       

       
      FROM SAPHEE.ZPSTW1307 AS A  
     WHERE A.MANDT =   #G_MANDT# 
       AND SUBSTR(A.RDATE,1,4) = SUBSTR(#SUPR_DTF#, 1 , 4)
       AND A.SUPR_DT= (SELECT MAX(X.SUPR_DT)  FROM SAPHEE.ZPSTW1307 AS X 
                        WHERE  A.MANDT = X.MANDT AND A.PSPID = X.PSPID AND X.SEQNO = (SELECT MAX(D.SEQNO)  FROM SAPHEE.ZPSTW1307 AS D WHERE X.MANDT = D.MANDT AND X.PSPID = D.PSPID AND X.SUPR_DT = D.SUPR_DT))     	
       AND A.GBN  &lt;&gt; 'B'

GROUP BY    A.MANDT
)  AS F
ON A.MANDT = F.MANDT


WHERE A.MANDT =  #G_MANDT# 

GROUP BY A.ACTSS, F.P1, F.P2, F.P3, F.P4, F.P5, F.P6, F.P7, F.P8, F.P9, F.P10, F.P11, F.P12

)  AS T2
ORDER BY T2.ACTSS, T2.GBN, T2.GBN2 

WITH UR</statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_list">
	</output>
</query>
