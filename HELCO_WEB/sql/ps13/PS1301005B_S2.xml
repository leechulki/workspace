<?xml version="1.0" encoding="euc-kr"?>
<query>
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>
<![CDATA[
SELECT '1' GBN
      ,LIFNR
      ,PERNO
      ,MAX(SIGN1) AS CHASU1
      ,MAX(SIGN2) AS CHASU2
      ,MAX(SIGN3) AS CHASU3
      ,MAX(SIGN4) AS CHASU4
FROM (
    SELECT LIFNR
            ,PERNO
            ,CASE WHEN SEQ='001' THEN SIGN ELSE '' END SIGN1
            ,CASE WHEN SEQ='002' THEN SIGN ELSE '' END SIGN2
            ,CASE WHEN SEQ='003' THEN SIGN ELSE '' END SIGN3
            ,CASE WHEN SEQ='004' THEN SIGN ELSE '' END SIGN4
    FROM SAPHEE.ZPST0143 P
    WHERE MANDT = #G_MANDT#
	AND LIFNR = #LIFNR# 
	AND PERNO = #PERNO#
    AND (SELECT USERCODE FROM SAPHEE.ZUSERF U WHERE U.MANDT = P.MANDT AND U.USERNUMB = P.GID) NOT IN ('0000009902')  -- 설치부 인원 제외 '0000009914',
) T
GROUP BY LIFNR,PERNO

UNION ALL

SELECT '2' GBN
      ,LIFNR
      ,PERNO
      ,CASE WHEN MAX(EDATE1)='00000000' OR MAX(EDATE1)='' THEN '' ELSE SUBSTR(MAX(EDATE1),5,2)||'.'||SUBSTR(MAX(EDATE1),7,2) END AS CHASU1
      ,CASE WHEN MAX(EDATE2)='00000000' OR MAX(EDATE2)='' THEN '' ELSE SUBSTR(MAX(EDATE2),5,2)||'.'||SUBSTR(MAX(EDATE2),7,2) END AS CHASU2
      ,CASE WHEN MAX(EDATE3)='00000000' OR MAX(EDATE3)='' THEN '' ELSE SUBSTR(MAX(EDATE3),5,2)||'.'||SUBSTR(MAX(EDATE3),7,2) END AS CHASU3
      ,CASE WHEN MAX(EDATE4)='00000000' OR MAX(EDATE4)='' THEN '' ELSE SUBSTR(MAX(EDATE4),5,2)||'.'||SUBSTR(MAX(EDATE4),7,2) END AS CHASU4
FROM (
    SELECT LIFNR
            ,PERNO
            ,CASE WHEN SEQ='001' THEN EDATE ELSE '' END EDATE1
            ,CASE WHEN SEQ='002' THEN EDATE ELSE '' END EDATE2
            ,CASE WHEN SEQ='003' THEN EDATE ELSE '' END EDATE3
            ,CASE WHEN SEQ='004' THEN EDATE ELSE '' END EDATE4
    FROM SAPHEE.ZPST0143 P
    WHERE MANDT = #G_MANDT#
	AND LIFNR = #LIFNR# 
	AND PERNO = #PERNO#
    AND (SELECT USERCODE FROM SAPHEE.ZUSERF U WHERE U.MANDT = P.MANDT AND U.USERNUMB = P.GID) NOT IN ('0000009902')   -- 설치부 인원 제외 '0000009914',
) T
GROUP BY LIFNR,PERNO

UNION ALL

SELECT '3' GBN
      ,LIFNR
      ,PERNO
      ,MAX(RANK1) AS CHASU1
      ,MAX(RANK2) AS CHASU2
      ,MAX(RANK3) AS CHASU3
      ,MAX(RANK4) AS CHASU4
FROM (
    SELECT LIFNR
            ,PERNO
            ,CASE WHEN SEQ='001' THEN RANK ELSE '' END RANK1
            ,CASE WHEN SEQ='002' THEN RANK ELSE '' END RANK2
            ,CASE WHEN SEQ='003' THEN RANK ELSE '' END RANK3
            ,CASE WHEN SEQ='004' THEN RANK ELSE '' END RANK4
    FROM SAPHEE.ZPST0143 P
    WHERE MANDT = #G_MANDT#
	AND LIFNR = #LIFNR# 
	AND PERNO = #PERNO#
    AND (SELECT USERCODE FROM SAPHEE.ZUSERF U WHERE U.MANDT = P.MANDT AND U.USERNUMB = P.GID) NOT IN ('0000009902')   -- 설치부 인원 제외 '0000009914',
) T
GROUP BY LIFNR,PERNO

UNION ALL

SELECT '4' GBN
      ,LIFNR
      ,PERNO
      ,MAX(GNM1) AS CHASU1
      ,MAX(GNM2) AS CHASU2
      ,MAX(GNM3) AS CHASU3
      ,MAX(GNM4) AS CHASU4
FROM (
    SELECT LIFNR
            ,PERNO
            ,CASE WHEN SEQ='001' THEN GNM ELSE '' END GNM1
            ,CASE WHEN SEQ='002' THEN GNM ELSE '' END GNM2
            ,CASE WHEN SEQ='003' THEN GNM ELSE '' END GNM3
            ,CASE WHEN SEQ='004' THEN GNM ELSE '' END GNM4
    FROM SAPHEE.ZPST0143 P
    WHERE MANDT = #G_MANDT#
	AND LIFNR = #LIFNR# 
	AND PERNO = #PERNO#
    AND (SELECT USERCODE FROM SAPHEE.ZUSERF U WHERE U.MANDT = P.MANDT AND U.USERNUMB = P.GID) NOT IN ('0000009902') -- 설치부 인원 제외 '0000009914',
) T
GROUP BY LIFNR,PERNO
ORDER BY GBN

FOR FETCH ONLY WITH UR	]]></statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_gyul">
	</output>
</query>
