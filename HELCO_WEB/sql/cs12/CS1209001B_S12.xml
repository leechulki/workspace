<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>
------------
-- 미발주 --
------------
SELECT A.PJT PJT
      ,A.HNO HNO
      ,G.ZSITE_NM SPT
      ,G.KUNNR_NM NAM
      ,'' UPN
      ,'' SLA
      ,F.ABG ABG
      ,CASE WHEN H.ZSPEC12 = '' THEN H.ZSPEC1 ELSE H.ZSPEC12 END TYP
      ,H.ZSPEC7 ZSPEC7
      ,Z.CTEXT2 BLD_NM
      ,INT(H.ZSPEC9) HCNT
      ,DEC(CASE H.ZSPEC3 WHEN '' THEN '0' ELSE H.ZSPEC3 END) ZSPEC3
      ,H.ZSPEC2 SPC
      ,CASE WHEN A.ISD = '' THEN 'Y'
            ELSE (
                  CASE WHEN DAYS(DATE(SUBSTR(#DAT#,1,4)||'-'||SUBSTR(#DAT#,5,2)||'-'||SUBSTR(#DAT#,7,2)))
                            -
                            DAYS(DATE(SUBSTR(VALUE(A.ISD,'19000101'),1,4)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),5,2)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),7,2))) &lt;= 1278 THEN 'Y'
                       ELSE 'N'
                  END
                 )
       END HJA
      ,A.ARA ARA
      ,VALUE(SAPHEE.CODE_CONV(F.MANDT,'CS115',F.ARA),'') ARA_NM
      ,A.TEM TEM
      ,VALUE(SAPHEE.CODE_CONV(F.MANDT,'VKGRP',A.TEM),'') TEM_NM
      ,F.BPM BPM
      ,VALUE(SAPHEE.GET_BOSU_INWON(F.MANDT,F.BPM),'') BPM_NM
      ,F.BSU BSU
      ,VALUE(SAPHEE.GET_VENDER_NAME(F.MANDT,F.BSU),'') BSU_NM
      ,F.JUJ JUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(F.MANDT,F.JUJ),'') JUJ_NM
      ,F.BUJ BUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(F.MANDT,F.BUJ),'') BUJ_NM       
      ,A.WDT DAT01
      ,CASE WHEN A.WNO='' THEN ' ' ELSE SAPHEE.CODE_CONV(F.MANDT,'PS004',A.WNO) END STR01
      ,CASE WHEN A.SCT    > '00000000' THEN A.SCT    ELSE ' ' END  DAT02
      ,CASE WHEN A.RCD    > '00000000' THEN A.RCD    ELSE ' ' END  DAT03
      ,CASE WHEN A.IGD    > '00000000' THEN A.IGD    ELSE ' ' END  IGD
      ,CASE WHEN A.ISD    > '00000000' THEN A.ISD    ELSE ' ' END  ISD
      ,CASE WHEN A.IJY    > '00000000' THEN A.IJY    ELSE ' ' END  IJY
      ,CASE WHEN H.ZOIPSU > '00000000' THEN H.ZOIPSU ELSE ' ' END  IPS
      ,H.ZMUSAOCNT  MGM
      ,A.BGT_A      BGT_A
      ,A.BMT_A      BHD_A
      ,A.GNO_A      BGN_A
      ,H.ZMUSAOCNT2 MIM
      ,''           BGT_B
      ,''           BHD_B
      ,''           BGN_B
      ,A.USD_C      USD_C
      ,A.UHJ_C      UHJ_C
      ,A.GNO_C      UGN_C
      ,''           USD_D
      ,''           UHJ_D
      ,''           UGN_D
      ,''           JHD   
      ,''           JJD
      ,''           UDT
      ,''           JGD
      ,''           HST          
      ,''           HST_NM1
      ,''           STS1
      ,'무상미개시' HST_NM2
      ,0 AS AMT
      ,'' P1B
      ,G.ADDR1 ||' '|| G.ADDR2 P1C
      ,''           TEA
      ,''           KUNNR
      ,''           SNAM
   FROM (
         SELECT A.PJT, A.HNO, A.ARA, A.BSU, A.BGT, A.USD, A.PJTM, A.PJTU, A.WDT, A.WNO, A.SCT, A.RCD, A.IGD, A.ISD, A.IJY,
                A.BGT_A, A.BMT_A, A.GNO_A, A.USD_C, A.UHJ_C, A.GNO_C ,A.TEM
         FROM (
               SELECT
                      B.CS101_PJT PJT,
                      B.CS101_HNO HNO,
                      MAX(B.CS101_ARA) ARA,
                      MAX(ZWBT.VKGRP)  TEM,
                      MAX(B.CS101_BSU) BSU,
                      MIN(B.CS101_WDT) WDT,
                      MIN(B.CS101_WNO) WNO,
                      MIN(B.CS101_SCT) SCT,
                      MIN(B.CS101_RCD) RCD,
                      MIN(B.CS101_IGD) IGD,
                      MIN(B.CS101_ISD) ISD,
                      MIN(B.CS101_IJY) IJY,
                      MIN(VALUE(A.CS116_BGT,'')) BGT,
                      MIN(VALUE(C.CS126_USD,'')) USD,
                      MIN(VALUE(D.CS116_PJT,'')) PJTM,
                      MIN(VALUE(E.CS126_PJT,'')) PJTU,
                      MIN(VALUE(F.CS116_BGT,'')) BGT_A,
                      MAX(VALUE(F.CS116_BMT,'')) BMT_A,
                      MAX(VALUE(F.CS116_GNO,'')) GNO_A,
                      MIN(VALUE(G.CS126_USD,'')) USD_C,
                      MAX(VALUE(G.CS126_UHJ,'')) UHJ_C,
                      MAX(VALUE(G.CS126_GNO,'')) GNO_C
                 FROM SAPHEE.ZCST101 B
                      LEFT OUTER JOIN SAPHEE.ZCST116 A ON  A.MANDT = B.MANDT
                                                      AND A.CS116_PJT = B.CS101_PJT
                                                      AND A.CS116_HNO = B.CS101_HNO
                                                      AND A.CS116_PST = 'A6'
                                                      AND A.CS116_GND = 'B'
                                                      AND A.CS116_BST &lt;= #DAT#
                      LEFT OUTER JOIN SAPHEE.ZCST126 C ON  C.MANDT = B.MANDT
                                                      AND C.CS126_PJT = B.CS101_PJT
                                                      AND C.CS126_HNO = B.CS101_HNO
                                                      AND C.CS126_PST = 'A6'
                                                      AND C.CS126_DDT = ''
                                                      AND C.CS126_GND = 'D'
                                                      AND C.CS126_ADT &lt;= #DAT#
                      LEFT OUTER JOIN SAPHEE.ZCST116 D ON  D.MANDT = B.MANDT
                                                      AND D.CS116_PJT = B.CS101_PJT
                                                      AND D.CS116_HNO = B.CS101_HNO
                                                      AND D.CS116_PST = 'A6'
                                                      AND D.CS116_GND = 'A'
                                                      AND D.CS116_BST &lt;= #DAT#
                                                      AND D.CS116_BGT &lt;= #DAT#
                                                      AND D.CS116_BMT &gt;= SUBSTR(#DAT#,1,6)||'01'
                      LEFT OUTER JOIN SAPHEE.ZCST126 E ON  E.MANDT = B.MANDT
                                                      AND E.CS126_PJT = B.CS101_PJT
                                                      AND E.CS126_HNO = B.CS101_HNO
                                                      AND E.CS126_PST = 'A6'
                                                      AND E.CS126_DDT = ''
                                                      AND E.CS126_GND = 'C'
                                                      AND E.CS126_ADT &lt;= #DAT#
                                                      AND E.CS126_USD &lt;= #DAT#
                                                      AND E.CS126_UHJ &gt;= SUBSTR(#DAT#,1,6)||'01'
                      LEFT OUTER JOIN SAPHEE.ZCST116 F ON  F.MANDT = B.MANDT
                                                      AND F.CS116_PJT = B.CS101_PJT
                                                      AND F.CS116_HNO = B.CS101_HNO
                                                      AND F.CS116_PST = 'A6'
                                                      AND F.CS116_GND = 'A'
                                                      AND F.CS116_BST &lt;= #DAT#
                      LEFT OUTER JOIN SAPHEE.ZCST126 G ON  G.MANDT = B.MANDT
                                                      AND G.CS126_PJT = B.CS101_PJT
                                                      AND G.CS126_HNO = B.CS101_HNO
                                                      AND G.CS126_PST = 'A6'
                                                      AND G.CS126_DDT = ''
                                                      AND G.CS126_GND = 'C'
                                                      AND G.CS126_ADT &lt;= #DAT#
                      LEFT OUTER JOIN SAPHEE.ZWBT010 ZWBT
                                                       ON ZWBT.MANDT = B.MANDT
                                                      AND ZWBT.LGORT = CASE WHEN B.CS101_BSU = '' THEN 'E53' ELSE B.CS101_BSU END                                
                WHERE B.MANDT = #G_MANDT#
                  AND B.CS101_IGD BETWEEN '00000001' AND #DAT#
                  AND SUBSTR(B.CS101_HNO,1,1) = 'J'
                  AND B.CS101_PST = 'A6'
                  AND B.CS101_ARA > ''
                  AND B.CS101_BSU > ''
                  AND B.CS101_PJT NOT LIKE 'M%'
                  AND B.CS101_FDT &lt;= #DAT#
<isNotNull col="PJT">
                  AND B.CS101_PJT = #PJT#
</isNotNull>
<isNotNull col="ARA">
                  AND B.CS101_ARA = #ARA#
</isNotNull>
<isNotNull col="BSU">
                  AND B.CS101_BSU = #BSU#
</isNotNull>
<isNotNull col="BPM">
                  AND B.CS101_BPM = #BPM#
</isNotNull>
<isNotNull col="TEM">
                  AND ZWBT.VKGRP = #TEM#
</isNotNull> 
                GROUP BY B.CS101_PJT, B.CS101_HNO
              ) A
         ) A
              LEFT OUTER JOIN (
                               SELECT
                                      CS144_PJT PJT,
                                      CS144_HNO HNO,
                                      MAX(CS143_FSD) JHD
                                 FROM SAPHEE.ZCST144 A, SAPHEE.ZCST143 B
                                WHERE A.MANDT     = B.MANDT
                                  AND A.CS144_SEQ = B.CS143_SEQ
                                  AND A.MANDT     = #G_MANDT#
                                  AND A.CS144_PST = 'A6'
                                  AND B.CS143_FSD &lt;= #DAT#
                                  AND B.CS143_FSD &lt;= #DAT#
                                GROUP BY CS144_PJT, CS144_HNO
                              ) B ON A.PJT = B.PJT
                                 AND A.HNO = B.HNO
              LEFT OUTER JOIN (
                               SELECT CS172_PJO PJO, CS172_HNO HNO, MAX(CS172_MDT) MDT
                                 FROM SAPHEE.ZCST172
                                WHERE MANDT     = #G_MANDT#
                                GROUP BY CS172_PJO, CS172_HNO
                              ) D ON A.PJT = D.PJO
                                 AND A.HNO = D.HNO,
             SAPHEE.ZCST111 F INNER JOIN SAPHEE.ZMASTER01 G
                                      ON F.MANDT = G.MANDT
                                     AND F.PJT = G.POSID
                              INNER JOIN SAPHEE.ZMASTER02 H
                                      ON F.MANDT = H.MANDT
                                     AND F.PJT = H.POSID
                                     AND F.PJT||F.HNO = H.POSID_1
                              LEFT OUTER JOIN SAPHEE.ZLCODE AS Z ON F.MANDT = Z.MANDT
                                                        AND F.BLD = Z.CODE2
                                                        AND Z.LANG = 'ko'
                                                        AND Z.CODE1 = 'CS123'         
 WHERE A.PJT = F.PJT
   AND A.HNO = F.HNO
   AND F.MANDT = #G_MANDT#
   AND (F.HST &lt;&gt; 'D' OR (F.HST = 'D' AND VALUE(D.PJO,'') > ''))
   AND (SUBSTR(VALUE(A.BGT,''),1,6) > SUBSTR(#DAT#,1,6) OR VALUE(A.BGT,'') = '')
   AND (VALUE(A.USD,'') > #DAT# OR VALUE(A.USD,'') = '')
   AND (VALUE(B.JHD,'') > #DAT# OR VALUE(B.JHD,'') = '')
   AND (VALUE(D.MDT,'') > #DAT# OR VALUE(D.MDT,'') = '')
   AND A.PJTM = ''
   AND A.PJTU = ''
   AND A.ARA > ''

 UNION ALL

SELECT F.CS101_PJT PJT
      ,F.CS101_HNO HNO
      ,G.ZSITE_NM SPT
      ,G.KUNNR_NM NAM
      ,'' UPN
      ,'' SLA
      ,I.ABG ABG
      ,CASE WHEN H.ZSPEC12 = '' THEN H.ZSPEC1 ELSE H.ZSPEC12 END TYP
      ,H.ZSPEC7 ZSPEC7
      ,Z.CTEXT2 BLD_NM
      ,INT(H.ZSPEC9) HCNT
      ,DEC(CASE H.ZSPEC3 WHEN '' THEN '0' ELSE H.ZSPEC3 END) ZSPEC3
      ,H.ZSPEC2 SPC
      ,'Y' HJA
      ,F.CS101_ARA ARA
      ,VALUE(SAPHEE.CODE_CONV(F.MANDT,'CS115',F.CS101_ARA),'') ARA_NM
      ,ZWBT.VKGRP TEM
      ,VALUE(SAPHEE.CODE_CONV(F.MANDT,'VKGRP',ZWBT.VKGRP),'') TEM_NM
      ,F.CS101_BPM BPM
      ,VALUE(SAPHEE.GET_BOSU_INWON(F.MANDT,F.CS101_BPM),'') BPM_NM
      ,F.CS101_BSU BSU
      ,VALUE(SAPHEE.GET_VENDER_NAME(F.MANDT,F.CS101_BSU),'') BSU_NM
      ,'' JUJ                                                                       
      ,'' JUJ_NM
      ,'' BUJ                                                                       
      ,'' BUJ_NM       
      ,F.CS101_WDT DAT01
      ,CASE WHEN F.CS101_WNO='' THEN ' ' ELSE SAPHEE.CODE_CONV(F.MANDT,'PS004',F.CS101_WNO) END STR01
      ,CASE WHEN F.CS101_SCT    > '00000000' THEN F.CS101_SCT    ELSE ' ' END  DAT02
      ,CASE WHEN F.CS101_RCD    > '00000000' THEN F.CS101_RCD    ELSE ' ' END  DAT03
      ,CASE WHEN F.CS101_IGD    > '00000000' THEN F.CS101_IGD    ELSE ' ' END  IGD
      ,CASE WHEN F.CS101_ISD    > '00000000' THEN F.CS101_ISD    ELSE ' ' END  ISD
      ,CASE WHEN F.CS101_IJY    > '00000000' THEN F.CS101_IJY    ELSE ' ' END  IJY
      ,CASE WHEN H.ZOIPSU > '00000000' THEN H.ZOIPSU ELSE ' ' END  IPS
      ,H.ZMUSAOCNT  MGM
      ,''           BGT_A
      ,''           BHD_A
      ,''           BGN_A
      ,H.ZMUSAOCNT2 MIM
      ,''           BGT_B
      ,''           BHD_B
      ,''           BGN_B
      ,''           USD_C
      ,''           UHJ_C
      ,''           UGN_C
      ,''           USD_D
      ,''           UHJ_D
      ,''           UGN_D
      ,''           JHD   
      ,''           JJD
      ,''           UDT
      ,''           JGD
      ,'' HST          
      ,''           HST_NM1
      ,'' STS1
      ,'무상미개시' HST_NM2
      ,0 AS AMT
      ,'' P1B
      ,G.ADDR1 ||' '|| G.ADDR2 P1C
      ,''           TEA
      ,''           KUNNR
      ,''           SNAM
  FROM SAPHEE.ZCST101 F INNER JOIN SAPHEE.ZMASTER01 G
                                ON F.MANDT = G.MANDT
                               AND F.CS101_PJT = G.POSID
                        INNER JOIN SAPHEE.ZMASTER02 H
                                ON F.MANDT = H.MANDT
                               AND F.CS101_PJT = H.POSID
                               AND F.CS101_PJT||F.CS101_HNO = H.POSID_1
                        LEFT OUTER JOIN SAPHEE.ZCST111 I
                                 ON F.MANDT = I.MANDT
                                AND F.CS101_PJT = I.PJT
                                AND F.CS101_HNO = I.HNO
                        LEFT OUTER JOIN SAPHEE.ZLCODE AS Z ON I.MANDT = Z.MANDT
                                                        AND I.BLD = Z.CODE2
                                                        AND Z.LANG = 'ko'
                                                        AND Z.CODE1 = 'CS123' 
                        LEFT OUTER JOIN SAPHEE.ZWBT010 ZWBT
                                ON ZWBT.MANDT = F.MANDT
                               AND ZWBT.LGORT = CASE WHEN F.CS101_BSU = '' THEN 'E53' ELSE F.CS101_BSU END                                          
 WHERE F.MANDT = #G_MANDT#
   AND SUBSTR(F.CS101_HNO,1,1) = 'J'
   AND F.CS101_PST = 'A1'
   AND F.CS101_ARA > ''
   AND F.CS101_IGD BETWEEN '00000001' AND #DAT#
   AND F.CS101_PJT NOT LIKE 'M%'
   AND F.MDATE &lt;= #DAT#
<isNotNull col="PJT">
   AND F.CS101_PJT = #PJT#
</isNotNull>
<isNotNull col="ARA">
   AND F.CS101_ARA = #ARA#
</isNotNull>
<isNotNull col="BSU">
   AND F.CS101_BSU = #BSU#
</isNotNull>
<isNotNull col="BPM">
   AND F.CS101_BPM = #BPM#
</isNotNull>
<isNotNull col="TEM">
   AND ZWBT.VKGRP = #TEM#
</isNotNull> 

  
UNION ALL  
------------
--무상공사--
------------
SELECT A.PJT PJT                                                                                
      ,A.HNO HNO
      ,A.ZSITE_NM SPT
      ,A.KUNNR_NM NAM
      ,'' UPN
      ,'' SLA
      ,A.ABG ABG
      ,CASE WHEN A.ZSPEC12 = '' THEN A.ZSPEC1 ELSE A.ZSPEC12 END TYP
      ,A.ZSPEC7 ZSPEC7
      ,A.BLD_NM BLD_NM
      ,INT(A.ZSPEC9) HCNT
      ,DEC(CASE A.ZSPEC3 WHEN '' THEN '0' ELSE A.ZSPEC3 END) ZSPEC3
      ,A.ZSPEC2 SPC
      ,CASE WHEN A.ISD = '' THEN 'Y'
            ELSE (
                  CASE WHEN DAYS(DATE(SUBSTR(#DAT#,1,4)||'-'||SUBSTR(#DAT#,5,2)||'-'||SUBSTR(#DAT#,7,2)))
                            -
                            DAYS(DATE(SUBSTR(VALUE(A.ISD,'19000101'),1,4)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),5,2)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),7,2))) &lt;= 1278 THEN 'Y'
                       ELSE 'N'
                  END
                 )
       END HJA
      ,A.ARA ARA
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'CS115',A.ARA),'') ARA_NM
      ,A.TEM TEM
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'VKGRP',A.TEM),'') TEM_NM
      ,A.BPM BPM
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BPM),'') BPM_NM
      ,A.BSU BSU
      ,VALUE(SAPHEE.GET_VENDER_NAME(A.MANDT,A.BSU),'') BSU_NM
      ,A.JUJ JUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.JUJ),'') JUJ_NM
      ,A.BUJ BUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BUJ),'') BUJ_NM       
      ,A.WDT DAT01
      ,CASE WHEN A.WNO='' THEN ' ' ELSE SAPHEE.CODE_CONV(A.MANDT,'PS004',A.WNO) END STR01
      ,CASE WHEN A.SCT    > '00000000' THEN A.SCT    ELSE ' ' END  DAT02
      ,CASE WHEN A.RCD    > '00000000' THEN A.RCD    ELSE ' ' END  DAT03
      ,CASE WHEN A.IGD    > '00000000' THEN A.IGD    ELSE ' ' END  IGD
      ,CASE WHEN A.ISD    > '00000000' THEN A.ISD    ELSE ' ' END  ISD
      ,CASE WHEN A.IJY    > '00000000' THEN A.IJY    ELSE ' ' END  IJY
      ,CASE WHEN A.ZOIPSU > '00000000' THEN A.ZOIPSU ELSE ' ' END  IPS
      ,A.ZMUSAOCNT  MGM
      ,A.BGT        BGT_A
      ,A.BMT        BHD_A
      ,A.GNO        BGN_A
      ,A.ZMUSAOCNT2 MIM
      ,''           BGT_B
      ,''           BHD_B
      ,''           BGN_B
      ,''           USD_C
      ,''           UHJ_C
      ,''           UGN_C
      ,''           USD_D
      ,''           UHJ_D
      ,''           UGN_D
      ,''           JHD   
      ,''           JJD
      ,''           UDT
      ,''           JGD
      ,''           HST          
      ,''           HST_NM1
      ,''           STS1
      ,'무상공사'   HST_NM2
      ,0 AS AMT
      ,'' P1B
      ,A.P1C P1C
      ,''           TEA
      ,''           KUNNR
      ,''           SNAM
  FROM (
        SELECT A.MANDT, A.PJT, A.HNO, A.ARA, A.BSU, A.WDT, A.WNO, A.SCT, A.RCD, A.IGD, A.ISD, A.IJY, Z.BGT, Z.BMT, Z.GNO, G.ADDR1||' '||G.ADDR2 P1C,
               G.ZSITE_NM, G.KUNNR_NM, H.ZSPEC1, H.ZSPEC2, H.ZSPEC3, H.ZSPEC7, H.ZSPEC9, H.ZSPEC12, F.ABG, F.BPM, F.JUJ, F.BUJ, H.ZOIPSU, H.ZMUSAOCNT, H.ZMUSAOCNT2, H.ZZGUBUN,
               Z.CTEXT2 BLD_NM ,A.TEM
          FROM
              (
               SELECT MAX(B.MANDT) MANDT,
                      B.CS101_PJT PJT, B.CS101_HNO HNO,
                      MAX(B.CS101_ARA) ARA,
                      MAX(ZWBT.VKGRP)  TEM,
                      MAX(B.CS101_BSU) BSU,
                      MIN(B.CS101_WDT) WDT,
                      MIN(B.CS101_WNO) WNO,
                      MIN(B.CS101_SCT) SCT,
                      MIN(B.CS101_RCD) RCD,
                      MIN(B.CS101_IGD) IGD,
                      MIN(B.CS101_ISD) ISD,
                      MIN(B.CS101_IJY) IJY,
                      MIN(VALUE(A.CS116_BGT,'')) BGT,
                      MAX(VALUE(A.CS116_BMT,'')) BMT,
                      MIN(VALUE(C.CS126_USD,'')) USD,
                      MAX(VALUE(A.CS116_GNO,'')) GNO
                 FROM SAPHEE.ZCST101 B LEFT OUTER JOIN SAPHEE.ZCST116 A
               	                                    ON A.MANDT = B.MANDT
                                                   AND A.CS116_PJT = B.CS101_PJT
                                                   AND A.CS116_HNO = B.CS101_HNO
                                                   AND A.CS116_PST = 'A6'
                                                   AND A.CS116_GND = 'B'
                                                   AND A.CS116_BST &lt;= #DAT#
                                       LEFT OUTER JOIN SAPHEE.ZCST126 C
               	                                    ON C.MANDT = B.MANDT
                                                   AND C.CS126_PJT = B.CS101_PJT
                                                   AND C.CS126_HNO = B.CS101_HNO
                                                   AND C.CS126_PST = 'A6'
                                                   AND C.CS126_DDT = ''
                                                   AND C.CS126_GND = 'D'
                                                   AND C.CS126_ADT &lt;= #DAT#
                                       LEFT OUTER JOIN SAPHEE.ZWBT010 ZWBT
                                                    ON ZWBT.MANDT = B.MANDT
                                                   AND ZWBT.LGORT = B.CS101_BSU            
                WHERE B.MANDT = #G_MANDT#
                  AND B.CS101_IGD &lt;= #DAT#
                  AND SUBSTR(B.CS101_HNO,1,1) = 'J'
                  AND B.CS101_PST = 'A6'
                  AND B.CS101_ARA > ''
                  AND B.CS101_BSU > ''
                  AND B.MDATE &lt;= #DAT#
<isNotNull col="PJT">
                  AND B.CS101_PJT = #PJT#
</isNotNull>
<isNotNull col="ARA">
                  AND B.CS101_ARA = #ARA#
</isNotNull>
<isNotNull col="BSU">
                  AND B.CS101_BSU = #BSU#
</isNotNull>
<isNotNull col="BPM">
                  AND B.CS101_BPM = #BPM#
</isNotNull>
<isNotNull col="TEM">
                  AND ZWBT.VKGRP = #TEM#
</isNotNull>                              
                GROUP BY B.CS101_PJT, B.CS101_HNO
              ) A LEFT OUTER JOIN
                                  (
                                   SELECT CS144_PJT PJT, CS144_HNO HNO, MAX(CS143_FSD) JHD
                                     FROM SAPHEE.ZCST144 A, SAPHEE.ZCST143 B
                                    WHERE A.MANDT = B.MANDT
                                      AND A.CS144_SEQ = B.CS143_SEQ
                                      AND A.MANDT = #G_MANDT#
                                      AND A.CS144_PST = 'A6'
                                      AND B.CS143_FSD &lt;= #DAT#
                                    GROUP BY CS144_PJT, CS144_HNO
                                  ) B ON A.PJT = B.PJT
                                     AND A.HNO = B.HNO
                  LEFT OUTER JOIN (
                                   SELECT CS172_PJO PJO, CS172_HNO HNO, MAX(CS172_MDT) MDT
                                     FROM SAPHEE.ZCST172
                                    WHERE MANDT = #G_MANDT#
                                    GROUP BY CS172_PJO, CS172_HNO
                                  ) D ON A.PJT = D.PJO
                                     AND A.HNO = D.HNO,
              SAPHEE.ZCST111 F
              INNER JOIN SAPHEE.ZMASTER01 G
                                ON F.MANDT = G.MANDT
                               AND F.PJT = G.POSID
                        INNER JOIN SAPHEE.ZMASTER02 H
                                ON F.MANDT = H.MANDT
                               AND F.PJT = H.POSID
                               AND F.PJT||F.HNO = H.POSID_1
              INNER JOIN (
                          SELECT
                                 CS116_PJT PJT,
                                 CS116_HNO HNO,
                                 MIN(CS116_BGT) BGT,
                                 MAX(CS116_BMT) BMT,
								 MAX(CS116_GNO) GNO
                            FROM SAPHEE.ZCST116
                           WHERE MANDT = #G_MANDT#
                             AND SUBSTR(CS116_HNO,1,1) = 'J'
                             AND CS116_PST = 'A6'
                             AND CS116_GND = 'A'
                             AND CS116_BST &lt;= #DAT#
                           GROUP BY CS116_PJT, CS116_HNO
                         ) AS Z  ON F.PJT = Z.PJT
                                AND F.HNO = Z.HNO
               LEFT OUTER JOIN SAPHEE.ZLCODE AS Z ON F.MANDT = Z.MANDT
                                                        AND F.BLD = Z.CODE2
                                                        AND Z.LANG = 'ko'
                                                        AND Z.CODE1 = 'CS123'                   
         WHERE A.PJT = F.PJT
           AND A.HNO = F.HNO
           AND F.MANDT = #G_MANDT#
           AND (F.HST &lt;&gt; 'D' OR (F.HST = 'D' AND VALUE(D.PJO,'') > ''))
           AND (SUBSTR(VALUE(A.BGT,''),1,6) > SUBSTR(#DAT#,1,6) OR VALUE(A.BGT,'') = '')
           AND (VALUE(A.USD,'') > #DAT# OR VALUE(A.USD,'') = '')
           AND (VALUE(B.JHD,'') > #DAT# OR VALUE(B.JHD,'') = '')
           AND (VALUE(D.MDT,'') > #DAT# OR VALUE(D.MDT,'') = '')
           AND Z.BGT &lt;= #DAT#
           AND Z.BMT &gt;= SUBSTR(#DAT#,1,6)||'01'
       ) A

  
UNION ALL  
--------------
-- 유상공사 --
--------------
SELECT A.PJT PJT
      ,A.HNO HNO
      ,A.ZSITE_NM SPT
      ,A.KUNNR_NM NAM
      ,A.UPN UPN
      ,A.SLA SLA
      ,A.ABG ABG
      ,CASE WHEN A.ZSPEC12 = '' THEN A.ZSPEC1 ELSE A.ZSPEC12 END TYP
      ,A.ZSPEC7 ZSPEC7
      ,A.BLD_NM BLD_NM
      ,INT(A.ZSPEC9) HCNT
      ,DEC(CASE A.ZSPEC3 WHEN '' THEN '0' ELSE A.ZSPEC3 END) ZSPEC3
      ,A.ZSPEC2 SPC
      ,CASE WHEN A.ISD = '' THEN 'Y'
            ELSE (
                  CASE WHEN DAYS(DATE(SUBSTR(#DAT#,1,4)||'-'||SUBSTR(#DAT#,5,2)||'-'||SUBSTR(#DAT#,7,2)))
                            -
                            DAYS(DATE(SUBSTR(VALUE(A.ISD,'19000101'),1,4)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),5,2)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),7,2))) &lt;= 1278 THEN 'Y'
                       ELSE 'N'
                  END
                 )
       END HJA
      ,A.ARA ARA
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'CS115',A.ARA),'') ARA_NM
      ,A.TEM TEM
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'VKGRP',A.TEM),'') TEM_NM
      ,A.BPM BPM
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BPM),'') BPM_NM
      ,A.BSU BSU
      ,VALUE(SAPHEE.GET_VENDER_NAME(A.MANDT,A.BSU),'') BSU_NM
      ,A.JUJ JUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.JUJ),'') JUJ_NM
      ,A.BUJ BUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BUJ),'') BUJ_NM       
      ,A.WDT DAT01
      ,CASE WHEN A.WNO='' THEN ' ' ELSE SAPHEE.CODE_CONV(A.MANDT,'PS004',A.WNO) END STR01
      ,CASE WHEN A.SCT    > '00000000' THEN A.SCT    ELSE ' ' END  DAT02
      ,CASE WHEN A.RCD    > '00000000' THEN A.RCD    ELSE ' ' END  DAT03
      ,CASE WHEN A.IGD    > '00000000' THEN A.IGD    ELSE ' ' END  IGD
      ,CASE WHEN A.ISD    > '00000000' THEN A.ISD    ELSE ' ' END  ISD
      ,CASE WHEN A.IJY    > '00000000' THEN A.IJY    ELSE ' ' END  IJY
      ,CASE WHEN A.ZOIPSU > '00000000' THEN A.ZOIPSU ELSE ' ' END  IPS
      ,A.ZMUSAOCNT  MGM
      ,A.BGT_A      BGT_A
      ,A.BMT_A      BHD_A
      ,A.GNO_A      BGN_A
      ,A.ZMUSAOCNT2 MIM
      ,A.BGT_B      BGT_B
      ,A.BMT_B      BHD_B
      ,A.GNO_B      BGN_B
      ,A.USD        USD_C
      ,A.UHJ        UHJ_C
      ,A.GNO        UGN_C
      ,''           USD_D
      ,''           UHJ_D
      ,''           UGN_D
      ,''           JHD   
      ,''           JJD
      ,''           UDT
      ,''           JGD
      ,''           HST          
      ,''           HST_NM1
      ,''           STS1
      ,'유상공사'   HST_NM2
      ,A.AMT AS AMT
      ,A.P1B P1B
      ,A.P1C P1C
      ,A.TEA        TEA
      ,''           KUNNR
      ,''           SNAM
  FROM (
        SELECT A.MANDT, Z.UPN, Z.SLA, Z.USD, Z.UHJ, Z.GNO, Z.AMT,
               A.PJT, A.HNO, A.ARA, A.BSU, A.WDT, A.WNO, A.SCT, A.RCD, A.IGD, A.ISD, A.IJY,
               A.BGT_A, A.BMT_A, A.GNO_A, A.BGT_B, A.BMT_B, A.GNO_B,
               G.ZSITE_NM, G.KUNNR_NM, H.ZSPEC1, H.ZSPEC2, H.ZSPEC3, H.ZSPEC7, H.ZSPEC9, H.ZSPEC12, F.ABG, F.BPM, F.JUJ, F.BUJ, H.ZOIPSU, H.ZMUSAOCNT, H.ZMUSAOCNT2,
               I.CS121_P1B ||' '|| I.CS121_P2B P1B, I.CS121_P1C ||' '|| I.CS121_P2C P1C, H.ZZGUBUN,
               Z.CTEXT2 BLD_NM, I.CS121_TEA TEA ,A.TEM
          FROM
              (
               SELECT MAX(B.MANDT) MANDT,
                      B.CS101_PJT PJT, B.CS101_HNO HNO,
                      MAX(B.CS101_ARA) ARA,
                      MAX(ZWBT.VKGRP)  TEM,
                      MAX(B.CS101_BSU) BSU,
                      MIN(B.CS101_WDT) WDT,
                      MIN(B.CS101_WNO) WNO,
                      MIN(B.CS101_SCT) SCT,
                      MIN(B.CS101_RCD) RCD,
                      MIN(B.CS101_IGD) IGD,
                      MIN(B.CS101_ISD) ISD,
                      MIN(B.CS101_IJY) IJY,
                      MIN(VALUE(Y.CS116_BGT,'')) BGT_A,
                      MAX(VALUE(Y.CS116_BMT,'')) BMT_A,
                      MAX(VALUE(Y.CS116_GNO,'')) GNO_A,
                      MIN(VALUE(A.CS116_BGT,'')) BGT_B,
                      MAX(VALUE(A.CS116_BMT,'')) BMT_B,
                      MAX(VALUE(A.CS116_GNO,'')) GNO_B,
                      MIN(VALUE(C.CS126_USD,'')) USD
                 FROM SAPHEE.ZCST101 B LEFT OUTER JOIN SAPHEE.ZCST116 A
               	                                    ON A.MANDT = B.MANDT
                                                   AND A.CS116_PJT = B.CS101_PJT
                                                   AND A.CS116_HNO = B.CS101_HNO
                                                   AND A.CS116_PST = 'A6'
                                                   AND A.CS116_GND = 'B'
                                                   AND A.CS116_BST &lt;= #DAT#
                                       LEFT OUTER JOIN SAPHEE.ZCST116 Y
               	                                    ON Y.MANDT = B.MANDT
                                                   AND Y.CS116_PJT = B.CS101_PJT
                                                   AND Y.CS116_HNO = B.CS101_HNO
                                                   AND Y.CS116_PST = 'A6'
                                                   AND Y.CS116_GND = 'A'
                                                   AND Y.CS116_BST &lt;= #DAT#            
                                       LEFT OUTER JOIN SAPHEE.ZCST126 C
               	                                    ON C.MANDT = B.MANDT
                                                   AND C.CS126_PJT = B.CS101_PJT
                                                   AND C.CS126_HNO = B.CS101_HNO
                                                   AND C.CS126_PST = 'A6'
                                                   AND C.CS126_DDT = ''
                                                   AND C.CS126_GND = 'D'
                                                   AND C.CS126_ADT &lt;= #DAT#
                                       LEFT OUTER JOIN SAPHEE.ZWBT010 ZWBT
                                                    ON ZWBT.MANDT = B.MANDT
                                                   AND ZWBT.LGORT = B.CS101_BSU            
                WHERE B.MANDT = #G_MANDT#
                  AND B.CS101_IGD &lt;= #DAT#
                  AND SUBSTR(B.CS101_HNO,1,1) = 'J'
                  AND B.CS101_PST = 'A6'
                  AND B.CS101_ARA > ''
                  AND B.CS101_BSU > ''
                  AND B.MDATE &lt;= #DAT#
<isNotNull col="PJT">                                     
                  AND B.CS101_PJT = #PJT#
</isNotNull>
<isNotNull col="ARA">
                  AND B.CS101_ARA = #ARA#
</isNotNull>
<isNotNull col="BSU">
                  AND B.CS101_BSU = #BSU#
</isNotNull>
<isNotNull col="BPM">
                  AND B.CS101_BPM = #BPM#
</isNotNull>
<isNotNull col="TEM">
                  AND ZWBT.VKGRP = #TEM#
</isNotNull>                    
                GROUP BY B.CS101_PJT, B.CS101_HNO
              ) A LEFT OUTER JOIN
                                  (
                                   SELECT CS144_PJT PJT, CS144_HNO HNO, MAX(CS143_FSD) JHD
                                     FROM SAPHEE.ZCST144 A, SAPHEE.ZCST143 B
                                    WHERE A.MANDT = B.MANDT
                                      AND A.CS144_SEQ = B.CS143_SEQ
                                      AND A.MANDT = #G_MANDT#
                                      AND A.CS144_PST = 'A6'
                                      AND B.CS143_FSD &lt;= #DAT#
                                    GROUP BY CS144_PJT, CS144_HNO
                                  ) B ON A.PJT = B.PJT
                                     AND A.HNO = B.HNO
                  LEFT OUTER JOIN (
                                   SELECT CS172_PJO PJO, CS172_HNO HNO, MAX(CS172_MDT) MDT
                                     FROM SAPHEE.ZCST172
                                    WHERE MANDT = #G_MANDT#
                                    GROUP BY CS172_PJO, CS172_HNO
                                  ) D ON A.PJT = D.PJO
                                     AND A.HNO = D.HNO,
              SAPHEE.ZCST111 F
              INNER JOIN SAPHEE.ZMASTER01 G
                      ON F.MANDT = G.MANDT
                     AND F.PJT = G.POSID
              INNER JOIN SAPHEE.ZMASTER02 H
                      ON F.MANDT = H.MANDT
                     AND F.PJT = H.POSID
                     AND F.PJT||F.HNO = H.POSID_1
              INNER JOIN (
                          SELECT
                                 CS126_UPN UPN,
                                 CS126_CST CST,
                                 CS126_PJT PJT,
                                 CS126_HNO HNO,
                                 CS126_USD USD,
                                 CS126_UHJ UHJ,
                                 CS126_SLA SLA,
                                 CS126_GNO GNO,
                                 CS126_AMT AMT
                    FROM  SAPHEE.ZCST126
                    WHERE MANDT = #G_MANDT#
                      AND SUBSTR(CS126_HNO,1,1) = 'J'
                      AND CS126_PST = 'A6'
                      AND CS126_GND = 'C'
                      AND CS126_DDT = ''
                      AND CS126_ADT &lt;= #DAT#
                      AND CS126_USD &lt;= #DAT#
                      AND CS126_UHJ &gt;= SUBSTR(#DAT#,1,6)||'01'
                  ) AS Z  ON F.PJT = Z.PJT
                         AND F.HNO = Z.HNO
              INNER JOIN SAPHEE.ZCST121 I ON I.MANDT = #G_MANDT#
                                         AND Z.UPN = I.CS121_UPN
                                         AND Z.CST = I.CS121_CST
              LEFT OUTER JOIN SAPHEE.ZLCODE AS Z ON F.MANDT = Z.MANDT
                                                        AND F.BLD = Z.CODE2
                                                        AND Z.LANG = 'ko'
                                                        AND Z.CODE1 = 'CS123'                             
        WHERE A.PJT = F.PJT
          AND A.HNO = F.HNO
          AND F.MANDT = #G_MANDT#
          AND (F.HST &lt;&gt; 'D' OR (F.HST = 'D' AND VALUE(D.PJO,'') > ''))
          AND (SUBSTR(VALUE(A.BGT_B,''),1,6) > SUBSTR(#DAT#,1,6) OR VALUE(A.BGT_B,'') = '')
          AND (VALUE(A.USD,'') > #DAT# OR VALUE(A.USD,'') = '')
          AND (VALUE(B.JHD,'') > #DAT# OR VALUE(B.JHD,'') = '')
          AND (VALUE(D.MDT,'') > #DAT# OR VALUE(D.MDT,'') = '')
      ) A

 
UNION ALL 
-----------------
-- 무상ON-HAND --
-----------------
SELECT A.PJT PJT                                                                                
      ,A.HNO HNO
      ,A.ZSITE_NM SPT
      ,A.KUNNR_NM NAM
      ,'' UPN
      ,'' SLA
      ,A.ABG ABG
      ,CASE WHEN A.ZSPEC12 = '' THEN A.ZSPEC1 ELSE A.ZSPEC12 END TYP
      ,A.ZSPEC7 ZSPEC7
      ,A.BLD_NM BLD_NM
      ,INT(A.ZSPEC9) HCNT
      ,DEC(CASE A.ZSPEC3 WHEN '' THEN '0' ELSE A.ZSPEC3 END) ZSPEC3
      ,A.ZSPEC2 SPC
      ,CASE WHEN A.ISD = '' THEN 'Y'
            ELSE (
                  CASE WHEN DAYS(DATE(SUBSTR(#DAT#,1,4)||'-'||SUBSTR(#DAT#,5,2)||'-'||SUBSTR(#DAT#,7,2)))
                            -
                            DAYS(DATE(SUBSTR(VALUE(A.ISD,'19000101'),1,4)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),5,2)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),7,2))) &lt;= 1278 THEN 'Y'
                       ELSE 'N'
                  END
                 )
       END HJA
      ,A.ARA ARA
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'CS115',A.ARA),'') ARA_NM
      ,A.TEM TEM
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'VKGRP',A.TEM),'') TEM_NM
      ,A.BPM BPM
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BPM),'') BPM_NM
      ,A.BSU BSU
      ,VALUE(SAPHEE.GET_VENDER_NAME(A.MANDT,A.BSU),'') BSU_NM
      ,A.JUJ JUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.JUJ),'') JUJ_NM
      ,A.BUJ BUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BUJ),'') BUJ_NM       
      ,A.WDT DAT01
      ,CASE WHEN A.WNO='' THEN ' ' ELSE SAPHEE.CODE_CONV(A.MANDT,'PS004',A.WNO) END STR01
      ,CASE WHEN A.SCT    > '00000000' THEN A.SCT    ELSE ' ' END  DAT02
      ,CASE WHEN A.RCD    > '00000000' THEN A.RCD    ELSE ' ' END  DAT03
      ,CASE WHEN A.IGD    > '00000000' THEN A.IGD    ELSE ' ' END  IGD
      ,CASE WHEN A.ISD    > '00000000' THEN A.ISD    ELSE ' ' END  ISD
      ,CASE WHEN A.IJY    > '00000000' THEN A.IJY    ELSE ' ' END  IJY
      ,CASE WHEN A.ZOIPSU > '00000000' THEN A.ZOIPSU ELSE ' ' END  IPS
      ,A.ZMUSAOCNT  MGM
      ,A.BGT_A      BGT_A
      ,A.BMT_A      BHD_A
      ,A.GNO_A      BGN_A
      ,A.ZMUSAOCNT2 MIM
      ,A.BGT_B      BGT_B
      ,A.BMT_B      BHD_B
      ,A.GNO_B      BGN_B
      ,''           USD_C
      ,''           UHJ_C
      ,''           UGN_C
      ,''           USD_D
      ,''           UHJ_D
      ,''           UGN_D
      ,''           JHD   
      ,''           JJD
      ,''           UDT
      ,''           JGD
      ,''           HST          
      ,''           HST_NM1
      ,''           STS1
      ,'무상일반'   HST_NM2
      ,0 AS AMT
      ,'' P1B
      ,A.P1C P1C
      ,''           TEA
      ,''           KUNNR
      ,''           SNAM
  FROM (
        
        SELECT A.MANDT, A.PJT, A.HNO, A.ARA, A.BSU, A.WDT, A.WNO, A.SCT, A.RCD, A.IGD, A.ISD, A.IJY,
               A.BGT_B, A.BMT_B, A.BGT_A, A.BMT_A, A.GNO_B, A.GNO_A, G.ADDR1||' '||G.ADDR2 P1C,
               G.ZSITE_NM, G.KUNNR_NM, H.ZSPEC1, H.ZSPEC2, H.ZSPEC3, H.ZSPEC7, H.ZSPEC9, H.ZSPEC12, F.ABG, F.BPM, F.JUJ, F.BUJ, H.ZOIPSU, H.ZMUSAOCNT, H.ZMUSAOCNT2, H.ZZGUBUN,
               Z.CTEXT2 BLD_NM ,A.TEM
          FROM (
		SELECT *
          FROM
              (
               SELECT MAX(B.MANDT) MANDT,
                      B.CS116_PJT PJT, B.CS116_HNO HNO,
                      MAX(B.CS116_ARA) ARA,
                      MAX(ZWBT.VKGRP)  TEM,
                      MAX(B.CS116_BSU) BSU,
                      MIN(A.CS101_WDT) WDT,
                      MIN(A.CS101_WNO) WNO,
                      MIN(A.CS101_SCT) SCT,
                      MIN(A.CS101_RCD) RCD,
                      MIN(A.CS101_IGD) IGD,
                      MIN(A.CS101_ISD) ISD,
                      MIN(A.CS101_IJY) IJY,
                      MIN(VALUE(B.CS116_BGT,'')) BGT_B,
                      MAX(VALUE(B.CS116_BMT,'')) BMT_B,
                      MIN(VALUE(D.CS116_BGT,'')) BGT_A,
                      MAX(VALUE(D.CS116_BMT,'')) BMT_A,
                      MIN(VALUE(C.CS126_USD,'')) USD,
                      MAX(VALUE(B.CS116_GNO,'')) GNO_B,
                      MAX(VALUE(D.CS116_GNO,'')) GNO_A
                 FROM SAPHEE.ZCST101 A INNER JOIN SAPHEE.ZCST116 B
                                               ON A.MANDT = B.MANDT
                                              AND A.CS101_PJT = B.CS116_PJT
                                              AND A.CS101_HNO = B.CS116_HNO
                                       LEFT OUTER JOIN SAPHEE.ZCST126 C
               	                                    ON C.MANDT = B.MANDT
                                                   AND C.CS126_PJT = B.CS116_PJT
                                                   AND C.CS126_HNO = B.CS116_HNO
                                                   AND C.CS126_PST = 'A6'
                                                   AND C.CS126_GND = 'D'
                                                   AND C.CS126_DDT = ''
                                                   AND C.CS126_ADT &lt;= #DAT#
                                       LEFT OUTER JOIN SAPHEE.ZCST116 D
                                                    ON D.MANDT = B.MANDT
                                                   AND D.CS116_PJT = B.CS116_PJT
                                                   AND D.CS116_HNO = B.CS116_HNO            
                                                   AND D.CS116_PST = 'A6'
                                                   AND D.CS116_GND = 'A'
                                                   AND D.CS116_BST &lt;= #DAT#
                                                   AND D.CS116_BGT &lt;= #DAT#
                                       LEFT OUTER JOIN SAPHEE.ZWBT010 ZWBT
                                                    ON ZWBT.MANDT = B.MANDT
                                                   AND ZWBT.LGORT = B.CS116_BSU            
                WHERE B.MANDT = #G_MANDT#
                  AND SUBSTR(B.CS116_HNO,1,1) = 'J'
                  AND B.CS116_PST = 'A6'
                  AND B.CS116_GND = 'B'
                  AND B.CS116_BST &lt;= #DAT#
<isNotNull col="PJT">
                  AND B.CS116_PJT = #PJT#
</isNotNull>
<isNotNull col="ARA">
                  AND B.CS116_ARA = #ARA#
</isNotNull>
<isNotNull col="BSU">
                  AND B.CS116_BSU = #BSU#
</isNotNull>
<isNotNull col="BPM">
                  AND B.CS116_BPM = #BPM#
</isNotNull>
<isNotNull col="TEM">
                  AND ZWBT.VKGRP = #TEM#
</isNotNull>                    
                GROUP BY B.CS116_PJT, B.CS116_HNO
                      ) A
                WHERE (SUBSTR(A.BGT_B,1,6) = SUBSTR(#DAT#,1,6) OR (A.BGT_B &lt;= #DAT# AND A.BMT_B &gt;= SUBSTR(#DAT#,1,6)||'01'))
              ) A LEFT OUTER JOIN
                                  (
                                   SELECT CS144_PJT PJT, CS144_HNO HNO, MAX(CS143_FSD) JHD
                                     FROM SAPHEE.ZCST144 A, SAPHEE.ZCST143 B
                                    WHERE A.MANDT = B.MANDT
                                      AND A.CS144_SEQ = B.CS143_SEQ
                                      AND A.MANDT = #G_MANDT#
                                      AND A.CS144_PST = 'A6'
                                      AND B.CS143_FSD &lt;= #DAT#
                                    GROUP BY CS144_PJT, CS144_HNO
                                  ) B ON A.PJT = B.PJT
                                     AND A.HNO = B.HNO
                  LEFT OUTER JOIN (
    	                     SELECT CS172_PJO PJO, CS172_HNO HNO, MAX(CS172_MDT) MDT
    	                   FROM SAPHEE.ZCST172
    	                  WHERE MANDT = #G_MANDT#
    	                  GROUP BY CS172_PJO, CS172_HNO
    	                ) D ON A.PJT = D.PJO
    	                   AND A.HNO = D.HNO,
    	            SAPHEE.ZCST111 F INNER JOIN SAPHEE.ZMASTER01 G
                                           ON F.MANDT = G.MANDT
                                          AND F.PJT = G.POSID
                                   INNER JOIN SAPHEE.ZMASTER02 H
                                           ON F.MANDT = H.MANDT
                                          AND F.PJT = H.POSID
                                          AND F.PJT||F.HNO = H.POSID_1
                                   LEFT OUTER JOIN SAPHEE.ZLCODE AS Z ON F.MANDT = Z.MANDT
                                                        AND F.BLD = Z.CODE2
                                                        AND Z.LANG = 'ko'
                                                        AND Z.CODE1 = 'CS123'         
         WHERE A.PJT = F.PJT
           AND A.HNO = F.HNO
           AND F.MANDT = #G_MANDT#
           AND (F.HST &lt;&gt; 'D' OR (F.HST = 'D' AND VALUE(D.PJO,'') > ''))
           AND (VALUE(A.USD,'') > #DAT# OR VALUE(A.USD,'') = '')
           AND (VALUE(B.JHD,'') > #DAT# OR VALUE(B.JHD,'') = '' OR A.BGT_B > VALUE(B.JHD,''))
           AND (VALUE(D.MDT,'') > #DAT# OR VALUE(D.MDT,'') = '') 
       ) A     

  
UNION ALL  
--------------------
-- 무상만료(관리) --
--------------------
SELECT A.PJT PJT                                                                                
      ,A.HNO HNO
      ,A.ZSITE_NM SPT
      ,A.KUNNR_NM NAM
      ,'' UPN
      ,'' SLA
      ,A.ABG ABG
      ,CASE WHEN A.ZSPEC12 = '' THEN A.ZSPEC1 ELSE A.ZSPEC12 END TYP
      ,A.ZSPEC7 ZSPEC7
      ,A.BLD_NM BLD_NM
      ,INT(A.ZSPEC9) HCNT
      ,DEC(CASE A.ZSPEC3 WHEN '' THEN '0' ELSE A.ZSPEC3 END) ZSPEC3
      ,A.ZSPEC2 SPC
      ,CASE WHEN A.ISD = '' THEN 'Y'
            ELSE (
                  CASE WHEN DAYS(DATE(SUBSTR(#DAT#,1,4)||'-'||SUBSTR(#DAT#,5,2)||'-'||SUBSTR(#DAT#,7,2)))
                            -
                            DAYS(DATE(SUBSTR(VALUE(A.ISD,'19000101'),1,4)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),5,2)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),7,2))) &lt;= 1278 THEN 'Y'
                       ELSE 'N'
                  END
                 )
       END HJA
      ,A.ARA ARA
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'CS115',A.ARA),'') ARA_NM
      ,A.TEM TEM
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'VKGRP',A.TEM),'') TEM_NM
      ,A.BPM BPM
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BPM),'') BPM_NM
      ,A.BSU BSU
      ,VALUE(SAPHEE.GET_VENDER_NAME(A.MANDT,A.BSU),'') BSU_NM
      ,A.JUJ JUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.JUJ),'') JUJ_NM
      ,A.BUJ BUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BUJ),'') BUJ_NM       
      ,A.WDT DAT01
      ,CASE WHEN A.WNO='' THEN ' ' ELSE SAPHEE.CODE_CONV(A.MANDT,'PS004',A.WNO) END STR01
      ,CASE WHEN A.SCT    > '00000000' THEN A.SCT    ELSE ' ' END  DAT02
      ,CASE WHEN A.RCD    > '00000000' THEN A.RCD    ELSE ' ' END  DAT03
      ,CASE WHEN A.IGD    > '00000000' THEN A.IGD    ELSE ' ' END  IGD
      ,CASE WHEN A.ISD    > '00000000' THEN A.ISD    ELSE ' ' END  ISD
      ,CASE WHEN A.IJY    > '00000000' THEN A.IJY    ELSE ' ' END  IJY
      ,CASE WHEN A.ZOIPSU > '00000000' THEN A.ZOIPSU ELSE ' ' END  IPS
      ,A.ZMUSAOCNT  MGM
      ,A.BGT_A      BGT_A
      ,A.BMT_A      BHD_A
      ,A.GNO_A      BGN_A
      ,A.ZMUSAOCNT2 MIM
      ,A.BGT_B      BGT_B
      ,A.BMT_B      BHD_B
      ,A.GNO_B      BGN_B
      ,''           USD_C
      ,''           UHJ_C
      ,''           UGN_C
      ,''           USD_D
      ,''           UHJ_D
      ,''           UGN_D
      ,''           JHD   
      ,''           JJD
      ,''           UDT
      ,''           JGD
      ,''           HST          
      ,''           HST_NM1
      ,''           STS1
      ,CASE WHEN INT(A.MON) > 3 THEN '전환펜딩실패' ELSE '전환펜딩' END HST_NM2
      ,0 AS AMT
      ,'' P1B
      ,A.P1C P1C
      ,''           TEA
      ,''           KUNNR
      ,''           SNAM
  FROM (
        SELECT
               A.MANDT, A.PJT, A.HNO, A.ARA, A.BSU, A.WDT, A.WNO, A.SCT, A.RCD, A.IGD, A.ISD, A.IJY,
               A.BGT_B, A.BMT_B, A.BGT_A, A.BMT_A, A.GNO_B, A.GNO_A, G.ADDR1||' '||G.ADDR2 P1C,
               G.ZSITE_NM, G.KUNNR_NM, H.ZSPEC1, H.ZSPEC2, H.ZSPEC3, H.ZSPEC7, H.ZSPEC9, H.ZSPEC12, F.ABG, F.BPM, F.JUJ, F.BUJ, H.ZOIPSU, H.ZMUSAOCNT, H.ZMUSAOCNT2, H.ZZGUBUN,
               Z.CTEXT2 BLD_NM, A.TEM, SAPHEE.MONTH_BETWEEN(A.BMT_B,SUBSTR(#DAT#,1,6)||'31','1') MON
          FROM (
                SELECT A.MANDT, A.PJT, A.HNO, A.ARA, A.BSU, A.WDT, A.WNO, A.SCT, A.RCD, A.IGD, A.ISD, A.IJY,
					   A.BGT_B, A.BMT_B, A.BGT_A, A.BMT_A, A.GNO_B, A.GNO_A, C.USD ,A.TEM
                  FROM (
                        SELECT A.MANDT, A.PJT, A.HNO, A.ARA, A.BSU, A.WDT, A.WNO, A.SCT, A.RCD, A.IGD, A.ISD, A.IJY,
						       A.BGT_B, A.BMT_B, A.BGT_A, A.BMT_A, A.GNO_B, A.GNO_A ,A.TEM
                          FROM (
                                SELECT MAX(A.MANDT) MANDT,
                                       A.CS116_PJT PJT, 
                                       A.CS116_HNO HNO,
                                       MAX(A.CS116_ARA) ARA,
                                       MAX(ZWBT.VKGRP)  TEM,
                                       MAX(A.CS116_BSU) BSU,
                                       MIN(C.CS101_WDT) WDT,
                                       MIN(C.CS101_WNO) WNO,
                                       MIN(C.CS101_SCT) SCT,
                                       MIN(C.CS101_RCD) RCD,
                                       MIN(C.CS101_IGD) IGD,
                                       MIN(C.CS101_ISD) ISD,
                                       MIN(C.CS101_IJY) IJY,
                                       MIN(VALUE(A.CS116_BGT,'')) BGT_B,
                                       MAX(VALUE(A.CS116_BMT,'')) BMT_B,
                                       MIN(VALUE(D.CS116_BGT,'')) BGT_A,
                                       MAX(VALUE(D.CS116_BMT,'')) BMT_A,
                                       MAX(VALUE(A.CS116_GNO,'')) GNO_B,
                                       MAX(VALUE(D.CS116_GNO,'')) GNO_A
                                  FROM SAPHEE.ZCST116 A, SAPHEE.ZCST111 B INNER JOIN SAPHEE.ZCST101 C
                                                                                  ON B.MANDT = C.MANDT
                                                                                 AND B.PJT = C.CS101_PJT
                                                                                 AND B.HNO = C.CS101_HNO
                                                                          LEFT OUTER JOIN SAPHEE.ZCST116 D
                                                                                  ON B.MANDT = D.MANDT
                                                                                 AND B.PJT = D.CS116_PJT
                                                                                 AND B.HNO = D.CS116_HNO
                                                                                 AND D.CS116_PST = 'A6'
                                                                                 AND D.CS116_GND = 'A'
                                                                                 AND D.CS116_BGT &lt;= #DAT#
                                                                                 AND D.CS116_BST &lt;= #DAT#
                                                                          LEFT OUTER JOIN SAPHEE.ZWBT010 ZWBT
                                                                                  ON ZWBT.MANDT = B.MANDT
                                                                                 AND ZWBT.LGORT = B.BSU        
                                 WHERE A.MANDT = #G_MANDT#
                                   AND A.CS116_PST = 'A6'
                                   AND A.CS116_GND = 'B'
                                   AND A.MANDT = B.MANDT
                                   AND A.CS116_PJT = B.PJT
                                   AND A.CS116_HNO = B.HNO
                                   AND SUBSTR(B.HNO,1,1) = 'J'
                                   AND A.CS116_BST &lt;= #DAT#
<isNotNull col="PJT">
                                   AND A.CS116_PJT = #PJT#
</isNotNull>
<isNotNull col="ARA">
                                   AND A.CS116_ARA = #ARA#
</isNotNull>
<isNotNull col="BSU">
                                   AND A.CS116_BSU = #BSU#
</isNotNull>
<isNotNull col="BPM">
                                   AND A.CS116_BPM = #BPM#
</isNotNull>
<isNotNull col="TEM">
                                   AND ZWBT.VKGRP = #TEM#
</isNotNull>                                    
                                 GROUP BY A.CS116_PJT, A.CS116_HNO
                               ) A
                         WHERE A.BGT_B &lt;= #DAT#
                        ) A LEFT OUTER JOIN
                                  (
                              SELECT MAX(A.CS126_ARA) ARA, MAX(A.CS126_BSU) BSU, A.CS126_PJT PJT, A.CS126_HNO HNO,
                                                    MIN(A.CS126_USD) USD, MIN(A.CS126_UMR) UMR
                                               FROM SAPHEE.ZCST126 A, SAPHEE.ZCST111 B
                                              WHERE A.MANDT = #G_MANDT#
                                                AND A.CS126_DDT = ''
                                                AND A.CS126_PST = 'A6'
                                                AND A.CS126_GND = 'D'
                                                AND A.CS126_USD &lt;= #DAT#
                                                AND A.MANDT = B.MANDT
                                                AND A.CS126_PJT = B.PJT
                                                AND A.CS126_HNO = B.HNO
                                                AND SUBSTR(B.HNO,1,1) = 'J'
                                                AND A.CS126_ADT &lt;= #DAT#
                                              GROUP BY A.CS126_PJT, A.CS126_HNO
                             ) C ON A.PJT = C.PJT
                                AND A.HNO = C.HNO
                 WHERE A.BMT_B &lt;= #DAT1#
               ) A LEFT OUTER JOIN
                                   (
                                    SELECT CS144_PJT PJT, CS144_HNO HNO, MAX(CS143_FSD) JHD
                                      FROM SAPHEE.ZCST144 A, SAPHEE.ZCST143 B
                                     WHERE A.MANDT = B.MANDT
                                       AND A.CS144_SEQ = B.CS143_SEQ
                                       AND A.MANDT = #G_MANDT#
                                       AND A.CS144_PST = 'A6'
                                       AND B.CS143_FSD &lt;= #DAT#
                                     GROUP BY CS144_PJT, CS144_HNO
                                   ) B ON A.PJT = B.PJT
                                      AND A.HNO = B.HNO
                   LEFT OUTER JOIN (
                           SELECT CS172_PJO PJO, CS172_HNO HNO, MAX(CS172_MDT) MDT
                         FROM SAPHEE.ZCST172
                        WHERE MANDT = #G_MANDT#
                        GROUP BY CS172_PJO, CS172_HNO
                      ) D ON A.PJT = D.PJO
                         AND A.HNO = D.HNO,
       SAPHEE.ZCST111 F INNER JOIN SAPHEE.ZMASTER01 G
                                        ON F.MANDT = G.MANDT
                                       AND F.PJT = G.POSID
                                INNER JOIN SAPHEE.ZMASTER02 H
                                        ON F.MANDT = H.MANDT
                                       AND F.PJT = H.POSID
                                       AND F.PJT||F.HNO = H.POSID_1
                        LEFT OUTER JOIN SAPHEE.ZLCODE AS Z ON F.MANDT = Z.MANDT
                                                        AND F.BLD = Z.CODE2
                                                        AND Z.LANG = 'ko'
                                                        AND Z.CODE1 = 'CS123'                 
         WHERE A.PJT = F.PJT
           AND A.HNO = F.HNO
           AND F.MANDT = #G_MANDT#
           AND (F.HST &lt;&gt; 'D' OR (F.HST = 'D' AND VALUE(D.PJO,'') > ''))
           AND (VALUE(A.USD,'') > #DAT# OR VALUE(A.USD,'') = '')
           AND (VALUE(B.JHD,'') > #DAT# OR VALUE(B.JHD,'') = '' OR A.BGT_B > VALUE(B.JHD,''))
           AND (VALUE(D.MDT,'') > #DAT# OR VALUE(D.MDT,'') = '')     
       ) A

  
UNION ALL  
-----------------
-- 유상ON-HAND --
-----------------
SELECT A.PJT PJT                                                                                
      ,A.HNO HNO
      ,A.ZSITE_NM SPT
      ,A.KUNNR_NM NAM
      ,A.UPN UPN
      ,A.SLA SLA
      ,A.ABG ABG
      ,CASE WHEN A.ZSPEC12 = '' THEN A.ZSPEC1 ELSE A.ZSPEC12 END TYP
      ,A.ZSPEC7 ZSPEC7
      ,A.BLD_NM BLD_NM
      ,INT(A.ZSPEC9) HCNT
      ,DEC(CASE A.ZSPEC3 WHEN '' THEN '0' ELSE A.ZSPEC3 END) ZSPEC3
      ,A.ZSPEC2 SPC
      ,CASE WHEN A.ISD = '' THEN 'Y'
            ELSE (
                  CASE WHEN DAYS(DATE(SUBSTR(#DAT#,1,4)||'-'||SUBSTR(#DAT#,5,2)||'-'||SUBSTR(#DAT#,7,2)))
                            -
                            DAYS(DATE(SUBSTR(VALUE(A.ISD,'19000101'),1,4)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),5,2)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),7,2))) &lt;= 1278 THEN 'Y'
                       ELSE 'N'
                  END
                 )
       END HJA
      ,A.ARA ARA
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'CS115',A.ARA),'') ARA_NM
      ,A.TEM TEM
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'VKGRP',A.TEM),'') TEM_NM
      ,A.BPM BPM
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BPM),'') BPM_NM
      ,A.BSU BSU
      ,VALUE(SAPHEE.GET_VENDER_NAME(A.MANDT,A.BSU),'') BSU_NM
      ,A.JUJ JUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.JUJ),'') JUJ_NM
      ,A.BUJ BUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BUJ),'') BUJ_NM       
      ,A.WDT DAT01
      ,CASE WHEN A.WNO='' THEN ' ' ELSE SAPHEE.CODE_CONV(A.MANDT,'PS004',A.WNO) END STR01
      ,CASE WHEN A.SCT    > '00000000' THEN A.SCT    ELSE ' ' END  DAT02
      ,CASE WHEN A.RCD    > '00000000' THEN A.RCD    ELSE ' ' END  DAT03
      ,CASE WHEN A.IGD    > '00000000' THEN A.IGD    ELSE ' ' END  IGD
      ,CASE WHEN A.ISD    > '00000000' THEN A.ISD    ELSE ' ' END  ISD
      ,CASE WHEN A.IJY    > '00000000' THEN A.IJY    ELSE ' ' END  IJY
      ,CASE WHEN A.ZOIPSU > '00000000' THEN A.ZOIPSU ELSE ' ' END  IPS
      ,A.ZMUSAOCNT  MGM
      ,A.BGT_A      BGT_A
      ,A.BMT_A      BHD_A
      ,A.GNO_A      BGN_A
      ,A.ZMUSAOCNT2 MIM
      ,A.BGT_B      BGT_B
      ,A.BMT_B      BHD_B
      ,A.GNO_B      BGN_B
      ,A.USD_C      USD_C
      ,A.UHJ_C      UHJ_C
      ,A.GNO_C      UGN_C
      ,A.USD_D      USD_D
      ,A.UHJ_D      UHJ_D
      ,A.GNO_D      UGN_D
      ,''           JHD   
      ,''           JJD
      ,''           UDT
      ,''           JGD
      ,''           HST          
      ,''           HST_NM1
      ,''           STS1
      ,'유상일반'   HST_NM2
      ,A.AMT        AMT
      ,A.P1B        P1B
      ,A.P1C        P1C
      ,A.TEA        TEA
      ,A.KUNNR      KUNNR
      ,A.CS121_NAM  SNAM
  FROM (
        SELECT A.MANDT, A.PJT, A.HNO, F.ARA, F.BSU, A.USD, A.UHJ,
               C.WDT, C.WNO, C.SCT, C.RCD, C.IGD, C.ISD, C.IJY,
               E.BGT_B, E.BMT_B, E.GNO_B,
               E1.BGT_A, E1.BMT_A, E1.GNO_A,
               E2.USD_C, E2.UHJ_C, E2.GNO_C,
               G.ZSITE_NM, G.KUNNR_NM,
               H.ZSPEC1, H.ZSPEC2, H.ZSPEC3, H.ZSPEC7, H.ZSPEC9, H.ZSPEC12, H.ZOIPSU, H.ZMUSAOCNT, H.ZMUSAOCNT2, H.ZZGUBUN,
               F.ABG, F.BPM, F.JUJ, F.BUJ,
               E3.CS126_UPN UPN, E3.CS126_CST CST, E3.CS126_GNO GNO_D,
               E3.CS126_USD USD_D, E3.CS126_UHJ UHJ_D,
               E3.CS126_SLA SLA, E3.CS126_AMT AMT,
               E4.CS121_P1B ||' '|| E4.CS121_P2B P1B, E4.CS121_P1C ||' '|| E4.CS121_P2C P1C, E4.KUNNR, E4.CS121_NAM,
               Z.CTEXT2 BLD_NM, E4.CS121_TEA TEA ,ZWBT.VKGRP TEM
          FROM
              (
               SELECT A.MANDT, A.PJT, A.HNO, A.USD, A.UHJ, A.ARA, A.BSU
                 FROM (
                       SELECT MAX(A.MANDT) MANDT, A.PJT, A.HNO,
                              MAX(A.ARA) ARA, MAX(A.BSU) BSU,
                              MIN(A.USD) USD, MAX(A.UHJ) UHJ
                         FROM (
                               SELECT MAX(B.MANDT) MANDT,
                                      B.CS126_GRP, B.CS126_PJT PJT, B.CS126_HNO HNO,
                                      MAX(B.CS126_ARA) ARA,
                                      MAX(B.CS126_BSU) BSU,
                                      MIN(B.CS126_USD) USD,
                                      MAX(B.CS126_UHJ) UHJ
                                 FROM SAPHEE.ZCST126 B
                                WHERE B.MANDT = #G_MANDT#
                                  AND SUBSTR(B.CS126_HNO,1,1) = 'J'
                                  AND B.CS126_PST = 'A6'
                                  AND B.CS126_DDT = ''
                                  AND B.CS126_GND = 'D'
                                  AND #DAT# BETWEEN (CASE WHEN B.CS126_ADT &lt; B.CS126_USD THEN B.CS126_USD
                                                                             ELSE B.CS126_ADT
                                                                    END) AND B.CS126_UHJ
                                GROUP BY B.CS126_GRP, B.CS126_PJT, B.CS126_HNO
                              ) A
                        WHERE A.USD &lt;= #DAT#      
                        GROUP BY A.PJT, A.HNO
                      ) A
                WHERE A.UHJ &gt;= SUBSTR(#DAT#,1,6)||'01'
              ) A LEFT OUTER JOIN (
                                   SELECT CS101_PJT PJT, CS101_HNO HNO,
                                          MIN(CS101_WDT) WDT,
                                          MIN(CS101_WNO) WNO,
                                          MIN(CS101_SCT) SCT,
                                          MIN(CS101_RCD) RCD,
                                          MIN(CS101_IGD) IGD,
                                          MIN(CS101_ISD) ISD,
                                          MIN(CS101_IJY) IJY
                                     FROM SAPHEE.ZCST101
                                    WHERE MANDT = #G_MANDT#
                                      AND MDATE &lt;= #DAT#
                                    GROUP BY CS101_PJT, CS101_HNO
                                  ) C ON A.PJT = C.PJT
                                     AND A.HNO = C.HNO
                  LEFT OUTER JOIN (
                                   SELECT CS116_PJT PJT, CS116_HNO HNO,
                                          MIN(CS116_BGT) BGT_B, MAX(CS116_BMT) BMT_B, MAX(CS116_GNO) GNO_B
                                     FROM SAPHEE.ZCST116
                                    WHERE MANDT = #G_MANDT#
                                      AND CS116_PST = 'A6'
                                      AND CS116_GND = 'B'
                                      AND CS116_BST &lt;= #DAT#
                                    GROUP BY CS116_PJT, CS116_HNO
                                  ) E ON A.PJT = E.PJT
                                     AND A.HNO = E.HNO
                  LEFT OUTER JOIN (
                                   SELECT CS116_PJT PJT, CS116_HNO HNO, 
                                          MIN(CS116_BGT) BGT_A, MAX(CS116_BMT) BMT_A, MAX(CS116_GNO) GNO_A
                                     FROM SAPHEE.ZCST116
                                    WHERE MANDT = #G_MANDT#
                                      AND CS116_PST = 'A6'
                                      AND CS116_GND = 'A'
                                      AND CS116_BST &lt;= #DAT#
                                    GROUP BY CS116_PJT, CS116_HNO
                                  ) E1 ON A.PJT = E1.PJT
                                      AND A.HNO = E1.HNO                   
                  LEFT OUTER JOIN (
                                   SELECT CS126_PJT PJT, CS126_HNO HNO, 
                                          MIN(CS126_USD) USD_C, MAX(CS126_UHJ) UHJ_C, MAX(CS126_GNO) GNO_C
                                     FROM SAPHEE.ZCST126
                                    WHERE MANDT = #G_MANDT#
                                      AND CS126_PST = 'A6'
                                      AND CS126_GND = 'C'
                                      AND CS126_DDT = ''
                                      AND CS126_ADT &lt;= #DAT#
                                    GROUP BY CS126_PJT, CS126_HNO
                                  ) E2 ON A.PJT = E2.PJT
                                      AND A.HNO = E2.HNO
                  LEFT OUTER JOIN
                                  (
                                   SELECT CS144_PJT PJT, CS144_HNO HNO, MAX(CS143_FSD) JHD
                                     FROM SAPHEE.ZCST144 A, SAPHEE.ZCST143 B
                                    WHERE A.MANDT = B.MANDT
                                      AND A.CS144_SEQ = B.CS143_SEQ
                                      AND A.MANDT = #G_MANDT#
                                      AND A.CS144_PST = 'A6'
                                      AND B.CS143_FSD &lt;= #DAT#
                                    GROUP BY CS144_PJT, CS144_HNO
                                  ) B ON A.PJT = B.PJT
                                     AND A.HNO = B.HNO
                  LEFT OUTER JOIN (
                                   SELECT CS172_PJO PJO, CS172_HNO HNO, MAX(CS172_MDT) MDT
                                     FROM SAPHEE.ZCST172
                                    WHERE MANDT = #G_MANDT#
                                    GROUP BY CS172_PJO, CS172_HNO
                                  ) D ON A.PJT = D.PJO
                                     AND A.HNO = D.HNO
                  LEFT OUTER JOIN SAPHEE.ZWBT010 ZWBT
                               ON ZWBT.MANDT = A.MANDT
                              AND ZWBT.LGORT = A.BSU,
                  SAPHEE.ZCST111 F INNER JOIN SAPHEE.ZMASTER01 G
                                           ON F.MANDT = G.MANDT
                                          AND F.PJT = G.POSID
                                   INNER JOIN SAPHEE.ZMASTER02 H
                                           ON F.MANDT = H.MANDT
                                          AND F.PJT = H.POSID
                                          AND F.PJT||F.HNO = H.POSID_1
					                         INNER JOIN SAPHEE.ZCST126 E3
					                                 ON E3.MANDT = #G_MANDT#
					                                AND F.PJT = E3.CS126_PJT
					                                AND F.HNO = E3.CS126_HNO
					                                AND E3.CS126_PST = 'A6'
					                                AND E3.CS126_GND = 'D'
					                                AND E3.CS126_DDT = ''
					                                AND E3.CS126_USD &lt;= #DAT#
					                                AND E3.CS126_UHJ &gt;= #DAT#
					                                AND E3.CS126_ADT &lt;= #DAT#
					                         INNER JOIN SAPHEE.ZCST121 E4
					                                 ON E4.MANDT = #G_MANDT#
					                                AND E3.CS126_UPN = E4.CS121_UPN
					                                AND E3.CS126_CST = E4.CS121_CST
					                         LEFT OUTER JOIN SAPHEE.ZLCODE AS Z ON F.MANDT = Z.MANDT
                                                        AND F.BLD = Z.CODE2
                                                        AND Z.LANG = 'ko'
                                                        AND Z.CODE1 = 'CS123'         
         WHERE A.PJT = F.PJT
           AND A.HNO = F.HNO
           AND F.MANDT = #G_MANDT#
           AND (F.HST &lt;&gt; 'D' OR (F.HST = 'D' AND VALUE(D.PJO,'') > ''))
           AND (VALUE(B.JHD,'') > #DAT# OR VALUE(B.JHD,'') = '' OR A.UHJ > VALUE(B.JHD,''))
           AND (VALUE(D.MDT,'') > #DAT# OR VALUE(D.MDT,'') = '')
           AND (VALUE(E.BMT_B,'') &lt;= A.UHJ)
<isNotNull col="PJT">
           AND F.PJT = #PJT#
</isNotNull>
<isNotNull col="ARA">
           AND F.ARA = #ARA#
</isNotNull>
<isNotNull col="BSU">
           AND F.BSU = #BSU#
</isNotNull>
<isNotNull col="BPM">
           AND F.BPM = #BPM#
</isNotNull>
<isNotNull col="TEM">
           AND ZWBT.VKGRP = #TEM#
</isNotNull>                                                                            
       ) A           
  

UNION ALL  
--------------------
-- 유상만료(관리) --
--------------------
SELECT A.PJT PJT                                                                                
      ,A.HNO HNO
      ,A.ZSITE_NM SPT
      ,A.KUNNR_NM NAM
      ,A.UPN UPN
      ,A.SLA SLA
      ,A.ABG ABG
      ,CASE WHEN A.ZSPEC12 = '' THEN A.ZSPEC1 ELSE A.ZSPEC12 END TYP
      ,A.ZSPEC7 ZSPEC7
      ,A.BLD_NM BLD_NM
      ,INT(A.ZSPEC9) HCNT
      ,DEC(CASE A.ZSPEC3 WHEN '' THEN '0' ELSE A.ZSPEC3 END) ZSPEC3
      ,A.ZSPEC2 SPC
      ,CASE WHEN A.ISD = '' THEN 'Y'
            ELSE (
                  CASE WHEN DAYS(DATE(SUBSTR(#DAT#,1,4)||'-'||SUBSTR(#DAT#,5,2)||'-'||SUBSTR(#DAT#,7,2)))
                            -
                            DAYS(DATE(SUBSTR(VALUE(A.ISD,'19000101'),1,4)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),5,2)||'-'||SUBSTR(VALUE(A.ISD,'19000101'),7,2))) &lt;= 1278 THEN 'Y'
                       ELSE 'N'
                  END
                 )
       END HJA
      ,A.ARA ARA
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'CS115',A.ARA),'') ARA_NM
      ,A.TEM TEM
      ,VALUE(SAPHEE.CODE_CONV(A.MANDT,'VKGRP',A.TEM),'') TEM_NM
      ,A.BPM BPM
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BPM),'') BPM_NM
      ,A.BSU BSU
      ,VALUE(SAPHEE.GET_VENDER_NAME(A.MANDT,A.BSU),'') BSU_NM
      ,A.JUJ JUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.JUJ),'') JUJ_NM
      ,A.BUJ BUJ                                                                       
      ,VALUE(SAPHEE.GET_BOSU_INWON(A.MANDT,A.BUJ),'') BUJ_NM       
      ,A.WDT DAT01
      ,CASE WHEN A.WNO='' THEN ' ' ELSE SAPHEE.CODE_CONV(A.MANDT,'PS004',A.WNO) END STR01
      ,CASE WHEN A.SCT    > '00000000' THEN A.SCT    ELSE ' ' END  DAT02
      ,CASE WHEN A.RCD    > '00000000' THEN A.RCD    ELSE ' ' END  DAT03
      ,CASE WHEN A.IGD    > '00000000' THEN A.IGD    ELSE ' ' END  IGD
      ,CASE WHEN A.ISD    > '00000000' THEN A.ISD    ELSE ' ' END  ISD
      ,CASE WHEN A.IJY    > '00000000' THEN A.IJY    ELSE ' ' END  IJY
      ,CASE WHEN A.ZOIPSU > '00000000' THEN A.ZOIPSU ELSE ' ' END  IPS
      ,A.ZMUSAOCNT  MGM
      ,A.BGT_A      BGT_A
      ,A.BMT_A      BHD_A
      ,A.GNO_A      BGN_A
      ,A.ZMUSAOCNT2 MIM
      ,A.BGT_B      BGT_B
      ,A.BMT_B      BHD_B
      ,A.GNO_B      BGN_B
      ,A.USD_C      USD_C
      ,A.UHJ_C      UHJ_C
      ,A.GNO_C      UGN_C
      ,A.USD_D      USD_D
      ,A.UHJ_D      UHJ_D
      ,A.GNO_D      UGN_D
      ,''           JHD   
      ,''           JJD
      ,''           UDT
      ,''           JGD
      ,''           HST          
      ,''           HST_NM1
      ,''           STS1
      ,CASE WHEN INT(A.MON) > 3 THEN '갱신펜딩실패' ELSE '갱신펜딩' END HST_NM2
      ,A.AMT        AMT
      ,A.P1B        P1B
      ,A.P1C        P1C
      ,A.TEA        TEA
      ,A.KUNNR      KUNNR
      ,A.CS121_NAM  SNAM
  FROM (
        SELECT A.MANDT, A.PJT, A.HNO, F.ARA, F.BSU, A.USD, A.UHJ,
               C.WDT, C.WNO, C.SCT, C.RCD, C.IGD, C.ISD, C.IJY,
               E.BGT_B, E.BMT_B, E.GNO_B,
               E1.BGT_A, E1.BMT_A, E1.GNO_A,
               E2.USD_C, E2.UHJ_C, E2.GNO_C,
               G.ZSITE_NM, G.KUNNR_NM,
               H.ZSPEC1, H.ZSPEC2, H.ZSPEC3, H.ZSPEC7, H.ZSPEC9, H.ZSPEC12, H.ZOIPSU, H.ZMUSAOCNT, H.ZMUSAOCNT2, H.ZZGUBUN,
               F.ABG, F.BPM, F.JUJ, F.BUJ,
               E3.CS126_UPN UPN, E3.CS126_CST CST, E3.CS126_GNO GNO_D,
               E3.CS126_USD USD_D, E3.CS126_UHJ UHJ_D,
               E3.CS126_SLA SLA, E3.CS126_AMT AMT,
               E4.CS121_P1B ||' '|| E4.CS121_P2B P1B, E4.CS121_P1C ||' '|| E4.CS121_P2C P1C, E4.KUNNR, E4.CS121_NAM,
               Z.CTEXT2 BLD_NM, E4.CS121_TEA TEA ,ZWBT.VKGRP TEM, SAPHEE.MONTH_BETWEEN(E3.CS126_UHJ,SUBSTR(#DAT#,1,6)||'31','1') MON
          FROM
              (
               SELECT A.MANDT, A.PJT, A.HNO, A.USD, A.UHJ, A.ARA, A.BSU, A.USDM
                 FROM (
                       SELECT MAX(B.MANDT) MANDT, B.PJT, B.HNO, MAX(B.ARA) ARA, MAX(B.BSU) BSU,
                              MIN(B.USD) USD, MAX(B.UHJ) UHJ, MAX(B.USDM) USDM
                         FROM (     
                               SELECT MAX(A.MANDT) MANDT, 
                                      A.CS126_GRP, MAX(A.CS126_ARA) ARA, MAX(A.CS126_BSU) BSU, A.CS126_PJT PJT, A.CS126_HNO HNO,
                                      MIN(A.CS126_USD) USD, MAX(A.CS126_UHJ) UHJ, MAX(A.CS126_USD) USDM
                                 FROM SAPHEE.ZCST126 A, SAPHEE.ZCST111 B
                                WHERE A.MANDT = #G_MANDT#
                                  AND A.CS126_DDT = ''
                                  AND A.CS126_PST = 'A6'
                                  AND A.CS126_GND = 'D'
                                  AND A.CS126_USD &lt;= #DAT#
                                  AND A.MANDT = B.MANDT
                                  AND A.CS126_PJT = B.PJT
                                  AND A.CS126_HNO = B.HNO
                                  AND SUBSTR(B.HNO,1,1) = 'J'
                                  AND A.CS126_ADT &lt;= #DAT#
                                GROUP BY A.CS126_GRP, A.CS126_PJT, A.CS126_HNO
                              ) B
                        WHERE B.USD &lt;= #DAT#
                        GROUP BY B.PJT, B.HNO
                       ) A
                WHERE A.UHJ &lt;= #DAT1#
              ) A LEFT OUTER JOIN (
                                   SELECT CS101_PJT PJT, CS101_HNO HNO,
                                          MIN(CS101_WDT) WDT,
                                          MIN(CS101_WNO) WNO,
                                          MIN(CS101_SCT) SCT,
                                          MIN(CS101_RCD) RCD,
                                          MIN(CS101_IGD) IGD,
                                          MIN(CS101_ISD) ISD,
                                          MIN(CS101_IJY) IJY
                                     FROM SAPHEE.ZCST101
                                    WHERE MANDT = #G_MANDT#
                                      AND MDATE &lt;= #DAT#
                                    GROUP BY CS101_PJT, CS101_HNO
                                  ) C ON A.PJT = C.PJT
                                     AND A.HNO = C.HNO
      	          LEFT OUTER JOIN (
                                   SELECT CS116_PJT PJT, CS116_HNO HNO, MAX(CS116_BGT) BGT_B, MAX(CS116_BMT) BMT_B, MAX(CS116_GNO) GNO_B
                                     FROM SAPHEE.ZCST116
                                    WHERE MANDT = #G_MANDT#
                                      AND CS116_PST = 'A6'
                                      AND CS116_GND = 'B'
                                      AND CS116_BST &lt;= #DAT#
                                    GROUP BY CS116_PJT, CS116_HNO
                                  ) E ON A.PJT = E.PJT
                                     AND A.HNO = E.HNO
                  LEFT OUTER JOIN (
                                   SELECT CS116_PJT PJT, CS116_HNO HNO, MAX(CS116_BGT) BGT_A, MAX(CS116_BMT) BMT_A, MAX(CS116_GNO) GNO_A
                                     FROM SAPHEE.ZCST116
                                    WHERE MANDT = #G_MANDT#
                                      AND CS116_PST = 'A6'
                                      AND CS116_GND = 'A'
                                      AND CS116_BST &lt;= #DAT#
                                    GROUP BY CS116_PJT, CS116_HNO
                                  ) E1 ON A.PJT = E1.PJT
                                      AND A.HNO = E1.HNO                   
                  LEFT OUTER JOIN (
                                   SELECT CS126_PJT PJT, CS126_HNO HNO, 
                                          MIN(CS126_USD) USD_C, MAX(CS126_UHJ) UHJ_C, MAX(CS126_GNO) GNO_C
                                     FROM SAPHEE.ZCST126
                                    WHERE MANDT = #G_MANDT#
                                      AND CS126_PST = 'A6'
                                      AND CS126_GND = 'C'
                                      AND CS126_DDT = ''
                                      AND CS126_ADT &lt;= #DAT#
                                    GROUP BY CS126_PJT, CS126_HNO
                                  ) E2 ON A.PJT = E2.PJT
                                      AND A.HNO = E2.HNO                                      
       	          LEFT OUTER JOIN (
                                   SELECT CS144_PJT PJT, CS144_HNO HNO, MAX(CS143_FSD) JHD
                                     FROM SAPHEE.ZCST144 A, SAPHEE.ZCST143 B
                                    WHERE A.MANDT = B.MANDT
                                      AND A.CS144_SEQ = B.CS143_SEQ
                                      AND A.MANDT = #G_MANDT#
                                      AND A.CS144_PST = 'A6'
                                      AND B.CS143_FSD &lt;= #DAT#
                                    GROUP BY A.CS144_PJT, A.CS144_HNO
                                  ) B ON A.PJT = B.PJT
                                     AND A.HNO = B.HNO
                  LEFT OUTER JOIN (
                                   SELECT CS172_PJO PJO, CS172_HNO HNO, MAX(CS172_MDT) MDT
                                     FROM SAPHEE.ZCST172
                                    WHERE MANDT = #G_MANDT#
                                    GROUP BY CS172_PJO, CS172_HNO
                                  ) D ON A.PJT = D.PJO
                                     AND A.HNO = D.HNO
                  LEFT OUTER JOIN SAPHEE.ZWBT010 ZWBT
                               ON ZWBT.MANDT = A.MANDT
                              AND ZWBT.LGORT = A.BSU                   
                  INNER JOIN SAPHEE.ZCST126 E3
                          ON E3.MANDT = #G_MANDT#
                         AND A.PJT = E3.CS126_PJT
                         AND A.HNO = E3.CS126_HNO
                         AND E3.CS126_PST = 'A6'
                         AND E3.CS126_GND = 'D'
                         AND E3.CS126_DDT = ''
                         AND E3.CS126_USD = A.USDM
                         AND E3.CS126_ADT &lt;= #DAT#
                  INNER JOIN SAPHEE.ZCST121 E4
                          ON E4.MANDT = #G_MANDT#
                         AND E3.CS126_UPN = E4.CS121_UPN
                         AND E3.CS126_CST = E4.CS121_CST,
                  SAPHEE.ZCST111 F INNER JOIN SAPHEE.ZMASTER01 G
                                           ON F.MANDT = G.MANDT
                                          AND F.PJT = G.POSID
                                   INNER JOIN SAPHEE.ZMASTER02 H
                                           ON F.MANDT = H.MANDT
                                          AND F.PJT = H.POSID
                                          AND F.PJT||F.HNO = H.POSID_1
                                   LEFT OUTER JOIN SAPHEE.ZLCODE AS Z ON F.MANDT = Z.MANDT
                                                        AND F.BLD = Z.CODE2
                                                        AND Z.LANG = 'ko'
                                                        AND Z.CODE1 = 'CS123'         
         WHERE A.PJT = F.PJT
           AND A.HNO = F.HNO
           AND F.MANDT = #G_MANDT#
           AND (F.HST &lt;&gt; 'D' OR (F.HST = 'D' AND VALUE(D.PJO,'') > ''))
           AND (VALUE(B.JHD,'') > #DAT# OR VALUE(B.JHD,'') = '' OR A.UHJ > VALUE(B.JHD,''))
           AND (VALUE(D.MDT,'') > #DAT# OR VALUE(D.MDT,'') = '')
           AND (VALUE(E.BMT_B,'') &lt;= A.UHJ)
<isNotNull col="PJT">
           AND F.PJT = #PJT#
</isNotNull>
<isNotNull col="ARA">
           AND F.ARA = #ARA#
</isNotNull>
<isNotNull col="BSU">
           AND F.BSU = #BSU#
</isNotNull>
<isNotNull col="BPM">
           AND F.BPM = #BPM#
</isNotNull>
<isNotNull col="TEM">
           AND ZWBT.VKGRP = #TEM#
</isNotNull>              
       ) A
WITH UR	</statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_list">
	</output>
</query>
