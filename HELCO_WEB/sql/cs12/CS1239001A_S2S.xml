<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>


SELECT
	A.ISD
	,A.AGEK
	,A.PJT
	,A.HNO
	,A.VKGRP
	,A.ZSPEC2
	,A.ZSPEC12
	,A.ZSPEC3
	,A.ZSPEC7
	,A.ABG
	,A.BLD
	,A.GBU
	,A.CNT
	,A.USD
	,A.GKD
	,A.AMT
	,A.HMT
	,VALUE(A.AMT_TOT, 0) AMT_TOT
	,VALUE(A.PRE_AMT, 0) PRE_AMT
	,A.DMT
	,A.HEP
	,A.KND
	,A.DND
	,A.HWR
	,A.HFR
	,A.ACD_N
	,A.UMS
	,A.GYN
	,A.CNT_A
	,LPAD(A.CNT_A,2,'0') AS CS507_GUBUN
	,A.ACMT -- 공기청정기 추가 20200515 Han.JH
	,A.ACND -- 공기청정기 추가 20200515 Han.JH
	,'' AS SRG
	,'' AS SRG_CD
	,'' AS SEG
	,'' AS SEG_CD
	,'' AS STO
	,'' AS F1
	,'' AS F2
	,'' AS F3
	,'' AS F4
	,'' AS F5
	,'' AS F6
	,'' AS F7
	,'' AS F8
	,'' AS F9
	,'' AS F10
	,'' AS P1
	,'' AS P2
	,'' AS P3
	,'' AS P4
	,'' AS P5
	,'' AS P6
	,'' AS P7
	,'' AS P8
	,'' AS P9
	,'' AS P10
	,'' AS STD1
	,'' AS STD2
	,'' AS STD3
	,'' AS STD4
	,'' AS STD5
	,'' AS STD6
	,'' AS STD7
	,'' AS ITEM1
	,'' AS ITEM2
	,'' AS ITEM3
	,'' AS ITEM4
	,'' AS ITEM5
	,'' AS ITEM6
	,'' AS ITEM7
	,'' AS ITEM8
	,'' AS ITEM9
	,'' AS CS512_RAT
	FROM(
	SELECT
	C.CS101_ISD AS ISD
	,SAPHEE.get_days(DECODE(C.CS101_ISD,'','19991231',C.CS101_ISD),A.CS126_USD)/365
	AS AGEK
	,B.PJT AS PJT
	,B.HNO AS HNO
	,E.VKGRP AS VKGRP
	,D.ZSPEC2 AS ZSPEC2
	,D.ZSPEC12 AS ZSPEC12
	,D.ZSPEC3 AS ZSPEC3
	,D.ZSPEC7 AS ZSPEC7
	,B.ABG AS ABG
	,B.BLD AS BLD
	,B.GBU AS GBU
	,(SELECT COUNT(*) FROM SAPHEE.ZMASTER02 WHERE MANDT = A.MANDT AND POSID =
	A.CS126_PJT AND SUBSTR(POSID_1,7,1) IN ('L','S','W'))AS CNT

	,A.CS126_USD AS USD
	,A.CS126_GKD AS GKD
	,A.CS126_AMT AS AMT
	,A.CS126_HMT AS HMT
	,CASE WHEN A.CS126_DCE = 'Y' THEN 0 ELSE A.CS126_DMT END AS DMT
	,A.CS126_AMT + A.CS126_AMBT + A.CS126_HMT + A.CS126_DMT + A.CS126_ACMT AS AMT_TOT
	-- 현재단가 총계
	,(SELECT
	CS126_AMT + CS126_AMBT + CS126_HMT + CS126_DMT + CS126_ACMT
	FROM SAPHEE.ZCST126
	WHERE MANDT = '183'
	AND CS126_DDT = ''
	AND CS126_PST = 'A6'
	AND CS126_GND = 'D'
	AND CS126_PJT = B.PJT
	AND CS126_HNO = B.HNO
	AND CS126_USD &lt; A.CS126_USD
	ORDER BY CS126_USD DESC
	FETCH FIRST 1 ROW ONLY ) AS PRE_AMT -- 이전 계약단가
	,A.CS126_HEP AS HEP
	,A.CS126_KND AS KND
	,A.CS126_DND AS DND
	,A.CS126_HWR AS HWR -- 유무선
	,A.CS126_HFR AS HFR -- HRTS 무상
	,(
	SELECT
	VALUE(MAX(VALUE),'')
	FROM
	SAPHEE.ZSDT0005
	WHERE
	MANDT = A.MANDT
	AND HOGI = A.CS126_PJT || A.CS126_HNO
	AND CHARACTERISTIC = 'EL_ACD2'
	) AS ACD_N

	,SAPHEE.MONTH_BETWEEN(A.CS126_RGS,A.CS126_RMR,2) AS UMS

	,VALUE((SELECT CASE WHEN F.POSID IS NOT NULL THEN 'Y' ELSE 'N' END GYN
	FROM SAPHEE.ZMASTER02 AS F
	WHERE MANDT = #G_MANDT#
	AND SUBSTR(POSID_1,7,1) = 'T'
	AND POSID = A.CS126_PJT
	GROUP BY MANDT, POSID),'N') AS GYN
	,COUNT(A.MANDT) OVER() AS CNT_A
	,A.CS126_ACMT AS ACMT -- 공기청정기 추가 20200515 Han.JH
	,A.CS126_ACND AS ACND -- 공기청정기 추가 20200515 Han.JH
	FROM SAPHEE.ZCST126 AS A INNER JOIN SAPHEE.ZCST111 AS B
	ON B.MANDT = A.MANDT
	AND B.PJT = A.CS126_PJT
	AND B.HNO = A.CS126_HNO

	LEFT OUTER JOIN SAPHEE.ZCST101 AS C
	ON C.MANDT = A.MANDT
	AND C.CS101_PJT = A.CS126_PJT
	AND C.CS101_HNO = A.CS126_HNO

	LEFT OUTER JOIN SAPHEE.ZMASTER02 AS D
	ON D.MANDT = A.MANDT
	AND D.POSID = A.CS126_PJT
	AND D.POSID_1 = A.CS126_PJT||A.CS126_HNO

	LEFT OUTER JOIN SAPHEE.ZWBT010 AS E
	ON E.MANDT = A.MANDT
	AND E.LGORT = A.CS126_BSU



	WHERE A.MANDT = #G_MANDT#
	AND A.CS126_DDT = ''
	AND A.CS126_PST = 'A5'
	AND A.CS126_UPN = #CS126_UPN#
	AND A.CS126_CST = #CS126_CST#
	AND A.CS126_UGS = #CS126_UGS#

	) AS A
	WITH UR                   		
 
  	</statement>
	<input default-name="ds_list">
	</input>
	<output default-name="none">
	</output>
</query>
