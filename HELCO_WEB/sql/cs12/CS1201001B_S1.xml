<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
    <type>select</type>
    <description><![CDATA[]]></description>
    <reload>true</reload>
    <monitoring>true</monitoring>
    <result-count>1</result-count>
    <statement>
SELECT
       CS122C.CHK,
       CS122C.FLAG,
       CS122C.UPN,
       CS122C.CST,
       CS122C.PJT,
       CS122C.HNO,
       CS122C.SEQ,
       CS122C.BSU,
       CS122C.BSU_NM,
       CS122C.FSD,
       CS122C.CCG,
       CS122C.EXP,
       CS122C.CS2,
       CS122C.IS2, 
       CS122C.BPM,
       CS122C.HNA,
       CS122C.ZSPEC,
       CS122C.ZSPEC1,
       CS122C.ZSPEC2,
       CS122C.ZSPEC3,
       CS122C.USD,
       CS122C.ADT,
       CS122C.UGS,
       CASE WHEN CS122C.USD = CS122C.UGS THEN 'Y' ELSE 'N' END SGBN, <!--승인용-->
       CS122C.UMR,
       CS122C.UHJ,
       CS122C.UMS,<!--승인용-->
       CS122C.AMT,
       CS122C.VAT,
       CS122C.TOT,
       CS122C.AMBT,
       CS122C.VABT,
       CS122C.TOBT,
       CS122C.AMTT,
       CS122C.VATT,
       CS122C.TOTT,
       CS122C.ORG_AMT,
       CS122C.ORG_VAT,
       CS122C.ORG_TOT,
       CS122C.ORG_AMBT,
       CS122C.ORG_VABT,
       CS122C.ORG_TOBT,
       CS122C.ORG_AMTT,
       CS122C.ORG_VATT,
       CS122C.ORG_TOTT,
       CS122C.ORG_BJG,
       CS122C.ORG_USD,
       CS122C.ORG_KND_YN,
       CS122C.GKD,
       SAPHEE.CODE_CONV(CAST(#G_MANDT# AS VARCHAR(3)),'CS130',CS122C.GKD) GKD_NM,
       '' T_GKD,
       CS122C.BGB,
       CS122C.RIV BJG,
       CS122C.RDT TIS,
       CS122C.JKH,
       CS122C.YYB,
       CS122C.ZER,
       CS122C.SLA,
       CS122C.SLR,
       CS122C.CYN,
       CS122C.CTP,
       CS122C.ETC,
       CS122C.ETCBG,
       CS122C.CSE,
       CS122C.RMK,
       CS122C.HMT,  --HRTS
       CS122C.DMT,  --DI-PBX
       CS122C.HYN,  --HRTS
       CS122C.HEP,  --HRTS
       CS122C.DYN,  --DI-PBX
       CS122C.DND,  --DI-PBX
       CS122C.DCE,  --DI-PBX
       (CS122C.AMT+CS122C.HMT+CS122C.DMT+CS122C.ACMT) SUT,  --소계 
       CS122C.ARA,
       CS122C.ARA_NM,
       CS122C.HTY,
       CS122C.AGB,
       CS122C.AGB_NM,
       CS122C.ABG,
       CS122C.ABG_NM,
       CS122C.RGB,
       CS122C.KND_YN,
       CS122C.KND,
       CS122C.KND_NM,
       CS122C.IYN,
       CS122C.GND,
       CS122C.JUJ,
       CS122C.BUJ,
       CS122C.GBU,
       CS122C.HST,
       CS122C.RTO,
       CS122C.JUJ_NM,
       CS122C.BUJ_NM,
       CS122C.PST,
       MAX(CS122C.MCHK) MCHK,
       CS122C.FMY,
       CS122C.FMS,
       CS122C.CRS,
       (SELECT CTEXT2 FROM SAPHEE.ZLCODE WHERE MANDT = #G_MANDT# AND CODE1 = 'CS180' AND CODE2 = CS122C.CRS AND LANG = #G_LANG#) CRS_NM,
       CS122C.WIL,<!--승인용-->
       CS122C.GBM,<!--승인용-->
       '' PRO,
       '' TYP,
       '' CGB,
       '' MMN,
       '' GBN,
       '' WYB,
       '' REQ,
       '' BHD,
       '' MYT,
       '' SQL_FLAG,
       '' MANDT,
       '1' CHK_QUERY,
       '' MAXSEQ,
       '' GRP,<!--승인용-->
       CS122C.HWR,  
       CS122C.CFG,  
       CS122C.SID,
       CS122C.ZMAN,
       CS122C.CBN,
       CS122C.DIF,
       (SELECT USERNAME FROM SAPHEE.ZUSERF WHERE MANDT = #G_MANDT# AND USERNUMB = CS122C.SID ) SNAME,   
       CS122C.LTC,
       CS122C.LTY,
       CS122C.LTS,
       CS122C.FCM,
       CS122C.RGS,
       CS122C.RMR,
       CS122C.GYB,
       CS122C.SIR,
       CS122C.DNO,
       CS122C.DOC,
       CS122C.REDPT1,
       CS122C.APSTAT,
       CAST(#GNO# AS VARCHAR(15)) GNO,
       0  AS P10,
       0  AS F10,
       VALUE(STDAMT,0) AS STDAMT,
       VALUE(PREAMT,0) AS PREAMT,
       VALUE(TRT,0) AS TRT,
       VALUE(SEG,'') AS SEG,
       '' AS DAT,
       CS122C.BDGBN,
       CS122C.ACMT, -- 공기청정기 공급가액
       CS122C.ACYN, -- 공기청정기 임대여부
       CS122C.ACND,  -- 공기청정기 종류
       
       CS122C.DISCRULE --전결규정 관련 추가
  FROM
       (
        SELECT
               CS122B.CHK,
               CS122B.FLAG,
               CS122B.UPN,
               CS122B.CST,
               CS122B.PJT,
               CS122B.HNO,
               CS122B.SEQ,
               CS122B.BSU,
               CS122B.BSU_NM,
               CS122B.FSD,
               CS122B.CCG,
               CS122B.EXP,
               CS122B.CS2,
               CS122B.IS2,
               CS122B.BPM,
               CS122B.HNA,
               CS122B.ZSPEC,
               CS122B.ZSPEC1,
               CS122B.ZSPEC2,
               CS122B.ZSPEC3,
               CS122B.USD,
               CS122B.ADT,
               CS122B.UGS,
               CS122B.UMR,
               CS122B.UHJ,
               CS122B.UMS,<!--승인용-->
               CS122B.AMT,
               CS122B.VAT,
               CS122B.TOT,
               CS122B.AMBT,
               CS122B.VABT,
               CS122B.TOBT,
               CS122B.AMTT,
               CS122B.VATT,
               CS122B.TOTT,
               CS122B.ORG_AMT,
               CS122B.ORG_VAT,
               CS122B.ORG_TOT,
               CS122B.ORG_AMBT,
               CS122B.ORG_VABT,
               CS122B.ORG_TOBT,
               CS122B.ORG_AMTT,
               CS122B.ORG_VATT,
               CS122B.ORG_TOTT,
               CS122B.ORG_BJG,
               CS122B.ORG_USD,
               CS122B.ORG_KND_YN,
               CS122B.GKD,
               CS122B.BGB,
               CS122B.RIV,
               CS122B.RDT,
               CS122B.JKH,
               CS122B.YYB,
               CS122B.ZER,
               CASE WHEN CS122B.SLA > '' THEN CS122B.SLA ELSE 'N' END SLA,
               CS122B.SLR,
               CS122B.CYN,
               CS122B.CTP,
               CS122B.ETC,
               CS122B.ETCBG,
               CS122B.CSE,
               CS122B.RMK,
               CS122B.HMT,  --HRTS
               CS122B.DMT,  --DI-PBX
               CASE WHEN CS122B.HYN = 'Y' THEN '1' ELSE '0' END HYN,    --HRTS
               CS122B.HEP,  --HRTS
               CASE WHEN CS122B.DYN = 'Y' THEN '1' ELSE '0' END DYN,    --DI-PBX
               CS122B.DND,  --DI-PBX
               CASE WHEN CS122B.DCE = 'Y' THEN '1' ELSE '0' END DCE,    --DI-PBX

               CS122B.ARA,
               CS122B.ARA_NM,
               CASE WHEN CS122B.USD &lt;&gt; '' THEN CS122B.HTY1 ELSE CS122B.HTY2 END HTY,
               CS122B.AGB2 AGB,
               CS122B.AGB_NM2 AGB_NM,
               CS122B.ABG2 ABG,
               CS122B.ABG_NM2 ABG_NM,
               CASE WHEN CS122B.RGB = 'Y' OR SUBSTR(CS122B.HNO,1,1) = 'J' OR SUBSTR(CS122B.HNO,1,1) = 'G' OR SUBSTR(CS122B.HNO,1,1) = 'S' THEN '1' ELSE '0' END RGB,
               CASE WHEN CS122B.KND > '' THEN '1' ELSE '0' END KND_YN,
               CS122B.KND,
               CS122B.KND_NM,
               CASE WHEN CS122B.IYN = 'Y' THEN '1' ELSE '0' END IYN,
               CS122B.GND,
               CS122B.JUJ,
               CS122B.BUJ,
               CS122B.GBU,
               CS122B.HST,
               CASE 
                    WHEN SUBSTR(CS122B.HNO,1,1) = 'J' THEN 60
                    WHEN SUBSTR(CS122B.HNO,1,1) = 'G' THEN 0
                    WHEN SUBSTR(CS122B.HNO,1,1) = 'S' THEN 64.2
                    WHEN SUBSTR(CS122B.HNO,1,1) = 'W' THEN 64.2
                    ELSE CS122B.RTO
               END RTO,
               CS122B.JUJ_NM,
               CS122B.BUJ_NM,
               CS122B.PST,
               CS122B.WIL,<!--승인용-->
               CS122B.GBM,<!--승인용-->
               CS122B.FMY,
               CS122B.FMS,
               CS122B.CRS,
               CS122B.HWR,
               CS122B.CFG,
               CS122B.SID,
               CS122B.ZMAN,
               CS122B.CBN,
               CS122B.DIF,
               CASE WHEN CS122B.LTC = 'Y' THEN '1' ELSE '0' END  LTC,
               CS122B.LTY,
               CS122B.LTS,
               CS122B.FCM,
               CS122B.RGS,
               CS122B.RMR,
               CS122B.GYB,
               CS122B.SIR,
               CS122B.DNO,
               CS122B.DOC,
               CS122B.REDPT1,
               CS122B.APSTAT,
               CS122B.DISCRULE, --전결규정 관련 추가 
               CS122B.STDAMT,
               CS122B.PREAMT,
               CS122B.TRT,
               CS122B.SEG,
               CS122B.BDGBN,
               CS122B.ACMT, -- 공기청정기 공급가액
               CASE WHEN CS122B.ACYN = 'Y' THEN '1' ELSE '0' END ACYN,    --공기청정기 임대여부
               CS122B.ACND,  -- 공기청정기 종류             
                               
<isNotNull col="USD">
               --CASE WHEN CS122B.MPT >= #USD# OR CS122B.MYT >= #USD# THEN 'Y' ELSE 'N' END MCHK
               'N' MCHK
</isNotNull>
<isEqual col="USD" value="">
               'N' MCHK
</isEqual>
          FROM
               (
                SELECT
                       '' CHK,
                       '' FLAG,
                       CS122A.CS122_UPN UPN,
                       CS122A.CS122_CST CST,
                       CS122A.CS122_PJT PJT,
                       CS122A.CS122_HNO HNO,
                       CS126D.SEQ,
                       CS111A.BSU,
                       MM005B.NAME1 BSU_NM,
                       CS111A.FSD,
                       CS111A.EXP,
                       CS111A.CS2,
                       CS111A.IS2,
                       CS111A.BPM,
                       CS111A.MPT,
                       CS111A.MYT,
                       CS111A.CCG,
                       CS101B.HNA,
                       MASTER02A.ZSPEC2,
                       CASE
                            WHEN SUBSTR(CS122A.CS122_HNO,7,1) = 'G' THEN MASTER02A.ZSPEC10
                            WHEN SUBSTR(CS122A.CS122_HNO,7,1) = 'J' THEN MASTER02A.ZSPEC9
                            ELSE '0'
                       END ZSPEC,
                       MASTER02A.ZSPEC1,
                       MASTER02A.ZSPEC3,
                       CS126D.USD,
                       CS126D.ADT,
                       CS126D.UGS,
                       CS126D.UMR,
                       CS126D.UHJ,
                       CS126D.UMS,<!--승인용-->
                       CS126D.AMT,
                       CS126D.VAT,
                       CS126D.TOT,
                       CS126D.AMBT,
                       CS126D.VABT,
                       CS126D.TOBT,
                       CS126D.AMTT,
                       CS126D.VATT,
                       CS126D.TOTT,
                       CS126N.ORG_AMT,
                       CS126N.ORG_VAT,
                       CS126N.ORG_TOT,
                       CS126N.ORG_AMBT,
                       CS126N.ORG_VABT,
                       CS126N.ORG_TOBT,
                       CS126N.ORG_AMTT,
                       CS126N.ORG_VATT,
                       CS126N.ORG_TOTT,
                       CS121A.CS121_RIV ORG_BJG,
                       CS126N.ORG_USD,
                       CS126N.ORG_KND_YN,
                       CS126D.GKD,
                       CS121A.CS121_BGB BGB,
                       CS121A.CS121_RIV RIV,
                       CS121A.CS121_RDT RDT,
                       CS126D.JKH,
                       CS126D.YYB,
                       CS121A.CS121_JZR ZER,
                       CS126D.SLA,
                       CS126D.SLR,
                       CS126D.CYN,
                       CS126D.CTP,
                       CS126D.ETC,
                       CS126D.ETCBG,
                       CS126D.CSE,
                       CS126D.RMK,
                       CS126D.HMT,  --HRTS
                       CS126D.DMT,  --DI-PBX
                       CS126D.HYN,  --HRTS
                       CS126D.HEP,  --HRTS
                       CS126D.DYN,  --DI-PBX
                       CS126D.DND,  --DI-PBX
                       CS126D.DCE,  --DI-PBX
                       CS101B.ARA,
                       CS101B.ARA_NM,
                       CS126D.HTY HTY1,
                       CASE WHEN DECODE(MASTER02A.ZSPEC3, '' , 0, MASTER02A.ZSPEC3) &gt;= INT(CS101B.HTY) THEN 'Y' ELSE 'N' END HTY2,
                       CS126D.AGB AGB1,
                       CS126D.AGB_NM AGB_NM1,
                       CS101B.AGB AGB2,
                       CS101B.AGB_NM AGB_NM2,
                       CS126D.ABG ABG1,
                       CS126D.ABG_NM ABG_NM1,
                       CS101B.ABG ABG2,
                       CS101B.ABG_NM ABG_NM2,
                       CS126D.RGB,
                       CS126D.KND,
                       CS126D.KND_NM,
                       CS126D.IYN,
                       CS126D.GND,
                       CS111A.JUJ,
                       CS111A.BUJ,
                       CS111A.GBU,
                       CS111A.HST,
                       VALUE(CS126D.RTO, 0) RTO,
                       TBCSB1A.CCSB1EPN JUJ_NM,
                       TBCSB1B.CCSB1EPN BUJ_NM,
                       CS126D.PST,
                       CS126D.WIL,<!--승인용-->
                       CS126D.GBM,<!--승인용-->
                       CS126D.FMY,
                       CS126D.FMS,
                       CS126D.CRS,
                       CS126D.HWR,
                       CS126D.CFG,
                       CS126D.SID,
                       CS126D.ZMAN,
                       CS126D.CBN,
                       CS126D.DIF,
                       CS126D.LTC,
                       CS126D.LTY,
                       CS126D.LTS,
                       CS126D.FCM,
                       CS126D.RGS,
                       CS126D.RMR,
                       CS126D.GYB,
                       CS126D.SIR,
                       CS126D.DNO,
                       CS126D.DOC,
                       CS126D.REDPT1,
                       CS126D.APSTAT,
                       CS126D.STDAMT,
                       CS126D.PREAMT,
                       CS126D.TRT,
                       CS126D.SEG,
                       CS126D.BDGBN,
                       CS126D.ACMT, -- 공기청정기 공급가액
                       CS126D.ACYN, -- 공기청정기 임대여부
                       CS126D.ACND,  -- 공기청정기 종류
                       
                       CS126D.DISCRULE --전결규정 관련 추가                         
                  FROM
                       SAPHEE.ZCST122 CS122A
                              LEFT OUTER JOIN (
                                               SELECT
                                                      CS126C.MANDT,
                                                      CS126C.CS126_UPN UPN,
                                                      CS126C.CS126_CST CST,
                                                      CS126C.CS126_PJT PJT,
                                                      CS126C.CS126_HNO HNO,
                                                      CS126C.CS126_SEQ SEQ,
                                                      COALESCE(CS126C.CS126_USD,'') USD,
                                                      COALESCE(CS126C.CS126_ADT,'') ADT,
                                                      COALESCE(CS126C.CS126_UGS,'') UGS,
                                                      COALESCE(CS126C.CS126_UMR,'') UMR,
                                                      COALESCE(CS126C.CS126_UHJ,'') UHJ,
                                                      COALESCE(CS126C.CS126_UMS,0) UMS,<!--승인용-->
                                                      CS126C.CS126_GKD GKD,
                                                      CS126C.CS126_JKH JKH,
                                                      CS126C.CS126_YYB YYB,
                                                      CS126C.CS126_ZER ZER,
                                                      CS126C.CS126_SLA SLA,
                                                      CS126C.CS126_SLR SLR,
                                                      CASE WHEN VALUE(CS126C.CS126_CYN, '') = '' THEN 'N'
                                                           WHEN VALUE(CS126C.CS126_CYN, '') = 'N' THEN 'N'
                                                           ELSE 'Y'
                                                      END CYN,
                                                      CS126C.CS126_CTP CTP,
                                                      CS126C.CS126_ETC ETC,
                                                      CS126C.CS126_ETCBG ETCBG,
                                                      CASE WHEN VALUE(CS126C.CS126_CSE, '') = '' THEN 'N'
                                                           WHEN VALUE(CS126C.CS126_CSE, '') = 'N' THEN 'N'
                                                           ELSE 'Y'
                                                      END CSE,
                                                      CS126C.CS126_RMK1||CS126C.CS126_RMK2 RMK,
                                                      COALESCE(CS126C.CS126_AMT,0) AMT,
                                                      COALESCE(CS126C.CS126_VAT,0) VAT,
                                                      COALESCE(CS126C.CS126_TOT,0) TOT,
                                                      COALESCE(CS126C.CS126_AMBT,0) AMBT,
                                                      COALESCE(CS126C.CS126_VABT,0) VABT,
                                                      COALESCE(CS126C.CS126_TOBT,0) TOBT,
                                                      COALESCE(CS126C.CS126_AMT,0) + COALESCE(CS126C.CS126_AMBT,0) AS AMTT,
                                                      COALESCE(CS126C.CS126_VAT,0) + COALESCE(CS126C.CS126_VABT,0) AS VATT,
                                                      COALESCE(CS126C.CS126_TOT,0) + COALESCE(CS126C.CS126_TOBT,0) AS TOTT,
                                                      COALESCE(CS126C.CS126_HMT,0) HMT,
                                                      COALESCE(CS126C.CS126_DMT,0) DMT,
                                                      COALESCE(CS126C.CS126_HYN,'N') HYN,
                                                      COALESCE(CS126C.CS126_HEP,'' ) HEP,
                                                      COALESCE(CS126C.CS126_DYN,'N') DYN,
                                                      COALESCE(CS126C.CS126_DND,'' ) DND,
                                                      COALESCE(CS126C.CS126_DCE,'N') DCE,
                                                      CS126C.CS126_HTY HTY,
                                                      CS126C.CS126_AGB AGB,
                                                      MM028A.CTEXT2 AGB_NM,
                                                      CS126C.CS126_ABG ABG,
                                                      MM028B.CTEXT2 ABG_NM,
                                                      COALESCE(CS126C.CS126_RGB,'') RGB,
                                                      COALESCE(CS126C.CS126_KND,'') KND,
                                                      COALESCE(MM028C.CTEXT2,'') KND_NM,
                                                      COALESCE(CS126C.CS126_IYN,'') IYN,
                                                      CS126C.CS126_GND GND,
                                                      CS126C.CS126_PST PST,
                                                      CS126C.CS126_RTO RTO,
                                                      CS126C.CS126_WIL WIL,<!--승인용-->
                                                      CS126C.CS126_GBM GBM,<!--승인용-->
                                                      '' JUJ,
                                                      '' BUJ,
                                                      COALESCE(CS126C.CS126_FMY,'') FMY,
                                                      COALESCE(CS126C.CS126_FMS,'') FMS,
                                                      COALESCE(CS126C.CS126_CRS,'') CRS,
                                                      COALESCE(CS126C.CS126_HWR,'') HWR,
                                                      COALESCE(CS126C.CS126_CFG,'') CFG,
                                                      COALESCE(CS126C.CS126_SID,'') SID,
                                                      COALESCE(CS126C.CS126_ZMAN,'') ZMAN,
                                                      COALESCE(CS126C.CS126_GBN,'') CBN,
                                                      COALESCE(CS126C.CS126_DIF,0) DIF,
                                                      COALESCE(CS126C.CS126_LTC,'') LTC,
                                                      COALESCE(CS126C.CS126_LTY,'') LTY,
                                                      COALESCE(CS126C.CS126_LTS,'') LTS,
                                                      COALESCE(CS126C.CS126_FCM,'') FCM,
                                                      COALESCE(CS126C.CS126_RGS,'') RGS,
                                                      COALESCE(CS126C.CS126_RMR,'') RMR,
                                                      COALESCE(CS126C.CS126_GYB,'') GYB, <!-- 자동계약여부 -->
                                                      COALESCE(CS126C.CS126_SIR,'') SIR, <!-- 견적번호차수 : 견적을 통해 생성한 계약인 경우 -->
                                                      COALESCE(CS126C.CS126_DNO,'') DNO, <!-- 전자결재번호 -->
                                                      COALESCE(CS126C.CS126_DOC,'') DOC, <!-- 문서관리번호 -->
                                                      H.REDPT1 REDPT1, <!-- 수신부서 -->
                                                      VALUE(H.APSTAT, '0') APSTAT, <!-- 전자결재상태 -->
                                                      COALESCE(CS126C.CS126_STDAMT,0) STDAMT,
                                                      COALESCE(CS126C.CS126_PREAMT,0) PREAMT,
                                                      COALESCE(CS126C.CS126_TRT,0) TRT,
                                                      COALESCE(CS126C.CS126_SEG,'') SEG,
                                                      DECODE(COALESCE(CS126C.CS126_BDGBN,''),'X','1','') AS BDGBN,
                                                      COALESCE(CS126C.CS126_ACMT,0) ACMT,
                                                      COALESCE(CS126C.CS126_ACYN,'N') ACYN,
                                                      COALESCE(CS126C.CS126_ACND,'' ) ACND,
                                                      
                                                      VALUE(H.DISCRULE, '') AS DISCRULE --전결규정 관련 추가      
                                                  
                                                 FROM
                                                      SAPHEE.ZCST126 CS126C
                                                             LEFT OUTER JOIN SAPHEE.ZWBAP01 H 
                                                                          ON H.MANDT = CS126C.MANDT
                                                                         AND H.DOCNO = CS126C.CS126_DNO
                                                                         AND H.DOCKIND = '4'
                                                             LEFT OUTER JOIN SAPHEE.ZLCODE MM028C ON MM028C.CODE1 = 'CS129' 
                                                                                                 AND CS126C.MANDT = MM028C.MANDT 
                                                                                                 AND CS126C.CS126_KND = MM028C.CODE2
                                                                                                 AND MM028C.LANG = #G_LANG#,
                                                      (
                                                       SELECT
                                                              CS126A.MANDT,
                                                              CS126A.CS126_UPN UPN,
                                                              CS126A.CS126_CST CST,
                                                              CS126A.CS126_PJT PJT,
                                                              CS126A.CS126_HNO HNO,
                                                              CS126A.CS126_SEQ SEQ
                                                         FROM
                                                              SAPHEE.ZCST126 CS126A
                                                        WHERE
                                                              CS126A.MANDT = #G_MANDT#
                                                          AND CS126A.CS126_UPN = #UPN#
                                                          AND CS126A.CS126_CST = #CST#
<isNotNull col="ARA">
                                                          AND CS126A.CS126_ARA = #ARA#
</isNotNull>
                                                          AND CS126A.CS126_GND = 'C'
<isNull col="DOCNO"><!-- 기안을 올린 계약을 삭제했을 경우 결재화면에서 해당 건을  보기 위해 -->
                                                          AND CS126A.CS126_DDT = ''
</isNull>
<isNotNull col="DOCNO"><!-- 기안을 올린 계약을 삭제했을 경우 결재화면에서 해당 건을  보기 위해 -->
                                                          AND CS126A.CS126_DNO = #DOCNO#
</isNotNull>                                                          
                                                          AND CS126A.CS126_GNO = #GNO#
                                                      ) CS126B,
                                                      SAPHEE.ZLCODE MM028A,
                                                      SAPHEE.ZLCODE MM028B
                                                WHERE
                                                      CS126C.MANDT = CS126B.MANDT
                                                  AND CS126C.MANDT = MM028A.MANDT
                                                  AND CS126C.MANDT = MM028B.MANDT
                                                  AND CS126C.CS126_UPN = CS126B.UPN
                                                  AND CS126C.CS126_CST = CS126B.CST
                                                  AND CS126C.CS126_PJT = CS126B.PJT
                                                  AND CS126C.CS126_HNO = CS126B.HNO
                                                  AND CS126C.CS126_SEQ = CS126B.SEQ
                                                  AND CS126C.CS126_AGB = MM028A.CODE2
                                                  AND CS126C.CS126_ABG = MM028B.CODE2
                                                  AND MM028A.CODE1 = 'CS116'
                                                  AND MM028B.CODE1 = 'CS112'
                                                  AND MM028A.LANG = #G_LANG#
                                                  AND MM028B.LANG = #G_LANG#
                                              ) CS126D 
                                                LEFT OUTER JOIN (
                                                                 SELECT
                                                                        CS126M.MANDT,
                                                                        CS126M.CS126_UPN UPN,
                                                                        CS126M.CS126_CST CST,
                                                                        CS126M.CS126_PJT PJT,
                                                                        CS126M.CS126_HNO HNO,
                                                                        CS126M.CS126_SEQ SEQ,
                                                                        COALESCE(CS126M.CS126_BJG,'') ORG_BJG,
                                                                        COALESCE(CS126M.CS126_TOT,0) ORG_TOT,
                                                                        COALESCE(CS126M.CS126_AMT,0) ORG_AMT,
                                                                        COALESCE(CS126M.CS126_VAT,0) ORG_VAT,
                                                                        COALESCE(CS126M.CS126_TOBT,0) ORG_TOBT,
                                                                        COALESCE(CS126M.CS126_AMBT,0) ORG_AMBT,
                                                                        COALESCE(CS126M.CS126_VABT,0) ORG_VABT,
                                                                        COALESCE(CS126M.CS126_TOT,0) + COALESCE(CS126M.CS126_TOBT,0) AS ORG_TOTT,
                                                                        COALESCE(CS126M.CS126_AMT,0) + COALESCE(CS126M.CS126_AMBT,0) AS ORG_AMTT,
                                                                        COALESCE(CS126M.CS126_VAT,0) + COALESCE(CS126M.CS126_VABT,0) AS ORG_VATT,
                                                                        COALESCE(CS126M.CS126_USD,'') ORG_USD,
                                                                        CASE WHEN COALESCE(CS126M.CS126_KND,'') > '' THEN '1' ELSE '0' END ORG_KND_YN
                                                                   FROM
                                                                        SAPHEE.ZCST126 CS126M,
                                                                        (
                                                                         SELECT
                                                                                CS126K.MANDT,
                                                                                CS126K.CS126_UPN UPN,
                                                                                CS126K.CS126_CST CST,
                                                                                CS126K.CS126_PJT PJT,
                                                                                CS126K.CS126_HNO HNO,
                                                                                SAPHEE.FILLINZERO(INT(SAPHEE.FILLINZERO(CS126K.CS126_SEQ,1)) - 1, 2) SEQ
                                                                           FROM
                                                                                SAPHEE.ZCST126 CS126K
                                                                          WHERE
                                                                                CS126K.MANDT = #G_MANDT#
                                                                            AND CS126K.CS126_UPN = #UPN#
                                                                            AND CS126K.CS126_CST = #CST#
                  <isNotNull col="ARA">
                                                                            AND CS126K.CS126_ARA = #ARA#
                  </isNotNull>
                                                                            AND CS126K.CS126_GND = 'C'
<isNull col="DOCNO"><!-- 기안을 올린 계약을 삭제했을 경우 결재화면에서 해당 건을  보기 위해 -->
                                                                            AND CS126K.CS126_DDT = ''
</isNull>
<isNotNull col="DOCNO"><!-- 기안을 올린 계약을 삭제했을 경우 결재화면에서 해당 건을  보기 위해 -->
                                                                            AND CS126K.CS126_DNO = #DOCNO#
</isNotNull>                                                          
                                                                            AND CS126K.CS126_GNO = #GNO#
                                                                        ) CS126L
                                                                  WHERE
                                                                        CS126M.MANDT = CS126L.MANDT
                                                                    AND CS126M.CS126_UPN = CS126L.UPN
                                                                    AND CS126M.CS126_CST = CS126L.CST
                                                                    AND CS126M.CS126_PJT = CS126L.PJT
                                                                    AND CS126M.CS126_HNO = CS126L.HNO
                                                                    AND CS126M.CS126_SEQ = CS126L.SEQ
                                                                    AND CS126M.CS126_PST = 'A6'
                                                                ) CS126N ON CS126N.MANDT = CS126D.MANDT
                                                                        AND CS126N.UPN = CS126D.UPN
                                                                        AND CS126N.CST = CS126D.CST
                                                                        AND CS126N.PJT = CS126D.PJT
                                                                        AND CS126N.HNO = CS126D.HNO
                                                                        AND CS126N.SEQ = CS126D.SEQ
                                                        ON CS126D.MANDT = CS122A.MANDT
                                                       AND CS126D.UPN = CS122A.CS122_UPN
                                                       AND CS126D.CST = CS122A.CS122_CST
                                                       AND CS126D.PJT = CS122A.CS122_PJT
                                                       AND CS126D.HNO = CS122A.CS122_HNO
                              LEFT OUTER JOIN (
                                               SELECT
                                                      CS101A.MANDT,
                                                      CS101A.CS101_PJT PJT,
                                                      CS101A.CS101_HNO HNO,
                                                      CS101A.CS101_HNA HNA,
                                                      CS101A.CS101_ARA ARA,
                                                      MM028D.CTEXT2 ARA_NM,
                                                      CS101A.CS101_AGB AGB,
                                                      MM028E.CTEXT2 AGB_NM,
                                                      CS101A.CS101_ABG ABG,
                                                      MM028F.CTEXT2 ABG_NM,
                                                      MM028G.CTEXT2 HTY
                                                 FROM
                                                      SAPHEE.ZCST101 CS101A,
                                                      SAPHEE.ZLCODE MM028D,
                                                      SAPHEE.ZLCODE MM028E,
                                                      SAPHEE.ZLCODE MM028F,
                                                      SAPHEE.ZLCODE MM028G
                                                WHERE
                                                      CS101A.MANDT = #G_MANDT#
                                                  AND CS101A.MANDT = MM028D.MANDT
                                                  AND CS101A.MANDT = MM028E.MANDT
                                                  AND CS101A.MANDT = MM028F.MANDT
                                                  AND CS101A.MANDT = MM028G.MANDT
                                                  AND CS101A.CS101_ARA = MM028D.CODE2
                                                  AND CS101A.CS101_AGB = MM028E.CODE2
                                                  AND CS101A.CS101_ABG = MM028F.CODE2
                                                  AND MM028D.CODE1 = 'CS115'
                                                  AND MM028E.CODE1 = 'CS116'
                                                  AND MM028F.CODE1 = 'CS112'
                                                  AND MM028G.CODE1 = 'CS120'
                                                  AND MM028D.LANG = #G_LANG#
                                                  AND MM028E.LANG = #G_LANG#
                                                  AND MM028F.LANG = #G_LANG#
                                                  AND MM028G.LANG = #G_LANG#
                                                  AND MM028G.CODE2 = 'B4'
                                              ) CS101B ON CS101B.MANDT = CS122A.MANDT
                                                      AND CS101B.PJT = CS122A.CS122_PJT
                                                      AND CS101B.HNO = CS122A.CS122_HNO,
                       SAPHEE.ZCST111 CS111A
                              LEFT OUTER JOIN (
                                               SELECT
                                                      MANDT,
                                                      CCSB1EMP,
                                                      CCSB1EPN
                                                 FROM
                                                      SAPHEE.ZTBCSB1
                                                WHERE
                                                      MANDT = #G_MANDT#
                                                  AND CCSB1RTD = ''
                                              ) TBCSB1A ON TBCSB1A.MANDT = CS111A.MANDT 
                                                       AND TBCSB1A.CCSB1EMP = CS111A.JUJ
                              LEFT OUTER JOIN (
                                               SELECT
                                                      MANDT,
                                                      CCSB1EMP,
                                                      CCSB1EPN
                                                 FROM
                                                      SAPHEE.ZTBCSB1
                                                WHERE
                                                      MANDT = #G_MANDT#
                                                  AND CCSB1RTD = ''
                                              ) TBCSB1B ON TBCSB1B.MANDT = CS111A.MANDT 
                                                       AND TBCSB1B.CCSB1EMP = CS111A.BUJ
                              LEFT OUTER JOIN (
                                               SELECT
                                                      MM005A.MANDT,
                                                      MM005A.LGORT,
                                                      MM005A.LIFNR,
                                                      MM012A.NAME1
                                                 FROM
                                                      SAPHEE.ZMMT005 MM005A,
                                                      SAPHEE.ZMMT012 MM012A
                                                WHERE
                                                      MM005A.MANDT = #G_MANDT#
                                                  AND MM005A.MANDT = MM012A.MANDT
                                                  AND MM005A.LIFNR = MM012A.LIFNR
                                              ) MM005B ON MM005B.MANDT = CS111A.MANDT 
                                                      AND MM005B.LGORT = CS111A.BSU,
                       SAPHEE.ZMASTER02 MASTER02A,
                       SAPHEE.ZCST121 CS121A
                 WHERE
                       CS122A.MANDT = CS111A.MANDT
                   AND CS122A.MANDT = MASTER02A.MANDT
                   AND CS122A.CS122_PJT = CS111A.PJT
                   AND CS122A.CS122_PJT = MASTER02A.POSID
                   AND CS122A.CS122_HNO = CS111A.HNO
                   AND (CS122A.CS122_PJT || CS122A.CS122_HNO) = MASTER02A.POSID_1
                   AND CS122A.MANDT = CS121A.MANDT
                   AND CS122A.CS122_UPN = CS121A.CS121_UPN
                   AND CS122A.CS122_CST = CS121A.CS121_CST
                   AND CS122A.MANDT = #G_MANDT#
                   AND CS122A.CS122_UPN = #UPN#
                   AND CS122A.CS122_CST = #CST#
<isEqual col="JPGBN" value="A">
                   AND SUBSTR(CS122A.CS122_HNO,1,1) IN ('L','S','W')
</isEqual>
<isEqual col="JPGBN" value="B">
                   AND SUBSTR(CS122A.CS122_HNO,1,1) IN ('J')
</isEqual>
<isEqual col="JPGBN" value="C">
                   AND SUBSTR(CS122A.CS122_HNO,1,1) IN ('G')
</isEqual>
<isEqual col="JPGBN" value="D">
                   AND SUBSTR(CS122A.CS122_HNO,1,1) IN ('F')
</isEqual>
               ) CS122B
       ) CS122C
GROUP BY
       CS122C.CHK,
       CS122C.FLAG,
       CS122C.UPN,
       CS122C.CST,
       CS122C.PJT,
       CS122C.HNO,
       CS122C.SEQ,
       CS122C.BSU,
       CS122C.BSU_NM,
       CS122C.FSD,
       CS122C.CCG,
       CS122C.EXP,
       CS122C.CS2,
       CS122C.IS2,
       CS122C.BPM,
       CS122C.HNA,
       CS122C.ZSPEC,
       CS122C.ZSPEC1,
       CS122C.ZSPEC2,
       CS122C.ZSPEC3,
       CS122C.USD,
       CS122C.ADT,
       CS122C.UGS,
       CS122C.UMR,
       CS122C.UHJ,
       CS122C.UMS,<!--승인용-->
       CS122C.AMT,
       CS122C.VAT,
       CS122C.TOT,
       CS122C.AMBT,
       CS122C.VABT,
       CS122C.TOBT,
       CS122C.AMTT,
       CS122C.VATT,
       CS122C.TOTT,
       CS122C.ORG_AMT,
       CS122C.ORG_VAT,
       CS122C.ORG_TOT,
       CS122C.ORG_AMBT,
       CS122C.ORG_VABT,
       CS122C.ORG_TOBT,
       CS122C.ORG_AMTT,
       CS122C.ORG_VATT,
       CS122C.ORG_TOTT,
       CS122C.ORG_BJG,
       CS122C.ORG_USD,
       CS122C.ORG_KND_YN,
       CS122C.GKD,
       CS122C.BGB,
       CS122C.RIV,
       CS122C.RDT,
       CS122C.JKH,
       CS122C.YYB,
       CS122C.ZER,
       CS122C.SLA,
       CS122C.SLR,
       CS122C.CYN,
       CS122C.CTP,
       CS122C.ETC,
       CS122C.ETCBG,
       CS122C.CSE,
       CS122C.RMK,
       CS122C.HMT,
       CS122C.DMT,
       CS122C.HYN,
       CS122C.HEP,
       CS122C.DYN,
       CS122C.DND,
       CS122C.DCE,
       CS122C.ARA,
       CS122C.ARA_NM,
       CS122C.HTY,
       CS122C.AGB,
       CS122C.AGB_NM,
       CS122C.ABG,
       CS122C.ABG_NM,
       CS122C.RGB,
       CS122C.KND_YN,
       CS122C.KND,
       CS122C.KND_NM,
       CS122C.IYN,
       CS122C.GND,
       CS122C.JUJ,
       CS122C.BUJ,
       CS122C.GBU,
       CS122C.HST,
       CS122C.RTO,
       CS122C.JUJ_NM,
       CS122C.BUJ_NM,
       CS122C.PST,
       CS122C.WIL,<!--승인용-->
       CS122C.GBM,<!--승인용-->
       CS122C.FMY,
       CS122C.FMS,
       CS122C.CRS,
       CS122C.HWR,
       CS122C.CFG,
       CS122C.SID,
       CS122C.ZMAN,
       CS122C.CBN,
       CS122C.DIF,
       CS122C.LTC,
       CS122C.LTY,
       CS122C.LTS,
       CS122C.FCM,
       CS122C.RGS,
       CS122C.RMR,
       CS122C.GYB,
       CS122C.SIR,
       CS122C.DNO,
       CS122C.DOC,
       CS122C.REDPT1,
       CS122C.APSTAT,
       CS122C.STDAMT,
       CS122C.PREAMT,
       CS122C.TRT,
       CS122C.SEG,
       CS122C.BDGBN,
       CS122C.ACMT,
       CS122C.ACYN,
       CS122C.ACND,
       
       CS122C.DISCRULE--전결규정 관련 추가
             
ORDER BY SEQ,UPN,PJT,HNO <!-- 계약에 저장되지 않은 리스트를 뒤로 보내기 위해 SEQ 추가 -->
WITH UR </statement>
    <input default-name="ds_cond">
        <col name="G_MANDT" size="255" type="VARCHAR" description="" /> 
        <col name="USD" size="255" type="VARCHAR" description="" /> 
        <col name="G_LANG" size="255" type="VARCHAR" description="" /> 
        <col name="UPN" size="255" type="VARCHAR" description="" /> 
        <col name="CST" size="255" type="VARCHAR" description="" /> 
        <col name="ARA" size="255" type="VARCHAR" description="" /> 
        <col name="GNO" size="255" type="VARCHAR" description="" /> 
        <col name="JPGBN" size="255" type="VARCHAR" description="" /> 
    </input>
    <output default-name="ds_list">
        <col name="ABG" size="3" type="VARCHAR" description="" /> 
        <col name="ABG_NM" size="60" type="VARCHAR" description="" /> 
        <col name="AGB" size="3" type="VARCHAR" description="" /> 
        <col name="AGB_NM" size="60" type="VARCHAR" description="" /> 
        <col name="ARA" size="6" type="VARCHAR" description="" /> 
        <col name="ARA_NM" size="60" type="VARCHAR" description="" /> 
        <col name="BGB" size="3" type="VARCHAR" description="" /> 
        <col name="BHD" size="0" type="VARCHAR" description="" /> 
        <col name="BJG" size="3" type="VARCHAR" description="" /> 
        <col name="BPM" size="30" type="VARCHAR" description="" /> 
        <col name="BSU" size="12" type="VARCHAR" description="" /> 
        <col name="BSU_NM" size="105" type="VARCHAR" description="" /> 
        <col name="BUJ" size="30" type="VARCHAR" description="" /> 
        <col name="BUJ_NM" size="30" type="VARCHAR" description="" /> 
        <col name="CCG" size="3" type="VARCHAR" description="" /> 
        <col name="CGB" size="0" type="VARCHAR" description="" /> 
        <col name="CHK" size="0" type="VARCHAR" description="" /> 
        <col name="CHK_QUERY" size="1" type="VARCHAR" description="" /> 
        <col name="CS2" size="6" type="NUMERIC" description="" /> 
        <col name="CST" size="9" type="VARCHAR" description="" /> 
        <col name="EXP" size="24" type="VARCHAR" description="" /> 
        <col name="FLAG" size="0" type="VARCHAR" description="" /> 
        <col name="FSD" size="24" type="VARCHAR" description="" /> 
        <col name="GBM" size="6" type="VARCHAR" description="" /> 
        <col name="GBN" size="0" type="VARCHAR" description="" /> 
        <col name="GBU" size="3" type="VARCHAR" description="" /> 
        <col name="GKD" size="3" type="VARCHAR" description="" /> 
        <col name="GKD_NM" size="80" type="VARCHAR" description="" /> 
        <col name="GND" size="1" type="VARCHAR" description="" /> 
        <col name="GYB" size="0" type="VARCHAR" description="" /> 
        <col name="HNA" size="90" type="VARCHAR" description="" /> 
        <col name="HNO" size="9" type="VARCHAR" description="" /> 
        <col name="HST" size="9" type="VARCHAR" description="" /> 
        <col name="HTY" size="3" type="VARCHAR" description="" /> 
        <col name="IS2" size="6" type="NUMERIC" description="" /> 
        <col name="IYN" size="1" type="VARCHAR" description="" /> 
        <col name="JKH" size="6" type="NUMERIC" description="" /> 
        <col name="JUJ" size="30" type="VARCHAR" description="" /> 
        <col name="JUJ_NM" size="30" type="VARCHAR" description="" /> 
        <col name="KND" size="3" type="VARCHAR" description="" /> 
        <col name="KND_NM" size="60" type="VARCHAR" description="" /> 
        <col name="KND_YN" size="1" type="VARCHAR" description="" /> 
        <col name="MANDT" size="0" type="VARCHAR" description="" /> 
        <col name="MAXSEQ" size="0" type="VARCHAR" description="" /> 
        <col name="MCHK" size="1" type="VARCHAR" description="" /> 
        <col name="MMN" size="0" type="VARCHAR" description="" /> 
        <col name="MYT" size="0" type="VARCHAR" description="" /> 
        <col name="AMT" size="13" type="NUMERIC" description="" /> 
        <col name="VAT" size="13" type="NUMERIC" description="" /> 
        <col name="TOT" size="13" type="NUMERIC" description="" /> 
        <col name="AMBT" size="13" type="NUMERIC" description="" /> 
        <col name="VABT" size="13" type="NUMERIC" description="" /> 
        <col name="TOBT" size="13" type="NUMERIC" description="" /> 
        <col name="AMTT" size="13" type="NUMERIC" description="" /> 
        <col name="VATT" size="13" type="NUMERIC" description="" /> 
        <col name="TOTT" size="13" type="NUMERIC" description="" /> 
        <col name="ORG_AMT" size="13" type="NUMERIC" description="" /> 
        <col name="ORG_VAT" size="13" type="NUMERIC" description="" /> 
        <col name="ORG_TOT" size="13" type="NUMERIC" description="" /> 
        <col name="ORG_AMBT" size="13" type="NUMERIC" description="" /> 
        <col name="ORG_VABT" size="13" type="NUMERIC" description="" /> 
        <col name="ORG_TOBT" size="13" type="NUMERIC" description="" /> 
        <col name="ORG_AMTT" size="13" type="NUMERIC" description="" /> 
        <col name="ORG_VATT" size="13" type="NUMERIC" description="" /> 
        <col name="ORG_TOTT" size="13" type="NUMERIC" description="" /> 
        <col name="ORG_BJG" size="3" type="VARCHAR" description="" /> 
        <col name="ORG_KND_YN" size="1" type="VARCHAR" description="" /> 
        <col name="ORG_USD" size="24" type="VARCHAR" description="" /> 
        <col name="PJT" size="18" type="VARCHAR" description="" /> 
        <col name="PRO" size="0" type="VARCHAR" description="" /> 
        <col name="PST" size="6" type="VARCHAR" description="" /> 
        <col name="REQ" size="0" type="VARCHAR" description="" /> 
        <col name="RGB" size="1" type="VARCHAR" description="" /> 
        <col name="RMK" size="150" type="VARCHAR" description="" /> 
        <col name="RTO" size="15" type="NUMERIC" description="" /> 
        <col name="SEQ" size="6" type="VARCHAR" description="" /> 
        <col name="SLA" size="3" type="VARCHAR" description="" /> 
        <col name="SQL_FLAG" size="0" type="VARCHAR" description="" /> 
        <col name="T_GKD" size="0" type="VARCHAR" description="" /> 
        <col name="TIS" size="6" type="VARCHAR" description="" /> 
        <col name="TYP" size="0" type="VARCHAR" description="" /> 
        <col name="UGS" size="24" type="VARCHAR" description="" /> 
        <col name="UHJ" size="24" type="VARCHAR" description="" /> 
        <col name="UMR" size="24" type="VARCHAR" description="" /> 
        <col name="UMS" size="0" type="VARCHAR" description="" /> 
        <col name="UPN" size="18" type="VARCHAR" description="" /> 
        <col name="USD" size="24" type="VARCHAR" description="" /> 
        <col name="WIL" size="3" type="VARCHAR" description="" /> 
        <col name="WYB" size="0" type="VARCHAR" description="" /> 
        <col name="YYB" size="3" type="VARCHAR" description="" /> 
        <col name="ZER" size="3" type="VARCHAR" description="" /> 
        <col name="ZSPEC" size="9" type="VARCHAR" description="" /> 
        <col name="ZSPEC1" size="15" type="VARCHAR" description="" /> 
        <col name="ZSPEC2" size="75" type="VARCHAR" description="" /> 
        <col name="ZSPEC3" size="12" type="VARCHAR" description="" /> 
        <col name="BDGBN" size="12" type="VARCHAR" description="" /> 
    </output>
</query>