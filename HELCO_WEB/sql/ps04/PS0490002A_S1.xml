<?xml version="1.0" encoding="euc-kr"?>
<query>
	<type>select</type>
	<description><![CDATA[STO현장 안전 난간대 적용 sql]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>0</result-count>
	<statement>
<![CDATA[
SELECT F.ZZACTSS, F.ACTSS_NM , F.DEPART_NM, F.DEPART , SUM(F.MON01) AS MON01 ,  SUM(F.MON02) AS MON02 ,SUM(F.MON03) AS MON03 ,SUM(F.MON04) AS MON04 ,SUM(F.MON05) AS MON05, SUM(F.MON06) AS MON06 ,
              SUM(F.MON07) AS MON07, SUM(F.MON08) AS MON08,SUM(F.MON09) AS MON09, SUM(F.MON10) AS MON10, SUM(F.MON11) AS MON11,SUM(F.MON12) AS MON12 ,
			    SUM(F.MON01) AS MMON01 ,  SUM(F.MON02) AS MMON02 ,SUM(F.MON03) AS MMON03 ,SUM(F.MON04) AS MMON04 ,SUM(F.MON05) AS MMON05, SUM(F.MON06) AS MMON06 ,
              SUM(F.MON07) AS MMON07, SUM(F.MON08) AS MMON08,SUM(F.MON09) AS MMON09, SUM(F.MON10) AS MMON10, SUM(F.MON11) AS MMON11,SUM(F.MON12) AS MMON12
FROM 
(
SELECT  T1.ZZACTSS, PS.ACTSS_NM , PS.DEPART_NM, PS.DEPART,  SUM(T1.MON01) AS MON01 ,  SUM(T1.MON02) AS MON02 ,SUM(T1.MON03) AS MON03 ,SUM(T1.MON04) AS MON04 ,SUM(T1.MON05) AS MON05, SUM(T1.MON06) AS MON06 ,
              SUM(T1.MON07) AS MON07, SUM(T1.MON08) AS MON08,SUM(T1.MON09) AS MON09, SUM(T1.MON10) AS MON10, SUM(T1.MON11) AS MON11,SUM(T1.MON12) AS MON12 ,
			  0 AS MMON01, 0 AS MMON02 ,0 AS MMON03, 0 AS MMON04 , 0 AS MMON05 , 0 AS MMON06 , 0 AS MMON07 ,0 AS MMON08 , 0 AS MMON09 , 0 AS MMON10 , 0 AS MMON11 , 0 AS MMON12
 FROM
(
SELECT     A.MANDT, A.ZZACTSS,  (CASE WHEN SUBSTR(A.CONTR_DA,1,6) = #YEARF# || '01' THEN  1 ELSE 0 END) AS MON01,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '02'THEN  1 ELSE 0 END) AS MON02,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '03' THEN  1 ELSE 0 END) AS MON03,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '04'THEN  1 ELSE 0 END) AS MON04,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '05'THEN  1 ELSE 0 END) AS MON05,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '06'THEN  1 ELSE 0 END) AS MON06,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '07'THEN  1 ELSE 0 END) AS MON07,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '08'THEN  1 ELSE 0 END) AS MON08,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '09'THEN  1 ELSE 0 END) AS MON09,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '10'THEN  1 ELSE 0 END) AS MON10,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '11'THEN  1 ELSE 0 END) AS MON11,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '12'THEN  1 ELSE 0 END) AS MON12





FROM SAPHEE.ZMASTER01 AS A	  
WHERE A.MANDT = #G_MANDT#
     AND  SUBSTR(A.CONTR_DA,1,4) = #YEARF#
	AND  A.ZQNTY <= 2
	AND A.ZZACTSS <> ''
	
	) AS T1
	
	
	LEFT OUTER JOIN SAPHEE.ZPST0000 AS PS
	  ON PS.MANDT = T1.MANDT
	  AND PS.ACTSS = T1.ZZACTSS
	  
	  
	GROUP BY T1.ZZACTSS , PS.ACTSS_NM , PS.DEPART_NM, PS.DEPART


UNION ALL

SELECT  T1.ZZACTSS, PS.ACTSS_NM , PS.DEPART_NM, PS.DEPART,  SUM(T1.MON01) AS MMON01 ,  SUM(T1.MON02) AS MMON02 ,SUM(T1.MON03) AS MMON03 ,SUM(T1.MON04) AS MMON04 ,SUM(T1.MON05) AS MMON05, SUM(T1.MON06) AS MMON06 ,
              SUM(T1.MON07) AS MMON07, SUM(T1.MON08) AS MMON08,SUM(T1.MON09) AS MMON09, SUM(T1.MON10) AS MMON10, SUM(T1.MON11) AS MMON11,SUM(T1.MON12) AS MMON12,
			  0 AS MON01, 0 AS MON02 ,0 AS MON03, 0 AS MON04 , 0 AS MON05 , 0 AS MON06 , 0 AS MON07 ,0 AS MON08 , 0 AS MON09 , 0 AS MON10 , 0 AS MON11 , 0 AS MON12
FROM
(
SELECT     A.MANDT, A.ZZACTSS,  (CASE WHEN SUBSTR(A.CONTR_DA,1,6) = #YEARF# || '01' THEN  1 ELSE 0 END) AS MON01,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '02'THEN  1 ELSE 0 END) AS MON02,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '03' THEN  1 ELSE 0 END) AS MON03,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '04'THEN  1 ELSE 0 END) AS MON04,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '05'THEN  1 ELSE 0 END) AS MON05,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '06'THEN  1 ELSE 0 END) AS MON06,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '07'THEN  1 ELSE 0 END) AS MON07,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '08'THEN  1 ELSE 0 END) AS MON08,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '09'THEN  1 ELSE 0 END) AS MON09,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '10'THEN  1 ELSE 0 END) AS MON10,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '11'THEN  1 ELSE 0 END) AS MON11,
					 (CASE WHEN  SUBSTR(A.CONTR_DA,1,6) = #YEARF#  || '12'THEN  1 ELSE 0 END) AS MON12




FROM SAPHEE.ZMASTER01 AS A	  
WHERE A.MANDT = #G_MANDT#
    AND  SUBSTR(A.CONTR_DA,1,4) = #YEARF#
	AND  A.ZQNTY <= 2
	AND A.ZZACTSS <> ''
	
	) AS T1
	
	
	LEFT OUTER JOIN SAPHEE.ZPST0000 AS PS
	  ON PS.MANDT = T1.MANDT
	  AND PS.ACTSS = T1.ZZACTSS
	  
	  
 GROUP BY T1.ZZACTSS , PS.ACTSS_NM , PS.DEPART_NM, PS.DEPART

	
	) AS F
	
	GROUP BY F.ZZACTSS , F.ACTSS_NM , F.DEPART_NM, F.DEPART

ORDER BY  F.DEPART, F.ZZACTSS

WITH UR	]]></statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_list">
	</output>
</query>
