<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[화면 메인 조회쿼리]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>
SELECT T.POSID, SUM(T.TOT_B) AS TOT_B , SUM(T.TOT) AS TOT , SUM(T.TOT_G) AS TOT_G
FROM 
(	SELECT Z.POSID, P.PRO_R AS TOT_B, 0 AS TOT  , 0 AS TOT_G  
  FROM SAPHEE.ZPSTW0304 AS Z
  LEFT OUTER JOIN SAPHEE.ZMASTER02 AS A
   ON A.MANDT = Z.MANDT
  AND A.POSID = Z.PSPID
  AND A.POSID_1 = Z.POSID
			   
  LEFT OUTER JOIN SAPHEE.ZPST0111 AS P
    ON A.MANDT = P.MANDT
  AND A.TYPE = P.TYPE
  AND A.ZZGUBUN = P.GUBUN
  AND P.PRONR = Z.PRONR
       	WHERE Z.MANDT = #G_MANDT#
		AND A.ZZGUBUN = #GUBUN#
	
    AND  Z.PSPID = #PSPID#
	AND   Z.POSID =  #POSID#
--	AND Z.INP_DT &lt;= #INP_DT# 
	
 GROUP BY Z.POSID  ,Z.PRONR , P.PRO_R


UNION  ALL


SELECT Z.POSID, 0 AS TOT_B,  SUM(P.PRO_R) AS TOT  , 0 AS TOT_G


FROM SAPHEE.ZPSTW0304 AS Z
  LEFT OUTER JOIN SAPHEE.ZMASTER02 AS A
   ON A.MANDT = Z.MANDT
  AND A.POSID = Z.PSPID
  AND A.POSID_1 = Z.POSID
			   
  LEFT OUTER JOIN SAPHEE.ZPST0111 AS P
    ON A.MANDT = P.MANDT
  AND A.TYPE = P.TYPE
  AND A.ZZGUBUN = P.GUBUN
  AND P.PRONR = Z.PRONR
       	WHERE Z.MANDT = #G_MANDT#
		AND A.ZZGUBUN = #GUBUN#
	
    AND  Z.PSPID = #PSPID#
	AND   Z.POSID =  #POSID#
	AND Z.INP_DT =#INP_DT#
--	AND   VER > ''
	GROUP BY Z.POSID  , Z.INP_DT 

UNION  ALL


SELECT POSID_1 AS POSID, 0 AS TOT_B, 0 AS TOT  , 0 AS TOT_G
   FROM SAPHEE.ZMASTER02
 WHERE MANDT = #G_MANDT#
    AND  POSID = #PSPID#
    AND   POSID_1 = #POSID#


UNION  ALL

	
SELECT A.POSID,0 AS TOT_B, 0 AS TOT,  SUM(A.PRO_R) AS TOT_G 
            
	FROM SAPHEE.ZPST0112 AS A
	WHERE A.GUBUN = #GUBUN#
	AND   A.MANDT = #G_MANDT#
    AND  A.PSPID = #PSPID#
	AND   A.POSID = #POSID# 
	
 GROUP BY A.POSID

) AS T

GROUP BY T.POSID


FOR FETCH ONLY
WITH UR	</statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_pop3">
	</output>
</query>
