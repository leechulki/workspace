<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>0</result-count>
	<statement>
WITH DATE_RANGE(DT, WEEK) AS 
(
	SELECT CHAR(DATE(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')), ISO) AS DT 
		  ,'W'||WEEK_ISO(CHAR(DATE(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')), ISO)) AS WEEK 
	  FROM SYSIBM.SYSDUMMY1
	  
	UNION ALL 
	
	SELECT CHAR(DATE(DT) + 1 DAY, ISO) AS DT 
		 , 'W'||WEEK_ISO(CHAR(DATE(DT) + 1 DAY, ISO)) AS WEEK 
	  FROM DATE_RANGE 
	 WHERE DT <![CDATA[<]]> CHAR(DATE(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')) + 1 YEAR, ISO) 
) 

SELECT TBL.WEEK_W2_TMP AS WEEK_W2
     , TBL.WEEK_W3_TMP AS WEEK_W3
     , TBL.WEEK_W4_TMP AS WEEK_W4
     , TBL.WEEK_W6_TMP AS WEEK_W6
     , TBL.GJAHR_W2
     , TBL.GJAHR_W3
     , TBL.GJAHR_W4
     , TBL.GJAHR_W6
     , TBL.STND_WEEK
     , (
     		SELECT REPLACE(CHAR(DATE(DT)),'-','') AS DATE_ST
			  FROM DATE_RANGE
			 WHERE WEEK = TBL.WEEK_W2
			 GROUP BY DT, WEEK
			 ORDER BY DATE_ST
			 FETCH FIRST 1 ROW ONLY WITH UR
       ) AS WEEK_W2_ST_DT
     , (
     		SELECT (DATE(DT)+6 DAY) AS DATE_FI 
			  FROM DATE_RANGE
			 WHERE WEEK = TBL.WEEK_W2
			 GROUP BY DT, WEEK
			 ORDER BY DT
			 FETCH FIRST 1 ROW ONLY WITH UR
       ) AS WEEK_W2_FI_DT
     , (
     		SELECT REPLACE(CHAR(DATE(DT)),'-','') AS DATE_ST
			  FROM DATE_RANGE
			 WHERE WEEK = TBL.WEEK_W3
			 GROUP BY DT, WEEK
			 ORDER BY DATE_ST
			 FETCH FIRST 1 ROW ONLY WITH UR
       ) AS WEEK_W3_ST_DT
     , (
     		SELECT (DATE(DT)+6 DAY) AS DATE_FI 
			  FROM DATE_RANGE
			 WHERE WEEK = TBL.WEEK_W3
			 GROUP BY DT, WEEK
			 ORDER BY DT
			 FETCH FIRST 1 ROW ONLY WITH UR
       ) AS WEEK_W3_FI_DT
     , (
     		SELECT REPLACE(CHAR(DATE(DT)),'-','') AS DATE_ST
			  FROM DATE_RANGE
			 WHERE WEEK = TBL.WEEK_W4
			 GROUP BY DT, WEEK
			 ORDER BY DATE_ST
			 FETCH FIRST 1 ROW ONLY WITH UR
       ) AS WEEK_W4_ST_DT
     , (
     		SELECT (DATE(DT)+6 DAY) AS DATE_FI 
			  FROM DATE_RANGE
			 WHERE WEEK = TBL.WEEK_W4
			 GROUP BY DT, WEEK
			 ORDER BY DT
			 FETCH FIRST 1 ROW ONLY WITH UR
       ) AS WEEK_W4_FI_DT
     , (
     		SELECT REPLACE(CHAR(DATE(DT)),'-','') AS DATE_ST
			  FROM DATE_RANGE
			 WHERE WEEK = TBL.WEEK_W6
			 GROUP BY DT, WEEK
			 ORDER BY DATE_ST
			 FETCH FIRST 1 ROW ONLY WITH UR
       ) AS WEEK_W6_ST_DT
     , (
     		SELECT (DATE(DT)+6 DAY) AS DATE_FI 
			  FROM DATE_RANGE
			 WHERE WEEK = TBL.WEEK_W6
			 GROUP BY DT, WEEK
			 ORDER BY DT
			 FETCH FIRST 1 ROW ONLY WITH UR
       ) AS WEEK_W6_FI_DT
     
  FROM
  (
	  	SELECT 'W'||WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD') + 21 DAY) AS WEEK_W2 -- 3
	  		  , 'W'||WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')  + 28 DAY) AS WEEK_W3 
		      , 'W'||WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')  + 35 DAY) AS WEEK_W4 -- 5
		      , 'W'||WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')  + 49 DAY) AS WEEK_W6 -- 7
		      
		      , 'W'||TRIM(REPEAT('0',2-LENGTH(TRIM(CHAR(INT(WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD') + 21 DAY)))))))||TRIM(CHAR(INT(WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD') + 21 DAY)))) AS WEEK_W2_TMP -- 3
		      , 'W'||TRIM(REPEAT('0',2-LENGTH(TRIM(CHAR(INT(WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD') + 28 DAY)))))))||TRIM(CHAR(INT(WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD') + 28 DAY)))) AS WEEK_W3_TMP
		      , 'W'||TRIM(REPEAT('0',2-LENGTH(TRIM(CHAR(INT(WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')  + 35 DAY)))))))||TRIM(CHAR(INT(WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')  + 35 DAY)))) AS WEEK_W4_TMP -- 5
		      , 'W'||TRIM(REPEAT('0',2-LENGTH(TRIM(CHAR(INT(WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')  + 49 DAY)))))))||TRIM(CHAR(INT(WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')  + 49 DAY)))) AS WEEK_W6_TMP -- 7
		      
		      , SUBSTR(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')  + 21 DAY,1,4) AS GJAHR_W2
		      , SUBSTR(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')  + 28 DAY,1,4) AS GJAHR_W3
		      , SUBSTR(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')  + 35 DAY,1,4) AS GJAHR_W4
		      , SUBSTR(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')  + 49 DAY,1,4) AS GJAHR_W6
		      , 'W'||TRIM(REPEAT('0',2-LENGTH(TRIM(CHAR(INT(WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD'))))))))||TRIM(CHAR(INT(WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD'))))) AS STND_WEEK
		      
			  -- , 'W'||WEEK_ISO(TIMESTAMP_FORMAT(#STND_DATE#,'YYYY-MM-DD')) AS STND_WEEK
		  
	 	  FROM SYSIBM.SYSDUMMY1
  ) AS TBL
  

		
FOR FETCH ONLY
WITH UR	</statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_week">
	</output>
</query>
