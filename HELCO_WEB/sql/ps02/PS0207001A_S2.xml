<?xml version="1.0" encoding="euc-kr"?>
<query>
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>0</result-count>
	<statement>
<![CDATA[
SELECT  P1.LIFNR     ,P1.PERNO     ,ZLCD109.CTEXT2 AS RSN1 
FROM SAPHEE.ZPST0138 AS P1
    LEFT OUTER JOIN SAPHEE.ZPST0147 AS ZPST0147 ON P1.MANDT=ZPST0147.MANDT AND P1.LIFNR=ZPST0147.LIFNR AND P1.PERNO=ZPST0147.PERNO
    LEFT OUTER JOIN SAPHEE.ZLCODE AS ZLCD109 ON ZPST0147.MANDT=ZLCD109.MANDT AND ZLCD109.LANG='ko' AND ZLCD109.CODE1='PS109' AND ZPST0147.PS109=ZLCD109.CODE2

WHERE P1.MANDT = #G_MANDT#
  AND P1.LIFNR = #ZZLIFNR#
 AND (SELECT CASE WHEN COUNT(P.MANDT) = 0 THEN 'B' 
            ELSE CASE WHEN (SELECT COUNT(*) FROM SAPHEE.ZPST0143 P2 WHERE P2.MANDT = P1.MANDT AND P2.LIFNR = P1.LIFNR AND P2.PERNO = P1.PERNO AND P2.SIGN > '') = 0 THEN 'A' 
                      WHEN (SELECT COUNT(*) FROM SAPHEE.ZPST0143 P2 WHERE P2.MANDT = P1.MANDT AND P2.LIFNR = P1.LIFNR AND P2.PERNO = P1.PERNO AND P2.SIGN = '¹Ý¼Û') > 0 OR (SELECT COUNT(*) FROM SAPHEE.ZPST0143 P2 WHERE P2.MANDT = P1.MANDT AND P2.LIFNR = P1.LIFNR AND P2.PERNO = P1.PERNO AND P2.SIGN > '') = COUNT(P.MANDT) THEN 'D'				
                 ELSE 'C' END 
            END CNT 
     FROM SAPHEE.ZPST0143 AS P WHERE P.MANDT = P1.MANDT AND P.LIFNR = P1.LIFNR AND P.PERNO = P1.PERNO 
    ) <> 'D'
AND P1.STATS = 'B'

  AND RETIF = 'X'
  AND CDATE <=  #INP_DT#  
  AND TEMNO = #TMCD#
  
FOR FETCH ONLY WITH UR	]]></statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_resign">
	</output>
</query>
