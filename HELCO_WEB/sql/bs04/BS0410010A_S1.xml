<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>0</result-count>
	<statement>
SELECT  T2.PSPID --호기
             , '' AS GUBUN
--          ,(T2.DEPT||T2.ITEMNO)AS NUM2
             , (T2.DEPT||(ROW_NUMBER() OVER (ORDER BY T2.ITEMNO) +10) )AS NUM2
             ,T2.ITEMNO
             , INT(ROW_NUMBER() OVER (ORDER BY T2.ITEMNO)) as  NUM             
             , SUBSTR( HEX(CURRENT DATE),3,2)||'년이전' as JUNYEAR
             , SUBSTR( HEX(CURRENT DATE),3,2)||'년' as YEAR
             ,SUBSTR('20150724',3,2)||'년' as NEXTYEAR
             , HEX(CURRENT DATE) AS TODAY
             ,T2.ZSITE_NM --현장명
             ,T2.DEPT --부서
             ,CASE WHEN T2.DEPT = 'A' THEN 'A' ELSE  'C' END AS SUM --합계구분값
             ,DEC(T2.RATE_P,10,1) AS RATE_P --시행율
             ,T2.TOTAL_T   --MR목표금액
             ,T2.PLANSUM_SUM -- IDEA도출계획
             ,T2.PLAN_R  -- IDEA 도출 목표비
             ,T2.ACTIVE_X--계획 실패
             ,T2.P1  --이전계획
             ,T2.P2  --이전실적
             ,T2.P3 -- 이전 (실패)
             ,T2.P4 -- 이전(제외)
             ,T2.P5  --1분기 계획
             ,T2.P6 -- 1분기 실적
             ,T2.P7 -- 1분기 (실패)
             ,T2.P8 -- 1분기(제외)
             ,CASE WHEN T2.P5 =0 THEN 0 ELSE ROUND((double(T2.P6)/double(T2.P5))*100,0) END AS PLAN1  --1분기 계획비
             ,T2.P9 --2분기 계획
             ,T2.P10 -- 2분기 실적
             ,T2.P11 -- 2분기 (실패)
             ,T2.P12 -- 2분기(제외)
             ,CASE WHEN T2.P9 =0 THEN 0 ELSE ROUND((double(T2.P10)/double(T2.P9))*100,0) END AS PLAN2  --2분기 계획비
             ,(T2.P5+T2.P9) AS SUM_P2 --1,2누계계획
             ,(T2.P6+T2.P10) AS SUM_S2 --1,2누계실적
             , CASE WHEN T2.P5+T2.P9 =0  THEN 0 ELSE ROUND((double(T2.P6+T2.P10)/double(T2.P5+T2.P9))*100,0) END AS PLAN5  --1,2누계 계획비
             ,(T2.P7+T2.P11) AS FAIL --1,2 분기 (실패)
             ,(T2.P8+T2.P12) AS PASS -- 1,2 분기(제외)
             ,T2.P13 --3분기 계획
             ,T2.P14 --3분기 실적
             ,T2.P15 -- 3분기 (실패)
             ,T2.P16 -- 3분기(제외)
             ,CASE WHEN T2.P13 =0 THEN 0 ELSE ROUND((double(T2.P14)/double(T2.P13))*100,0) END AS PLAN3  --3분기 계획비
             ,(T2.P5+T2.P9+T2.P13) AS SUM_P3 --1,2,3누계계획
             ,(T2.P6+T2.P10+T2.P14) AS SUM_S3 --1,2,3누계실적
             , CASE WHEN T2.P5+T2.P9+T2.P13 =0  THEN 0 ELSE ROUND((double(T2.P6+T2.P10+T2.P14)/double(T2.P5+T2.P9+T2.P13))*100,0) END AS PLAN6  --1,2,3누계 계획비
	,(T2.P7+T2.P11+T2.P15 ) AS FAIL2 --1,2 ,3분기 (실패)
              ,(T2.P8+T2.P12+T2.P16) AS PASS2 -- 1,2 ,3분기(제외)
              ,T2.P17 --4분기 계획
              ,T2.P18 -- 4분기 실적
	,T2.P19 -- 4분기 (실패)
	,T2.P20 -- 4분기(제외)
	,CASE WHEN T2.P17 =0 THEN 0 ELSE ROUND((double(T2.P18)/double(T2.P17))*100,0) END AS PLAN4  --4분기 계획비
	,(T2.P5+T2.P9+T2.P13+T2.P17) AS SUM_P4 --4누계계획
	,(T2.P6+T2.P10+T2.P14+T2.P18) AS SUM_S4 --4누계실적
	,T2.P23 -- 누계 (실패)
	,T2.P24 -- 누계(제외)
	, CASE WHEN T2.P5+T2.P9+T2.P13+T2.P17 =0  THEN 0 ELSE ROUND((double(T2.P6+T2.P10+T2.P14+T2.P18)/double(T2.P5+T2.P9+T2.P13+T2.P17))*100,0) END AS PLAN7  --4누계 계획비
             ,T2.P26 --이후 계획
             ,T2.P28--이후(실패)
             ,T2.P30 -- 완료시 계획
             ,T2.P31 -- 완료시 예상 실적
             ,T2.P32 --완료시 목표비
             ,T2.P33 -- 완료시 (실패)
             ,T2.P34 -- 완료시 (제외)


FROM
(SELECT  T.PSPID
             ,T.ZSITE_NM
             ,T.DEPT
			 ,T.ITEMNO
             ,T.RATE_P
             ,T.TOTAL_T   --금액
             ,T.PLANSUM_SUM -- 계획
             ,T.PLAN_R 
             ,T.ACTIVE_X--계획 실패

            ,ROUND(T.P1+T.P01+T.P001,0) AS P1  --이전계획
            ,ROUND(T.P2+T.P02+T.P002,0) AS P2  --이전실적
            ,ROUND(T.P3,0) AS P3 -- 이전 (실패)
            ,ROUND(T.P4,0) AS P4 -- 이전(제외)
            ,ROUND(T.P5+T.P05+T.P005,0) AS P5  --1분기 계획
            ,ROUND(T.P6+T.P06+T.P006,0) AS P6 -- 1분기 실적
            ,ROUND(T.P7,0) AS P7 -- 1분기 (실패)
            ,ROUND(T.P8,0) AS P8 -- 1분기(제외)
            ,ROUND(T.P9+T.P09+T.P009,0) AS P9 --2분기 계획
            ,ROUND(T.P10+T.P010+T.P0010,0) AS P10 -- 2분기 실적

            ,ROUND(T.P11,0) AS P11 -- 2분기 (실패)
            ,ROUND(T.P12,0) AS P12 -- 2분기(제외)
            ,ROUND(T.P13+T.P013+T.P0013,0) AS P13 --3분기 계획
            ,ROUND(T.P14+T.P014+T.P0014,0) AS P14 --3분기 실적
            ,ROUND(T.P15,0) AS P15 -- 3분기 (실패)
            ,ROUND(T.P16,0) AS P16 -- 3분기(제외)
            ,ROUND(T.P17+T.P017+T.P0017,0) AS P17 --4분기 계획
            ,ROUND(T.P18+T.P018+T.P0018,0) AS P18 -- 4분기 실적
            ,ROUND(T.P19,0) AS P19 -- 4분기 (실패)
            ,ROUND(T.P20,0) AS P20 -- 4분기(제외)
            ,ROUND(T.P23,0) AS P23 -- 누계 (실패)
            ,ROUND(T.P24,0) AS P24 -- 누계(제외)
            ,CASE WHEN T.P26+T.P026+T.P0026 =0 THEN 0 ELSE ROUND(T.P26+T.P026+T.P0026,0) END  AS P26 --이후 계획
            ,ROUND(T.P28,0) AS P28--이후(실패)
            ,ROUND(T.P30+T.P030+T.P0030,0) AS P30 -- 완료시 계획
            ,ROUND((T.P2+T.P02+T.P002+T.P6+T.P06+T.P006+T.P10+T.P010+T.P0010+T.P14+T.P014+T.P0014+T.P18+T.P018+T.P0018),0) AS P31 -- 완료시 예상 실적
            ,ROUND((double((T.P2+T.P02+T.P002+T.P6+T.P06+T.P006+T.P10+T.P010+T.P0010+T.P14+T.P014+T.P0014+T.P18+T.P018+T.P0018))/double(T.TOTAL_T))*100 ,0) AS P32 --완료시 목표비
            ,ROUND(T.P33,0) AS P33 -- 완료시 (실패)
            ,ROUND(T.P34,0) AS P34 -- 완료시 (제외)

FROM
(
SELECT A.PSPID
,C.ZSITE_NM
,D.DEPT
,B.RATE_P
,D.ITEMNO

,ROUND(SAPHEE.GET_CURRENCY2(CAST(B.WAERK AS VARCHAR(15) ), CAST(B.TOTAL_T  AS DECIMAL(13, 2) ) )/1000,0)  AS TOTAL_T   --금액
,ROUND(SAPHEE.GET_CURRENCY2(CAST(B.WAERK AS VARCHAR(15) ), CAST(B.PLANSUM_SUM  AS DECIMAL(13, 2) ) )/1000 ,0)  AS PLANSUM_SUM -- 계획
		    ,ROUND((SAPHEE.GET_CURRENCY2(CAST(B.WAERK AS VARCHAR(15) ), CAST(B.PLANSUM_SUM  AS DECIMAL(13, 2) ) ) / SAPHEE.GET_CURRENCY2(CAST(B.WAERK AS VARCHAR(15) ), CAST(B.TOTAL_T  AS DECIMAL(13, 2) ) )*100),0) AS PLAN_R --목표비
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'D'  THEN PLANSUM  ELSE  0 END) /10,0) AS  ACTIVE_X --실패
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) = SUBSTR(#MAKF_DTT#,1,4) THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P1 
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) = SUBSTR(#MAKF_DTT#,1,4) THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P01 
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(#MAKF_DTT#,1,4) THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P001 
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) = SUBSTR(#MAKF_DTT#,1,4) THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P2 
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) = SUBSTR(#MAKF_DTT#,1,4) THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P02 
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(#MAKF_DTT#,1,4) THEN A.TOTAL ELSE  0 END) /10 ,0) AS P002 
,VALUE(SUM(CASE WHEN A.ACTIVE_R = 'D' AND SUBSTR(A.FDATE,1,4) = SUBSTR(#MAKF_DTT#,1,4) THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P3
,VALUE(SUM(CASE WHEN A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(#MAKF_DTT#,1,4) THEN A.GAP  ELSE  0 END) /10 ,0) AS P4 

,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('01','02','03') THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P5
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('01','02','03') THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P05
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('01','02','03') THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P005
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(HEX(CURRENT DATE),1,4)AND SUBSTR(A.FDATE,5,2)  IN  ('01','02','03') THEN A.PLANSUM  ELSE  0 END) ) /10 ,0) AS P6 
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(HEX(CURRENT DATE),1,4)AND SUBSTR(A.FDATE,5,2)  IN  ('01','02','03') THEN A.PLANSUM  ELSE  0 END)) /10 ,0) AS P06 
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(HEX(CURRENT DATE),1,4)AND SUBSTR(A.FDATE,5,2)  IN  ('01','02','03') THEN A.TOTAL  ELSE  0 END) ) /10 ,0) AS P006  
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'D' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(HEX(CURRENT DATE),1,4)  AND SUBSTR(A.FDATE,5,2)  IN  ('01','02','03')  THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P7
,VALUE(SUM(CASE WHEN A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('01','02','03') THEN A.GAP  ELSE  0 END) /10 ,0) AS P8

,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('04','05','06') THEN A.TOTAL  ELSE  0 END)/10 ,0) AS P9
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('04','05','06') THEN A.TOTAL  ELSE  0 END)/10 ,0) AS P09
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('04','05','06') THEN A.TOTAL  ELSE  0 END)/10 ,0) AS P009
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('04','05','06') THEN A.PLANSUM  ELSE  0 END)) /10 ,0) AS P10
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('04','05','06') THEN A.PLANSUM  ELSE  0 END)) /10 ,0) AS P010
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('04','05','06') THEN A.TOTAL  ELSE  0 END)) /10 ,0) AS P0010
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'D' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(HEX(CURRENT DATE),1,4)  AND SUBSTR(A.FDATE,5,2)  IN ('04','05','06') THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P11
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN ('04','05','06') THEN A.GAP  ELSE  0 END) /10 ,0) AS P12

,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('07','08','09') THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P13
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('07','08','09') THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P013
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('07','08','09') THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P0013
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('07','08','09') THEN A.PLANSUM  ELSE  0 END) ) /10 ,0) AS P14
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('07','08','09') THEN A.PLANSUM  ELSE  0 END) ) /10 ,0) AS P014
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('07','08','09') THEN A.TOTAL  ELSE  0 END)) /10 ,0) AS P0014
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'D' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(HEX(CURRENT DATE),1,4)  AND SUBSTR(A.FDATE,5,2)  IN ('07','08','09') THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P15
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN ('07','08','09') THEN A.GAP  ELSE  0 END) /10 ,0) AS P16

,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('10','11','12') THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P17
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('10','11','12') THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P017
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('10','11','12') THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P0017
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('10','11','12') THEN A.PLANSUM  ELSE  0 END) ) /10 ,0) AS P18
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('10','11','12') THEN A.PLANSUM  ELSE  0 END)) /10 ,0) AS P018
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN  ('10','11','12') THEN A.TOTAL  ELSE  0 END) ) /10 ,0) AS P0018
,VALUE(SUM(CASE WHEN A.ACTIVE_R = 'D' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(HEX(CURRENT DATE),1,4)  AND SUBSTR(A.FDATE,5,2)  IN ('10','11','12') THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P19
,VALUE(SUM(CASE WHEN A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4) AND SUBSTR(A.FDATE,5,2)  IN ('10','11','12') THEN A.GAP  ELSE  0 END) /10 ,0) AS P20

,VALUE(SUM(CASE WHEN A.ACTIVE_R = 'D' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(HEX(CURRENT DATE),1,4)  THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P23
,VALUE(SUM(CASE WHEN A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(HEX(CURRENT DATE),1,4)  THEN A.GAP  ELSE  0 END) /10 ,0) AS P24
                                 
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) = SUBSTR(#MAKE_NY#,1,4)  THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P26
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) = SUBSTR(#MAKE_NY#,1,4)  THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P026
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) = SUBSTR(#MAKE_NY#,1,4)  THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P0026
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'A' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(#MAKE_NY#,1,4) THEN A.PLANSUM  ELSE  0 END) ) /10 ,0) AS P27
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'B' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(#MAKE_NY#,1,4) THEN A.PLANSUM  ELSE  0 END)) /10 ,0) AS P027
,VALUE((SUM(CASE WHEN A.ACTIVE_R = 'C' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(#MAKE_NY#,1,4) THEN A.TOTAL  ELSE  0 END) ) /10 ,0) AS P0027
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'D' AND SUBSTR(A.FDATE,1,4) =  SUBSTR(#MAKE_NY#,1,4)  THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P28

,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'A' THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P30
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'B' THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P030
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'C' THEN A.PLANSUM  ELSE  0 END)/10 ,0) AS P0030
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'D' THEN A.PLANSUM  ELSE  0 END) /10 ,0) AS P33
,VALUE(SUM(CASE WHEN  A.ACTIVE_R = 'C' THEN A.GAP  ELSE  0 END) /10 ,0) AS P34




			  
			  
FROM SAPHEE.ZSDTW012  AS A
INNER JOIN SAPHEE.ZMASTER01 AS C
        ON A.MANDT = C.MANDT
      AND A.PSPID = C.POSID
	  
INNER JOIN SAPHEE.ZSDTW011 AS B
            ON A.MANDT = B.MANDT
          AND A.PSPID = B.PSPID

	  
INNER JOIN SAPHEE.ZSDTW016 AS D
            ON A.MANDT = D.MANDT
          AND A.PSPID = D.PSPID
		  
WHERE A.MANDT =  #G_MANDT#
 AND A.MAKE_MM =  ( SELECT X.MAKE_MM
	                                   FROM SAPHEE.ZSDTW012 AS X
		                            WHERE X.MANDT = A.MANDT
		                                 AND X.PSPID = A.PSPID            
							  ORDER BY X.MAKE_MM  DESC
	                                   FETCH FIRST 1 ROWS ONLY         )
 AND B.MAKE_MM = 		( SELECT X.MAKE_MM
	                                   FROM SAPHEE.ZSDTW011 AS X
		                            WHERE X.MANDT = B.MANDT
		                                 AND X.PSPID = B.PSPID            
							  ORDER BY X.MAKE_MM  DESC
	                                   FETCH FIRST 1 ROWS ONLY         )	
AND D.DEPT IN ( 'A' ,'B')
AND D.STATE &lt;&gt; 'A'
<isNotNull col="PSPID"> 
       AND A.PSPID = #PSPID# 
       </isNotNull>
 
 GROUP BY A.PSPID,C.ZSITE_NM,B.RATE_P,TOTAL_T,PLANSUM_SUM, B.WAERK, D.DEPT ,D.ITEMNO

    )AS T

) AS T2

ORDER BY T2.DEPT  ,T2.ITEMNO


FOR FETCH ONLY
WITH UR	</statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_list">
	</output>
</query>
