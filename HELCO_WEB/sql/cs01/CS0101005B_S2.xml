<?xml version="1.0" encoding="euc-kr"?>
<query>
	<type>select</type>
	<description><![CDATA[호기별 청구이력 상세 - ERP자료]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>0</result-count>
	<statement>
<![CDATA[
SELECT                               
     MM031A.MANDT AS MANDT            
   , MM031A.MATNR AS MATNR            
   , MM031A.BWTAR AS BWTAR                   
   , MM031A.MTART AS MTART                   
  , CASE WHEN ( 
          SELECT MM004A.MATNR FROM SAPHEE.ZMMT004 AS MM004A
          WHERE MM004A.MANDT = MM031A.MANDT 
               AND MM004A.MATNR = MM031A.MATNR) IS NULL THEN '0' ELSE '1' END AS BANNAB
	, MM031A.MENGE AS MENGE                   
	, MM031A.NETPR AS NETPR                   
	, MM031A.MEINS AS MEINS                   
	, MM031A.CHAR1 AS CHAR1                   
	, CASE MM031A.BUSSI 
	      WHEN '1' THEN (SELECT SUM(MM018A.PRLAB) FROM SAPHEE.ZMMT018 MM018A
		           WHERE MM018A.MANDT = MM031A.MANDT
		             AND MM018A.WERKS = '2000'
		             AND MM018A.LGORT = '9000'
		             AND MM018A.MATNR = MM031A.MATNR
		             AND MM018A.CHARG = MM031A.BWTAR)
	      WHEN '2' THEN (SELECT SUM(MM018B.PRLAB) FROM SAPHEE.ZMMT018 MM018B
		           WHERE MM018B.MANDT = MM031A.MANDT
		             AND MM018B.WERKS = '2000'
		             AND MM018B.LGORT = '9039'
		             AND MM018B.MATNR = MM031A.MATNR
		             AND MM018B.CHARG = MM031A.BWTAR) END AS PARLAB
  , ( SELECT SUM(MM018C.PRLAB) FROM SAPHEE.ZMMT018 AS MM018C
      WHERE MM018C.MANDT = MM031A.MANDT
        AND MM018C.LGORT = MM031A.LGORT
        AND MM018C.MATNR = MM031A.MATNR
        AND MM018C.CHARG = MM031A.BWTAR) AS PARLAB1
	, QM008A.RETMSNO AS RETMSNO
	, QM008A.INSMSNO AS INSMSNO
	, QM008A.MBRETMSNO AS MBRETMSNO
	, QM008A.MBINSMSNO AS MBINSMSNO
	, QM008A.CAUSECOD AS CAUSECOD
	, QM008A.CAUSEGRP AS CAUSEGRP
	, QM008A.CAUSECAT AS CAUSECAT
	, QM008A.CAUSETXT AS CAUSETXT
	, QM008A.PHENOCOD AS PHENOCAT
	, QM008A.PHENOCOD AS PHENOCOD
	, QM008A.PHENOGRP AS PHENOGRP
	, QM008A.PHENOTXT AS PHENOTXT
	, QM008A.ASSNO AS ASSNO
	, MM031A.RDATE AS RDATE                   
	, MM031A.DMBTR AS DMBTR                   
	, MM031A.CROPE AS CROPE                   
	, MM031A.REQDATE AS REQDATE               
	, MM031A.BUSSI AS BUSSI               
	, MM031A.JQPRNUM AS JQPRNUM               
	, MM031A.LGORT AS LGORT                   
	, MM031A.POSID AS POSID                   
	, CASE WHEN MM031A.REQKIND IN ('8','6') AND MM031A.POSID2 > ''  THEN MM031A.POSID2 ELSE '' END AS POSID2                 
	, MM031A.QTNUM AS QTNUM                   
	, MM031A.RECE_F AS RECE_F                 
	, MM031A.REQITEM AS REQITEM               
	, MM031A.REQKIND AS REQKIND               
	, MM031A.REQKIND2 AS REQKIND2             
	, MM031A.REQNO AS REQNO                   
	, MM031A.REQNR AS REQNR                   
	, CAST(MM031A.REQSN AS INTEGER) AS REQSN                   
	, MM031A.SEQNO AS SEQNO                   
	, MM031A.SERNO AS SERNO                   
	, MM031A.WAERS AS WAERS
	, MM011A.MAKTX AS MAKTX
  , QM007A.HOGI AS HOGI
  , QM007A.ATYPE AS ATYPE
  , QM007A.SPEC AS SPEC
  , QM007A.TEMNO AS TEMNO
  , QM007A.NAMET AS NAMET
  , QM007A.CELLP AS CELLP
  , QM007A.CREDT AS CREDT
  , QM007A.CREID AS CREID
  , QM007A.CRENM AS CRENM
  , QM007A.PSPID AS PSPID
  , QM007A.POST1 AS POST1
  , QM007A.REJTXT AS REJTXT
  , QM007A.ZBEPJEO AS ZBEPJEO
  , QM007A.ZBOSUIN AS ZBOSUIN
  , QM007A.ZOIPSU AS ZOIPSU
  , QM007A.WORKDT AS WORKDT
  , MM001A.PS_PSP_PNR AS POSID3
  , '' AS SAMT1
 FROM SAPHEE.ZMMT031 AS MM031A
 LEFT OUTER JOIN SAPHEE.ZMMT011 AS MM011A ON MM031A.MANDT = MM011A.MANDT AND 
      MM031A.MATNR = MM011A.MATNR AND MM031A.MTART = MM011A.MTART
 LEFT OUTER JOIN SAPHEE.ZQMT008 AS QM008A ON MM031A.MANDT = QM008A.MANDT AND
      MM031A.JQPRNUM = QM008A.JQPRNUM 
     AND MM031A.SERNO = QM008A.SERNO 
     AND MM031A.MATNR = QM008A.MATNR
 LEFT OUTER JOIN SAPHEE.ZQMT007 AS QM007A ON MM031A.MANDT = QM007A.MANDT AND
      MM031A.JQPRNUM = QM007A.JQPRNUM
 LEFT OUTER JOIN SAPHEE.ZMMT001 AS MM001A ON MM031A.MANDT = MM001A.MANDT AND
      MM031A.REQNR = MM001A.REQNR AND MM031A.REQITEM = MM001A.REQITEM
   WHERE MM031A.MANDT = #G_MANDT#     
     AND MM031A.POSID  = #POSID_1# 
     AND MM031A.RECE_F = '3'
     AND MM031A.REQDATE LIKE #YEAR# || '%'

ORDER BY REQDATE DESC
   FOR FETCH ONLY
  WITH UR	]]></statement>
	<input default-name="ds_cond">
		<col name="G_MANDT" size="255" type="VARCHAR" description="" /> 
		<col name="POSID_1" size="255" type="VARCHAR" description="" /> 
		<col name="YEAR" size="255" type="VARCHAR" description="" /> 
	</input>
	<output default-name="ds_list">
	</output>
</query>
