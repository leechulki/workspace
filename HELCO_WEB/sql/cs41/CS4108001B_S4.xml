<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>1</result-count>
	<statement>
 
SELECT 
	   SUM(CNT) CNT 
	  ,SUM(TWBTR) TWBTR
	  ,(SELECT NAME1 FROM SAPHEE.LFA1 WHERE MANDT = '183' AND LIFNR = A.LIFNR ) INAME1
	  ,A.LIFNR WRKLFN
	  ,YYMM 
	  ,CASE WHEN YYMM != SUBSTR(HEX(CURRENT DATE),1,6) THEN SAPHEE.GET_LAST_DAY(YYMM||'32') 
	   	    ELSE SAPHEE.GET_LAST_DAY(SUBSTR(HEX(CURRENT DATE),1,6)||'32')                     
	   END BLDAT 
	  ,'X' FLAG
	  ,CASE WHEN FGBN IS NOT NULL THEN FGBN ELSE '' END AS FGBN 

FROM
	 (
		SELECT WB010.LIFNR LIFNR, CS411.CS411_HYYMM YYMM, CS006.FGBN FGBN, COUNT(*) CNT, COUNT(*) * 25000 TWBTR
			FROM SAPHEE.ZCST411 CS411
			
	 		LEFT OUTER JOIN SAPHEE.ZCST111 CS111
 				ON CS411.MANDT= CS111.MANDT
 			AND CS411.CS411_PJT = CS111.PJT
 			AND CS411.CS411_HNO = CS111.HNO
 			
 			LEFT OUTER JOIN SAPHEE.ZWBT010 WB010
 				ON CS111.MANDT = WB010.MANDT
 			AND CS111.BSU = WB010.LGORT
 			
 			LEFT OUTER JOIN SAPHEE.ZCST006 CS006
 				ON CS411.MANDT = CS006.MANDT
 			AND CS411.CS411_HWBS = CS006.PSPID
 			AND WB010.LIFNR = CS006.WRKLFN
 			AND CS411.CS411_HYYMM = SUBSTR(CS006.BLDAT, 1,6)

		WHERE CS411.MANDT = '183'
			AND CS411.CS411_HWBS = #PSPID# 
			AND CS411.CS411_HCHK = '1'
			AND CS411.CS411_LHCHK = '1'
			AND CS411.CS411_HCAN !=''
			AND CS411.CS411_HYYMM = SUBSTR(HEX(CURRENT DATE),1,6)   
		GROUP BY WB010.LIFNR, CS411.CS411_HYYMM, CS006.FGBN
    
		UNION ALL
	
		SELECT WB010.LIFNR LIFNR, CS411.CS411_DYYMM YYMM, CS006.FGBN FGBN, COUNT(*) CNT, COUNT(*) * 25000 TWBTR
			FROM SAPHEE.ZCST411 CS411
			
	 		LEFT OUTER JOIN SAPHEE.ZCST111 CS111
 			ON CS411.MANDT= CS111.MANDT
 			AND CS411.CS411_PJT = CS111.PJT
 			AND CS411.CS411_HNO = CS111.HNO
 			
 			LEFT OUTER JOIN SAPHEE.ZWBT010 WB010
 			ON CS111.MANDT = WB010.MANDT
 			AND CS111.BSU = WB010.LGORT

 			LEFT OUTER JOIN SAPHEE.ZCST006 CS006
 				ON CS411.MANDT = CS006.MANDT
 			AND CS411.CS411_DWBS = CS006.PSPID
 			AND WB010.LIFNR = CS006.WRKLFN
 			AND CS411.CS411_DYYMM = SUBSTR(CS006.BLDAT, 1,6)
 			
		WHERE CS411.MANDT = '183'
			AND CS411.CS411_DWBS = #PSPID#
			AND CS411.CS411_DCHK= '1'
			AND CS411.CS411_LDCHK = '1' 
			AND CS411.CS411_DCAN !=''
			AND CS411.CS411_DYYMM = SUBSTR(HEX(CURRENT DATE),1,6)
		GROUP BY WB010.LIFNR, CS411.CS411_DYYMM, CS006.FGBN
		
		UNION ALL
		
    	SELECT WB010.LIFNR LIFNR, CS411_HYYMM YYMM, CS006.FGBN FGBN, COUNT(*) CNT, COUNT(*) * 25000 TWBTR
			FROM SAPHEE.ZCST411 CS411
			
	 		LEFT OUTER JOIN SAPHEE.ZCST111 CS111
 			ON CS411.MANDT= CS111.MANDT
 			AND CS411.CS411_PJT = CS111.PJT
 			AND CS411.CS411_HNO = CS111.HNO
 			
 			LEFT OUTER JOIN SAPHEE.ZWBT010 WB010
 			ON CS111.MANDT = WB010.MANDT
 			AND CS111.BSU = WB010.LGORT
 	
 	 		LEFT OUTER JOIN SAPHEE.ZCST006 CS006
 				ON CS411.MANDT = CS006.MANDT
 			AND CS411.CS411_HWBS = CS006.PSPID
 			AND WB010.LIFNR = CS006.WRKLFN
 			AND CS411.CS411_HYYMM = SUBSTR(CS006.BLDAT, 1,6)
 

		WHERE CS411.MANDT = '183'
			AND CS411.CS411_HWBS = #PSPID# 
			AND CS411.CS411_HCHK = '1'
			AND CS411.CS411_LHCHK = '1'
			AND CS411.CS411_HCAN !=''
			AND CS411.CS411_HYYMM &lt; SUBSTR(HEX(CURRENT DATE),1,6)   
		GROUP BY WB010.LIFNR, CS411.CS411_HYYMM, CS006.FGBN
    
		UNION ALL
	
		SELECT WB010.LIFNR LIFNR, CS411.CS411_DYYMM YYMM, CS006.FGBN FGBN, COUNT(*) CNT, COUNT(*) * 25000 TWBTR
			FROM SAPHEE.ZCST411 CS411
			
	 		LEFT OUTER JOIN SAPHEE.ZCST111 CS111
 			ON CS411.MANDT= CS111.MANDT
 			AND CS411.CS411_PJT = CS111.PJT
 			AND CS411.CS411_HNO = CS111.HNO
 			
 			LEFT OUTER JOIN SAPHEE.ZWBT010 WB010
 			ON CS111.MANDT = WB010.MANDT
 			AND CS111.BSU = WB010.LGORT

 	 		LEFT OUTER JOIN SAPHEE.ZCST006 CS006
 				ON CS411.MANDT = CS006.MANDT
 			AND CS411.CS411_DWBS = CS006.PSPID
 			AND WB010.LIFNR = CS006.WRKLFN
 			AND CS411.CS411_DYYMM = SUBSTR(CS006.BLDAT, 1,6)
 			
		WHERE CS411.MANDT = '183'
			AND CS411.CS411_DWBS = #PSPID#
			AND CS411.CS411_DCHK= '1'
			AND CS411.CS411_LDCHK = '1' 
			AND CS411.CS411_DCAN !=''
			AND CS411.CS411_DYYMM &lt; SUBSTR(HEX(CURRENT DATE),1,6)
		GROUP BY WB010.LIFNR, CS411.CS411_DYYMM, CS006.FGBN
	) A
		GROUP BY LIFNR, YYMM, FGBN
  WITH UR	 
  
  
  </statement>
	<input default-name="ds_cond">
	</input>
	<output default-name="ds_list3">
	</output>
</query>
