<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
	<type>select</type>
	<description><![CDATA[리포트 일자별 현황 요약 조회]]></description>
	<reload>true</reload>
	<monitoring>true</monitoring>
	<result-count>0</result-count>
	<statement>		
		WITH TMP AS (
SELECT
 LE002.MANDT  AS MANDT
,LE002.ZKNUM  AS ZKNUM
,LE002.ZKNUM2 AS ZKNUM2
,LE002.PSPID  AS PSPID
,LE002.POST1  AS POST1
,LE002.POSID  AS POSID
,VALUE(MA01.ZZACTSS, '') AS ZZACTSS
,LE002.BEZEI  AS BEZEI
,SUBSTR(CASE WHEN LE002.ZTON1  > 0 THEN ',1T-'       || TRIM(CHAR(LE002.ZTON1 )) ELSE '' END ||
        CASE WHEN LE002.ZTON2  > 0 THEN ',2.5T-'     || TRIM(CHAR(LE002.ZTON2 )) ELSE '' END ||
        CASE WHEN LE002.ZTON3  > 0 THEN ',3.5T-'     || TRIM(CHAR(LE002.ZTON3 )) ELSE '' END ||
        CASE WHEN LE002.ZTON4  > 0 THEN ',5T-'       || TRIM(CHAR(LE002.ZTON4 )) ELSE '' END ||
        CASE WHEN LE002.ZTON5  > 0 THEN ',8T-'       || TRIM(CHAR(LE002.ZTON5 )) ELSE '' END ||
        CASE WHEN LE002.ZTON6  > 0 THEN ',11T-'      || TRIM(CHAR(LE002.ZTON6 )) ELSE '' END ||
        CASE WHEN LE002.ZTON7  > 0 THEN ',18T-'      || TRIM(CHAR(LE002.ZTON7 )) ELSE '' END ||
        CASE WHEN LE002.ZTON8  > 0 THEN ',25T-'      || TRIM(CHAR(LE002.ZTON8 )) ELSE '' END ||
        CASE WHEN LE002.ZTON9  > 0 THEN ',Trailer-'  || TRIM(CHAR(LE002.ZTON9 )) ELSE '' END ||
        CASE WHEN LE002.ZTON10 > 0 THEN ',택배-' || TRIM(CHAR(LE002.ZTON10)) ELSE '' END ||
        CASE WHEN LE002.ZTON11 > 0 THEN ',Trailer(20)-' || TRIM(CHAR(LE002.ZTON11)) ELSE '' END ||
        CASE WHEN LE002.ZTON12 > 0 THEN ',Trailer(40)-' || TRIM(CHAR(LE002.ZTON12)) ELSE '' END ||
        CASE WHEN LE002.ZTON13 > 0 THEN ',Trailer(20)round-' || TRIM(CHAR(LE002.ZTON13)) ELSE '' END ||
        CASE WHEN LE002.ZTON15 > 0 THEN ',셔틀-' || TRIM(CHAR(LE002.ZTON15)) ELSE '' END ||
        CASE WHEN LE002.ZTON14 > 0 THEN ',Trailer(40)round-' || TRIM(CHAR(LE002.ZTON14)) ELSE '' END,2) AS ZTON
,LE002.ZLZONE           AS ZLZONE
,VALUE(TZONT.VTEXT, '') AS ZLZONE_NM
,LE002.TPLSTDT1
,LE002.TPLSTDT2
,LE002.TPLSTDT3
,LE002.TPLSTDT4
,LE002.TPLSTDT5
,LE002.TPLSTDTZTON1
,LE002.TPLSTDTZTON2
,LE002.TPLSTDTZTON3
,LE002.TPLSTDTZTON4
,LE002.TPLSTDTZTON5  
,LE002.TPLSTDT6   
,LE002.TPLSTDTZTON6
,LE002.TPLSTDT7   
,LE002.TPLSTDTZTON7 
,LE002.LIFNRCO  
  FROM (

      SELECT
       T2.MANDT        AS MANDT
      ,T2.ZKNUM        AS ZKNUM
      ,T2.ZKNUM2       AS ZKNUM2
      ,MAX(T3.PSPID )  AS PSPID
      ,MAX(T3.POST1 )  AS POST1
      ,MAX(T2.ZTEXT )  AS ZTEXT
      ,MAX(T2.BEZEI )  AS BEZEI
      ,MAX(T2.ERDAT )  AS ERDAT
      ,MAX(T2.ERZET )  AS ERZET
      ,MAX(T2.DPTEN )  AS DPTEN
      ,MAX(T2.UPTEN )  AS UPTEN
      ,MAX(T2.ZTON1 )  AS ZTON1
      ,MAX(T2.ZTON2 )  AS ZTON2
      ,MAX(T2.ZTON3 )  AS ZTON3
      ,MAX(T2.ZTON4 )  AS ZTON4
      ,MAX(T2.ZTON5 )  AS ZTON5
      ,MAX(T2.ZTON6 )  AS ZTON6
      ,MAX(T2.ZTON7 )  AS ZTON7
      ,MAX(T2.ZTON8 )  AS ZTON8
      ,MAX(T2.ZTON9 )  AS ZTON9
      ,MAX(T2.ZTON10)  AS ZTON10
      ,MAX(T2.ZTON11)  AS ZTON11
      ,MAX(T2.ZTON12)  AS ZTON12
      ,MAX(T2.ZTON13)  AS ZTON13
      ,MAX(T2.ZTON14)  AS ZTON14
      ,MAX(T2.ZTON15)  AS ZTON15
      ,MAX(T3.ZLZONE)  AS ZLZONE
      ,MAX(T2.ZTYPE )  AS ZTYPE
      ,MAX(T2.ZCHAN )  AS ZCHAN
      ,MIN(T4.POSID)   AS POSID
      ,'2'   AS GUBN
      ,MAX(T2.NAMET) AS NAMET
      ,MAX(T2.MOB_NUMBER) AS MOB_NUMBER
      ,MAX(T2.TRAID) AS TRAID
      ,MAX(T2.AEDAT) AS AEDAT
      ,MAX(T2.UZEIT) AS UZEIT
      ,MAX(T2.ERNAM) AS ERNAM
      ,MAX(T2.TPLSTDT1) AS TPLSTDT1
      ,MAX(T2.TPLSTDT2) AS TPLSTDT2
      ,MAX(T2.TPLSTDT3) AS TPLSTDT3
      ,MAX(T2.TPLSTDT4) AS TPLSTDT4
      ,MAX(T2.TPLSTDT5) AS TPLSTDT5
      ,MAX(T2.TPLSTDTQTY1) AS TPLSTDTQTY1
      ,MAX(T2.TPLSTDTQTY2) AS TPLSTDTQTY2
      ,MAX(T2.TPLSTDTQTY3) AS TPLSTDTQTY3
      ,MAX(T2.TPLSTDTQTY4) AS TPLSTDTQTY4
      ,MAX(T2.TPLSTDTQTY5) AS TPLSTDTQTY5
      ,MAX(T2.TPLSTDTZTON1) AS TPLSTDTZTON1
      ,MAX(T2.TPLSTDTZTON2) AS TPLSTDTZTON2
      ,MAX(T2.TPLSTDTZTON3) AS TPLSTDTZTON3
      ,MAX(T2.TPLSTDTZTON4) AS TPLSTDTZTON4
      ,MAX(T2.TPLSTDTZTON5) AS TPLSTDTZTON5
      ,MAX(T2.TPLSTDT6) AS TPLSTDT6
      ,MAX(T2.TPLSTDTQTY6) AS TPLSTDTQTY6
      ,MAX(T2.TPLSTDTZTON6) AS TPLSTDTZTON6
      ,MAX(T2.TPLSTDT7) AS TPLSTDT7
      ,MAX(T2.TPLSTDTQTY7) AS TPLSTDTQTY7
      ,MAX(T2.TPLSTDTZTON7) AS TPLSTDTZTON7
      ,MAX(T2.CHNGCONFIRM) AS CHNGCONFIRM
      ,MAX(T2.LIFNR) AS LIFNRCO
      FROM SAPHEE.ZLET002 AS T2
           INNER JOIN SAPHEE.ZLET003 AS T3 ON  T2.MANDT  = T3.MANDT
                                           AND T2.ZKNUM  = T3.ZKNUM
                                           AND T2.ZKNUM2 = T3.ZKNUM2
           INNER JOIN SAPHEE.ZLET004 AS T4 ON  T3.MANDT  = T4.MANDT
                                           AND T3.VBELN  = T4.VBELN
        WHERE T2.MANDT =  #G_MANDT#
        AND T2.ERDAT =  #ERDAT#
--           AND T2.ERDAT BETWEEN  #ERDAT# AND #ERDAT_TO#
        AND T2.ZKNUM LIKE '_%'
          AND SUBSTR(T4.POSID,1,1) NOT IN ('C','E')
  --        AND T2.ZTYPE =  #ZTYPE#       
        AND T2.DELCONFIRM = 'Y'
      GROUP BY T2.MANDT,T2.ZKNUM,T2.ZKNUM2

      UNION

      SELECT
       T6.MANDT   AS MANDT
      ,T6.ZKNUM   AS ZKNUM
      ,T6.ZKNUM2  AS ZKNUM2
      ,MAX(T7.PSPID )  AS PSPID
      ,MAX(T7.POST1 )  AS POST1
      ,MAX(T6.ZTEXT )  AS ZTEXT
      ,MAX(T6.BEZEI )  AS BEZEI
      ,MAX(T6.ERDAT )  AS ERDAT
      ,MAX(T6.ERZET )  AS ERZET
      ,MAX(T6.DPTEN )  AS DPTEN
      ,MAX(T6.UPTEN )  AS UPTEN
      ,MAX(T6.ZTON1 )  AS ZTON1
      ,MAX(T6.ZTON2 )  AS ZTON2
      ,MAX(T6.ZTON3 )  AS ZTON3
      ,MAX(T6.ZTON4 )  AS ZTON4
      ,MAX(T6.ZTON5 )  AS ZTON5
      ,MAX(T6.ZTON6 )  AS ZTON6
      ,MAX(T6.ZTON7 )  AS ZTON7
      ,MAX(T6.ZTON8 )  AS ZTON8
      ,MAX(T6.ZTON9 )  AS ZTON9
      ,MAX(T6.ZTON10)  AS ZTON10
      ,MAX(T6.ZTON11)  AS ZTON11
      ,MAX(T6.ZTON12)  AS ZTON12
      ,MAX(T6.ZTON13)  AS ZTON13
      ,MAX(T6.ZTON14)  AS ZTON14
      ,MAX(T6.ZTON15)  AS ZTON15
      ,MAX(T7.ZLZONE)  AS ZLZONE
      ,MAX(T6.ZTYPE )  AS ZTYPE
      ,''              AS ZCHAN
      ,MIN(T7.POSID)   AS POSID
      ,'6'   AS GUBN
      ,MAX(T6.NAMET) AS NAMET
      ,MAX(T6.MOB_NUMBER) AS MOB_NUMBER
      ,MAX(T6.TRAID) AS TRAID
      ,MAX(T6.AEDAT) AS AEDAT
      ,MAX(T6.UZEIT) AS UZEIT
      ,MAX(T6.ERNAM) AS ERNAM
      ,'' AS TPLSTDT1
      ,'' AS TPLSTDT2
      ,'' AS TPLSTDT3
      ,'' AS TPLSTDT4
      ,'' AS TPLSTDT5
      ,'' AS TPLSTDTQTY1
      ,'' AS TPLSTDTQTY2
      ,'' AS TPLSTDTQTY3
      ,'' AS TPLSTDTQTY4
      ,'' AS TPLSTDTQTY5
      ,'' AS TPLSTDTZTON1
      ,'' AS TPLSTDTZTON2
      ,'' AS TPLSTDTZTON3
      ,'' AS TPLSTDTZTON4
      ,'' AS TPLSTDTZTON5
      ,'' AS TPLSTDT6
      ,'' AS TPLSTDTQTY6
      ,'' AS TPLSTDTZTON6
      ,'' AS TPLSTDT7
      ,'' AS TPLSTDTQTY7
      ,'' AS TPLSTDTZTON7
      ,MAX(T6.CHNGCONFIRM) AS CHNGCONFIRM
      ,MAX(T6.LIFNR) AS LIFNRCO
      FROM SAPHEE.ZLET006 AS T6
           INNER JOIN SAPHEE.ZLET007 AS T7 ON  T6.MANDT  = T7.MANDT
                                           AND T6.ZKNUM  = T7.ZKNUM
                                           AND T6.ZKNUM2 = T7.ZKNUM2
      WHERE T6.MANDT =  #G_MANDT#
        AND T6.ERDAT =  #ERDAT#
        AND T6.ZKNUM LIKE '_%'
          AND SUBSTR(T7.POSID,1,1) NOT IN ('C','E')
  --        AND T6.ZTYPE =  #ZTYPE#         
        AND T6.DELCONFIRM = 'Y'
      GROUP BY T6.MANDT,T6.ZKNUM,T6.ZKNUM2

      ) AS LE002


      LEFT OUTER JOIN SAPHEE.TZONT     AS TZONT ON  TZONT.MANDT  = LE002.MANDT
                                                AND TZONT.SPRAS  = '3'
                                                AND TZONT.LAND1  = 'KR'
                                                AND TZONT.ZONE1  = LE002.ZLZONE
      
    
      LEFT OUTER JOIN SAPHEE.ZMASTER01 AS MA01 ON MA01.MANDT= LE002.MANDT
	                                             AND MA01.POSID = COALESCE(CASE WHEN SUBSTR(LE002.POSID,1,2)='QM' THEN SUBSTR(LE002.POSID,3,6)
                                                                                             WHEN SUBSTR(LE002.POSID,1,1)='Q'  THEN SUBSTR(LE002.POSID,2,6) 
                                                                                             WHEN SUBSTR(LE002.POSID,1,1)='V'  THEN SUBSTR(LE002.POSID,2,6)
                                                                                             WHEN SUBSTR(LE002.POSID,7,2)='NC' THEN LE002.POSID       ELSE SUBSTR(LE002.POSID,1,6) END,'')    
WHERE 1=1
)

SELECT 
 '' AS FLAG
, '0' AS CHECK
, T1.MANDT
, T1.ZKNUM
, T1.ZKNUM2
,CASE WHEN T1.ZKNUM2 > '' THEN T2.PSPID ELSE T1.PSPID END AS PSPID2
, T1.PSPID
, CASE WHEN vbak.viptp = 'X' THEN '[VIP]'||T1.POST1 ELSE T1.POST1 END POST1
, CASE WHEN T1.TPLSTDT1 = '' AND T1.TPLSTDT2 = '' AND T1.TPLSTDT3 = '' AND T1.TPLSTDT4 = '' AND T1.TPLSTDT5 = ''
    THEN T1.BEZEI ELSE LF1.NAME1 END BEZEI
, CASE WHEN T1.TPLSTDT1 = '' AND T1.TPLSTDT2 = '' AND T1.TPLSTDT3 = '' AND T1.TPLSTDT4 = '' AND T1.TPLSTDT5 = ''
    THEN T1.ZTON ELSE T1.TPLSTDTZTON1 END ZTON
, T1.ZLZONE_NM
, T1.ZZACTSS
--,case when lt001.lifcd = 'A' then '로지'
--      when lt001.lifcd = 'B' then '신원'
--      else '' END as lifcd
,case when T1.LIFNRCO = '3148131696'   then '로지'
      when T1.LIFNRCO = '1018194310'   then '신원'
      else '' END as lifcd   
,LF1.NAME1 AS  TPLSTDT1
,LF2.NAME1 AS  TPLSTDT2
,LF3.NAME1 AS  TPLSTDT3
,LF4.NAME1 AS  TPLSTDT4
,LF5.NAME1 AS  TPLSTDT5
,VARCHAR(T1.TPLSTDTZTON1, 30) AS TPLSTDTZTON1
,VARCHAR(T1.TPLSTDTZTON2, 30) AS TPLSTDTZTON2
,VARCHAR(T1.TPLSTDTZTON3, 30) AS TPLSTDTZTON3
,VARCHAR(T1.TPLSTDTZTON4, 30) AS TPLSTDTZTON4
,VARCHAR(T1.TPLSTDTZTON5, 30) AS TPLSTDTZTON5   
,LF6.NAME1 AS  TPLSTDT6
,VARCHAR(T1.TPLSTDTZTON6, 30) AS TPLSTDTZTON6
,LF7.NAME1 AS  TPLSTDT7
,VARCHAR(T1.TPLSTDTZTON7, 30) AS TPLSTDTZTON7   
FROM TMP T1
LEFT OUTER JOIN TMP T2 ON  T2.MANDT = T1.MANDT AND T2.ZKNUM = T1.ZKNUM AND T2.ZKNUM2 = '' 
left outer join saphee.zlet001_1 as lt001 on T1.mandt = lt001.mandt and T1.ZLZONE = lt001.zone1
left outer join saphee.VBAK AS vbak on T1.mandt = vbak.mandt and T1.pspid = vbak.zzpjt_id
left outer join SAPHEE.ZMMT012 as LF1 on t1.TPLSTDT1 = LF1.LIFNR 
left outer join SAPHEE.ZMMT012 as LF2 on t1.TPLSTDT2 = LF2.LIFNR 
left outer join SAPHEE.ZMMT012 as LF3 on t1.TPLSTDT3 = LF3.LIFNR 
left outer join SAPHEE.ZMMT012 as LF4 on t1.TPLSTDT4 = LF4.LIFNR 
left outer join SAPHEE.ZMMT012 as LF5 on t1.TPLSTDT5 = LF5.LIFNR 
left outer join SAPHEE.ZMMT012 as LF6 on t1.TPLSTDT6 = LF6.LIFNR
left outer join SAPHEE.ZMMT012 as LF7 on t1.TPLSTDT7 = LF7.LIFNR
WHERE 1=1
<isEqual col="LIFCD" value="A">
        --and lt001.lifcd = 'A'
         AND T1.LIFNRCO = '3148131696'      
</isEqual>
<isEqual col="LIFCD" value="B">
        --and lt001.lifcd = 'B'
        AND T1.LIFNRCO = '1018194310'
</isEqual>
ORDER BY PSPID2, ZKNUM ,ZKNUM2
FOR FETCH ONLY
WITH UR	
	</statement>
	<input default-name="ds_cond">
		<input default-name="ds_cond">
		<col name="G_MANDT" size="255" type="VARCHAR" description="" /> 
		<col name="PJT" size="255" type="VARCHAR" description="" /> 
		<col name="ERDAT" size="255" type="VARCHAR" description="" /> 
	</input>
	</input>
	<output default-name="ds_list">
		<col name="ZKNUM" size="255" type="VARCHAR" description="" />
		<col name="ZKNUM2" size="255" type="VARCHAR" description="" />		
	</output>
</query>
