<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
    <type>select</type>
    <description><![CDATA[PS1601011A_S4]]></description>
    <reload>true</reload>
    <monitoring>true</monitoring>
    <result-count>1</result-count>
    <statement>
    WITH TEMP AS (
        SELECT substr(HOLIDAY_YMD,1,6) AS HOLIDAY_YMD
      , INTEGER(RIGHT(LAST_DAY( CAST(LEFT(substr(HOLIDAY_YMD,1,6),4)||'-'||substr(substr(HOLIDAY_YMD,1,6),5,2)||'-'||'01' AS DATE)),2) ) - COUNT(*) AS CNT
          FROM DB2WEB.TB_HOLIDAY
      GROUP BY substr(HOLIDAY_YMD,1,6)
    )
    SELECT Q.MANDT
        , L.TEAM_CD
        , L.TEAM_NM AS TEMNM
        , L.ZZACTSS_CD
        , L.ZZACTSS_NM
        , Q.LIFNR
      --  , C.NAME1 AS LIFNRNM 
        , (SELECT DISTINCT NN.NAME1 FROM SAPHEE.ZPST0034 NN WHERE NN.MANDT = Q.MANDT   AND NN.LIFNR = Q.LIFNR  AND NN.GBN = 'A' AND (SO = 'X' OR SO3 = 'X')) AS LIFNRNM
        , '' AS PRST_PERNO
        , Q.TEMNO
        , (SELECT NAMET FROM SAPHEE.ZPST0002 WHERE MANDT = Q.MANDT AND TEMNO = Q.TEMNO) AS NAMET2  
        , Q.QC_RT           AS QC_RT              --QC합격률
        , Q.QC_POINT        AS QC_POINT           --환산점수
        , Q.JQPR_CNT        AS JQPR_CNT           --JQPR
        , Q.JQPR_POINT      AS JQPR_POINT             
        , Q.AVG_PER_CNT     AS AVG_PER_CNT        --평균인원
        , Q.AVG_PER_POINT   AS AVG_PER_POINT      --인원관리 환산점수
        , Q.INP_RT          AS INP_RT             --투입률
        , Q.INP_POINT       AS INP_POINT          --작업일보 환산점수
        , Q.PER_INST_CNT    AS PER_INST_CNT       --설치실적 인당설치기성대수
        , Q.PER_INST_POINT  AS PER_INST_POINT     --설치실적 환산점수
        , Q.SAF_ACCT_CNT    AS SAF_ACCT_CNT       --안전사고건수
        , Q.SAF_ACCT_POINT  AS SAF_ACCT_POINT     --안전경고(사고)
        , Q.EVAL_IMNO_CNT   AS EVAL_IMNO_CNT      --안전점검 중대위반건수
        , Q.EVAL_IMNO_POINT AS EVAL_IMNO_POINT    --안전점검 환산점수
        , Q.PER_PER_CNT     AS PER_PER_CNT        --준공관리 인당대수
        , Q.PER_PER_POINT   AS PER_PER_POINT      --준공관리 환산점수
        , Q.MINWON_CNT      AS MINWON_CNT         --민원건수합계
        , Q.MINWON_POINT    AS MINWON_POINT       --환산점수9
        , DEC(Q.TOT_POINT, 10,2) AS TOT_POINT
        , RANK() OVER( ORDER BY SUM( CASE WHEN DEC(Q.TOT_POINT, 10,2) IS NULL THEN 0.00 ELSE DEC(Q.TOT_POINT, 10,2) END ) OVER (PARTITION BY Q.LIFNR, Q.TEMNO ORDER BY Q.LIFNR, Q.TEMNO ) DESC) AS RANKING
     FROM (
       SELECT MANDT, LIFNR, TEMNO
        , CASE WHEN SUM(QC_RT) IS NULL THEN 0 ELSE SUM(QC_RT) END AS QC_RT          --QC합격률
        , CASE WHEN SUM(QC_POINT) IS NULL THEN 0 ELSE SUM(QC_POINT) END AS QC_POINT      --환산점수
        , CASE WHEN SUM(JQPR_CNT) IS NULL THEN 0 ELSE SUM(JQPR_CNT) END AS JQPR_CNT      --JQPR
        , CASE WHEN SUM(JQPR_POINT) IS NULL THEN 0 ELSE SUM(JQPR_POINT) END AS JQPR_POINT
        , CASE WHEN SUM(AVG_PER_CNT) IS NULL THEN 0 ELSE SUM(AVG_PER_CNT) END AS AVG_PER_CNT    --평균인원
        , CASE WHEN SUM(AVG_PER_POINT) IS NULL THEN 0 ELSE SUM(AVG_PER_POINT) END AS AVG_PER_POINT  --인원관리 환산점수
        , CASE WHEN SUM(INP_RT) IS NULL THEN 0 ELSE SUM(INP_RT) END AS INP_RT --투입률
        , CASE WHEN SUM(INP_POINT) IS NULL THEN 0 ELSE SUM(INP_POINT) END AS INP_POINT  --작업일보 환산점수
        , CASE WHEN SUM(PER_INST_CNT) IS NULL THEN 0 ELSE SUM(PER_INST_CNT) END AS PER_INST_CNT --설치실적 인당설치기성대수
        , CASE WHEN SUM(PER_INST_POINT) IS NULL THEN 0 ELSE SUM(PER_INST_POINT) END AS PER_INST_POINT --설치실적 환산점수
        , CASE WHEN SUM(SAF_ACCT_CNT) IS NULL THEN 0 ELSE SUM(SAF_ACCT_CNT) END AS SAF_ACCT_CNT           --안전사고건수
        , CASE WHEN SUM(SAF_ACCT_POINT) IS NULL OR SUM(SAF_ACCT_POINT) = 0.0 THEN CAST(REPLACE(#VAR6#, ' ', '') AS DOUBLE) ELSE SUM(SAF_ACCT_POINT) END AS SAF_ACCT_POINT     --안전경고(사고)
        , CASE WHEN SUM(EVAL_IMNO_CNT) IS NULL THEN 0 ELSE SUM(EVAL_IMNO_CNT) END AS EVAL_IMNO_CNT        --안전점검 중대위반건수
        , CASE WHEN SUM(EVAL_IMNO_POINT) IS NULL THEN 0 ELSE SUM(EVAL_IMNO_POINT) END AS EVAL_IMNO_POINT  --안전점검 환산점수
        , CASE WHEN SUM(PER_PER_CNT) IS NULL THEN 0 ELSE SUM(PER_PER_CNT) END AS PER_PER_CNT              --준공관리 인당대수
        , CASE WHEN SUM(PER_PER_POINT) IS NULL THEN 0 ELSE SUM(PER_PER_POINT) END AS PER_PER_POINT        --준공관리 환산점수
        , CASE WHEN SUM(MINWON_CNT) IS NULL THEN 0 ELSE SUM(MINWON_CNT) END AS MINWON_CNT                 --민원건수합계
        , CASE WHEN SUM(MINWON_POINT) IS NULL THEN 0 ELSE SUM(MINWON_POINT) END AS MINWON_POINT           --환산점수9
        , CASE WHEN SUM(QC_POINT) IS NULL THEN 0 ELSE SUM(QC_POINT) END
          +CASE WHEN SUM(JQPR_POINT) IS NULL THEN 0 ELSE SUM(JQPR_POINT) END
          +CASE WHEN SUM(AVG_PER_POINT) IS NULL THEN 0 ELSE SUM(AVG_PER_POINT) END
          +CASE WHEN SUM(INP_POINT) IS NULL THEN 0 ELSE SUM(INP_POINT) END
          +CASE WHEN SUM(PER_INST_POINT) IS NULL THEN 0 ELSE SUM(PER_INST_POINT) END
          +CASE WHEN SUM(SAF_ACCT_POINT) IS NULL OR SUM(SAF_ACCT_POINT) = 0.0 THEN CAST(REPLACE(#VAR6#, ' ', '') AS DOUBLE) ELSE SUM(SAF_ACCT_POINT) END
          +CASE WHEN SUM(EVAL_IMNO_POINT) IS NULL THEN 0 ELSE SUM(EVAL_IMNO_POINT) END
          +CASE WHEN SUM(PER_PER_POINT) IS NULL THEN 0 ELSE SUM(PER_PER_POINT) END
          +CASE WHEN SUM(MINWON_POINT) IS NULL THEN 0 ELSE SUM(MINWON_POINT) END
          AS TOT_POINT
         FROM (
              SELECT MANDT, LIFNR, TEMNO
                       , NULLIF(DEC(DEC((dec(APPROVED_SUM,10,1)/nullif(dec(FIRSTEXAM_SUM,10,1),0)) * 100,10,1),10,1),0)  AS QC_RT           --QC합격률
                      -- , NULLIF(DEC(DEC((dec(APPROVED_SUM,10,1)/nullif(dec(FIRSTEXAM_SUM,10,1),0)) * 100,10,1)*0.15,10,1),0) AS QC_POINT    --환산점수
                       , NULLIF(DEC(DEC((dec(APPROVED_SUM,10,1)/nullif(dec(FIRSTEXAM_SUM,10,1),0)) * 100,10,1)*CAST(REPLACE(#VAR1#, ' ', '') AS DOUBLE),10,1),0) AS QC_POINT    --환산점수
                       , 0 AS JQPR_CNT
                       , 0 AS JQPR_POINT
                       , 0 AS AVG_PER_CNT   --평균인원
                       , 0 AS AVG_PER_POINT  --인원관리 환산점수
                       , 0 AS INP_RT
                       , 0 AS INP_POINT
                       , 0 AS PER_INST_CNT  --설치실적 인당설치기성대수
                       , 0 AS PER_INST_POINT  --설치실적 환산점수
                       , 0 AS SAF_ACCT_CNT  --안전경고(사고) 안전사고건수
                       , 0 AS SAF_ACCT_POINT  --안전경고(사고) 환산점수
                       , 0 AS EVAL_IMNO_CNT  --안전점검 중대위반건수
                       , 0 AS EVAL_IMNO_POINT  --안전점검 환산점수
                       , 0 AS PER_PER_CNT   --준공관리 인당대수
                       , 0 AS PER_PER_POINT --준공관리 환산점수
                       , 0 AS MINWON_CNT  --민원건수합계
                       , 0 AS MINWON_POINT  --민원관리 환산점수9
               FROM (
                      SELECT  MANDT, LIFNR, TEMNO
                       , SUM(FIRSTEXAM) AS FIRSTEXAM_SUM
                       , SUM(APPROVED)  AS APPROVED_SUM
                  FROM (
                    SELECT  MANDT, PAPRYYYYMM ,LIFNR, TEMNO
                       , SUM(FIRSTEXAM) AS FIRSTEXAM
                       , SUM(APPROVED) AS APPROVED
                      FROM (
                          SELECT
                                 A.MANDT
                                ,substr(A.PAPRDT,1,6)  AS PAPRYYYYMM
                                ,A.LIFNR
                                ,A.TEMNO
                                ,(CASE WHEN A.seq = '01' THEN COUNT(*) ELSE 0 END)  AS FIRSTEXAM
                                ,(CASE WHEN (A.DSCODE = 'A' OR A.DSCODE = 'B' OR A.DSCODE = 'C' OR A.DSCODE = 'D') THEN COUNT(*) ELSE 0 END)  AS APPROVED 
                            FROM SAPHEE.ZQMT019 AS A             
                          INNER JOIN SAPHEE.ZPST0034  AS C ON A.MANDT = C.MANDT AND A.LIFNR = C.LIFNR AND C.GBN = 'A' AND (C.SO = 'X' OR C.SO3 = 'X')            
                          LEFT OUTER JOIN SAPHEE.ZMASTER02 M02 ON M02.MANDT = A.MANDT AND M02.POSID = A.PSPID AND M02.POSID_1 =  A.HOGI
                           WHERE A.MANDT = #G_MANDT#
                             AND A.ART = '8960'
                             AND A.SEQ = '01'
                             AND (substr(A.PAPRDT,1,6) BETWEEN #YYYYMMF#  AND #YYYYMMT#) 
                             AND C.SO5 <![CDATA[<>]]> 'X'
                             <isNotNull col="ZTEMNO">
                             AND A.TEMNO = #ZTEMNO#
                             </isNotNull>
                             <isNotNull col="ZZLIFNR">
                             AND A.LIFNR = #ZZLIFNR#
                             </isNotNull>
                             <isNotNull col="CHK_GBN">
                             AND A.ZZGUBUN = #CHK_GBN#
                             </isNotNull>
                             AND ( A.VDATUM    <![CDATA[  <> ]]>   '00000000' AND A.VDATUM   >   '')
                             AND A.LIFNR    <![CDATA[  <> ]]>   '0000008001'
                        GROUP BY A.MANDT, substr(A.PAPRDT,1,6), A.LIFNR,A.TEMNO, A.PSPID, A.HOGI, A.SEQ, A.DSCODE
               )  GROUP BY MANDT,PAPRYYYYMM, LIFNR ,TEMNO
          ) GROUP BY MANDT, LIFNR,TEMNO
     )  -- 품질관리  END  1
     UNION ALL  -- 자재관리  START 2
     (
     
    SELECT MANDT, LIFNR, TEMNO
          , 0 AS QC_RT
          , 0 AS QC_POINT
         -- , DEC(nullif(CNT_SUM,0)/DEC(DIFF_MON, 10,1), 10,1) AS JQPR_CNT  --귀책건수
          , CASE WHEN CNT_SUM IS NULL THEN 0.00 ELSE DEC(CNT_SUM, 10,2) END AS JQPR_CNT  --귀책건수
          , CASE WHEN DEC((QC_SUM), 10,2) IS NULL THEN 0.00
                WHEN DEC((QC_SUM), 10,2) <![CDATA[ < ]]>  0.00 THEN 0.00
                WHEN DEC((QC_SUM), 10,2) <![CDATA[ > ]]>  CAST(REPLACE(#VAR3#, ' ', '') AS DOUBLE) THEN CAST(REPLACE(#VAR3#, ' ', '') AS DOUBLE)
           ELSE DEC((QC_SUM), 10,2)  END
          + CASE WHEN DEC((POINT_SUM), 10,2) IS NULL THEN 0.00
                WHEN DEC((POINT_SUM), 10,2) <![CDATA[ < ]]> 0.00 THEN 0.00
                WHEN DEC((POINT_SUM), 10,2) <![CDATA[ > ]]> CAST(REPLACE(#VAR2#, ' ', '') AS DOUBLE) THEN CAST(REPLACE(#VAR2#, ' ', '') AS DOUBLE)
           ELSE DEC((POINT_SUM), 10,2)  END  AS JQPR_POINT     --환산점수
          , 0 AS AVG_PER_CNT   --평균인원
          , 0 AS AVG_PER_POINT  --인원관리 환산점수
          , 0 AS INP_RT   --투입률
          , 0 AS INP_POINT  --작업일보 환산점수
          , 0 AS PER_INST_CNT  --설치실적 인당설치기성대수
          , 0 AS PER_INST_POINT  --설치실적 환산점수
          , 0 AS SAF_ACCT_CNT  --안전경고(사고) 안전사고건수
          , 0 AS SAF_ACCT_POINT  --안전경고(사고) 환산점수
          , 0 AS EVAL_IMNO_CNT  --안전점검 중대위반건수
          , 0 AS EVAL_IMNO_POINT  --안전점검 환산점수
          , 0 AS PER_PER_CNT   --준공관리 인당대수
          , 0 AS PER_PER_POINT --준공관리 환산점수
          , 0 AS MINWON_CNT  --민원건수합계
          , 0 AS MINWON_POINT  --민원관리 환산점수9
       FROM ( 
               SELECT MANDT, LIFNR, TEMNO
                    , SUM(CNT) AS CNT_SUM
                    , SUM(OCCAMT)  AS OCCAMT_SUM
                    , SUM(JUNG_CNT)  AS JUNG_CNT_SUM
              --      , CASE WHEN DEC(5.00 - CASE WHEN  SUM(JUNG_CNT) IS NULL THEN 0.00 ELSE  DEC( DEC(SUM(CNT) ,10,2) / DEC(NULLIF(SUM(JUNG_CNT), 0),10,2) * 40.00, 10, 2)  END , 10, 2) IS NULL THEN 5.00 ELSE DEC(5.00 - CASE WHEN  SUM(JUNG_CNT)  IS NULL THEN 0.00 ELSE   DEC( DEC(SUM(CNT) ,10,2) / DEC(NULLIF(SUM(JUNG_CNT), 0),10,2) * 40.00, 10, 2) END , 10, 2) END AS POINT_SUM
              --      , CASE WHEN DEC(5.00 - CASE WHEN  SUM(JUNG_CNT) IS NULL THEN 0.00 ELSE   DEC( DEC(SUM(OCCAMT) ,10,2) / DEC(NULLIF(SUM(JUNG_CNT), 0),10,2) / 6000.00, 10, 2) END , 10, 2) IS NULL THEN 5.00 ELSE  DEC(5.00 - CASE WHEN  SUM(JUNG_CNT) IS NULL THEN 0.00 ELSE   DEC( DEC(SUM(OCCAMT) ,10,2) / DEC(NULLIF(SUM(JUNG_CNT), 0),10,2) / 6000.00, 10, 2) END , 10, 2) END AS QC_SUM
                --    , CASE WHEN DEC(CAST(REPLACE(#VAR2#, ' ', '') AS DOUBLE) - CASE WHEN  SUM(JUNG_CNT) IS NULL THEN 0.00 ELSE  DEC( DEC(SUM(CNT) ,10,2) / DEC(NULLIF(SUM(JUNG_CNT), 0),10,2) * CAST(REPLACE(#VAR4#, ' ', '') AS DOUBLE), 10, 2)  END , 10, 2) IS NULL THEN CAST(REPLACE(#VAR2#, ' ', '') AS DOUBLE) ELSE DEC(CAST(REPLACE(#VAR2#, ' ', '') AS DOUBLE) - CASE WHEN  SUM(JUNG_CNT)  IS NULL THEN 0.00 ELSE   DEC( DEC(SUM(CNT) ,10,2) / DEC(NULLIF(SUM(JUNG_CNT), 0),10,2) * CAST(REPLACE(#VAR4#, ' ', '') AS DOUBLE), 10, 2) END , 10, 2) END AS POINT_SUM
                --    , CASE WHEN DEC(CAST(REPLACE(#VAR3#, ' ', '') AS DOUBLE) - CASE WHEN  SUM(JUNG_CNT) IS NULL THEN 0.00 ELSE   DEC( DEC(SUM(OCCAMT) ,10,2) / DEC(NULLIF(SUM(JUNG_CNT), 0),10,2) / CAST(REPLACE(#VAR5#, ' ', '') AS DOUBLE), 10, 2) END , 10, 2) IS NULL THEN CAST(REPLACE(#VAR3#, ' ', '') AS DOUBLE) ELSE  DEC(CAST(REPLACE(#VAR3#, ' ', '') AS DOUBLE) - CASE WHEN  SUM(JUNG_CNT) IS NULL THEN 0.00 ELSE   DEC( DEC(SUM(OCCAMT) ,10,2) / DEC(NULLIF(SUM(JUNG_CNT), 0),10,2) / CAST(REPLACE(#VAR5#, ' ', '') AS DOUBLE), 10, 2) END , 10, 2) END AS QC_SUM
                    , CASE WHEN SUM(JUNG_CNT) IS NULL OR SUM(JUNG_CNT) = 0.00 THEN 0.00 ELSE  DEC(CAST(REPLACE(#VAR2#, ' ', '') AS DOUBLE) - DEC( DEC(SUM(CNT) ,10,2) / DEC(NULLIF(SUM(JUNG_CNT), 0),10,2) * CAST(REPLACE(#VAR4#, ' ', '') AS DOUBLE), 10, 2) , 10, 2)  END AS POINT_SUM
                    , CASE WHEN SUM(JUNG_CNT) IS NULL OR SUM(JUNG_CNT) = 0.00 THEN 0.00 ELSE  DEC(CAST(REPLACE(#VAR3#, ' ', '') AS DOUBLE) - DEC( DEC(SUM(OCCAMT) ,20,2) / DEC(NULLIF(SUM(JUNG_CNT), 0),10,2) / CAST(REPLACE(#VAR5#, ' ', '') AS DOUBLE), 10, 2) , 10, 2)  END AS QC_SUM

                FROM (
                  SELECT PAPRYYYYMM, MANDT, LIFNR, TEMNO
                       , CASE WHEN SUM(CNT) IS NULL THEN 0.00 ELSE SUM(CNT) END AS CNT  
                       , CASE WHEN SUM(OCCAMT) IS NULL THEN 0.00 ELSE SUM(OCCAMT) END AS OCCAMT  
                       , CASE WHEN SUM(JUNG_CNT) IS NULL THEN 0.00 ELSE SUM(JUNG_CNT) END AS JUNG_CNT  
                    FROM (
                         SELECT A.MANDT
                              ,substr(A.CREDT,1,6)  AS PAPRYYYYMM
                              ,A.LIFNR
                              ,A.TEMNO
                              ,COUNT(*) AS CNT --건수
                              ,(SUM(A.IWBTR) + SUM(A.OWBTR))*100 AS OCCAMT     -- 발생금액  
                              ,0 AS JUNG_CNT 
                           FROM SAPHEE.ZQMT007 AS A                        
                            INNER JOIN SAPHEE.ZPST0034 AS C ON A.MANDT = C.MANDT AND A.LIFNR = C.LIFNR AND C.GBN = 'A' AND (C.SO = 'X' OR C.SO3 = 'X')  
                       LEFT OUTER JOIN SAPHEE.ZMASTER02 M02 ON M02.MANDT = A.MANDT AND M02.POSID = A.PSPID AND M02.POSID_1 =  A.HOGI
                       LEFT OUTER JOIN SAPHEE.KNA1 AS K 
					                      ON A.MANDT  = K.MANDT 
					                     AND A.IMPLFN = K.KUNNR
                          WHERE A.MANDT = #G_MANDT#
                            AND (A.LIFNR IS NOT NULL OR A.LIFNR != '' OR A.LIFNR != ' ')
                            AND A.WERKS BETWEEN '1000' AND '3110'
		  					AND A.STATUS IN ('3','4','5','6')
                          --  AND A.LIFNR <![CDATA[ <> ]]> '0000008098'
                            AND A.GUBUN = 'J'
                            AND (substr(A.CREDT,1,6) BETWEEN #YYYYMMF#  AND #YYYYMMT#)
                            AND A.LIFNR = K.STCD2 -- 설치귀책만 조회되도록
                            AND C.SO5 <![CDATA[<>]]> 'X'
                            
                            <isNotNull col="ZTEMNO">
                            AND A.TEMNO = #ZTEMNO#
                            </isNotNull>
                            <isNotNull col="ZZLIFNR">
                            AND A.LIFNR = #ZZLIFNR#
                            </isNotNull>
                            <isNotNull col="CHK_GBN">
                            AND M02.ZZGUBUN = #CHK_GBN#
                            </isNotNull>
                       GROUP BY  A.MANDT, substr(A.CREDT,1,6), A.LIFNR ,A.TEMNO, A.PSPID, A.HOGI, A.JQPRNUM
                           UNION ALL 
                           (
                               SELECT A.MANDT
                                    , substr(A.ZBOSUOUT,1,6)  AS PAPRYYYYMM--준공월
                                    , A.LIFNR 
                                    , A.TEMNO2 AS TEMNO
                                    , 0 AS CNT
                                    , 0 AS OCCAMT
                                    , COUNT(*) AS JUNG_CNT
                                 FROM SAPHEE.ZMASTER02 AS A
                           INNER JOIN SAPHEE.ZPST0034 AS C ON A.MANDT = C.MANDT AND A.LIFNR = C.LIFNR AND C.GBN = 'A' AND (C.SO = 'X' OR C.SO3 = 'X')  
                                WHERE A.MANDT = #G_MANDT#
                                  AND (substr(A.ZBOSUOUT,1,6) BETWEEN #YYYYMMF#  AND #YYYYMMT#) 
                                  AND C.SO5 <![CDATA[<>]]> 'X'
                                  AND A.TXT04      <![CDATA[ <> ]]>   'C'
                                  <isNotNull col="ZTEMNO">
                                  AND A.TEMNO2 = #ZTEMNO#
                                  </isNotNull>
                                  <isNotNull col="ZZLIFNR">
                                  AND A.LIFNR = #ZZLIFNR#      
                                  </isNotNull>
                                  <isNotNull col="CHK_GBN">
                                  AND A.ZZGUBUN = #CHK_GBN#
                                  </isNotNull>
                                  <isNotNull col="CHK_GBN">
                                  <isEqual col="CHK_GBN" value="10">
                                  AND (C.EL_INDC = 'X' OR (C.EL_INDC = 'X' AND C.ES_INDC = 'X')) AND A.LIFNR  <![CDATA[  <> ]]> '0000008001'
                                  </isEqual>
                                  </isNotNull>
                                  <isNotNull col="CHK_GBN">
                                  <isEqual col="CHK_GBN" value="11">
                                  AND (C.ES_INDC = 'X' OR (C.ES_INDC = 'X' AND C.ES_INDC = 'X')) AND A.LIFNR  <![CDATA[  <> ]]> '0000008001'
                                  </isEqual>
                                  </isNotNull>
                             GROUP BY A.MANDT, substr(A.ZBOSUOUT,1,6),  A.LIFNR, A.TEMNO2
                          )    
                    <isNotNull col="YYYYMMDD0" >
                    UNION ALL
                    (
                     SELECT MANDT, substr(#YYYYMMDD0#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                     , 0 AS CNT
                                      , 0 AS OCCAMT 
                                      , 0 AS JUNG_CNT 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD0#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD0#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                              ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>

                        <isNotNull col="YYYYMMDD1" >
                         UNION ALL
                        (
                         SELECT MANDT, substr(#YYYYMMDD1#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                              , 0 AS CNT
                              , 0 AS OCCAMT 
                              , 0 AS JUNG_CNT 
                           FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD1#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD1#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                              ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD2" >
                        UNION ALL
                        (
                         SELECT MANDT, substr(#YYYYMMDD2#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                              , 0 AS CNT
                              , 0 AS OCCAMT 
                              , 0 AS JUNG_CNT 
                           FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD2#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD2#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                              ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD3" >
                         UNION ALL
                        (
                         SELECT MANDT, substr(#YYYYMMDD3#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                              , 0 AS CNT
                              , 0 AS OCCAMT 
                              , 0 AS JUNG_CNT 
                           FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD3#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD3#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                              ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD4" >
                        UNION ALL
                        (
                         SELECT MANDT, substr(#YYYYMMDD4#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                              , 0 AS CNT
                              , 0 AS OCCAMT 
                              , 0 AS JUNG_CNT 
                           FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD4#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD4#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                              ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD5" >
                        UNION ALL
                        (
                         SELECT MANDT, substr(#YYYYMMDD5#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                              , 0 AS CNT
                              , 0 AS OCCAMT 
                              , 0 AS JUNG_CNT 
                           FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD5#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD5#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                              ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD6" >
                        UNION ALL
                        (
                         SELECT MANDT, substr(#YYYYMMDD6#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                              , 0 AS CNT
                              , 0 AS OCCAMT 
                              , 0 AS JUNG_CNT 
                           FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD6#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD6#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                              ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD7" >
                        UNION ALL
                        (
                         SELECT MANDT, substr(#YYYYMMDD7#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                              , 0 AS CNT
                              , 0 AS OCCAMT 
                              , 0 AS JUNG_CNT 
                           FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD7#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD7#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                              ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD8" >
                        UNION ALL
                        (
                         SELECT MANDT, substr(#YYYYMMDD8#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                              , 0 AS CNT
                              , 0 AS OCCAMT 
                              , 0 AS JUNG_CNT 
                           FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD8#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD8#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                             ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD9" >
                        UNION ALL
                        (
                         SELECT MANDT, substr(#YYYYMMDD9#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                              , 0 AS CNT
                              , 0 AS OCCAMT 
                              , 0 AS JUNG_CNT 
                           FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD9#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD9#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                              ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD10" >
                        UNION ALL
                        (
                         SELECT MANDT, substr(#YYYYMMDD10#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                              , 0 AS CNT
                              , 0 AS OCCAMT 
                              , 0 AS JUNG_CNT 
                           FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD10#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD10#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                              ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD11" >
                        UNION ALL
                        (
                         SELECT MANDT, substr(#YYYYMMDD11#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                              , 0 AS CNT
                              , 0 AS OCCAMT 
                              , 0 AS JUNG_CNT 
                           FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD11#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                         --    AND LIFNR = '1058619749'      
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                                  SELECT MANDT, LIFNR, TEMNO, PERKEY
                                    FROM SAPHEE.ZPST0001  
                                   WHERE 1=1 
                                     AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD11#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND POSIT = 'X'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO#
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                   ) GROUP BY MANDT, PAPRYYYYMM, LIFNR ,TEMNO
               )  GROUP BY MANDT, LIFNR ,TEMNO
        )
     )   --자재관리 UNION END 2
     UNION ALL  --인원관리 START 3
     (
         SELECT MANDT, LIFNR, TEMNO
                , 0 AS QC_RT           -- QC합격률
                , 0 AS QC_POINT        -- 환산점수
                , 0 AS JQPR_CNT
                , 0 AS JQPR_POINT
                , DEC(DEC(nullif(CNT4_SUM,0),10,1)/ DEC(DIFF_MON, 10,1), 10,1) AS AVG_PER_CNT --인원
                , SAPHEE.GET_POINTS(#G_MANDT#, '1601003', '2', CASE WHEN DEC(DEC(nullif(CNT4_SUM,0),10,1)/ DEC(DIFF_MON, 10,1), 10,0) > 10
                													THEN 10
                													ELSE DEC(DEC(nullif(CNT4_SUM,0),10,1)/ DEC(DIFF_MON, 10,1), 10,0)
                													END) AS AVG_PER_POINT
                , 0 AS INP_RT   --투입률
                , 0 AS INP_POINT  --작업일보 환산점수
                , 0 AS PER_INST_CNT  --설치실적 인당설치기성대수
                , 0 AS PER_INST_POINT  --설치실적 환산점수
                , 0 AS SAF_ACCT_CNT  --안전경고(사고) 안전사고건수
                , 0 AS SAF_ACCT_POINT  --안전경고(사고) 환산점수
                , 0 AS EVAL_IMNO_CNT  --안전점검 중대위반건수
                , 0 AS EVAL_IMNO_POINT  --안전점검 환산점수
                , 0 AS PER_PER_CNT   --준공관리 인당대수
                , 0 AS PER_PER_POINT --준공관리 환산점수
                , 0 AS MINWON_CNT  --민원건수합계
                , 0 AS MINWON_POINT  --민원관리 환산점수9
             FROM ( 
                    SELECT MANDT, LIFNR, TEMNO
                         , SUM( CNT4 )   AS CNT4_SUM  --평균근속연수
                         --, SUM( CNT5 )   AS CNT5_SUM  -- 근속연수 환산점수 합
                         , CAST(REPLACE(#DIFF_MON#, ' ', '0') AS INT) AS DIFF_MON
                    FROM (
                      SELECT MANDT, PAPRYYYYMM, LIFNR, TEMNO
                           , SUM(CNT1) AS CNT4
                           , SUM(CNT2) AS CNT5  
                        FROM (
                            <isNotNull col="YYYYMMDD0" >
		              		(
		                    SELECT MANDT, substr(#YYYYMMDD0#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                    , DEC(AVG(CAREY), 10,1) AS CNT1
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END
		                    
		                     ) AS CNT2
		                  FROM (
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD0#,1,4)||'-'||substr(#YYYYMMDD0#,5,2)||'-'||substr(#YYYYMMDD0#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER <![CDATA[ <= ]]> #YYYYMMDD0#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD0#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
		                  <isNotNull col="YYYYMMDD1" >
		                  UNION ALL
		                  (
		                    SELECT MANDT, substr(#YYYYMMDD1#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                    , DEC(AVG(CAREY), 10,1) AS CNT1
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END ) AS CNT2
		                  FROM (
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD1#,1,4)||'-'||substr(#YYYYMMDD1#,5,2)||'-'||substr(#YYYYMMDD1#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD1#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD1#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
		                  <isNotNull col="YYYYMMDD2" >
		                  UNION ALL
		                  (
		                     SELECT MANDT, substr(#YYYYMMDD2#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                          , DEC(AVG(CAREY), 10,1) AS CNT1
		                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
		                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
		                   --        ELSE 0
		                   --        END AS CNT2
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END ) AS CNT2
		                  FROM (
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD2#,1,4)||'-'||substr(#YYYYMMDD2#,5,2)||'-'||substr(#YYYYMMDD2#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12) ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD2#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD2#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
		                  <isNotNull col="YYYYMMDD3" >
		                  UNION ALL
		                  (
		                    SELECT MANDT, substr(#YYYYMMDD3#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                    , DEC(AVG(CAREY), 10,1) AS CNT1
		                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
		                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
		                   --        ELSE 0
		                   --        END AS CNT2
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END ) AS CNT2
		                  FROM (
		                      
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD3#,1,4)||'-'||substr(#YYYYMMDD3#,5,2)||'-'||substr(#YYYYMMDD3#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD3#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD3#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
		                  <isNotNull col="YYYYMMDD4" >
		                  UNION ALL
		                  (
		                    SELECT MANDT, substr(#YYYYMMDD4#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                    , DEC(AVG(CAREY), 10,1) AS CNT1
		                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
		                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
		                   --        ELSE 0
		                   --        END AS CNT2
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END ) AS CNT2
		                  FROM (
		                      
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD4#,1,4)||'-'||substr(#YYYYMMDD4#,5,2)||'-'||substr(#YYYYMMDD4#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD4#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD4#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
		                  <isNotNull col="YYYYMMDD5" >
		                  UNION ALL
		                  (
		                    SELECT MANDT, substr(#YYYYMMDD5#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                    , DEC(AVG(CAREY), 10,1) AS CNT1
		                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
		                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
		                   --        ELSE 0
		                   --        END AS CNT2
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END ) AS CNT2
		                  FROM (
		                      
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD5#,1,4)||'-'||substr(#YYYYMMDD5#,5,2)||'-'||substr(#YYYYMMDD5#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER     <![CDATA[ <= ]]> #YYYYMMDD5#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID <![CDATA[ <= ]]> #YYYYMMDD5# AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
		                  <isNotNull col="YYYYMMDD6" >
		                  UNION ALL
		                  (
		                    SELECT MANDT, substr(#YYYYMMDD6#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                         , DEC(AVG(CAREY), 10,1) AS CNT1
		                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
		                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
		                   --        ELSE 0
		                   --        END AS CNT2
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END ) AS CNT2
		                  FROM (
		                      
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD6#,1,4)||'-'||substr(#YYYYMMDD6#,5,2)||'-'||substr(#YYYYMMDD6#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12) ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD6#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD6#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
		                 <isNotNull col="YYYYMMDD7" >
		                  UNION ALL
		                  (
		                    SELECT MANDT, substr(#YYYYMMDD7#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                    , DEC(AVG(CAREY), 10,1) AS CNT1
		                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
		                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
		                   --        ELSE 0
		                   --        END AS CNT2
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END ) AS CNT2
		                  FROM (
		                      
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD7#,1,4)||'-'||substr(#YYYYMMDD7#,5,2)||'-'||substr(#YYYYMMDD7#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD7#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD7#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
		                 <isNotNull col="YYYYMMDD8" >
		                  UNION ALL
		                  (
		                    SELECT MANDT, substr(#YYYYMMDD8#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                    , DEC(AVG(CAREY), 10,1) AS CNT1
		                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
		                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
		                   --        ELSE 0
		                   --        END AS CNT2
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END ) AS CNT2
		                  FROM (
		                      
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD8#,1,4)||'-'||substr(#YYYYMMDD8#,5,2)||'-'||substr(#YYYYMMDD8#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD8#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD8#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
		                 <isNotNull col="YYYYMMDD9" >
		                  UNION ALL
		                  (
		                    SELECT MANDT, substr(#YYYYMMDD9#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                    , DEC(AVG(CAREY), 10,1) AS CNT1
		                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
		                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
		                   --        ELSE 0
		                   --        END AS CNT2
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END ) AS CNT2
		                  FROM (
		                     
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD9#,1,4)||'-'||substr(#YYYYMMDD9#,5,2)||'-'||substr(#YYYYMMDD9#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12) ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD9#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD9#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE 
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
		                 <isNotNull col="YYYYMMDD10" >
		                  UNION ALL
		                  (
		                    SELECT MANDT, substr(#YYYYMMDD10#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                    , DEC(AVG(CAREY), 10,1) AS CNT1
		                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
		                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
		                   --        ELSE 0
		                   --        END AS CNT2
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END ) AS CNT2
		                  FROM (
		                      
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD10#,1,4)||'-'||substr(#YYYYMMDD10#,5,2)||'-'||substr(#YYYYMMDD10#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD10#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD10#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE 
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
		                  <isNotNull col="YYYYMMDD11" >
		                  UNION ALL
		                  (
		                    SELECT MANDT, substr(#YYYYMMDD11#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
		                    , DEC(AVG(CAREY), 10,1) AS CNT1
		                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
		                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
		                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
		                   --        ELSE 0
		                   --        END AS CNT2
		                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
		                                                                       THEN 10
		                                                                       ELSE TRUNCATE(AVG(CAREY))
		                                                                       END ) AS CNT2
		                  FROM (
		                      
		                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
		                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD11#,1,4)||'-'||substr(#YYYYMMDD11#,5,2)||'-'||substr(#YYYYMMDD11#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
		                     FROM( 
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                        FROM SAPHEE.ZPST0001
		                       WHERE 1=1 
		                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD11#
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>   
		                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                 EXCEPT
		                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
		                        FROM SAPHEE.ZPST0001  
		                       WHERE 1=1 
		                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD11#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
		                         AND GBN = 'A'
		                         AND TYPE = '1'
		                         AND MANDT = #G_MANDT#
		                         <isNotNull col="ZTEMNO">
		                         AND TEMNO = #ZTEMNO# 
		                         </isNotNull>
		                         <isNotNull col="ZZLIFNR">
		                         AND LIFNR = #ZZLIFNR#      
		                         </isNotNull>
		                         <isNotNull col="CHK_GBN2">
		                         AND GUBUN = #CHK_GBN2#
		                         </isNotNull>
		                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
		                     ) GROUP BY MANDT, LIFNR, TEMNO
		                  )
		                  </isNotNull>
                    ) GROUP BY MANDT, PAPRYYYYMM, LIFNR, TEMNO
              ) GROUP BY MANDT, LIFNR, TEMNO
          )
     )  -- 인원관리 UNION END 3 
     UNION ALL  --작업일보 START 9
     (
         SELECT 
                MANDT, LIFNR, TEMNO
             , 0 AS QC_RT           --QC합격률
             , 0 AS QC_POINT    --   환산점수
             , 0 AS JQPR_CNT
             , 0 AS JQPR_POINT
             , 0 AS AVG_PER_CNT   --평균인원
             , 0 AS AVG_PER_POINT  --인원관리 환산점수
             , NULLIF(DEC((dec(CNT2_SUM,10,1)/nullif(dec(CNT_SUM,10,1),0))* 100,10,1),0) AS INP_RT
            -- , CASE WHEN (NULLIF(DEC((dec(CNT2_SUM,10,1)/nullif(dec(CNT_SUM,10,1),0))* 100,10,1),0)*0.1) > 10 THEN 10 ELSE (NULLIF(DEC((dec(CNT2_SUM,10,1)/nullif(dec(CNT_SUM,10,1),0))* 100,10,1),0)*0.1) END AS INP_POINT
             , CASE WHEN (NULLIF(DEC((dec(CNT2_SUM,10,1)/nullif(dec(CNT_SUM,10,1),0))* 100,10,1),0)* CAST(REPLACE(#VAR13#, ' ', '') AS DECIMAL(10,1)) ) > 10 THEN 10 ELSE (NULLIF(DEC((dec(CNT2_SUM,10,1)/nullif(dec(CNT_SUM,10,1),0))* 100,10,1),0)* CAST(REPLACE(#VAR13#, ' ', '') AS DECIMAL(10,1)) ) END AS INP_POINT
             , 0 AS PER_INST_CNT  --설치실적 인당설치기성대수
             , 0 AS PER_INST_POINT  --설치실적 환산점수
             , 0 AS SAF_ACCT_CNT  --안전경고(사고) 안전사고건수
             , 0 AS SAF_ACCT_POINT  --안전경고(사고) 환산점수
             , 0 AS EVAL_IMNO_CNT  --안전점검 중대위반건수
             , 0 AS EVAL_IMNO_POINT  --안전점검 환산점수
             , 0 AS PER_PER_CNT   --준공관리 인당대수
             , 0 AS PER_PER_POINT --준공관리 환산점수
             , 0 AS MINWON_CNT  --민원건수합계
             , 0 AS MINWON_POINT  --민원관리 환산점수9
          FROM (
          SELECT 
                 MANDT, LIFNR, TEMNO
                , SUM( CNT21 )  AS CNT2_SUM
                , SUM( CNT )    AS CNT_SUM
          FROM (
          SELECT 
                PAPRYYYYMM, MANDT, LIFNR, TEMNO
                , SUM(CNT) AS CNT  --보유
               -- , DEC((nullif(SUM(CNT2),0)/nullif((SELECT CNT FROM TEMP WHERE HOLIDAY_YMD = PAPRYYYYMM),0)) / 10 , 10, 1) AS CNT21  --투입인원
                , DEC((nullif(SUM(CNT2),0)/nullif((SELECT CNT FROM TEMP WHERE HOLIDAY_YMD = PAPRYYYYMM),0)) / CAST(REPLACE(#VAR14#, ' ', '0') AS DOUBLE) , 10, 1) AS CNT21  --투입인원
          FROM (
                   (
                       SELECT substr(a.inp_dt,1,6) AS PAPRYYYYMM
                            , a.MANDT                                         
                            , a.LIFNR
                            , a.TMCD AS TEMNO
                            , 0 AS CNT
                            , SUM(c.M_MH)+ SUM(c.A_MH) + SUM(c.N_MH) AS CNT2   
                            , 0 AS CNT3
                         FROM SAPHEE.zpstw0301 AS a
                         LEFT OUTER JOIN SAPHEE.zpstw0302 AS c
                                      ON a.inp_dt = c.inp_dt
                                     AND a.lifnr = c.lifnr
                                     AND a.perno = c.perno
                         LEFT OUTER JOIN  SAPHEE.ZMASTER02 M02 
                                      ON M02.MANDT = c.MANDT  AND M02.POSID = c.PSPID AND M02.POSID_1 =  c.POSID
                         WHERE substr(a.inp_dt,1,6) BETWEEN #YYYYMMF#  AND #YYYYMMT#
                           AND ( a.tuip_chka = 'X' OR (a.tuip_chkb = 'X' AND a.sayu = 'H' AND a.sayu = 'J' AND a.sayu = 'F') )
                           <isNotNull col="CHK_GBN">
                           AND M02.ZZGUBUN = #CHK_GBN#
                           </isNotNull>
                     --    AND c.pspid IS NOT NULL AND c.posid IS NOT NULL
                           GROUP BY substr(a.inp_dt,1,6), A.MANDT, A.LIFNR, A.TMCD
                          ) 
                         <isNotNull col="YYYYMMDD0" >
                         UNION ALL
                        (
                                     SELECT  substr(#YYYYMMDD0#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                  AND MANDT = #G_MANDT#
                                                  AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD0#
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                   <isNotNull col="ZTEMNO">
                                                  AND TEMNO = #ZTEMNO# 
                                                  </isNotNull>
                                                  <isNotNull col="ZZLIFNR">
                                                  AND LIFNR = #ZZLIFNR#      
                                                  </isNotNull>
                                                  <isNotNull col="CHK_GBN2">
                                                  AND GUBUN = #CHK_GBN2#
                                                  </isNotNull>
                                           GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND MANDT = #G_MANDT#
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD0#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR, TEMNO
                            )
                             </isNotNull>
                         <isNotNull col="YYYYMMDD1" >
                         UNION ALL
                        (
                            SELECT  substr(#YYYYMMDD1#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                  , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                              FROM (
                                       SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                        FROM SAPHEE.ZPST0001 
                                           WHERE 1=1 
                                             AND MANDT = #G_MANDT#
                                             AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD1#
                                             AND GBN = 'A'
                                             AND TYPE = '1'
                                             AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                              <isNotNull col="ZTEMNO">
                                             AND TEMNO = #ZTEMNO# 
                                             </isNotNull>
                                             <isNotNull col="ZZLIFNR">
                                             AND LIFNR = #ZZLIFNR#      
                                             </isNotNull>
                                             <isNotNull col="CHK_GBN2">
                                             AND GUBUN = #CHK_GBN2#
                                             </isNotNull>  
                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                      EXCEPT
                                       SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                       FROM (
                                            SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                              FROM SAPHEE.ZPST0001
                                             WHERE 1=1 
                                               AND MANDT = #G_MANDT#
                                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD1#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                               AND GBN = 'A'
                                               AND TYPE = '1'
                                               AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                               <isNotNull col="ZTEMNO">
                                               AND TEMNO = #ZTEMNO# 
                                               </isNotNull>
                                               <isNotNull col="ZZLIFNR">
                                               AND LIFNR = #ZZLIFNR#      
                                               </isNotNull>
                                               <isNotNull col="CHK_GBN2">
                                               AND GUBUN = #CHK_GBN2#
                                               </isNotNull>
                                            ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                  )  
                                  GROUP BY MANDT, LIFNR, TEMNO
                            )
                         </isNotNull>
                         <isNotNull col="YYYYMMDD2" >
                         UNION ALL
                        (
                                    SELECT  substr(#YYYYMMDD2#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                  AND MANDT = #G_MANDT#
                                                  AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD2#
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                   <isNotNull col="ZTEMNO">
                                                  AND TEMNO = #ZTEMNO# 
                                                  </isNotNull>
                                                  <isNotNull col="ZZLIFNR">
                                                  AND LIFNR = #ZZLIFNR#      
                                                  </isNotNull>
                                                  <isNotNull col="CHK_GBN2">
                                                  AND GUBUN = #CHK_GBN2#
                                                  </isNotNull>  
                                         --    AND LIFNR = '1321110475'      
                                           GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND MANDT = #G_MANDT#
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD2#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR, TEMNO
                            )
                             </isNotNull>
                         <isNotNull col="YYYYMMDD3" >
                         UNION ALL
                        (
                                   SELECT  substr(#YYYYMMDD3#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                  AND MANDT = #G_MANDT#
                                                  AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD3#
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                   <isNotNull col="ZTEMNO">
                                                  AND TEMNO = #ZTEMNO# 
                                                  </isNotNull>
                                                  <isNotNull col="ZZLIFNR">
                                                  AND LIFNR = #ZZLIFNR#      
                                                  </isNotNull>
                                                  <isNotNull col="CHK_GBN2">
                                                  AND GUBUN = #CHK_GBN2#
                                                  </isNotNull>  
                                         --    AND LIFNR = '1321110475'      
                                           GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND MANDT = #G_MANDT#
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD3#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR, TEMNO
                            )
                             </isNotNull>
                         <isNotNull col="YYYYMMDD4" >
                         UNION ALL
                        (
                                  SELECT  substr(#YYYYMMDD4#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                  AND MANDT = #G_MANDT#
                                                  AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD4#
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                   <isNotNull col="ZTEMNO">
                                                  AND TEMNO = #ZTEMNO# 
                                                  </isNotNull>
                                                  <isNotNull col="ZZLIFNR">
                                                  AND LIFNR = #ZZLIFNR#      
                                                  </isNotNull>
                                                  <isNotNull col="CHK_GBN2">
                                                  AND GUBUN = #CHK_GBN2#
                                                  </isNotNull>  
                                         --    AND LIFNR = '1321110475'      
                                           GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND MANDT = #G_MANDT#
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD4#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR, TEMNO
                            )
                             </isNotNull>
                         <isNotNull col="YYYYMMDD5" >
                         UNION ALL
                        (
                                   SELECT  substr(#YYYYMMDD5#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                  AND MANDT = #G_MANDT#
                                                  AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD5#
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                   <isNotNull col="ZTEMNO">
                                                  AND TEMNO = #ZTEMNO# 
                                                  </isNotNull>
                                                  <isNotNull col="ZZLIFNR">
                                                  AND LIFNR = #ZZLIFNR#      
                                                  </isNotNull>
                                                  <isNotNull col="CHK_GBN2">
                                                  AND GUBUN = #CHK_GBN2#
                                                  </isNotNull>
                                           GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND MANDT = #G_MANDT#
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD5#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                 ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR, TEMNO
                            )
                             </isNotNull>
                          <isNotNull col="YYYYMMDD6" >
                         UNION ALL
                        (
                                   SELECT  substr(#YYYYMMDD6#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                  AND MANDT = #G_MANDT#
                                                  AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD6#
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                   <isNotNull col="ZTEMNO">
                                                  AND TEMNO = #ZTEMNO# 
                                                  </isNotNull>
                                                  <isNotNull col="ZZLIFNR">
                                                  AND LIFNR = #ZZLIFNR#      
                                                  </isNotNull>
                                                  <isNotNull col="CHK_GBN2">
                                                  AND GUBUN = #CHK_GBN2#
                                                  </isNotNull>
                                           GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND MANDT = #G_MANDT#
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD6#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                 ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR, TEMNO
                            )
                             </isNotNull>
                          <isNotNull col="YYYYMMDD7" >
                         UNION ALL
                        (
                                   SELECT  substr(#YYYYMMDD7#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                  AND MANDT = #G_MANDT#
                                                  AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD7#
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                   <isNotNull col="ZTEMNO">
                                                  AND TEMNO = #ZTEMNO# 
                                                  </isNotNull>
                                                  <isNotNull col="ZZLIFNR">
                                                  AND LIFNR = #ZZLIFNR#      
                                                  </isNotNull>
                                                  <isNotNull col="CHK_GBN2">
                                                  AND GUBUN = #CHK_GBN2#
                                                  </isNotNull>
                                           GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND MANDT = #G_MANDT#
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD7#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                 ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR, TEMNO
                            )
                             </isNotNull>
                          <isNotNull col="YYYYMMDD8" >
                         UNION ALL
                        (
                                   SELECT  substr(#YYYYMMDD8#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                  AND MANDT = #G_MANDT#
                                                  AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD8#
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                   <isNotNull col="ZTEMNO">
                                                  AND TEMNO = #ZTEMNO# 
                                                  </isNotNull>
                                                  <isNotNull col="ZZLIFNR">
                                                  AND LIFNR = #ZZLIFNR#      
                                                  </isNotNull>
                                                  <isNotNull col="CHK_GBN2">
                                                  AND GUBUN = #CHK_GBN2#
                                                  </isNotNull>
                                           GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND MANDT = #G_MANDT#
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD8#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                 ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR, TEMNO
                            )
                             </isNotNull>
                          <isNotNull col="YYYYMMDD9" >
                         UNION ALL
                        (
                                   SELECT  substr(#YYYYMMDD9#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                  AND MANDT = #G_MANDT#
                                                  AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD9#
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                   <isNotNull col="ZTEMNO">
                                                  AND TEMNO = #ZTEMNO# 
                                                  </isNotNull>
                                                  <isNotNull col="ZZLIFNR">
                                                  AND LIFNR = #ZZLIFNR#      
                                                  </isNotNull>
                                                  <isNotNull col="CHK_GBN2">
                                                  AND GUBUN = #CHK_GBN2#
                                                  </isNotNull>
                                           GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND MANDT = #G_MANDT#
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD9#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                 ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR, TEMNO
                            )
                             </isNotNull>
                          <isNotNull col="YYYYMMDD10" >
                         UNION ALL
                        (
                                   SELECT  substr(#YYYYMMDD10#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                  AND MANDT = #G_MANDT#
                                                  AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD10#
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                   <isNotNull col="ZTEMNO">
                                                  AND TEMNO = #ZTEMNO# 
                                                  </isNotNull>
                                                  <isNotNull col="ZZLIFNR">
                                                  AND LIFNR = #ZZLIFNR#      
                                                  </isNotNull>
                                                  <isNotNull col="CHK_GBN2">
                                                  AND GUBUN = #CHK_GBN2#
                                                  </isNotNull>
                                           GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND MANDT = #G_MANDT#
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD10#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                 ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR, TEMNO
                            )
                             </isNotNull>
                          <isNotNull col="YYYYMMDD11" >
                         UNION ALL
                        (
                                   SELECT  substr(#YYYYMMDD11#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                  AND MANDT = #G_MANDT#
                                                  AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD11#
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                   <isNotNull col="ZTEMNO">
                                                  AND TEMNO = #ZTEMNO# 
                                                  </isNotNull>
                                                  <isNotNull col="ZZLIFNR">
                                                  AND LIFNR = #ZZLIFNR#      
                                                  </isNotNull>
                                                  <isNotNull col="CHK_GBN2">
                                                  AND GUBUN = #CHK_GBN2#
                                                  </isNotNull>
                                           GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND MANDT = #G_MANDT#
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD11#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND (TEMNO IS NOT NULL AND TEMNO != '' AND TEMNO != ' ')
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                 ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR, TEMNO
                            )
                             </isNotNull>
                   )  GROUP BY PAPRYYYYMM, MANDT, LIFNR, TEMNO
                ) GROUP BY MANDT, LIFNR, TEMNO
              )
     ) --작업일보 END 9 
     UNION ALL   -- 설치실적 START 5 
     (
       SELECT 
               MANDT, LIFNR, TEMNO
             , 0 AS QC_RT           --QC합격률
             , 0 AS QC_POINT    --   환산점수
             , 0 AS JQPR_CNT
             , 0 AS JQPR_POINT
             , 0 AS AVG_PER_CNT   --평균인원
             , 0 AS AVG_PER_POINT  --인원관리 환산점수
             , 0 AS INP_RT
             , 0 AS INP_POINT
             , CNT1_SUM  AS PER_INST_CNT
           , SAPHEE.GET_POINTS(#G_MANDT#, '1601005','3',CNT1_SUM) AS PER_INST_POINT
           , 0 AS SAF_ACCT_CNT  --안전경고(사고) 안전사고건수
           , 0 AS SAF_ACCT_POINT  --안전경고(사고) 환산점수
           , 0 AS EVAL_IMNO_CNT  --안전점검 중대위반건수
           , 0 AS EVAL_IMNO_POINT  --안전점검 환산점수
           , 0 AS PER_PER_CNT   --준공관리 인당대수
           , 0 AS PER_PER_POINT --준공관리 환산점수
           , 0 AS MINWON_CNT  --민원건수합계
           , 0 AS MINWON_POINT  --민원관리 환산점수9
        FROM (
            SELECT MANDT  
                 , LIFNR
                 , TEMNO
                 , CNT_SUM
                 , TOT_MH_SUM
                 , CNT2_SUM   --투입인원
                 , DEC(  ( dec(TOT_MH_SUM,10,2) / DEC(CNT2_SUM, 10,2)) / dec(CNT_SUM / counting, 10, 2)  , 10, 2) AS CNT1_SUM --평균 인당설치기성대수
              FROM (
                 SELECT MANDT, LIFNR, TEMNO
                      , SUM(TOT_MH) AS TOT_MH_SUM
                      , SUM(CNT2)   AS CNT2_SUM
                      , SUM(CNT)    AS CNT_SUM
                      , CAST(REPLACE(#DIFF_MON#, ' ', '0') AS INT) AS DIFF_MON
                      , COUNT(LIFNR) AS counting
                 FROM (
                  SELECT PAPRYYYYMM, MANDT,  LIFNR, TEMNO
                     --  , (nullif((SELECT CNT FROM TEMP WHERE HOLIDAY_YMD = PAPRYYYYMM),0) * 10 ) AS CNT
                       , (nullif((SELECT CNT FROM TEMP WHERE HOLIDAY_YMD = PAPRYYYYMM),0) * CAST(REPLACE(#VAR10#, ' ', '') AS DOUBLE) ) AS CNT
                       , SUM(TOT_MH) AS TOT_MH
                       , DEC(nullif(SUM(CNT2),0), 10, 1) AS CNT2  --투입인원
                    FROM (
                           (
                              SELECT
                                    TAXDATE AS PAPRYYYYMM  
                                    , MANDT 
                                    , LIFNR 
                                    , TEMNO
                                    , 0  AS CNT2   
                                    , SUM(TOT_MH) AS TOT_MH
                                  FROM (  
                                         SELECT
                                              MANDT
                                            , TAXDATE   
                                            , PSPID
                                            , POSID
                                            , SEQNO
                                            , LIFNR  
                                            , TEMNO
                                            , DEC(DEC(SUM(PRO_R)/100,10,3) * (DEC((CASE WHEN MAX(WSCALE) = 0
									                                                    THEN 0
									                                                    ELSE DEC(MAX(TOT)/MAX(WSCALE), 10,3)
									                                                    END), 10,2)), 10,2) AS TOT_MH
                                            FROM (
                                              SELECT 
                                                    A.MANDT
                                                   ,substr(A.TAXDATE,1,6) AS TAXDATE
                                                   , A.PSPID
                                                   , A.POSID 
                                                   , A.SEQNO 
                                                   , B.CHGNO
                                                   , A.LIFNR 
                                                   , C.TEMNO2 AS TEMNO
                                                   , A.PRO_R
                                                   , B.LABMH
                                                   , B.TOT
                                                   , B.WSCALE
                                                FROM SAPHEE.ZPST0116 AS A 
                                                  INNER JOIN SAPHEE.ZPST0034 AS K 
                                                 ON A.MANDT = K.MANDT AND A.LIFNR = K.LIFNR AND K.GBN = 'A' AND (K.SO = 'X' OR K.SO3 = 'X')
                                                INNER JOIN SAPHEE.ZPST0100 AS B
                                                  ON A.MANDT = B.MANDT
                                                 AND A.PSPID = B.PSPID
                                                 AND A.POSID = B.POSID
                                               INNER JOIN (
                                                SELECT S.MANDT, S.PSPID, S.POSID,  S.CHGNO
                                                    FROM (
                                                        SELECT MANDT, PSPID, POSID, MAX(CHGNO)  AS CHGNO
                                                          FROM saphee.ZPST0113 WHERE CNF_GBN='A' AND GUBUN='5' AND STATE='Y'
                                                      GROUP BY MANDT, PSPID, POSID
                                                 ) S
                                            ) AS P
                                             ON A.MANDT = P.MANDT
                                              AND A.PSPID = P.PSPID
                                              AND A.POSID = P.POSID
                                              AND B.CHGNO = P.CHGNO
                                             INNER JOIN SAPHEE.ZMASTER02 AS C
                                                     ON A.MANDT = C.MANDT
                                                    AND A.PSPID = C.POSID
                                                    AND A.POSID = C.POSID_1
                                           WHERE A.MANDT = #G_MANDT#  
                                             AND (SUBSTR(A.TAXDATE,1,6) BETWEEN #YYYYMMF#  AND #YYYYMMT#) 
                                             AND K.SO5 <![CDATA[<>]]> 'X'
                                             AND A.BELNR > '0000000000'    
                                             <isNotNull col="ZTEMNO">
                                             AND C.TEMNO2 = #ZTEMNO#
                                             </isNotNull>
                                             <isNotNull col="ZZLIFNR">
                                             AND A.LIFNR = #ZZLIFNR#      
                                             </isNotNull>
                                             <isNotNull col="CHK_GBN">
                                             AND  A.GUBUN = #CHK_GBN#
                                             </isNotNull> 
                                            )  GROUP BY MANDT, TAXDATE, LIFNR, TEMNO, PSPID , POSID,  SEQNO
                                    ) GROUP BY MANDT, TAXDATE, LIFNR, TEMNO
                          )
                          <isNotNull col="YYYYMMDD0" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD0#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD0#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD0# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                                             <isNotNull col="YYYYMMDD1" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD1#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD1#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD1# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                                             <isNotNull col="YYYYMMDD2" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD2#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD2#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD2# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                                             <isNotNull col="YYYYMMDD3" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD3#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD3#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD3# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                                             <isNotNull col="YYYYMMDD4" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD4#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD4#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD4# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                                             <isNotNull col="YYYYMMDD5" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD5#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD5#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD5# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                                             <isNotNull col="YYYYMMDD6" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD6#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD6#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD6# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                                             <isNotNull col="YYYYMMDD7" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD7#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD7#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD7# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                                             <isNotNull col="YYYYMMDD8" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD8#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD8#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD8# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                                             <isNotNull col="YYYYMMDD9" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD9#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD9#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD9# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                                             <isNotNull col="YYYYMMDD10" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD10#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD10#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD10# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                                             <isNotNull col="YYYYMMDD11" >
                                             UNION ALL
                                             (
                                                 SELECT substr(#YYYYMMDD11#,1,6)  AS PAPRYYYYMM,MANDT, LIFNR, TEMNO 
                                                      , CASE WHEN COUNT(PERKEY) IS NULL THEN 0 ELSE COUNT(PERKEY) END AS CNT2  --보유인원
                                                      , 0 AS TOT_MH
                                                  FROM (
                                                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                        FROM SAPHEE.ZPST0001 
                                                       WHERE 1=1 
                                                         AND ENTER <![CDATA[  <= ]]> #YYYYMMDD11#
                                                         AND GBN = 'A'
                                                         AND TYPE = '1'
                                                         AND MANDT = #G_MANDT#
                                                         <isNotNull col="ZTEMNO">
                                                         AND TEMNO = #ZTEMNO# 
                                                         </isNotNull>
                                                         <isNotNull col="ZZLIFNR">
                                                         AND LIFNR = #ZZLIFNR#      
                                                         </isNotNull>
                                                         <isNotNull col="CHK_GBN2">
                                                         AND GUBUN = #CHK_GBN2#
                                                         </isNotNull>
                                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                      EXCEPT
                                                          SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                            FROM SAPHEE.ZPST0001
                                                           WHERE 1=1 
                                                             AND (RETID <![CDATA[  <= ]]> #YYYYMMDD11# AND RETID  <![CDATA[  <> ]]> '00000000' AND RETID  <![CDATA[  <> ]]>  '')
                                                             AND GBN = 'A'
                                                             AND TYPE = '1'
                                                             AND MANDT = #G_MANDT#
                                                             <isNotNull col="ZTEMNO">
                                                             AND TEMNO = #ZTEMNO# 
                                                             </isNotNull>
                                                             <isNotNull col="ZZLIFNR">
                                                             AND LIFNR = #ZZLIFNR#      
                                                             </isNotNull>
                                                             <isNotNull col="CHK_GBN2">
                                                             AND GUBUN = #CHK_GBN2#
                                                             </isNotNull>
                                                             GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                                          )  GROUP BY MANDT, LIFNR,TEMNO
                                                         
                                             ) 
                                             </isNotNull>
                   ) AS J GROUP BY PAPRYYYYMM, MANDT, LIFNR, TEMNO
           )  GROUP BY  MANDT, LIFNR, TEMNO
          )
        )
     )  --설치실적 END 5
     UNION ALL  --안전경고(사고) START   4
     (
          SELECT  MANDT, LIFNR, TEMNO
              , 0 AS QC_RT           --QC합격률
              , 0 AS QC_POINT    --   환산점수
              , 0 AS JQPR_CNT
              , 0 AS JQPR_POINT
              , 0 AS AVG_PER_CNT   --평균인원
              , 0 AS AVG_PER_POINT  --인원관리 환산점수
              , 0 AS INP_RT
              , 0 AS INP_POINT
              , 0 AS PER_INST_CNT  --설치실적 인당설치기성대수
              , 0 AS PER_INST_POINT  --설치실적 환산점수
              , ITEM_CNT2_SUM AS SAF_ACCT_CNT  --안전경고(사고) 안전사고건수
              --, 10- dec(( dec(ITEM_CNT1_SUM,10,1) * 0.5)+( dec(ITEM_CNT2_SUM,10,1)* 3.0)+( dec(ITEM_CNT3_SUM,10,1) * 7.0),10,1)  AS SAF_ACCT_POINT  --안전경고(사고) 환산점수
              ,   CAST(REPLACE(#VAR6#, ' ', '') AS DOUBLE)- dec(( dec(ITEM_CNT1_SUM,10,1) * CAST(REPLACE(#VAR7#, ' ', '') AS DOUBLE))+( dec(ITEM_CNT2_SUM,10,1)* CAST(REPLACE(#VAR8#, ' ', '') AS DOUBLE))+( dec(ITEM_CNT3_SUM,10,1) * CAST(REPLACE(#VAR9#, ' ', '') AS DOUBLE)),10,1)  AS SAF_ACCT_POINT  --안전경고(사고) 환산점수
              , 0 AS EVAL_IMNO_CNT  --안전점검 중대위반건수
              , 0 AS EVAL_IMNO_POINT  --안전점검 환산점수
              , 0 AS PER_PER_CNT   --준공관리 인당대수
              , 0 AS PER_PER_POINT --준공관리 환산점수
              , 0 AS MINWON_CNT  --민원건수합계
              , 0 AS MINWON_POINT  --민원관리 환산점수9
             FROM (
          SELECT  MANDT, LIFNR, TEMNO
                , SUM(ITEM_CNT1) AS ITEM_CNT1_SUM
                , SUM(ITEM_CNT2) AS ITEM_CNT2_SUM
                , SUM(ITEM_CNT3) AS ITEM_CNT3_SUM
             FROM (
               SELECT MANDT, PAPRYYYYMM, LIFNR, TEMNO
                    , CASE WHEN SUM(ITEM_CNT1) IS NULL THEN 0 ELSE SUM(ITEM_CNT1) END AS ITEM_CNT1
                    , CASE WHEN SUM(ITEM_CNT2) IS NULL THEN 0 ELSE SUM(ITEM_CNT2) END AS ITEM_CNT2
                    , CASE WHEN SUM(ITEM_CNT3) IS NULL THEN 0 ELSE SUM(ITEM_CNT3) END AS ITEM_CNT3
                FROM (
                 SELECT
                        A.MANDT
                      , substr(A.OCURDATE,1,6)  AS PAPRYYYYMM
                      , A.LIFNR
                      , A.TEMNO
                      , (CASE WHEN A.ITEM = 'A' THEN COUNT(*) ELSE 0 END)  AS ITEM_CNT1
                      , (CASE WHEN A.ITEM = 'C' THEN COUNT(*) ELSE 0 END)  AS ITEM_CNT2
                      , (CASE WHEN A.ITEM = 'D' THEN COUNT(*) ELSE 0 END)  AS ITEM_CNT3
                    FROM SAPHEE.ZPST0154 AS A       
                     INNER JOIN SAPHEE.ZPST0034 AS C ON A.MANDT = C.MANDT AND A.LIFNR = C.LIFNR AND C.GBN = 'A' AND (C.SO = 'X' OR C.SO3 = 'X')                 
                    LEFT OUTER JOIN  SAPHEE.ZMASTER02 M02 ON M02.MANDT = A.MANDT AND M02.POSID = A.PSPID AND M02.POSID_1 =  A.POSID
                 --   LEFT OUTER JOIN SAPHEE.ZPST0002 AS B ON A.MANDT = B.MANDT AND A.TEMNO = B.TEMNO AND B.DELEF = ''
                 WHERE A.MANDT = #G_MANDT#
                   AND (substr(A.OCURDATE,1,6) BETWEEN #YYYYMMF#  AND #YYYYMMT#) 
                   AND C.SO5 <![CDATA[<>]]> 'X'
                    <isNotNull col="ZTEMNO">
                   AND A.TEMNO = #ZTEMNO#
                   </isNotNull>
                   <isNotNull col="ZZLIFNR">
                   AND A.LIFNR = #ZZLIFNR#      
                   </isNotNull>
                   <isNotNull col="CHK_GBN">
                   AND  M02.ZZGUBUN = #CHK_GBN#
                   </isNotNull>
              GROUP BY A.MANDT, substr(A.OCURDATE,1,6), A.LIFNR, A.TEMNO, A.PSPID, A.POSID, A.ITEM
                                
                <isNotNull col="YYYYMMDD0" >
                    UNION ALL
                    (
                     SELECT MANDT, substr(#YYYYMMDD0#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD0#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD0#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                       
                        <isNotNull col="YYYYMMDD1" >
                        UNION ALL
                        (
                        
                       
                     SELECT MANDT, substr(#YYYYMMDD1#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD1#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD1#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD2" >
                        UNION ALL
                        (
                        
                       
                     SELECT MANDT, substr(#YYYYMMDD2#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD2#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                         --    AND LIFNR = '1058619749'      
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD2#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD3" >
                        UNION ALL
                        (
                        
                       
                     SELECT MANDT, substr(#YYYYMMDD3#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD3#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                         --    AND LIFNR = '1058619749'      
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD3#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD4" >
                        UNION ALL
                        (
                        
                      
                     SELECT MANDT, substr(#YYYYMMDD4#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD4#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                         --    AND LIFNR = '1058619749'      
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD4#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD5" >
                        UNION ALL
                        (
                       
                     SELECT MANDT, substr(#YYYYMMDD5#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD5#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                         --    AND LIFNR = '1058619749'      
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD5#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD6" >
                        UNION ALL
                        (
                       
                     SELECT MANDT, substr(#YYYYMMDD6#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD6#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                         --    AND LIFNR = '1058619749'      
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD6#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD7" >
                        UNION ALL
                        (
                       
                     SELECT MANDT, substr(#YYYYMMDD7#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD7#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                         --    AND LIFNR = '1058619749'      
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD7#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD8" >
                        UNION ALL
                        (
                      
                     SELECT MANDT, substr(#YYYYMMDD8#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD8#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                         --    AND LIFNR = '1058619749'      
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD8#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                        <isNotNull col="YYYYMMDD9" >
                        UNION ALL
                        (
                       
                     SELECT MANDT, substr(#YYYYMMDD9#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD9#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                         --    AND LIFNR = '1058619749'      
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD9#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                       <isNotNull col="YYYYMMDD10" >
                        UNION ALL
                        (
                       
                     SELECT MANDT, substr(#YYYYMMDD10#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD10#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                         --    AND LIFNR = '1058619749'      
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD10#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
                       <isNotNull col="YYYYMMDD11" >
                        UNION ALL
                        (
                       
                     SELECT MANDT, substr(#YYYYMMDD11#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                                , 0 AS ITEM_CNT1
                                , 0 AS ITEM_CNT2
                                , 0 AS ITEM_CNT3 
                        FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001
                             WHERE 1=1 
                               AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD11#
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                         --    AND LIFNR = '1058619749'      
                          GROUP BY MANDT, LIFNR, TEMNO, PERKEY
                       EXCEPT
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM (
                            SELECT MANDT, LIFNR, TEMNO, PERKEY
                              FROM SAPHEE.ZPST0001  
                             WHERE 1=1 
                               AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD11#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                               AND GBN = 'A'
                               AND TYPE = '1'
                               AND POSIT = 'X'
                               AND MANDT = #G_MANDT#
                               <isNotNull col="ZTEMNO">
                               AND TEMNO = #ZTEMNO# 
                               </isNotNull>
                               <isNotNull col="ZZLIFNR">
                               AND LIFNR = #ZZLIFNR#      
                               </isNotNull>
                               <isNotNull col="CHK_GBN2">
                               AND GUBUN = #CHK_GBN2#
                               </isNotNull>
                               --   AND LIFNR = '1321110475'
                                  ) GROUP BY MANDT, LIFNR, TEMNO, PERKEY 
                           ) GROUP BY MANDT, LIFNR, TEMNO
                        )
                        </isNotNull>
          ) GROUP BY MANDT, PAPRYYYYMM,  LIFNR, TEMNO
        ) GROUP BY MANDT, LIFNR, TEMNO
      )
     )   --안전경고(사고) END 4  --여기까지
     UNION ALL  --안전점검 START 6
     (
      SELECT MANDT, LIFNR, TEMNO
           , 0 AS QC_RT           --QC합격률
           , 0 AS QC_POINT    --   환산점수
           , 0 AS JQPR_CNT
           , 0 AS JQPR_POINT
           , 0 AS AVG_PER_CNT   --평균인원
           , 0 AS AVG_PER_POINT  --인원관리 환산점수
           , 0 AS INP_RT
           , 0 AS INP_POINT
           , 0 AS PER_INST_CNT  --설치실적 인당설치기성대수
           , 0 AS PER_INST_POINT  --설치실적 환산점수
           , 0 AS SAF_ACCT_CNT  --안전경고(사고) 안전사고건수
           , 0 AS SAF_ACCT_POINT  --안전경고(사고) 환산점수
           , IMPTCNT_SUM AS EVAL_IMNO_CNT   --안전점검 중대재해위반
         --  , dec(dec(nullif(EVAL_GRADE_SUM,0)/nullif(CNT_SUM,0),10,1)/10,10,1) AS EVAL_IMNO_POINT -- 환산점수
           , dec(dec(nullif(EVAL_GRADE_SUM,0)/nullif(CNT_SUM,0),10,1)/CAST(REPLACE(#VAR11#, ' ', '') AS DOUBLE),10,1) AS EVAL_IMNO_POINT -- 환산점수
           , 0 AS PER_PER_CNT   --준공관리 인당대수
           , 0 AS PER_PER_POINT --준공관리 환산점수
           , 0 AS MINWON_CNT  --민원건수합계
           , 0 AS MINWON_POINT  --민원관리 환산점수9
       FROM (
             SELECT MANDT, LIFNR, TEMNO
                  , SUM(EVAL_GRADE)   AS EVAL_GRADE_SUM
                  , SUM(CNT)          AS CNT_SUM
                  , SUM(IMPTCNT)      AS IMPTCNT_SUM
               FROM (
                     SELECT MANDT, PAPRYYYYMM, LIFNR, TEMNO
                          , SUM(CHKCNT) AS CNT
                          , SUM(EVAL_IMNO) AS IMPTCNT
                          , SUM(EVAL_GRADE)  AS EVAL_GRADE
                      FROM (
                          SELECT
                               A.MANDT
                             , substr(A.CHKDAT,1,6)  AS PAPRYYYYMM
                             , Left(A.POSID, 6)
                             , A.POSID
                             , M02.LIFNR
                             , M02.TEMNO2 AS TEMNO
                             , SUM(A.EVAL_IMNO) AS EVAL_IMNO 
                             , SUM(A.EVAL_GRADE) AS EVAL_GRADE 
                             , COUNT(*) AS CHKCNT 
                            FROM SAPHEE.ZPSTW1902 AS A                        
                     LEFT OUTER JOIN  SAPHEE.ZMASTER02 M02 ON M02.MANDT = A.MANDT AND M02.POSID = Left(A.POSID, 6)   AND M02.POSID_1 =  A.POSID
                      --  LEFT OUTER JOIN SAPHEE.ZPST0002 AS B ON A.MANDT = B.MANDT AND M02.TEMNO2 = B.TEMNO AND B.DELEF = ''
                  WHERE A.MANDT = #G_MANDT#
                    AND (substr(A.CHKDAT,1,6) BETWEEN #YYYYMMF#  AND #YYYYMMT#) 
                    <isNotNull col="ZTEMNO">
                    AND M02.TEMNO2 = #ZTEMNO#
                    </isNotNull>
                    <isNotNull col="ZZLIFNR">
                    AND M02.LIFNR = #ZZLIFNR#      
                    </isNotNull>  
                    <isEqual col="CHK_GBN" value="10">
                    <isNotNull col="CHK_GBN3">
                    AND  A.ZZGUBUN = #CHK_GBN3#
                    </isNotNull>
                    </isEqual>
                    <isEqual col="CHK_GBN" value="11">
                    <isNotNull col="CHK_GBN3">
                    AND A.ZZGUBUN = #CHK_GBN3# AND SUBSTR(A.POSID,7,1) = 'S'
                    </isNotNull>
                    </isEqual>
                    GROUP BY A.MANDT, substr(A.CHKDAT,1,6), M02.LIFNR, M02.TEMNO2, Left(A.POSID, 6), A.POSID
               ) GROUP BY MANDT, PAPRYYYYMM, LIFNR, TEMNO
            ) GROUP BY MANDT, LIFNR, TEMNO
         )
     )  -- 안전점검 END 6
    UNION ALL  -- 준공관리 START 7
     (
          SELECT 
                MANDT, LIFNR, TEMNO
                     , 0 AS QC_RT           --QC합격률
                     , 0 AS QC_POINT    --   환산점수
                     , 0 AS JQPR_CNT
                     , 0 AS JQPR_POINT
                     , 0 AS AVG_PER_CNT   --평균인원
                     , 0 AS AVG_PER_POINT  --인원관리 환산점수
                     , 0 AS INP_RT
                     , 0 AS INP_POINT
                     , 0 AS PER_INST_CNT  --설치실적 인당설치기성대수
                     , 0 AS PER_INST_POINT  --설치실적 환산점수
                     , 0 AS SAF_ACCT_CNT  --안전경고(사고) 안전사고건수
                     , 0 AS SAF_ACCT_POINT  --안전경고(사고) 환산점수
                     , 0 AS EVAL_IMNO_CNT   -- 중대재해위반
                     , 0 AS EVAL_IMNO_POINT -- 환산점수
                     , PERCNT3_SUM AS PER_PER_CNT    --준공관리 인당대수
                     , SAPHEE.GET_POINTS(#G_MANDT#, '1601007', '2', PERCNT3_SUM) AS PER_PER_POINT -- 준공관리 환산점수
                     , 0 AS MINWON_CNT  --민원건수합계
                     , 0 AS MINWON_POINT  --민원관리 환산점수9
          FROM (
          SELECT MANDT, LIFNR, TEMNO
               , JUNGCNT_SUM
               , PERCNT2_SUM    
               , dec( NULLIF(JUNGCNT_SUM / (dec(NULLIF(PERCNT2_SUM,0) ,10,2)),0),10,2)  AS PERCNT3_SUM  
          FROM (
          SELECT 
                  MANDT, LIFNR, TEMNO
               , SUM(JUNGCNT) AS JUNGCNT_SUM
               , SUM(PERCNT) AS PERCNT2_SUM
          FROM (
                SELECT 
                       PAPRYYYYMM--준공월
                     , MANDT
                     , LIFNR 
                     , TEMNO
                     , SUM(CNT1)  AS JUNGCNT
                     , SUM(CNT)  AS PERCNT
              FROM (
                
                     SELECT 
                          substr(A.ZBOSUOUT,1,6)  AS PAPRYYYYMM
                        , A.MANDT
                        , A.LIFNR 
                        , A.TEMNO2 AS TEMNO
                        , 0 AS CNT 
                        , COUNT(*)  AS CNT1  
                      FROM SAPHEE.ZMASTER02 AS A
                     WHERE A.MANDT = '183' 
                       AND (substr(A.ZBOSUOUT,1,6) BETWEEN #YYYYMMF#  AND #YYYYMMT#) 
                       AND A.TXT04     <![CDATA[ <> ]]>  'C'
                  <isNotNull col="ZTEMNO">
                  AND A.TEMNO2 = #ZTEMNO#
                  </isNotNull>
                  <isNotNull col="ZZLIFNR">
                  AND A.LIFNR = #ZZLIFNR#      
                  </isNotNull>
                  <isNotNull col="ATYPE">
                  AND A.ZSPEC1 = #ATYPE#
                  </isNotNull>          
                  <isNotNull col="SPEC">
                  <isEqual col="SPEC" value="300">
                  AND CAST(REPLACE(A.ZSPEC3, ' ', '0') AS INT) >= 300
                  </isEqual> 
                  <isNotEqual col="SPEC" value="300">
                  <isNotNull col="SPEC2">
                  AND CAST(REPLACE(A.ZSPEC3, ' ', '0') AS INT) BETWEEN #SPEC# AND #SPEC2#
                  </isNotNull> 
                  </isNotEqual> 
                  </isNotNull>  
                  <isNotNull col="CHK_GBN">
                  AND  A.ZZGUBUN = #CHK_GBN#
                  </isNotNull>  
                  GROUP BY substr(A.ZBOSUOUT,1,6), A.MANDT, A.LIFNR, A.TEMNO2
                 <isNotNull col="YYYYMMDD0" >
                   UNION ALL
                   (
                       SELECT  substr(#YYYYMMDD0#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>    #YYYYMMDD0#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID <![CDATA[ <= ]]>  #YYYYMMDD0#  AND RETID    <![CDATA[ <> ]]>  '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                     GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                             )  GROUP BY MANDT, LIFNR, TEMNO
                   )
                   </isNotNull>
                  <isNotNull col="YYYYMMDD1" >
                   UNION ALL
                   (
                       SELECT  substr(#YYYYMMDD1#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD1#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD1#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                        GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                 )  GROUP BY MANDT, LIFNR, TEMNO
                            )
                       </isNotNull>
                       <isNotNull col="YYYYMMDD2" >
                   UNION ALL
                   (
                       SELECT  substr(#YYYYMMDD2#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD2#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD2#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                       GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                 )  GROUP BY MANDT, LIFNR, TEMNO
                            )
                       </isNotNull>
                       <isNotNull col="YYYYMMDD3" >
                   UNION ALL
                   (
                       SELECT  substr(#YYYYMMDD3#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD3#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD3#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                     GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                 )  GROUP BY MANDT, LIFNR, TEMNO
                            )
                       </isNotNull>
                       <isNotNull col="YYYYMMDD4" >
                       UNION ALL
                       (
                       SELECT  substr(#YYYYMMDD4#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD4#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD4#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                     GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                 )  GROUP BY MANDT, LIFNR, TEMNO
                            )
                       </isNotNull>
                       <isNotNull col="YYYYMMDD5" >
                       UNION ALL
                       (
                       SELECT  substr(#YYYYMMDD5#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD5#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD5#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                 )  GROUP BY MANDT, LIFNR, TEMNO
                            )
                       </isNotNull>
                      <isNotNull col="YYYYMMDD6" >
                   UNION ALL
                   (
                       SELECT  substr(#YYYYMMDD6#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD6#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD6#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                        GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                 )  GROUP BY MANDT, LIFNR, TEMNO
                            )
                       </isNotNull>
                      <isNotNull col="YYYYMMDD7" >
                   UNION ALL
                   (
                       SELECT  substr(#YYYYMMDD7#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD7#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD7#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                        GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                 )  GROUP BY MANDT, TEMNO, LIFNR
                            )
                       </isNotNull>
                       <isNotNull col="YYYYMMDD8" >
                   UNION ALL
                   (
                       SELECT  substr(#YYYYMMDD8#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD8#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD8#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                       GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                 )  GROUP BY MANDT, LIFNR, TEMNO
                            )
                       </isNotNull>
                      <isNotNull col="YYYYMMDD9" >
                   UNION ALL
                   (
                       SELECT  substr(#YYYYMMDD9#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD9#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD9#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                 )  GROUP BY MANDT, LIFNR, TEMNO
                            )
                       </isNotNull>
                      <isNotNull col="YYYYMMDD10" >
                   UNION ALL
                   (
                       SELECT  substr(#YYYYMMDD10#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD10#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD10#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                       GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                 )  GROUP BY MANDT, LIFNR, TEMNO
                            )
                       </isNotNull>
                      <isNotNull col="YYYYMMDD11" >
                   UNION ALL
                   (
                       SELECT  substr(#YYYYMMDD11#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR, TEMNO
                             , COUNT(PERKEY) AS CNT, 0 AS CNT1
                         FROM (
                                  SELECT  MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                    FROM SAPHEE.ZPST0001 
                                   WHERE 1=1 
                                     AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD11#
                                     AND GBN = 'A'
                                     AND TYPE = '1'
                                     AND MANDT = #G_MANDT#
                                     <isNotNull col="ZTEMNO">
                                     AND TEMNO = #ZTEMNO# 
                                     </isNotNull>
                                     <isNotNull col="ZZLIFNR">
                                     AND LIFNR = #ZZLIFNR#      
                                     </isNotNull>
                                     <isNotNull col="CHK_GBN2">
                                     AND GUBUN = #CHK_GBN2#
                                     </isNotNull>
                                 GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                   EXCEPT
                                       SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                         FROM SAPHEE.ZPST0001
                                        WHERE 1=1 
                                          AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD11#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                          AND GBN = 'A'
                                          AND TYPE = '1'
                                          AND MANDT = #G_MANDT#
                                          <isNotNull col="ZTEMNO">
                                          AND TEMNO = #ZTEMNO# 
                                          </isNotNull>
                                          <isNotNull col="ZZLIFNR">
                                          AND LIFNR = #ZZLIFNR#      
                                          </isNotNull>
                                          <isNotNull col="CHK_GBN2">
                                          AND GUBUN = #CHK_GBN2#
                                          </isNotNull>
                                      GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY
                                 )  GROUP BY MANDT, LIFNR, TEMNO
                            )
                       </isNotNull>
             ) 
             GROUP BY  MANDT, PAPRYYYYMM, LIFNR, TEMNO
           --  HAVING  SUM(CNT1)   >   0 
             ) GROUP BY  MANDT, LIFNR, TEMNO
           )
         )   
     )  -- 준공관리 END 7
     UNION ALL  --민원관리 START 8
     (
       SELECT  MANDT, LIFNR, TEMNO
           , 0 AS QC_RT           --QC합격률
           , 0 AS QC_POINT    --   환산점수
           , 0 AS JQPR_CNT
           , 0 AS JQPR_POINT
           , 0 AS AVG_PER_CNT   --평균인원
           , 0 AS AVG_PER_POINT  --인원관리 환산점수
           , 0 AS INP_RT
           , 0 AS INP_POINT
           , 0 AS PER_INST_CNT  --설치실적 인당설치기성대수
           , 0 AS PER_INST_POINT  --설치실적 환산점수
           , 0 AS SAF_ACCT_CNT  --안전경고(사고) 안전사고건수
           , 0 AS SAF_ACCT_POINT  --안전경고(사고) 환산점수
           , 0 AS EVAL_IMNO_CNT   -- 중대재해위반
           , 0 AS EVAL_IMNO_POINT -- 환산점수
           , 0 AS PER_PER_CNT   --준공관리 인당대수
           , 0 AS PER_PER_POINT --준공관리 환산점수
           , CNT_SUM  AS MINWON_CNT                        --민원건수합계
         --  , DEC((CNT_SUM * (-1)), 10, 1) AS MINWON_POINT  --환산점수9
           , DEC((CNT_SUM * -(CAST(REPLACE(#VAR12#, ' ', '') AS DOUBLE))), 10, 1) AS MINWON_POINT  --환산점수9
   FROM (      
  SELECT  MANDT, LIFNR, TEMNO
        , SUM(CNT)  AS CNT_SUM  --민원건수합계
    FROM (
      
        SELECT   
           MANDT,
           PAPRYYYYMM,  /*검사일자*/
           LIFNR,   --업체번호
           TEMNO,
            SUM(CNT) AS CNT,  --민원건수
             DEC((SUM(CNT) * (-1)), 10, 1) AS POINT
         FROM   (
                   SELECT  A.RDATE ,
                           A.MANDT, 
                           A.PSPID,  
                           A.SEQNO , 
                           substr(A.RDATE,1,6)  AS PAPRYYYYMM,
                           ROWNUMBER() OVER(PARTITION BY A.PSPID) AS CNT,
                          A.LIFNR,
                          A.TEMNO    --팀장  M02.NAMET2 
                      FROM SAPHEE.ZPSTW1307 AS A
                         INNER JOIN  SAPHEE.ZMASTER01 M01 ON M01.MANDT = A.MANDT AND M01.POSID = A.PSPID
                   --    LEFT OUTER JOIN  SAPHEE.ZMASTER01 M01 ON M01.MANDT = A.MANDT AND M01.POSID = A.PSPID 
                  --  LEFT OUTER JOIN  SAPHEE.ZMASTER02 M02 ON M02.MANDT = A.MANDT AND M02.POSID = Left(A.PSPID, 6)   AND M02.POSID_1 =  A.PSPID
       WHERE A.MANDT = #G_MANDT#
             AND A.STATE <![CDATA[  <> ]]>  'D'                
             AND (substr(A.RDATE,1,6) BETWEEN #YYYYMMF#  AND #YYYYMMT#) 
          <isNotNull col="ZTEMNO">
             AND A.TEMNO = #ZTEMNO#
          </isNotNull>
          <isNotNull col="ZZLIFNR">
              AND A.LIFNR = #ZZLIFNR#      
          </isNotNull>
         <isNotNull col="CHK_GBN2">
              AND M01.PRART = #CHK_GBN2#
          </isNotNull>
             AND A.LIFNR <![CDATA[  <> ]]> ' '
    UNION ALL
                   SELECT  A.RDATE ,
                           A.MANDT, 
                           A.PSPID,  
                           A.SEQNO , 
                           substr(A.RDATE,1,6)  AS PAPRYYYYMM,
                           ROWNUMBER() OVER(PARTITION BY A.PSPID, A.SUPR_DT) AS CNT,
                           A.LIFNR,
                           A.TEMNO    
                FROM SAPHEE.ZPSTW1307B AS A
                   --   LEFT OUTER JOIN  SAPHEE.ZMASTER01 M01 ON M01.MANDT = A.MANDT AND M01.POSID = A.PSPID 
                      INNER JOIN  SAPHEE.ZMASTER01 M01 ON M01.MANDT = A.MANDT AND M01.POSID = A.PSPID
      WHERE A.MANDT = #G_MANDT#
             AND A.STATE <![CDATA[  <> ]]>  'D'                
             AND (substr(A.RDATE,1,6) BETWEEN #YYYYMMF#  AND #YYYYMMT#) 
          <isNotNull col="ZTEMNO">
             AND A.TEMNO = #ZTEMNO#
          </isNotNull>
          <isNotNull col="ZZLIFNR">
              AND A.LIFNR = #ZZLIFNR#      
          </isNotNull>
         <isNotNull col="CHK_GBN2">
              AND M01.PRART = #CHK_GBN2#
          </isNotNull>
             AND A.LIFNR <![CDATA[  <> ]]> ' '
                  )    GROUP BY MANDT, PAPRYYYYMM, LIFNR, TEMNO
             ) GROUP BY MANDT,  LIFNR, TEMNO
       )   
    )  --민원관리 END
) WHERE TEMNO != ''  GROUP BY MANDT, LIFNR, TEMNO
) AS Q
INNER JOIN SAPHEE.ZPST0034 AS C 
        ON Q.MANDT = C.MANDT AND Q.LIFNR = C.LIFNR AND C.GBN = 'A' AND (C.SO = 'X' OR C.SO3 = 'X')
INNER JOIN SAPHEE.ZPST0002 KK
        ON Q.MANDT = KK.MANDT AND Q.LIFNR = KK.LIFNR AND Q.TEMNO = KK.TEMNO AND KK.DELEF = ''
 LEFT OUTER JOIN SAPHEE.ZWBT010 W
              ON Q.MANDT = W.MANDT
             AND Q.LIFNR = W.LIFNR
     INNER JOIN  
     (
     SELECT        
           MANDT
         , DTEXT3 AS TEAM_CD     --팀코드
         , DTEXT4 AS TEAM_NM     --팀명
         , CODE2 AS ZZACTSS_CD   --지사코드
         , CTEXT2 AS ZZACTSS_NM  --지사명
      FROM SAPHEE.ZLCODE N 
       WHERE N.CODE1 = 'PS003' AND N.DTEXT3 <![CDATA[  <> ]]> '' 
         AND N.LANG = 'ko' 
                      --AND N.CODE2 = ZZACTSS
     ) L ON W.MANDT = L.MANDT
        AND W.ZZACTSS = L.ZZACTSS_CD
    INNER JOIN  
     (
     SELECT MANDT, LIFNR, TEMNO, POSIT, NAMET 
       FROM SAPHEE.ZPST0001 
      WHERE MANDT = #G_MANDT# 
      AND POSIT = 'X' AND GBN = 'A' AND TYPE = '1' 
  --   AND RETIF   <![CDATA[  <> ]]>  'X'  
      GROUP BY MANDT, LIFNR, TEMNO, POSIT, NAMET
     ) AS J ON J.MANDT = Q.MANDT
        AND J.LIFNR = Q.LIFNR
        AND J.TEMNO = Q.TEMNO
  WHERE 1=1 
    AND (W.ZZACTSS IS NOT NULL OR W.ZZACTSS != '' )
    AND C.SO5 <![CDATA[<>]]> 'X'
    <isNotNull col="CHK_GBN">
    <isEqual col="CHK_GBN" value="10">
    AND (C.EL_INDC = 'X' OR (C.EL_INDC = 'X' AND C.ES_INDC = 'X')) AND Q.LIFNR  <![CDATA[  <> ]]> '0000008001'
    </isEqual>
    </isNotNull>
    <isNotNull col="CHK_GBN">
    <isEqual col="CHK_GBN" value="11">
    AND (C.ES_INDC = 'X' OR (C.ES_INDC = 'X' AND C.ES_INDC = 'X')) AND Q.LIFNR  <![CDATA[  <> ]]> '0000008001'
    </isEqual>
    </isNotNull>
    <isNotNull col="TEMNO">
    AND W.ZZACTSS IN ( SELECT CODE2 FROM SAPHEE.ZLCODE  WHERE MANDT = Q.MANDT AND CODE1 = 'PS003' AND LANG = 'ko' AND DTEXT3 = #TEMNO# )
    </isNotNull>
    <isNotNull col="ZZACTSS">
    AND W.ZZACTSS = #ZZACTSS#
    </isNotNull>
    <isNotNull col="ZZLIFNR">
        AND C.LIFNR = #ZZLIFNR#      
    </isNotNull>
    <isNotNull col="ZTEMNO">
        AND Q.TEMNO = #ZTEMNO#
     </isNotNull>
     AND (Q.TEMNO IS NOT NULL AND Q.TEMNO != '')
    AND (Q.LIFNR IS NOT NULL AND Q.LIFNR != '')
      <isNotNull col="TEMNO">
            AND W.ZZACTSS IN ( SELECT CODE2 FROM SAPHEE.ZLCODE  WHERE MANDT = Q.MANDT AND CODE1 = 'PS003' AND LANG = 'ko' AND DTEXT3 = #TEMNO# )
       </isNotNull>
       <isNotNull col="ZZACTSS">
           AND W.ZZACTSS = #ZZACTSS#
       </isNotNull>
FOR FETCH ONLY
WITH UR  

    </statement>
    <input default-name="ds_cond">
    </input>

    <output default-name="ds_list1">
    </output>

</query>
