<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
    <type>select</type>
    <description><![CDATA[PS1601003A_S3]]></description>
    <reload>true</reload>
    <monitoring>true</monitoring>
    <result-count>1</result-count>
    <statement>

SELECT PAPRYYYYMM, LIFNR, TEMNO, NAMET2, LIFNRNM, TEMNM, ZZACTSS 
     , CNT1
     , CNT2   --경력년수
     , CNT3   --경력월수
     , POINT  --환산점수
     , CNT1_SUM
     , DIFF_MON
     , CNT1_AVG
     , CNT2_SUM  --환산점수집계
     , CNT2_SUM2 --경력년수집계
     , CNT3_SUM2 --경력월수집계
     , DENSE_RANK() OVER(ORDER BY  CNT2_SUM  desc) AS RANKING
 FROM(
   SELECT PAPRYYYYMM, LIFNR, TEMNO,  NAMET2,  LIFNRNM,  TEMNM,  ZZACTSS
         , CNT1
         , CNT2   
         , CNT3  
         , POINT
         , CNT1_SUM
         , DIFF_MON
         , CNT1_AVG
         , CASE WHEN CNT2_SUM IS NULL THEN 0 
                WHEN CNT2_SUM   <![CDATA[ < ]]>   0 THEN 0
                WHEN CNT2_SUM   <![CDATA[ > ]]>  10 THEN 10
           ELSE CNT2_SUM END AS CNT2_SUM
         , SUBSTR(CNT1_AVG, 1, LOCATE('.',CNT1_AVG)-1 ) AS CNT2_SUM2
         , SUBSTR(CNT1_AVG, LOCATE('.', CNT1_AVG)+1, LENGTH(CNT1_AVG)-LOCATE('.', CNT1_AVG) )  AS CNT3_SUM2
     FROM ( 
       SELECT PAPRYYYYMM, LIFNR, TEMNO, NAMET2, LIFNRNM, TEMNM, ZZACTSS
         , CNT1
         , CNT2  
         ,  CNT3  
         ,  POINT
         ,  CNT1_SUM
         ,  DIFF_MON
         ,  DEC(CNT1_SUM / DIFF_MON ,10,1 ) AS CNT1_AVG
          , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(CNT1_SUM / DIFF_MON) > 10
                                                             THEN 10
                                                             ELSE TRUNCATE(CNT1_SUM / DIFF_MON)
                                                             END) AS CNT2_SUM
      
       FROM ( 
      SELECT PAPRYYYYMM, LIFNR, TEMNO
         , NAMET2
         , LIFNRNM
         , TEMNM
         , ZZACTSS
         , CNT1
         , CNT2  
         , CNT3 
         , POINT
         , SUM(CNT1) OVER (PARTITION BY LIFNR, TEMNO ORDER BY LIFNR, TEMNO )   AS CNT1_SUM
         , DIFF_MON
     FROM ( 
       SELECT E.PAPRYYYYMM, E.LIFNR, E.TEMNO
            , (SELECT NAMET FROM SAPHEE.ZPST0002 WHERE MANDT = E.MANDT AND TEMNO = E.TEMNO) AS NAMET2
            , (SELECT DISTINCT NN.NAME1 FROM SAPHEE.ZPST0034 NN WHERE NN.MANDT = E.MANDT   AND NN.LIFNR = E.LIFNR  AND NN.GBN = 'A' AND (NN.SO = 'X' OR NN.SO3 = 'X')) AS LIFNRNM
            , (SELECT N.DTEXT4 FROM SAPHEE.ZLCODE N WHERE N.MANDT = E.MANDT AND N.CODE1 = 'PS003' AND N.LANG = 'ko' AND N.CODE2 = W.ZZACTSS) AS TEMNM
            , (SELECT MM028.CTEXT2 FROM SAPHEE.ZLCODE MM028 WHERE MM028.MANDT = E.MANDT AND MM028.CODE1 = 'PS003' AND MM028.LANG = 'ko' AND MM028.CODE2 = W.ZZACTSS) ZZACTSS
            , CASE WHEN SUM(E.CNT1) IS NULL THEN 0 ELSE SUM(E.CNT1) END AS CNT1
            , SUBSTR(SUM(E.CNT1), 1, LOCATE('.', SUM(E.CNT1))-1 ) AS CNT2
            , SUBSTR(SUM(E.CNT1), LOCATE('.', SUM(E.CNT1))+1, LENGTH(SUM(E.CNT1))-LOCATE('.', SUM(E.CNT1)) )  AS CNT3
            , CASE WHEN SUM(E.CNT2) IS NULL THEN 0 ELSE SUM(E.CNT2) END AS POINT
            , CAST(REPLACE(#DIFF_MON#, ' ', '0') AS INT) AS DIFF_MON
        FROM (  
          SELECT MANDT, PAPRYYYYMM,  LIFNR, TEMNO
                    ,  SUM(CNT1) AS CNT1
                    ,  SUM(CNT2) AS CNT2
            FROM ( 
              <isNotNull col="YYYYMMDD0" >
              (
                    SELECT MANDT, substr(#YYYYMMDD0#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                    , DEC(AVG(CAREY), 10,1) AS CNT1
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END
                    
                     ) AS CNT2
                  FROM (
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD0#,1,4)||'-'||substr(#YYYYMMDD0#,5,2)||'-'||substr(#YYYYMMDD0#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER <![CDATA[ <= ]]> #YYYYMMDD0#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD0#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
                  <isNotNull col="YYYYMMDD1" >
                  UNION ALL
                  (
                    SELECT MANDT, substr(#YYYYMMDD1#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                    , DEC(AVG(CAREY), 10,1) AS CNT1
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END ) AS CNT2
                  FROM (
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD1#,1,4)||'-'||substr(#YYYYMMDD1#,5,2)||'-'||substr(#YYYYMMDD1#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD1#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD1#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
                  <isNotNull col="YYYYMMDD2" >
                  UNION ALL
                  (
                     SELECT MANDT, substr(#YYYYMMDD2#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                          , DEC(AVG(CAREY), 10,1) AS CNT1
                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
                   --        ELSE 0
                   --        END AS CNT2
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END ) AS CNT2
                  FROM (
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD2#,1,4)||'-'||substr(#YYYYMMDD2#,5,2)||'-'||substr(#YYYYMMDD2#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12) ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD2#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD2#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
                  <isNotNull col="YYYYMMDD3" >
                  UNION ALL
                  (
                    SELECT MANDT, substr(#YYYYMMDD3#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                    , DEC(AVG(CAREY), 10,1) AS CNT1
                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
                   --        ELSE 0
                   --        END AS CNT2
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END ) AS CNT2
                  FROM (
                      
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD3#,1,4)||'-'||substr(#YYYYMMDD3#,5,2)||'-'||substr(#YYYYMMDD3#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD3#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD3#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
                  <isNotNull col="YYYYMMDD4" >
                  UNION ALL
                  (
                    SELECT MANDT, substr(#YYYYMMDD4#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                    , DEC(AVG(CAREY), 10,1) AS CNT1
                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
                   --        ELSE 0
                   --        END AS CNT2
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END ) AS CNT2
                  FROM (
                      
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD4#,1,4)||'-'||substr(#YYYYMMDD4#,5,2)||'-'||substr(#YYYYMMDD4#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD4#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD4#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
                  <isNotNull col="YYYYMMDD5" >
                  UNION ALL
                  (
                    SELECT MANDT, substr(#YYYYMMDD5#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                    , DEC(AVG(CAREY), 10,1) AS CNT1
                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
                   --        ELSE 0
                   --        END AS CNT2
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END ) AS CNT2
                  FROM (
                      
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD5#,1,4)||'-'||substr(#YYYYMMDD5#,5,2)||'-'||substr(#YYYYMMDD5#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER     <![CDATA[ <= ]]> #YYYYMMDD5#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID <![CDATA[ <= ]]> #YYYYMMDD5# AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
                  <isNotNull col="YYYYMMDD6" >
                  UNION ALL
                  (
                    SELECT MANDT, substr(#YYYYMMDD6#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                         , DEC(AVG(CAREY), 10,1) AS CNT1
                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
                   --        ELSE 0
                   --        END AS CNT2
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END ) AS CNT2
                  FROM (
                      
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD6#,1,4)||'-'||substr(#YYYYMMDD6#,5,2)||'-'||substr(#YYYYMMDD6#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12) ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD6#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD6#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
                 <isNotNull col="YYYYMMDD7" >
                  UNION ALL
                  (
                    SELECT MANDT, substr(#YYYYMMDD7#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                    , DEC(AVG(CAREY), 10,1) AS CNT1
                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
                   --        ELSE 0
                   --        END AS CNT2
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END ) AS CNT2
                  FROM (
                      
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD7#,1,4)||'-'||substr(#YYYYMMDD7#,5,2)||'-'||substr(#YYYYMMDD7#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD7#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD7#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
                 <isNotNull col="YYYYMMDD8" >
                  UNION ALL
                  (
                    SELECT MANDT, substr(#YYYYMMDD8#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                    , DEC(AVG(CAREY), 10,1) AS CNT1
                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
                   --        ELSE 0
                   --        END AS CNT2
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END ) AS CNT2
                  FROM (
                      
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD8#,1,4)||'-'||substr(#YYYYMMDD8#,5,2)||'-'||substr(#YYYYMMDD8#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD8#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD8#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
                 <isNotNull col="YYYYMMDD9" >
                  UNION ALL
                  (
                    SELECT MANDT, substr(#YYYYMMDD9#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                    , DEC(AVG(CAREY), 10,1) AS CNT1
                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
                   --        ELSE 0
                   --        END AS CNT2
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END ) AS CNT2
                  FROM (
                     
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD9#,1,4)||'-'||substr(#YYYYMMDD9#,5,2)||'-'||substr(#YYYYMMDD9#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12) ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD9#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD9#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE 
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
                 <isNotNull col="YYYYMMDD10" >
                  UNION ALL
                  (
                    SELECT MANDT, substr(#YYYYMMDD10#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                    , DEC(AVG(CAREY), 10,1) AS CNT1
                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
                   --        ELSE 0
                   --        END AS CNT2
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END ) AS CNT2
                  FROM (
                      
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD10#,1,4)||'-'||substr(#YYYYMMDD10#,5,2)||'-'||substr(#YYYYMMDD10#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD10#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD10#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE 
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
                  <isNotNull col="YYYYMMDD11" >
                  UNION ALL
                  (
                    SELECT MANDT, substr(#YYYYMMDD11#,1,6) AS PAPRYYYYMM,  LIFNR, TEMNO
                    , DEC(AVG(CAREY), 10,1) AS CNT1
                   -- , CASE WHEN TRUNCATE(AVG(CAREY)) = 0 THEN 0
                   --        WHEN TRUNCATE(AVG(CAREY)) = 1 THEN 1
                   --        WHEN TRUNCATE(AVG(CAREY)) = 2 THEN 2
                   --        WHEN TRUNCATE(AVG(CAREY)) = 3 THEN 3 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 4 THEN 4 
                   --        WHEN TRUNCATE(AVG(CAREY)) = 5 THEN 5
                   --        WHEN TRUNCATE(AVG(CAREY)) = 6 THEN 6
                   --        WHEN TRUNCATE(AVG(CAREY)) = 7 THEN 7
                   --        WHEN TRUNCATE(AVG(CAREY)) = 8 THEN 8
                   --        WHEN TRUNCATE(AVG(CAREY)) = 9 THEN 9
                   --        WHEN AVG(CAREY) <![CDATA[ >= ]]> 10 THEN 10
                   --        ELSE 0
                   --        END AS CNT2
                    , SAPHEE.GET_POINTS(#G_MANDT#, '1601003','2', CASE WHEN TRUNCATE(AVG(CAREY)) > 10
                                                                       THEN 10
                                                                       ELSE TRUNCATE(AVG(CAREY))
                                                                       END ) AS CNT2
                  FROM (
                      
                     SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY
                  ,  DEC( (MONTHS_BETWEEN (DATE(substr(#YYYYMMDD11#,1,4)||'-'||substr(#YYYYMMDD11#,5,2)||'-'||substr(#YYYYMMDD11#,7,2)), DATE(LEFT(CDATE,4)||'-'||substr(CDATE,5,2)||'-'||substr(CDATE,7,2))) /12)  ,10,1) AS CAREY
                     FROM( 
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                        FROM SAPHEE.ZPST0001
                       WHERE 1=1 
                         AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD11#
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>   
                    GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                 EXCEPT
                      SELECT MANDT, LIFNR, TEMNO, PERNO, PERKEY,CDATE
                        FROM SAPHEE.ZPST0001  
                       WHERE 1=1 
                         AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD11#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                         AND GBN = 'A'
                         AND TYPE = '1'
                         AND MANDT = #G_MANDT#
                         <isNotNull col="ZTEMNO">
                         AND TEMNO = #ZTEMNO# 
                         </isNotNull>
                         <isNotNull col="ZZLIFNR">
                         AND LIFNR = #ZZLIFNR#      
                         </isNotNull>
                         <isNotNull col="CHK_GBN2">
                         AND GUBUN = #CHK_GBN2#
                         </isNotNull>
                   ) GROUP BY MANDT, LIFNR, TEMNO, PERNO, PERKEY, CDATE
                     ) GROUP BY MANDT, LIFNR, TEMNO
                  )
                  </isNotNull>
             ) GROUP BY MANDT, PAPRYYYYMM,  LIFNR, TEMNO
        ) AS E
        INNER JOIN SAPHEE.ZPST0034 AS C 
                ON E.MANDT = C.MANDT AND E.LIFNR = C.LIFNR AND C.GBN = 'A' AND (C.SO = 'X' OR C.SO3 = 'X')
        LEFT OUTER JOIN SAPHEE.ZWBT010 W
              ON E.MANDT = W.MANDT
             AND E.LIFNR = W.LIFNR
        INNER JOIN SAPHEE.ZPST0002 KK
                ON E.MANDT = KK.MANDT AND E.LIFNR = KK.LIFNR AND E.TEMNO = KK.TEMNO AND KK.DELEF = ''
    WHERE E.MANDT = #G_MANDT#
       AND (W.ZZACTSS IS NOT NULL OR W.ZZACTSS != '' OR W.ZZACTSS != ' ')
       AND (E.TEMNO IS NOT NULL AND E.TEMNO != '' AND E.TEMNO != ' ')
       AND C.SO5 <![CDATA[<>]]> 'X'
       <isNotNull col="CHK_GBN">
       <isEqual col="CHK_GBN" value="10">
       AND (C.EL_INDC = 'X' OR (C.EL_INDC = 'X' AND C.ES_INDC = 'X')) AND E.LIFNR  <![CDATA[  <> ]]> '0000008001'
       </isEqual>
       </isNotNull>
       <isNotNull col="CHK_GBN"> 
       <isEqual col="CHK_GBN" value="11">
       AND (C.ES_INDC = 'X' OR (C.ES_INDC = 'X' AND C.ES_INDC = 'X')) AND E.LIFNR  <![CDATA[  <> ]]> '0000008001'
       </isEqual>
       </isNotNull>
       <isNotNull col="TEMNO">
            AND W.ZZACTSS IN ( SELECT CODE2 FROM SAPHEE.ZLCODE  WHERE MANDT = E.MANDT AND CODE1 = 'PS003' AND LANG = 'ko' AND DTEXT3 = #TEMNO# )
       </isNotNull>
       <isNotNull col="ZZACTSS">
           AND W.ZZACTSS = #ZZACTSS#
       </isNotNull>
       -- AND W.ZZACTSS = '07'
       GROUP BY E.MANDT, E.PAPRYYYYMM, W.ZZACTSS,  E.LIFNR, E.TEMNO
      -- HAVING SUM(E.CNT)    >    0 AND SUM(E.CNT2)   >    0
      -- HAVING  SUM(E.CNT2)   >    0
   )
   )
   )
   )
FOR FETCH ONLY
WITH UR </statement>
    <input default-name="ds_cond">
    </input>

    <output default-name="ds_list2">
        
    </output>

</query>


