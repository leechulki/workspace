<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
    <type>select</type>
    <description><![CDATA[PS1601007A_S2]]></description>
    <reload>true</reload>
    <monitoring>true</monitoring>
    <result-count>1</result-count>
    <statement>

SELECT 
       PAPRYYYYMM--준공월
     , MANDT
     , TEMNM
     , ZZACTSS
     , LIFNR
     , LIFNRNM
     , JUNGCNT  --준공대수
     , CNT AS PERCNT2  --월말보유인원
     , PERCNT AS PERCNT3  --인당대수
     , POINTAVG           --환산점수
     , JUNGCNT_SUM       --준공대수누계
     , CNT_SUM        --월말보유인원누계
     , PERCNT3_SUM    --평균인당대수
     , POINTAVG_SUM    --평균환산점수
     , DENSE_RANK() OVER(ORDER BY CASE WHEN POINTAVG_SUM IS NULL THEN 0 ELSE POINTAVG_SUM END desc) AS RANKING --순위
FROM (
    SELECT PAPRYYYYMM--준공월
         , MANDT
         , TEMNM
         , ZZACTSS
         , LIFNR
         , LIFNRNM
         , JUNGCNT
         , CNT
         , PERCNT
         , POINTAVG
         , JUNGCNT_SUM
         , CNT_SUM
         , PERCNT3_SUM  
        -- , CASE WHEN PERCNT3_SUM  <![CDATA[ >= ]]> 1.00  THEN 10 
        --        WHEN PERCNT3_SUM <![CDATA[>=]]> 0.90 AND PERCNT3_SUM  <![CDATA[<]]> 1.00 THEN 9
        --        WHEN PERCNT3_SUM <![CDATA[>=]]> 0.80 AND PERCNT3_SUM  <![CDATA[<]]> 0.90 THEN 8 
        --        WHEN PERCNT3_SUM <![CDATA[>=]]> 0.70 AND PERCNT3_SUM  <![CDATA[<]]> 0.80 THEN 7 
        --        WHEN PERCNT3_SUM <![CDATA[>=]]> 0.60 AND PERCNT3_SUM  <![CDATA[<]]> 0.70 THEN 6 
        --        WHEN PERCNT3_SUM <![CDATA[>=]]> 0.50 AND PERCNT3_SUM  <![CDATA[<]]> 0.60 THEN 5 
        --        WHEN PERCNT3_SUM <![CDATA[>=]]> 0.40 AND PERCNT3_SUM  <![CDATA[<]]> 0.50 THEN 4 
        --        WHEN PERCNT3_SUM <![CDATA[>=]]> 0.30 AND PERCNT3_SUM  <![CDATA[<]]> 0.40 THEN 3
        --        WHEN PERCNT3_SUM <![CDATA[>=]]> 0.20 AND PERCNT3_SUM  <![CDATA[<]]> 0.30 THEN 2
        --        WHEN PERCNT3_SUM  <![CDATA[ < ]]>   0.20 THEN 1
        --        ELSE 0
        --   END POINTAVG_SUM     
         , SAPHEE.GET_POINTS(#G_MANDT#, '1601007', '1' ,PERCNT3_SUM) AS POINTAVG_SUM
     FROM (
         SELECT PAPRYYYYMM--준공월
              , MANDT
              , TEMNM
              , ZZACTSS
              , LIFNR
              , LIFNRNM
              , JUNGCNT
              , CNT
              , PERCNT
              , POINTAVG
              , JUNGCNT_SUM
              , CNT_SUM
              , dec( NULLIF(JUNGCNT_SUM / (dec(NULLIF(CNT_SUM,0) ,10,2)),0),10,2)  AS PERCNT3_SUM  
           FROM (
               SELECT PAPRYYYYMM--준공월
                    , MANDT
                    , TEMNM
                    , ZZACTSS
                    , LIFNR
                    , LIFNRNM
                    , JUNGCNT
                    , CNT
                    , PERCNT
                    , POINTAVG
                    , SUM(JUNGCNT) OVER (PARTITION BY LIFNR ORDER BY LIFNR )   AS JUNGCNT_SUM
                    , SUM(CNT) OVER (PARTITION BY LIFNR ORDER BY LIFNR )   AS CNT_SUM
                 FROM (
                     SELECT P.PAPRYYYYMM--준공월 
                          , P.MANDT
                          , TEAM_NM AS TEMNM
                          , ZZACTSS_NM AS ZZACTSS
                          , P.LIFNR
                          , (SELECT DISTINCT NN.NAME1 FROM SAPHEE.ZPST0034 NN WHERE NN.MANDT = P.MANDT AND NN.LIFNR = P.LIFNR  AND NN.GBN = 'A') AS LIFNRNM
                          ,  P.JUNGCNT
                          ,  P.CNT 
                          , P.PERCNT  
                         -- , CASE WHEN P.PERCNT  <![CDATA[ >= ]]> 1.00 THEN 10 
                         --        WHEN P.PERCNT <![CDATA[>=]]> 0.90 AND P.PERCNT <![CDATA[<]]> 1.00 THEN 9
                         --        WHEN P.PERCNT <![CDATA[>=]]> 0.80 AND P.PERCNT <![CDATA[<]]> 0.90 THEN 8 
                         --        WHEN P.PERCNT <![CDATA[>=]]> 0.70 AND P.PERCNT <![CDATA[<]]> 0.80 THEN 7 
                         --        WHEN P.PERCNT <![CDATA[>=]]> 0.60 AND P.PERCNT <![CDATA[<]]> 0.70 THEN 6 
                         --        WHEN P.PERCNT <![CDATA[>=]]> 0.50 AND P.PERCNT <![CDATA[<]]> 0.60 THEN 5 
                         --        WHEN P.PERCNT <![CDATA[>=]]> 0.40 AND P.PERCNT <![CDATA[<]]> 0.50 THEN 4 
                         --        WHEN P.PERCNT <![CDATA[>=]]> 0.30 AND P.PERCNT <![CDATA[<]]> 0.40 THEN 3
                         --        WHEN P.PERCNT <![CDATA[>=]]> 0.20 AND P.PERCNT <![CDATA[<]]> 0.30 THEN 2
                         --        WHEN P.PERCNT  <![CDATA[ < ]]> 0.20 THEN 1
                         --        ELSE 0
                         --    END POINTAVG
                          , SAPHEE.GET_POINTS(#G_MANDT#, '1601007', '1' , P.PERCNT) AS POINTAVG
                      FROM (
                          SELECT PAPRYYYYMM--준공월
                               , MANDT
                               , LIFNR 
                               , SUM(CNT1)  AS JUNGCNT
                               , SUM(CNT)  AS CNT
                               , dec( NULLIF(SUM(CNT1) / (dec(NULLIF(SUM(CNT),0) ,10,2)),0),10,2)  AS PERCNT  
                            FROM (
                                 SELECT substr(A.ZBOSUOUT,1,6)  AS PAPRYYYYMM--준공월
                                      , A.MANDT
                                      , A.LIFNR 
                                      , 0 AS CNT  --보유인원
                                      , COUNT(*)  AS CNT1  -- 준공대수 
                                  FROM SAPHEE.ZMASTER02 AS A
                                 WHERE A.MANDT = #G_MANDT# 
                                   AND (substr(A.ZBOSUOUT,1,6) BETWEEN #YYYYMMF#  AND #YYYYMMT#) 
                            --  AND A.ZZACTSS     <![CDATA[ >= ]]>  '01'  AND A.ZZACTSS  <![CDATA[ <= ]]>     '21'
                            --  AND A.ZZGUBUN IN ('10', '11', '12', '13', '14', '20')
                            --  AND A.PRART   IN ('01','02', '11')  --승강기(01)/주차기(02)/교체공사(11)
                            --  AND A.ZZCOMP2 >= '20190731' --준공예정일
                            --  AND A.ZZCOMP2 >= '20080901'
                              AND A.TXT04     <![CDATA[ <> ]]>  'C'
                              --   AND A.LIFNR = '2168114582'
                              <isNotNull col="ZTEMNO">
                              AND A.TEMNO2 = #ZTEMNO#
                              </isNotNull>
                              <isNotNull col="ZZLIFNR">
                              AND A.LIFNR = #ZZLIFNR#      
                              </isNotNull>
                              <isNotNull col="ATYPE">
                              AND A.ZSPEC1 = #ATYPE#
                              </isNotNull>          
                              <isNotNull col="SPEC">
                              <isEqual col="SPEC" value="300">
                              AND CAST(REPLACE(A.ZSPEC3, ' ', '0') AS INT) >= 300
                              </isEqual> 
                              <isNotEqual col="SPEC" value="300">
                              <isNotNull col="SPEC2">
                              AND CAST(REPLACE(A.ZSPEC3, ' ', '0') AS INT) BETWEEN #SPEC# AND #SPEC2#
                              </isNotNull> 
                              </isNotEqual> 
                              </isNotNull>  
                              <isNotNull col="CHK_GBN">
                              AND  A.ZZGUBUN = #CHK_GBN#
                              </isNotNull>  
                              GROUP BY substr(A.ZBOSUOUT,1,6), A.MANDT, A.LIFNR
                             <isNotNull col="YYYYMMDD0" >
                               UNION ALL
                               (
                                   SELECT  substr(#YYYYMMDD0#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>    #YYYYMMDD0#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID <![CDATA[ <= ]]>  #YYYYMMDD0#  AND RETID    <![CDATA[ <> ]]>  '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                         )  GROUP BY MANDT, LIFNR
                               )
                               </isNotNull>
                              <isNotNull col="YYYYMMDD1" >
                               UNION ALL
                               (
                                   SELECT  substr(#YYYYMMDD1#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD1#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD1#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                             )  GROUP BY MANDT, LIFNR
                                        )
                                   </isNotNull>
                                   <isNotNull col="YYYYMMDD2" >
                               UNION ALL
                               (
                                   SELECT  substr(#YYYYMMDD2#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD2#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD2#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                             )  GROUP BY MANDT, LIFNR
                                        )
                                   </isNotNull>
                                   <isNotNull col="YYYYMMDD3" >
                               UNION ALL
                               (
                                   SELECT  substr(#YYYYMMDD3#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD3#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD3#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                             )  GROUP BY MANDT, LIFNR
                                        )
                                   </isNotNull>
                                   <isNotNull col="YYYYMMDD4" >
                                   UNION ALL
                                   (
                                   SELECT  substr(#YYYYMMDD4#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD4#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD4#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                             )  GROUP BY MANDT, LIFNR
                                        )
                                   </isNotNull>
                                   <isNotNull col="YYYYMMDD5" >
                                   UNION ALL
                                   (
                                   SELECT  substr(#YYYYMMDD5#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD5#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD5#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                             )  GROUP BY MANDT, LIFNR
                                        )
                                   </isNotNull>
                                  <isNotNull col="YYYYMMDD6" >
                               UNION ALL
                               (
                                   SELECT  substr(#YYYYMMDD6#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD6#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD6#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                             )  GROUP BY MANDT, LIFNR
                                        )
                                   </isNotNull>
                                  <isNotNull col="YYYYMMDD7" >
                               UNION ALL
                               (
                                   SELECT  substr(#YYYYMMDD7#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD7#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD7#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                             )  GROUP BY MANDT, LIFNR
                                        )
                                   </isNotNull>
                                   <isNotNull col="YYYYMMDD8" >
                               UNION ALL
                               (
                                   SELECT  substr(#YYYYMMDD8#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD8#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD8#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                             )  GROUP BY MANDT, LIFNR
                                        )
                                   </isNotNull>
                                  <isNotNull col="YYYYMMDD9" >
                               UNION ALL
                               (
                                   SELECT  substr(#YYYYMMDD9#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD9#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD9#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                             )  GROUP BY MANDT, LIFNR
                                        )
                                   </isNotNull>
                                  <isNotNull col="YYYYMMDD10" >
                               UNION ALL
                               (
                                   SELECT  substr(#YYYYMMDD10#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD10#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD10#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                             )  GROUP BY MANDT, LIFNR
                                        )
                                   </isNotNull>
                                  <isNotNull col="YYYYMMDD11" >
                               UNION ALL
                               (
                                   SELECT  substr(#YYYYMMDD11#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT1
                                     FROM (
                                              SELECT  MANDT, LIFNR, PERNO, PERKEY
                                                FROM SAPHEE.ZPST0001 
                                               WHERE 1=1 
                                                 AND ENTER     <![CDATA[ <= ]]>     #YYYYMMDD11#
                                                 AND GBN = 'A'
                                                 AND TYPE = '1'
                                                 AND MANDT = #G_MANDT#
                                                 <isNotNull col="ZTEMNO">
                                                 AND TEMNO = #ZTEMNO# 
                                                 </isNotNull>
                                                 <isNotNull col="ZZLIFNR">
                                                 AND LIFNR = #ZZLIFNR#      
                                                 </isNotNull>
                                                 <isNotNull col="CHK_GBN2">
                                                 AND GUBUN = #CHK_GBN2#
                                                 </isNotNull>
                                             GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                               EXCEPT
                                                   SELECT MANDT, LIFNR, PERNO, PERKEY
                                                     FROM SAPHEE.ZPST0001
                                                    WHERE 1=1 
                                                      AND (RETID    <![CDATA[ <= ]]>    #YYYYMMDD11#  AND RETID   <![CDATA[ <> ]]>   '00000000' AND RETID   <![CDATA[ <> ]]>   '')
                                                      AND GBN = 'A'
                                                      AND TYPE = '1'
                                                      AND MANDT = #G_MANDT#
                                                      <isNotNull col="ZTEMNO">
                                                      AND TEMNO = #ZTEMNO# 
                                                      </isNotNull>
                                                      <isNotNull col="ZZLIFNR">
                                                      AND LIFNR = #ZZLIFNR#      
                                                      </isNotNull>
                                                      <isNotNull col="CHK_GBN2">
                                                      AND GUBUN = #CHK_GBN2#
                                                      </isNotNull>
                                             )  GROUP BY MANDT, LIFNR
                                        )
                                   </isNotNull>
                                  ) GROUP BY  MANDT , PAPRYYYYMM, LIFNR 
                                     -- HAVING  SUM(CNT1) <![CDATA[ > ]]> 0
                            )  AS P  
                            INNER JOIN SAPHEE.ZPST0034 AS C 
                            ON P.MANDT = C.MANDT AND P.LIFNR = C.LIFNR AND C.GBN = 'A' AND (C.SO = 'X' OR C.SO3 = 'X')
                            LEFT OUTER JOIN SAPHEE.ZWBT010  AS W
                            ON P.MANDT = W.MANDT AND P.LIFNR = W.LIFNR
                            INNER JOIN  
                            (
                                SELECT MANDT
                                     , DTEXT3 AS TEAM_CD
                                     , DTEXT4 AS TEAM_NM
                                     , CODE2 AS ZZACTSS_CD   
                                     , CTEXT2 AS ZZACTSS_NM  
                                  FROM SAPHEE.ZLCODE N 
                                 WHERE N.CODE1 = 'PS003' AND N.DTEXT3 <![CDATA[ <> ]]> '' 
                                   AND N.LANG = 'ko' 
                            ) L ON W.MANDT = L.MANDT
                               AND W.ZZACTSS = L.ZZACTSS_CD
                        WHERE W.MANDT = #G_MANDT# 
                          AND (W.ZZACTSS IS NOT NULL OR W.ZZACTSS != '' )
                          AND C.SO5 <![CDATA[<>]]> 'X'
                          <isNotNull col="CHK_GBN">
                          <isEqual col="CHK_GBN" value="10">
                          AND (C.EL_INDC = 'X' OR (C.EL_INDC = 'X' AND C.ES_INDC = 'X')) AND P.LIFNR  <![CDATA[  <> ]]> '0000008001'
                          </isEqual>
                          </isNotNull>
                          <isNotNull col="CHK_GBN">
                          <isEqual col="CHK_GBN" value="11">
                          AND (C.ES_INDC = 'X' OR (C.ES_INDC = 'X' AND C.ES_INDC = 'X')) AND P.LIFNR  <![CDATA[  <> ]]> '0000008001'
                          </isEqual>
                          </isNotNull>
                          <isNotNull col="TEMNO">
                          AND W.ZZACTSS IN ( SELECT CODE2 FROM SAPHEE.ZLCODE  WHERE MANDT = P.MANDT AND CODE1 = 'PS003' AND LANG = 'ko' AND DTEXT3 = #TEMNO# )
                          </isNotNull>
                          <isNotNull col="ZZACTSS">
                          AND W.ZZACTSS = #ZZACTSS#
                          </isNotNull>
                         --  GROUP BY Q.PAPRYYYYMM, P.MANDT, W.ZZACTSS,  Q.LIFNR
                        --   HAVING  SUM(Q.CNT1) <![CDATA[ > ]]> 0
                     )
               )
         )
    )
FOR FETCH ONLY
WITH UR  </statement>
    <input default-name="ds_cond">
    </input>

    <output default-name="ds_list1">
    </output>

</query>


