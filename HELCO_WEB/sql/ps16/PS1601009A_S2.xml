<?xml version="1.0" encoding="euc-kr"?>
<query dynamic="true">
    <type>select</type>
    <description><![CDATA[PS1601009A_S3]]></description>
    <reload>true</reload>
    <monitoring>true</monitoring>
    <result-count>1</result-count>
    <statement>

WITH TEMP AS (
    SELECT substr(HOLIDAY_YMD,1,6) AS HOLIDAY_YMD
         , INTEGER(RIGHT(LAST_DAY( CAST(LEFT(substr(HOLIDAY_YMD,1,6),4)||'-'||substr(substr(HOLIDAY_YMD,1,6),5,2)||'-'||'01' AS DATE)),2) ) - COUNT(*) AS CNT
      FROM DB2WEB.TB_HOLIDAY
  GROUP BY  substr(HOLIDAY_YMD,1,6)
)
SELECT PAPRYYYYMM, MANDT, TEMNM, ZZACTSS, LIFNR, LIFNRNM
     , CASE WHEN CNT IS NULL THEN 0.0 ELSE CNT END AS CNT  --보유인원
     , CASE WHEN CNT21 IS NULL THEN 0.0 ELSE CNT21 END AS CNT21  --투입인원
     , INP_RT       --투입률
     , DEC(INP_POINT, 10,1) AS INP_POINT  --환산점수
     , CNT2_SUM  --투입인원누계
     , CNT_SUM   --보유인원누계
     , INP_RT_SUM  --투입률누계
     , DEC(INP_POINT_SUM, 10,1) AS INP_POINT_SUM  --평균투입률
     , DENSE_RANK() OVER(ORDER BY  CASE WHEN DEC(INP_POINT_SUM, 10,1) IS NULL THEN 0 ELSE DEC(INP_POINT_SUM, 10,1) END  desc) AS RANKING  --순위
FROM (
    SELECT PAPRYYYYMM, MANDT, TEMNM, ZZACTSS, LIFNR, LIFNRNM
         , CNT   
         , CNT21 
         , INP_RT
         , INP_POINT
         , CNT2_SUM
         , CNT_SUM
         , NULLIF(DEC((dec(CNT2_SUM,10,1)/nullif(dec(CNT_SUM,10,1),0))* 100,10,1),0) AS INP_RT_SUM
         , CASE WHEN (NULLIF(DEC((dec(CNT2_SUM,10,1)/nullif(dec(CNT_SUM,10,1),0))* 100,10,1),0) * CAST(REPLACE(#VAR1#, ' ', '0') AS DOUBLE)) > 10 THEN 10 ELSE (NULLIF(DEC((dec(CNT2_SUM,10,1)/nullif(dec(CNT_SUM,10,1),0))* 100,10,1),0) * CAST(REPLACE(#VAR1#, ' ', '0') AS DOUBLE) ) end AS INP_POINT_SUM
     FROM (
         SELECT PAPRYYYYMM, MANDT, TEMNM, ZZACTSS, LIFNR,  LIFNRNM
              , CNT   
              , CNT21 
              , INP_RT
              , INP_POINT
              , SUM( CNT21 ) OVER (PARTITION BY   LIFNR ORDER BY   LIFNR )   AS CNT2_SUM
              , SUM( CNT ) OVER (PARTITION BY   LIFNR ORDER BY   LIFNR )   AS CNT_SUM
           FROM (
               SELECT Q.PAPRYYYYMM, Q.MANDT  
                    , (SELECT N.DTEXT4 FROM SAPHEE.ZLCODE N WHERE N.MANDT = Q.MANDT AND N.CODE1 = 'PS003' AND N.LANG = 'ko' AND N.CODE2 = W.ZZACTSS) AS TEMNM
                    , (SELECT MM028.CTEXT2 FROM SAPHEE.ZLCODE MM028 WHERE MM028.MANDT = Q.MANDT AND MM028.CODE1 = 'PS003' AND MM028.LANG = 'ko' AND MM028.CODE2 = W.ZZACTSS) ZZACTSS
                    , Q.LIFNR
                    , (SELECT DISTINCT NN.NAME1 FROM SAPHEE.ZPST0034 NN WHERE NN.MANDT = Q.MANDT   AND NN.LIFNR = Q.LIFNR  AND NN.GBN = 'A') AS LIFNRNM
                    , SUM(Q.CNT) AS CNT    
                    , SUM(Q.CNT21) AS CNT21 
                    , NULLIF(DEC((dec(SUM(Q.CNT21),10,1)/nullif(dec(SUM(Q.CNT),10,1),0))* 100,10,1),0) AS INP_RT
                    , CASE WHEN (NULLIF(DEC((dec(SUM(Q.CNT21),10,1)/nullif(dec(SUM(Q.CNT),10,1),0))* 100,10,1),0) * CAST(REPLACE(#VAR1#, ' ', '0') AS DOUBLE) ) > 10 THEN 10 ELSE (NULLIF(DEC((dec(SUM(Q.CNT21),10,1)/nullif(dec(SUM(Q.CNT),10,1),0))* 100,10,1),0) * CAST(REPLACE(#VAR1#, ' ', '0') AS DOUBLE) ) END AS INP_POINT
                 FROM (
                     SELECT PAPRYYYYMM, MANDT, LIFNR
                          , SUM(CNT) AS CNT
                          , SUM(CNT2) AS CNT2
                          , DEC((nullif(SUM(CNT2),0)/nullif((SELECT CNT FROM TEMP WHERE HOLIDAY_YMD = PAPRYYYYMM),0)) / CAST(REPLACE(#VAR2#, ' ', '0') AS DOUBLE) , 10, 1) AS CNT21  
                       FROM (
                            (
                                SELECT substr(a.inp_dt,1,6) AS PAPRYYYYMM
                                     , a.MANDT
                                     , a.LIFNR
                                     , 0 AS CNT
                                     , SUM(c.M_MH)+ SUM(c.A_MH) + SUM(c.N_MH) AS CNT2
                                     , 0 AS CNT3
                                  FROM SAPHEE.zpstw0301 AS a
                       LEFT OUTER JOIN SAPHEE.zpstw0302 AS c
                                    ON a.inp_dt = c.inp_dt
                                   AND a.lifnr = c.lifnr
                                   AND a.perno = c.perno
                       LEFT OUTER JOIN  SAPHEE.ZMASTER02 M02 
                                    ON M02.MANDT = c.MANDT  AND M02.POSID = c.PSPID AND M02.POSID_1 =  c.POSID
                                 WHERE substr(a.inp_dt,1,6) BETWEEN #YYYYMMF# AND #YYYYMMT#
                                   AND ( a.tuip_chka = 'X' OR (a.tuip_chkb = 'X' AND a.sayu = 'H' AND a.sayu = 'J' AND a.sayu = 'F') )     
                                   <isNotNull col="ZTEMNO">
                                      AND a.tmcd = #ZTEMNO# 
                                  </isNotNull>
                                  <isNotNull col="ZZLIFNR">
                                       AND A.LIFNR = #ZZLIFNR#
                                  </isNotNull>
                                 <isNotNull col="CHK_GBN">
                                    AND M02.ZZGUBUN = #CHK_GBN#
                                  </isNotNull>
                                   --AND c.pspid IS NOT NULL AND c.posid IS NOT NULL
                                GROUP BY substr(a.inp_dt,1,6), A.MANDT, A.LIFNR
                          ) 
                          <isNotNull col="YYYYMMDD0" >
                          UNION ALL
                          (
                                     SELECT  substr(#YYYYMMDD0#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERKEY) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, PERNO, PERKEY
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD0#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                           GROUP BY MANDT, LIFNR, PERNO, PERKEY
                                           EXCEPT
                                            SELECT  MANDT, LIFNR , PERNO, PERKEY
                                            FROM (
                                                 SELECT MANDT, LIFNR, PERNO, PERKEY
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD0#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#
                                                </isNotNull>
                                               <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                                ) GROUP BY MANDT, LIFNR, PERNO, PERKEY 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                             </isNotNull>
                             <isNotNull col="YYYYMMDD1" >
                             UNION ALL
                             (
                                     SELECT  substr(#YYYYMMDD1#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERNO) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, NAME1, PERNO
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD1#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                           GROUP BY MANDT, LIFNR, NAME1, PERNO
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, NAME1 , PERNO
                                            FROM (
                                                 SELECT MANDT, LIFNR, NAME1, PERNO
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                  AND   (RETID  <![CDATA[ <= ]]>  #YYYYMMDD1#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                               <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                                ) GROUP BY MANDT, LIFNR,  NAME1, PERNO 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                             </isNotNull>
                             <isNotNull col="YYYYMMDD2" >
                              UNION ALL
                             (
                                     SELECT  substr(#YYYYMMDD2#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERNO) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, NAME1, PERNO
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD2#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                           GROUP BY MANDT, LIFNR, NAME1, PERNO
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, NAME1 , PERNO
                                            FROM (
                                                 SELECT MANDT, LIFNR, NAME1, PERNO
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD2#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND MANDT = #G_MANDT#
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                ) GROUP BY MANDT, LIFNR,  NAME1, PERNO 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                             </isNotNull>
                            <isNotNull col="YYYYMMDD3" >
                              UNION ALL
                             (
                                    SELECT  substr(#YYYYMMDD3#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERNO) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, NAME1, PERNO
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                             
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD3#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                           GROUP BY MANDT, LIFNR, NAME1, PERNO
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, NAME1 , PERNO
                                            FROM (
                                                 SELECT MANDT, LIFNR, NAME1, PERNO
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                  AND   (RETID  <![CDATA[ <= ]]>  #YYYYMMDD3#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                               <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                                 --   AND LIFNR = '1321110475'
                                                ) GROUP BY MANDT, LIFNR,  NAME1, PERNO 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                             </isNotNull>
                             <isNotNull col="YYYYMMDD4" >
                              UNION ALL
                             (
                                   SELECT  substr(#YYYYMMDD4#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERNO) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, NAME1, PERNO
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                             
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD4#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                         --    AND LIFNR = '1321110475'      
                                           GROUP BY MANDT, LIFNR, NAME1, PERNO
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, NAME1 , PERNO
                                            FROM (
                                                 SELECT MANDT, LIFNR, NAME1, PERNO
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD4#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                               <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                                 --   AND LIFNR = '1321110475'
                                                ) GROUP BY MANDT, LIFNR,  NAME1, PERNO 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                             </isNotNull>
                           <isNotNull col="YYYYMMDD5" >
                              UNION ALL
                             (
                                    SELECT  substr(#YYYYMMDD5#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERNO) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, NAME1, PERNO
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                             
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD5#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                         --    AND LIFNR = '1321110475'      
                                           GROUP BY MANDT, LIFNR, NAME1, PERNO
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, NAME1 , PERNO
                                            FROM (
                                                 SELECT MANDT, LIFNR, NAME1, PERNO
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                  AND   (RETID  <![CDATA[ <= ]]>  #YYYYMMDD5#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                               <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                                 --   AND LIFNR = '1321110475'
                                                ) GROUP BY MANDT, LIFNR,  NAME1, PERNO 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                            </isNotNull>
                            <isNotNull col="YYYYMMDD6" >
                              UNION ALL
                             (
                                    SELECT  substr(#YYYYMMDD6#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERNO) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, NAME1, PERNO
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                             
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD6#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                         --    AND LIFNR = '1321110475'      
                                           GROUP BY MANDT, LIFNR, NAME1, PERNO
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, NAME1 , PERNO
                                            FROM (
                                                 SELECT MANDT, LIFNR, NAME1, PERNO
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                  AND   (RETID  <![CDATA[ <= ]]>  #YYYYMMDD6#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                               <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                                 --   AND LIFNR = '1321110475'
                                                ) GROUP BY MANDT, LIFNR,  NAME1, PERNO 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                             </isNotNull>
                            <isNotNull col="YYYYMMDD7" >
                              UNION ALL
                             (
                                    SELECT  substr(#YYYYMMDD7#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERNO) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, NAME1, PERNO
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                             
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD7#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                         --    AND LIFNR = '1321110475'      
                                           GROUP BY MANDT, LIFNR, NAME1, PERNO
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, NAME1 , PERNO
                                            FROM (
                                                 SELECT MANDT, LIFNR, NAME1, PERNO
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                  AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD7#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                  AND GBN = 'A'
                                                  AND TYPE = '1'
                                                  AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                               <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                                 --   AND LIFNR = '1321110475'
                                                ) GROUP BY MANDT, LIFNR,  NAME1, PERNO 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                             </isNotNull>
                             <isNotNull col="YYYYMMDD8" >
                              UNION ALL
                             (
                                     SELECT  substr(#YYYYMMDD8#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERNO) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, NAME1, PERNO
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD8#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                         --    AND LIFNR = '1321110475'      
                                           GROUP BY MANDT, LIFNR, NAME1, PERNO
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, NAME1 , PERNO
                                            FROM (
                                                 SELECT MANDT, LIFNR, NAME1, PERNO
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                  AND   (RETID  <![CDATA[ <= ]]>  #YYYYMMDD8#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                               <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                                 --   AND LIFNR = '1321110475'
                                             ) GROUP BY MANDT, LIFNR,  NAME1, PERNO 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                             </isNotNull>
                        <isNotNull col="YYYYMMDD9" >
                              UNION ALL
                             (
                                       SELECT  substr(#YYYYMMDD9#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERNO) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, NAME1, PERNO
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                             
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD9#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                         --    AND LIFNR = '1321110475'      
                                           GROUP BY MANDT, LIFNR, NAME1, PERNO
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, NAME1 , PERNO
                                            FROM (
                                                 SELECT MANDT, LIFNR, NAME1, PERNO
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD9#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                               <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                                 --   AND LIFNR = '1321110475'
                                                ) GROUP BY MANDT, LIFNR,  NAME1, PERNO 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                             </isNotNull>
                             <isNotNull col="YYYYMMDD10" >
                              UNION ALL
                             (
                                    SELECT  substr(#YYYYMMDD10#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERNO) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, NAME1, PERNO
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1 
                                             
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD10#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                         --    AND LIFNR = '1321110475'      
                                           GROUP BY MANDT, LIFNR, NAME1, PERNO
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, NAME1 , PERNO
                                            FROM (
                                                 SELECT MANDT, LIFNR, NAME1, PERNO
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                  AND   (RETID  <![CDATA[ <= ]]>  #YYYYMMDD10#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#      
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                                 --   AND LIFNR = '1321110475'
                                                ) GROUP BY MANDT, LIFNR,  NAME1, PERNO 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                             </isNotNull>
                             <isNotNull col="YYYYMMDD11" >
                              UNION ALL
                             (
                                    SELECT  substr(#YYYYMMDD11#,1,6)  AS PAPRYYYYMM, MANDT, LIFNR
                                         , COUNT(PERNO) AS CNT, 0 AS CNT2,0 AS CNT3
                                        FROM (
                                            SELECT  MANDT, LIFNR, NAME1, PERNO
                                             FROM SAPHEE.ZPST0001 
                                                WHERE 1=1
                                                AND ENTER   <![CDATA[ <= ]]>   #YYYYMMDD11#
                                                AND GBN = 'A'
                                                AND TYPE = '1'
                                                AND MANDT = #G_MANDT#
                                                <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO#
                                                </isNotNull>
                                                <isNotNull col="ZZLIFNR">
                                                     AND LIFNR = #ZZLIFNR#
                                                </isNotNull>
                                                <isNotNull col="CHK_GBN2">
                                                AND GUBUN = #CHK_GBN2#
                                                </isNotNull>
                                         --    AND LIFNR = '1321110475'
                                           GROUP BY MANDT, LIFNR, NAME1, PERNO
                                           EXCEPT
                                            SELECT  MANDT, LIFNR, NAME1 , PERNO
                                            FROM (
                                                 SELECT MANDT, LIFNR, NAME1, PERNO
                                                   FROM SAPHEE.ZPST0001
                                                  WHERE 1=1 
                                                    AND (RETID  <![CDATA[ <= ]]>  #YYYYMMDD11#  AND RETID <![CDATA[ <> ]]> '00000000' AND RETID <![CDATA[ <> ]]> '')
                                                    AND GBN = 'A'
                                                    AND TYPE = '1'
                                                    AND MANDT = #G_MANDT#
                                                    <isNotNull col="ZTEMNO">
                                                    AND TEMNO = #ZTEMNO# 
                                                    </isNotNull>
                                                    <isNotNull col="ZZLIFNR">
                                                    AND LIFNR = #ZZLIFNR#      
                                                    </isNotNull>
                                                    <isNotNull col="CHK_GBN2">
                                                    AND GUBUN = #CHK_GBN2#
                                                    </isNotNull>
                                                 --   AND LIFNR = '1321110475'
                                                ) GROUP BY MANDT, LIFNR,  NAME1, PERNO 
                                       )  
                                       GROUP BY MANDT, LIFNR
                            )
                             </isNotNull>
                        
                   ) AS J GROUP BY PAPRYYYYMM, MANDT, LIFNR
               
       ) AS Q  
      INNER JOIN SAPHEE.ZPST0034 AS C 
        ON Q.MANDT = C.MANDT AND Q.LIFNR = C.LIFNR AND C.GBN = 'A' AND (C.SO = 'X' OR C.SO3 = 'X')
      LEFT OUTER JOIN SAPHEE.ZWBT010 W
                  ON Q.MANDT = W.MANDT
                  AND Q.LIFNR = W.LIFNR
     WHERE W.MANDT = #G_MANDT# 
      AND (W.ZZACTSS IS NOT NULL OR W.ZZACTSS != '' OR W.ZZACTSS != ' ')
      AND C.SO5 <![CDATA[<>]]> 'X'
       <isNotNull col="CHK_GBN">
       <isEqual col="CHK_GBN" value="10">
       AND (C.EL_INDC = 'X' OR (C.EL_INDC = 'X' AND C.ES_INDC = 'X')) AND Q.LIFNR  <![CDATA[  <> ]]> '0000008001'
       </isEqual>
       </isNotNull>
       <isNotNull col="CHK_GBN">
       <isEqual col="CHK_GBN" value="11">
       AND (C.ES_INDC = 'X' OR (C.ES_INDC = 'X' AND C.ES_INDC = 'X')) AND Q.LIFNR  <![CDATA[  <> ]]> '0000008001'
       </isEqual>
       </isNotNull>
       <isNotNull col="TEMNO">
            AND W.ZZACTSS IN ( SELECT CODE2 FROM SAPHEE.ZLCODE  WHERE MANDT = Q.MANDT AND CODE1 = 'PS003' AND LANG = 'ko' AND DTEXT3 = #TEMNO# )
       </isNotNull>
       <isNotNull col="ZTEMNO">
         --   AND a.tmcd = #ZTEMNO# 
       </isNotNull>
       <isNotNull col="ZZLIFNR">
            AND Q.LIFNR = #ZZLIFNR#      
       </isNotNull>
       <isNotNull col="ZZACTSS">
           AND W.ZZACTSS = #ZZACTSS#
       </isNotNull>
       <isNotNull col="CHK_GBN">
             --    AND M02.ZZGUBUN = #CHK_GBN#
       </isNotNull>
       GROUP BY Q.PAPRYYYYMM, Q.MANDT, W.ZZACTSS,  Q.LIFNR
  -- HAVING SUM(Q.CNT)  <![CDATA[ > ]]>  0 AND SUM(Q.CNT2) <![CDATA[ > ]]>  0
   --   HAVING  SUM(Q.CNT2) <![CDATA[ > ]]>  0
            )
      )
      )
FOR FETCH ONLY
WITH UR </statement>
   <input default-name="ds_cond">
 
    </input>

    <output default-name="ds_list1">

    </output>

</query>


